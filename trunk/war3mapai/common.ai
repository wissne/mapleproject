native DebugS               takes string str                            returns nothing
native DebugFI              takes string str, integer val               returns nothing
native DebugUnitID          takes string str, integer val               returns nothing
native DisplayText          takes integer p, string str                 returns nothing
native DisplayTextI         takes integer p, string str, integer val    returns nothing
native DisplayTextII        takes integer p, string str, integer v1, integer v2 returns nothing
native DisplayTextIII       takes integer p, string str, integer v1, integer v2, integer v3 returns nothing
native DoAiScriptDebug      takes nothing                               returns boolean

native GetAiPlayer          takes nothing                               returns integer
native GetHeroId            takes nothing                               returns integer
native GetHeroLevelAI       takes nothing                               returns integer

native GetUnitCount         takes integer unitid                        returns integer
native GetPlayerUnitTypeCount takes player p, integer unitid            returns integer
native GetUnitCountDone     takes integer unitid                        returns integer
native GetTownUnitCount     takes integer id, integer tn, boolean dn    returns integer
native GetUnitGoldCost      takes integer unitid                        returns integer
native GetUnitWoodCost      takes integer unitid                        returns integer
native GetUnitBuildTime     takes integer unitid                        returns integer

native GetMinesOwned        takes nothing                               returns integer
native GetGoldOwned         takes nothing                               returns integer
native TownWithMine         takes nothing                               returns integer
native TownHasMine          takes integer townid                        returns boolean
native TownHasHall          takes integer townid                        returns boolean

native GetUpgradeLevel      takes integer id                            returns integer
native GetUpgradeGoldCost   takes integer id                            returns integer
native GetUpgradeWoodCost   takes integer id                            returns integer
native GetNextExpansion     takes nothing                               returns integer
native GetMegaTarget        takes nothing                               returns unit
native GetBuilding          takes player p                              returns unit
native GetEnemyPower        takes nothing                               returns integer
native SetAllianceTarget    takes unit id                               returns nothing
native GetAllianceTarget    takes nothing                               returns unit

native SetProduce           takes integer qty, integer id, integer town returns boolean
native Unsummon             takes unit unitid                           returns nothing
native SetExpansion         takes unit peon, integer id                 returns boolean
native SetUpgrade           takes integer id                            returns boolean
native SetHeroLevels        takes code func                             returns nothing
native SetNewHeroes         takes boolean state                         returns nothing
native PurchaseZeppelin     takes nothing                               returns nothing

native MergeUnits           takes integer qty, integer a, integer b, integer make returns boolean
native ConvertUnits         takes integer qty, integer id               returns boolean

native SetCampaignAI        takes nothing                               returns nothing
native SetMeleeAI           takes nothing                               returns nothing
native SetTargetHeroes      takes boolean state                         returns nothing
native SetPeonsRepair       takes boolean state                         returns nothing
native SetRandomPaths       takes boolean state                         returns nothing
native SetDefendPlayer      takes boolean state                         returns nothing
native SetHeroesFlee        takes boolean state                         returns nothing
native SetHeroesBuyItems    takes boolean state                         returns nothing
native SetWatchMegaTargets  takes boolean state                         returns nothing
native SetIgnoreInjured     takes boolean state                         returns nothing
native SetHeroesTakeItems   takes boolean state                         returns nothing
native SetUnitsFlee         takes boolean state                         returns nothing
native SetGroupsFlee        takes boolean state                         returns nothing
native SetSlowChopping      takes boolean state                         returns nothing
native SetCaptainChanges    takes boolean allow                         returns nothing
native SetSmartArtillery    takes boolean state                         returns nothing
native SetReplacementCount  takes integer qty                           returns nothing
native GroupTimedLife       takes boolean allow                         returns nothing
native RemoveInjuries       takes nothing                               returns nothing
native RemoveSiege          takes nothing                               returns nothing

native InitAssault          takes nothing                               returns nothing
native AddAssault           takes integer qty, integer id               returns boolean
native AddDefenders         takes integer qty, integer id               returns boolean

native GetCreepCamp         takes integer min, integer max, boolean flyers_ok returns unit

native StartGetEnemyBase    takes nothing                               returns nothing
native WaitGetEnemyBase     takes nothing                               returns boolean
native GetEnemyBase         takes nothing                               returns unit
native GetExpansionFoe      takes nothing                               returns unit
native GetEnemyExpansion    takes nothing                               returns unit
native GetExpansionX        takes nothing                               returns integer
native GetExpansionY        takes nothing                               returns integer
native SetStagePoint        takes real x, real y                        returns nothing
native AttackMoveKill       takes unit target                           returns nothing
native AttackMoveXY         takes integer x, integer y                  returns nothing
native LoadZepWave          takes integer x, integer y                  returns nothing
native SuicidePlayer        takes player id, boolean check_full         returns boolean
native SuicidePlayerUnits   takes player id, boolean check_full         returns boolean
native CaptainInCombat      takes boolean attack_captain                returns boolean
native IsTowered            takes unit target                           returns boolean

native ClearHarvestAI       takes nothing                               returns nothing
native HarvestGold          takes integer town, integer peons           returns nothing
native HarvestWood          takes integer town, integer peons           returns nothing
native GetExpansionPeon     takes nothing                               returns unit

native StopGathering        takes nothing                               returns nothing
native AddGuardPost         takes integer id, real x, real y            returns nothing
native FillGuardPosts       takes nothing                               returns nothing
native ReturnGuardPosts     takes nothing                               returns nothing
native CreateCaptains       takes nothing                               returns nothing
native SetCaptainHome       takes integer which, real x, real y         returns nothing
native ResetCaptainLocs     takes nothing                               returns nothing
native ShiftTownSpot        takes real x, real y                        returns nothing
native TeleportCaptain      takes real x, real y                        returns nothing
native ClearCaptainTargets  takes nothing                               returns nothing
native CaptainAttack        takes real x, real y                        returns nothing
native CaptainVsUnits       takes player id                             returns nothing
native CaptainVsPlayer      takes player id                             returns nothing
native CaptainGoHome        takes nothing                               returns nothing
native CaptainIsHome        takes nothing                               returns boolean
native CaptainIsFull        takes nothing                               returns boolean
native CaptainIsEmpty       takes nothing                               returns boolean
native CaptainGroupSize     takes nothing                               returns integer
native CaptainReadiness     takes nothing                               returns integer
native CaptainRetreating    takes nothing                               returns boolean
native CaptainReadinessHP   takes nothing                               returns integer
native CaptainReadinessMa   takes nothing                               returns integer
native CaptainAtGoal        takes nothing                               returns boolean
native CreepsOnMap          takes nothing                               returns boolean
native SuicideUnit          takes integer count, integer unitid         returns nothing
native SuicideUnitEx        takes integer ct, integer uid, integer pid  returns nothing
native StartThread          takes code func                             returns nothing
native Sleep                takes real seconds                          returns nothing
native UnitAlive            takes unit id                               returns boolean
native UnitInvis            takes unit id                               returns boolean
native IgnoredUnits         takes integer unitid                        returns integer
native TownThreatened       takes nothing                               returns boolean
native DisablePathing       takes nothing                               returns nothing
native SetAmphibious        takes nothing                               returns nothing

native CommandsWaiting      takes nothing                               returns integer
native GetLastCommand       takes nothing                               returns integer
native GetLastData          takes nothing                               returns integer
native PopLastCommand       takes nothing                               returns nothing
native MeleeDifficulty      takes nothing                               returns integer
globals

  constant integer ARCHMAGE = 1
  constant integer oARCHMAGE = 'Hamg'
  constant integer PALADIN = 2
  constant integer oPALADIN = 'Hpal'
  constant integer MTN_KING = 3
  constant integer oMTN_KING = 'Hmkg'
  constant integer BLOOD_MAGE = 4
  constant integer oBLOOD_MAGE = 'Hblm'
  constant integer BLADE_MASTER = 5
  constant integer oBLADE_MASTER = 'Obla'
  constant integer FAR_SEER = 6
  constant integer oFAR_SEER = 'Ofar'
  constant integer TAUREN_CHIEF = 7
  constant integer oTAUREN_CHIEF = 'Otch'
  constant integer SHADOW_HUNTER = 8
  constant integer oSHADOW_HUNTER = 'Oshd'
  constant integer DEATH_KNIGHT = 9
  constant integer oDEATH_KNIGHT = 'Udea'
  constant integer DREAD_LORD = 10
  constant integer oDREAD_LORD = 'Udre'
  constant integer LICH = 11
  constant integer oLICH = 'Ulic'
  constant integer CRYPT_LORD = 12
  constant integer oCRYPT_LORD = 'Ucrl'
  constant integer DEMON_HUNTER = 13
  constant integer oDEMON_HUNTER = 'Edem'
  constant integer KEEPER = 14
  constant integer oKEEPER = 'Ekee'
  constant integer MOON_CHICK = 15
  constant integer oMOON_CHICK = 'Emoo'
  constant integer WARDEN = 16
  constant integer oWARDEN = 'Ewar'
  constant integer NEUTRAL_HERO_START = 17
  constant integer oNEUTRAL_HERO_START = 'noid'
  constant integer SEA_WITCH = 18
  constant integer oSEA_WITCH = 'Nngs'
  constant integer BEAST_MASTER = 19
  constant integer oBEAST_MASTER = 'Nbst'
  constant integer DARK_RANGER = 20
  constant integer oDARK_RANGER = 'Nbrn'
  constant integer PIT_LORD = 21
  constant integer oPIT_LORD = 'Nplh'
  constant integer BREW_MASTER = 22
  constant integer oBREW_MASTER = 'Npbm'
  constant integer GOBLIN_THINKER = 23
  constant integer oGOBLIN_THINKER = 'Ntin'
  constant integer GOBLIN_THINKER_M = 24
  constant integer oGOBLIN_THINKER_M = 'Nrob'
  constant integer NEUTRAL_HERO_END = 25
  constant integer oNEUTRAL_HERO_END = 'noid'
  constant integer HERO_END = 26
  constant integer oHERO_END = 'noid'
  constant integer HUMAN_UNITS_START = 27
  constant integer oHUMAN_UNITS_START = 'noid'
  constant integer COPTER = 28
  constant integer oCOPTER = 'hgyr'
  constant integer ELEMENTAL = 29
  constant integer oELEMENTAL = 'hwat'
  constant integer FOOTMAN = 30
  constant integer oFOOTMAN = 'hfoo'
  constant integer GRYPHON = 31
  constant integer oGRYPHON = 'hgry'
  constant integer KNIGHT = 32
  constant integer oKNIGHT = 'hkni'
  constant integer MORTAR = 33
  constant integer oMORTAR = 'hmtm'
  constant integer PEASANT = 34
  constant integer oPEASANT = 'hpea'
  constant integer PRIEST = 35
  constant integer oPRIEST = 'hmpr'
  constant integer RIFLEMAN = 36
  constant integer oRIFLEMAN = 'hrif'
  constant integer SORCERESS = 37
  constant integer oSORCERESS = 'hsor'
  constant integer TANK = 38
  constant integer oTANK = 'hmtt'
  constant integer SPELL_BREAKER = 39
  constant integer oSPELL_BREAKER = 'hspt'
  constant integer HUMAN_DRAGON_HAWK = 40
  constant integer oHUMAN_DRAGON_HAWK = 'hdhw'
  constant integer MILITIA = 41
  constant integer oMILITIA = 'hmil'
  constant integer HUMAN_UNITS_END = 42
  constant integer oHUMAN_UNITS_END = 'noid'
  constant integer HUMAN_BUILDINGS_START = 43
  constant integer oHUMAN_BUILDINGS_START = 'noid'
  constant integer AVIARY = 44
  constant integer oAVIARY = 'hgra'
  constant integer BARRACKS = 45
  constant integer oBARRACKS = 'hbar'
  constant integer BLACKSMITH = 46
  constant integer oBLACKSMITH = 'hbla'
  constant integer CANNON_TOWER = 47
  constant integer oCANNON_TOWER = 'hctw'
  constant integer CASTLE = 48
  constant integer oCASTLE = 'hcas'
  constant integer GUARD_TOWER = 49
  constant integer oGUARD_TOWER = 'hgtw'
  constant integer HOUSE = 50
  constant integer oHOUSE = 'hhou'
  constant integer HUMAN_ALTAR = 51
  constant integer oHUMAN_ALTAR = 'halt'
  constant integer KEEP = 52
  constant integer oKEEP = 'hkee'
  constant integer LUMBER_MILL = 53
  constant integer oLUMBER_MILL = 'hlum'
  constant integer SANCTUM = 54
  constant integer oSANCTUM = 'hars'
  constant integer TOWN_HALL = 55
  constant integer oTOWN_HALL = 'htow'
  constant integer WATCH_TOWER = 56
  constant integer oWATCH_TOWER = 'hwtw'
  constant integer WORKSHOP = 57
  constant integer oWORKSHOP = 'harm'
  constant integer ARCANE_VAULT = 58
  constant integer oARCANE_VAULT = 'hvlt'
  constant integer ARCANE_TOWER = 59
  constant integer oARCANE_TOWER = 'hatw'
  constant integer HUMAN_BUILDINGS_END = 60
  constant integer oHUMAN_BUILDINGS_END = 'noid'
  constant integer HUMAN_UPGRADES_START = 61
  constant integer oHUMAN_UPGRADES_START = 'noid'
  constant integer UPG_SIGHT = 62
  constant integer oUPG_SIGHT = 'Rhss'
  constant integer UPG_DEFEND = 63
  constant integer oUPG_DEFEND = 'Rhde'
  constant integer UPG_BREEDING = 64
  constant integer oUPG_BREEDING = 'Rhan'
  constant integer UPG_GUN_RANGE = 65
  constant integer oUPG_GUN_RANGE = 'Rhri'
  constant integer UPG_SENTINEL = 66
  constant integer oUPG_SENTINEL = 'Rhse'
  constant integer UPG_BOMBS = 67
  constant integer oUPG_BOMBS = 'Rhgb'
  constant integer UPG_HAMMERS = 68
  constant integer oUPG_HAMMERS = 'Rhhb'
  constant integer UPG_FRAGS = 69
  constant integer oUPG_FRAGS = 'Rhfs'
  constant integer UPG_TANK = 70
  constant integer oUPG_TANK = 'Rhrt'
  constant integer UPG_FLAK = 71
  constant integer oUPG_FLAK = 'Rhfc'
  constant integer UPG_CLOUD = 72
  constant integer oUPG_CLOUD = 'Rhcd'
  constant integer UPG_CONT_MAGIC = 73
  constant integer oUPG_CONT_MAGIC = 'Rhss'
  constant integer HUMAN_UPGRADES_END = 74
  constant integer oHUMAN_UPGRADES_END = 'noid'
  constant integer ORC_UNITS_START = 75
  constant integer oORC_UNITS_START = 'noid'
  constant integer CATAPULT = 76
  constant integer oCATAPULT = 'ocat'
  constant integer WITCH_DOCTOR = 77
  constant integer oWITCH_DOCTOR = 'odoc'
  constant integer GRUNT = 78
  constant integer oGRUNT = 'ogru'
  constant integer HEAD_HUNTER = 79
  constant integer oHEAD_HUNTER = 'ohun'
  constant integer KODO_BEAST = 80
  constant integer oKODO_BEAST = 'okod'
  constant integer PEON = 81
  constant integer oPEON = 'opeo'
  constant integer RAIDER = 82
  constant integer oRAIDER = 'orai'
  constant integer SHAMAN = 83
  constant integer oSHAMAN = 'oshm'
  constant integer TAUREN = 84
  constant integer oTAUREN = 'otau'
  constant integer WYVERN = 85
  constant integer oWYVERN = 'owyv'
  constant integer BATRIDER = 86
  constant integer oBATRIDER = 'otbr'
  constant integer SPIRIT_WALKER = 87
  constant integer oSPIRIT_WALKER = 'ospm'
  constant integer SPIRIT_WALKER_M = 88
  constant integer oSPIRIT_WALKER_M = 'ospw'
  constant integer BERSERKER = 89
  constant integer oBERSERKER = 'otbk'
  constant integer ORC_UNITS_END = 90
  constant integer oORC_UNITS_END = 'noid'
  constant integer ORC_BUILDINGS_START = 91
  constant integer oORC_BUILDINGS_START = 'noid'
  constant integer ORC_ALTAR = 92
  constant integer oORC_ALTAR = 'oalt'
  constant integer ORC_BARRACKS = 93
  constant integer oORC_BARRACKS = 'obar'
  constant integer BESTIARY = 94
  constant integer oBESTIARY = 'obea'
  constant integer FORGE = 95
  constant integer oFORGE = 'ofor'
  constant integer FORTRESS = 96
  constant integer oFORTRESS = 'ofrt'
  constant integer GREAT_HALL = 97
  constant integer oGREAT_HALL = 'ogre'
  constant integer LODGE = 98
  constant integer oLODGE = 'osld'
  constant integer STRONGHOLD = 99
  constant integer oSTRONGHOLD = 'ostr'
  constant integer BURROW = 100
  constant integer oBURROW = 'otrb'
  constant integer TOTEM = 101
  constant integer oTOTEM = 'otto'
  constant integer ORC_WATCH_TOWER = 102
  constant integer oORC_WATCH_TOWER = 'owtw'
  constant integer VOODOO_LOUNGE = 103
  constant integer oVOODOO_LOUNGE = 'ovln'
  constant integer ORC_BUILDINGS_END = 104
  constant integer oORC_BUILDINGS_END = 'noid'
  constant integer ORC_UPGRADES_START = 105
  constant integer oORC_UPGRADES_START = 'noid'
  constant integer UPG_ORC_WAR_DRUMS = 106
  constant integer oUPG_ORC_WAR_DRUMS = 'Rwdm'
  constant integer UPG_ORC_PILLAGE = 107
  constant integer oUPG_ORC_PILLAGE = 'Ropg'
  constant integer UPG_ORC_BERSERK = 108
  constant integer oUPG_ORC_BERSERK = 'Robs'
  constant integer UPG_ORC_PULVERIZE = 109
  constant integer oUPG_ORC_PULVERIZE = 'Rows'
  constant integer UPG_ORC_ENSNARE = 110
  constant integer oUPG_ORC_ENSNARE = 'Roen'
  constant integer UPG_ORC_VENOM = 111
  constant integer oUPG_ORC_VENOM = 'Rovs'
  constant integer UPG_ORC_REGEN = 112
  constant integer oUPG_ORC_REGEN = 'Rotr'
  constant integer UPG_ORC_FIRE = 113
  constant integer oUPG_ORC_FIRE = 'Rolf'
  constant integer UPG_ORC_BERSERKER = 114
  constant integer oUPG_ORC_BERSERKER = 'Robk'
  constant integer UPG_ORC_ARTILLERY = 115
  constant integer oUPG_ORC_ARTILLERY = 'Roaa'
  constant integer UPG_ORC_BURROWS = 116
  constant integer oUPG_ORC_BURROWS = 'Rorb'
  constant integer ORC_UPGRADES_END = 117
  constant integer oORC_UPGRADES_END = 'noid'
  constant integer UNDEAD_UNITS_START = 118
  constant integer oUNDEAD_UNITS_START = 'noid'
  constant integer ABOMINATION = 119
  constant integer oABOMINATION = 'uabo'
  constant integer ACOLYTE = 120
  constant integer oACOLYTE = 'uaco'
  constant integer BANSHEE = 121
  constant integer oBANSHEE = 'uban'
  constant integer CRYPT_FIEND = 122
  constant integer oCRYPT_FIEND = 'ucry'
  constant integer FROST_WYRM = 123
  constant integer oFROST_WYRM = 'ufro'
  constant integer GARGOYLE = 124
  constant integer oGARGOYLE = 'ugar'
  constant integer GARGOYLE_MORPH = 125
  constant integer oGARGOYLE_MORPH = 'ugrm'
  constant integer GHOUL = 126
  constant integer oGHOUL = 'ugho'
  constant integer MEAT_WAGON = 127
  constant integer oMEAT_WAGON = 'umtw'
  constant integer NECRO = 128
  constant integer oNECRO = 'unec'
  constant integer SKEL_WARRIOR = 129
  constant integer oSKEL_WARRIOR = 'uske'
  constant integer SHADE = 130
  constant integer oSHADE = 'ushd'
  constant integer OBSIDIAN_STATUE = 131
  constant integer oOBSIDIAN_STATUE = 'uobs'
  constant integer STATUE_FOR_UPGRADE = 132
  constant integer oSTATUE_FOR_UPGRADE = 'uobs'
  constant integer BLK_SPHINX = 133
  constant integer oBLK_SPHINX = 'ubsp'
  constant integer UNDEAD_UNITS_END = 134
  constant integer oUNDEAD_UNITS_END = 'noid'
  constant integer UNDEAD_BUILDINGS_START = 135
  constant integer oUNDEAD_BUILDINGS_START = 'noid'
  constant integer UNDEAD_MINE = 136
  constant integer oUNDEAD_MINE = 'ugol'
  constant integer UNDEAD_ALTAR = 137
  constant integer oUNDEAD_ALTAR = 'uaod'
  constant integer BONEYARD = 138
  constant integer oBONEYARD = 'ubon'
  constant integer NECROPOLIS_1 = 139
  constant integer oNECROPOLIS_1 = 'unpl'
  constant integer NECROPOLIS_2 = 140
  constant integer oNECROPOLIS_2 = 'unp1'
  constant integer NECROPOLIS_3 = 141
  constant integer oNECROPOLIS_3 = 'unp2'
  constant integer SAC_PIT = 142
  constant integer oSAC_PIT = 'usap'
  constant integer CRYPT = 143
  constant integer oCRYPT = 'usep'
  constant integer SLAUGHTERHOUSE = 144
  constant integer oSLAUGHTERHOUSE = 'uslh'
  constant integer DAMNED_TEMPLE = 145
  constant integer oDAMNED_TEMPLE = 'utod'
  constant integer ZIGGURAT_1 = 146
  constant integer oZIGGURAT_1 = 'uzig'
  constant integer ZIGGURAT_2 = 147
  constant integer oZIGGURAT_2 = 'uzg1'
  constant integer ZIGGURAT_FROST = 148
  constant integer oZIGGURAT_FROST = 'uzg2'
  constant integer GRAVEYARD = 149
  constant integer oGRAVEYARD = 'ugrv'
  constant integer TOMB_OF_RELICS = 150
  constant integer oTOMB_OF_RELICS = 'utom'
  constant integer UNDEAD_BUILDINGS_END = 151
  constant integer oUNDEAD_BUILDINGS_END = 'noid'
  constant integer UNDEAD_UPGRADES_START = 152
  constant integer oUNDEAD_UPGRADES_START = 'noid'
  constant integer UPG_CANNIBALIZE = 153
  constant integer oUPG_CANNIBALIZE = 'Ruac'
  constant integer UPG_GHOUL_FRENZY = 154
  constant integer oUPG_GHOUL_FRENZY = 'Rugf'
  constant integer UPG_FIEND_WEB = 155
  constant integer oUPG_FIEND_WEB = 'Ruwb'
  constant integer UPG_STONE_FORM = 156
  constant integer oUPG_STONE_FORM = 'Rusf'
  constant integer UPG_WYRM_BREATH = 157
  constant integer oUPG_WYRM_BREATH = 'Rufb'
  constant integer UPG_SKEL_LIFE = 158
  constant integer oUPG_SKEL_LIFE = 'Rusl'
  constant integer UPG_PLAGUE = 159
  constant integer oUPG_PLAGUE = 'Rupc'
  constant integer UPG_SKEL_MASTERY = 160
  constant integer oUPG_SKEL_MASTERY = 'Rusm'
  constant integer UPG_BLK_SPHINX = 161
  constant integer oUPG_BLK_SPHINX = 'Rusp'
  constant integer UPG_BURROWING = 162
  constant integer oUPG_BURROWING = 'Rubu'
  constant integer UPG_EXHUME = 163
  constant integer oUPG_EXHUME = 'Ruex'
  constant integer UNDEAD_UPGRADES_END = 164
  constant integer oUNDEAD_UPGRADES_END = 'noid'
  constant integer ELF_UNITS_START = 165
  constant integer oELF_UNITS_START = 'noid'
  constant integer WISP = 166
  constant integer oWISP = 'ewsp'
  constant integer ARCHER = 167
  constant integer oARCHER = 'earc'
  constant integer DRUID_TALON = 168
  constant integer oDRUID_TALON = 'edot'
  constant integer DRUID_TALON_M = 169
  constant integer oDRUID_TALON_M = 'edtm'
  constant integer BALLISTA = 170
  constant integer oBALLISTA = 'ebal'
  constant integer DRUID_CLAW = 171
  constant integer oDRUID_CLAW = 'edoc'
  constant integer DRUID_CLAW_M = 172
  constant integer oDRUID_CLAW_M = 'edcm'
  constant integer DRYAD = 173
  constant integer oDRYAD = 'edry'
  constant integer HIPPO = 174
  constant integer oHIPPO = 'ehip'
  constant integer HIPPO_RIDER = 175
  constant integer oHIPPO_RIDER = 'ehpr'
  constant integer HUNTRESS = 176
  constant integer oHUNTRESS = 'esen'
  constant integer CHIMAERA = 177
  constant integer oCHIMAERA = 'echm'
  constant integer MOUNTAIN_GIANT = 178
  constant integer oMOUNTAIN_GIANT = 'emtg'
  constant integer FAERIE_DRAGON = 179
  constant integer oFAERIE_DRAGON = 'efdr'
  constant integer ELF_UNITS_END = 180
  constant integer oELF_UNITS_END = 'noid'
  constant integer ELF_BUILDINGS_START = 181
  constant integer oELF_BUILDINGS_START = 'noid'
  constant integer ANCIENT_LORE = 182
  constant integer oANCIENT_LORE = 'eaoe'
  constant integer ANCIENT_WAR = 183
  constant integer oANCIENT_WAR = 'eaom'
  constant integer ANCIENT_WIND = 184
  constant integer oANCIENT_WIND = 'eaow'
  constant integer TREE_AGES = 185
  constant integer oTREE_AGES = 'etoa'
  constant integer TREE_ETERNITY = 186
  constant integer oTREE_ETERNITY = 'etoe'
  constant integer TREE_LIFE = 187
  constant integer oTREE_LIFE = 'etol'
  constant integer ANCIENT_PROTECT = 188
  constant integer oANCIENT_PROTECT = 'etrp'
  constant integer ELF_ALTAR = 189
  constant integer oELF_ALTAR = 'eate'
  constant integer CHIMAERA_ROOST = 190
  constant integer oCHIMAERA_ROOST = 'edos'
  constant integer HUNTERS_HALL = 191
  constant integer oHUNTERS_HALL = 'edob'
  constant integer MOON_WELL = 192
  constant integer oMOON_WELL = 'emow'
  constant integer ELF_MINE = 193
  constant integer oELF_MINE = 'egol'
  constant integer DEN_OF_WONDERS = 194
  constant integer oDEN_OF_WONDERS = 'eden'
  constant integer ELF_BUILDINGS_END = 195
  constant integer oELF_BUILDINGS_END = 'noid'
  constant integer ELF_UPGRADES_START = 196
  constant integer oELF_UPGRADES_START = 'noid'
  constant integer UPG_ULTRAVISION = 197
  constant integer oUPG_ULTRAVISION = 'Reuv'
  constant integer UPG_BLESSING = 198
  constant integer oUPG_BLESSING = 'Renb'
  constant integer UPG_SCOUT = 199
  constant integer oUPG_SCOUT = 'Resc'
  constant integer UPG_GLAIVE = 200
  constant integer oUPG_GLAIVE = 'Remg'
  constant integer UPG_BOWS = 201
  constant integer oUPG_BOWS = 'Reib'
  constant integer UPG_MARKSMAN = 202
  constant integer oUPG_MARKSMAN = 'Remk'
  constant integer UPG_ABOLISH = 203
  constant integer oUPG_ABOLISH = 'Resi'
  constant integer UPG_CHIM_ACID = 204
  constant integer oUPG_CHIM_ACID = 'Recb'
  constant integer UPG_HIPPO_TAME = 205
  constant integer oUPG_HIPPO_TAME = 'Reht'
  constant integer UPG_BOLT = 206
  constant integer oUPG_BOLT = 'Repd'
  constant integer UPG_MARK_CLAW = 207
  constant integer oUPG_MARK_CLAW = 'Reeb'
  constant integer UPG_MARK_TALON = 208
  constant integer oUPG_MARK_TALON = 'Reec'
  constant integer UPG_HARD_SKIN = 209
  constant integer oUPG_HARD_SKIN = 'Rehs'
  constant integer UPG_RESIST_SKIN = 210
  constant integer oUPG_RESIST_SKIN = 'Rers'
  constant integer UPG_WELL_SPRING = 211
  constant integer oUPG_WELL_SPRING = 'Rews'
  constant integer ELF_UPGRADES_END = 212
  constant integer oELF_UPGRADES_END = 'noid'
  constant integer ML_UPGRADE_START = 213
  constant integer oML_UPGRADE_START = 'noid'
  constant integer UPG_MELEE = 214
  constant integer oUPG_MELEE = 'Rhme'
  constant integer UPG_RANGED = 215
  constant integer oUPG_RANGED = 'Rhra'
  constant integer UPG_ARMOR = 216
  constant integer oUPG_ARMOR = 'Rhar'
  constant integer UPG_LEATHER = 217
  constant integer oUPG_LEATHER = 'Rhla'
  constant integer UPG_MASONRY = 218
  constant integer oUPG_MASONRY = 'Rhac'
  constant integer UPG_WOOD = 219
  constant integer oUPG_WOOD = 'Rhlh'
  constant integer UPG_PRAYING = 220
  constant integer oUPG_PRAYING = 'Rhpt'
  constant integer UPG_SORCERY = 221
  constant integer oUPG_SORCERY = 'Rhst'
  constant integer UPG_ORC_MELEE = 222
  constant integer oUPG_ORC_MELEE = 'Rome'
  constant integer UPG_ORC_RANGED = 223
  constant integer oUPG_ORC_RANGED = 'Rora'
  constant integer UPG_ORC_ARMOR = 224
  constant integer oUPG_ORC_ARMOR = 'Roar'
  constant integer UPG_ORC_SPIKES = 225
  constant integer oUPG_ORC_SPIKES = 'Rosp'
  constant integer UPG_ORC_DOCS = 226
  constant integer oUPG_ORC_DOCS = 'Rowd'
  constant integer UPG_ORC_SHAMAN = 227
  constant integer oUPG_ORC_SHAMAN = 'Rost'
  constant integer UPG_ORC_SWALKER = 228
  constant integer oUPG_ORC_SWALKER = 'Rowt'
  constant integer UPG_UNHOLY_STR = 229
  constant integer oUPG_UNHOLY_STR = 'Rume'
  constant integer UPG_CR_ATTACK = 230
  constant integer oUPG_CR_ATTACK = 'Rura'
  constant integer UPG_UNHOLY_ARMOR = 231
  constant integer oUPG_UNHOLY_ARMOR = 'Ruar'
  constant integer UPG_CR_ARMOR = 232
  constant integer oUPG_CR_ARMOR = 'Rucr'
  constant integer UPG_NECROS = 233
  constant integer oUPG_NECROS = 'Rune'
  constant integer UPG_BANSHEE = 234
  constant integer oUPG_BANSHEE = 'Ruba'
  constant integer UPG_STR_MOON = 235
  constant integer oUPG_STR_MOON = 'Resm'
  constant integer UPG_STR_WILD = 236
  constant integer oUPG_STR_WILD = 'Resw'
  constant integer UPG_MOON_ARMOR = 237
  constant integer oUPG_MOON_ARMOR = 'Rema'
  constant integer UPG_HIDES = 238
  constant integer oUPG_HIDES = 'Rerh'
  constant integer UPG_DRUID_TALON = 239
  constant integer oUPG_DRUID_TALON = 'Redt'
  constant integer UPG_DRUID_CLAW = 240
  constant integer oUPG_DRUID_CLAW = 'Redc'
  constant integer ML_UPGRADE_END = 241
  constant integer oML_UPGRADE_END = 'noid'
  constant integer ITEMS_START = 242
  constant integer oITEMS_START = 'noid'
  constant integer HUMAN_ITEMS_START = 243
  constant integer oHUMAN_ITEMS_START = 'noid'
  constant integer SCROLL_OF_REGENERATION = 244
  constant integer oSCROLL_OF_REGENERATION = 'sreg'
  constant integer MECHANICAL_CRITTER = 245
  constant integer oMECHANICAL_CRITTER = 'mcri'
  constant integer LESSER_CLARITY_POTION = 246
  constant integer oLESSER_CLARITY_POTION = 'plcl'
  constant integer HEALING_POTION = 247
  constant integer oHEALING_POTION = 'phea'
  constant integer MANA_POTION = 248
  constant integer oMANA_POTION = 'pman'
  constant integer TOWN_PORTAL = 249
  constant integer oTOWN_PORTAL = 'stwp'
  constant integer IVORY_TOWER = 250
  constant integer oIVORY_TOWER = 'tsct'
  constant integer ORB_OF_FIRE = 251
  constant integer oORB_OF_FIRE = 'ofir'
  constant integer STAFF_OF_SANCTUARY = 252
  constant integer oSTAFF_OF_SANCTUARY = 'ssan'
  constant integer ORC_ITEMS_START = 253
  constant integer oORC_ITEMS_START = 'noid'
  constant integer HEALING_SALVE = 254
  constant integer oHEALING_SALVE = 'hslv'
  constant integer SCROLL_OF_SPEED = 255
  constant integer oSCROLL_OF_SPEED = 'shas'
  constant integer ORB_OF_LIGHTNING = 256
  constant integer oORB_OF_LIGHTNING = 'oli2'
  constant integer TINY_GREAT_HALL = 257
  constant integer oTINY_GREAT_HALL = 'tgrh'
  constant integer UNDEAD_ITEMS_START = 258
  constant integer oUNDEAD_ITEMS_START = 'noid'
  constant integer ROD_OF_NECROMANCY = 259
  constant integer oROD_OF_NECROMANCY = 'rnec'
  constant integer SACRIFICIAL_SKULL = 260
  constant integer oSACRIFICIAL_SKULL = 'skul'
  constant integer DUST_OF_APPEARANCE = 261
  constant integer oDUST_OF_APPEARANCE = 'dust'
  constant integer ORB_OF_CORRUPTION = 262
  constant integer oORB_OF_CORRUPTION = 'ocor'
  constant integer SCROLL_OF_HEALING = 263
  constant integer oSCROLL_OF_HEALING = 'shea'
  constant integer ELF_ITEMS_START = 264
  constant integer oELF_ITEMS_START = 'noid'
  constant integer MOONSTONE = 265
  constant integer oMOONSTONE = 'moon'
  constant integer STAFF_OF_PRESERVATION = 266
  constant integer oSTAFF_OF_PRESERVATION = 'spre'
  constant integer ORB_OF_VENOM = 267
  constant integer oORB_OF_VENOM = 'oven'
  constant integer ANTI_MAGIC_POTION = 268
  constant integer oANTI_MAGIC_POTION = 'pams'
  constant integer MERCHANT_ITEMS_START = 269
  constant integer oMERCHANT_ITEMS_START = 'noid'
  constant integer CIRCLET_OF_NOBILITY = 270
  constant integer oCIRCLET_OF_NOBILITY = 'cnob'
  constant integer PERIAPT_OF_VITALITY = 271
  constant integer oPERIAPT_OF_VITALITY = 'prvt'
  constant integer BOOTS_OF_SPEED = 272
  constant integer oBOOTS_OF_SPEED = 'bspd'
  constant integer M_DUST_OF_APPEARANCE = 273
  constant integer oM_DUST_OF_APPEARANCE = 'dust'
  constant integer M_SCROLL_OF_HEALING = 274
  constant integer oM_SCROLL_OF_HEALING = 'shea'
  constant integer SCROLL_OF_PROTECTION = 275
  constant integer oSCROLL_OF_PROTECTION = 'spro'
  constant integer M_TOWN_PORTAL = 276
  constant integer oM_TOWN_PORTAL = 'stwp'
  constant integer POTION_OF_INVISIBILITY = 277
  constant integer oPOTION_OF_INVISIBILITY = 'pinv'
  constant integer TOME_OF_RETRAINING = 278
  constant integer oTOME_OF_RETRAINING = 'tret'
  constant integer STAFF_OF_TELEPORTATION = 279
  constant integer oSTAFF_OF_TELEPORTATION = 'stel'
  constant integer POTION_OF_LESSER_INVULNERBILITY = 280
  constant integer oPOTION_OF_LESSER_INVULNERBILITY = 'pnvl'
  constant integer ITEMS_END = 281
  constant integer oITEMS_END = 'noid'
  constant integer NEUTRAL_UNITS_START = 282
  constant integer oNEUTRAL_UNITS_START = 'noid'
  constant integer NEUTRAL_MERC_START = 283
  constant integer oNEUTRAL_MERC_START = 'noid'
  constant integer SATYR_SHADOWDANCER = 284
  constant integer oSATYR_SHADOWDANCER = 'nsts'
  constant integer FURBOLG_SHAMAN = 285
  constant integer oFURBOLG_SHAMAN = 'nfrs'
  constant integer THUNDER_LIZARD = 286
  constant integer oTHUNDER_LIZARD = 'nthl'
  constant integer CENTAUR_OUTRUNNER = 287
  constant integer oCENTAUR_OUTRUNNER = 'ncen'
  constant integer HARPY_ROGUE = 288
  constant integer oHARPY_ROGUE = 'nhrr'
  constant integer RAZORMANE_MEDICINE_MAN = 289
  constant integer oRAZORMANE_MEDICINE_MAN = 'nrzm'
  constant integer HARPY_WINDWITCH = 290
  constant integer oHARPY_WINDWITCH = 'nhrw'
  constant integer FEL_BEAST = 291
  constant integer oFEL_BEAST = 'npfl'
  constant integer DRAENEI_DISCIPLE = 292
  constant integer oDRAENEI_DISCIPLE = 'ndrm'
  constant integer VOIDWALKER = 293
  constant integer oVOIDWALKER = 'nvdw'
  constant integer DRAENEI_DARKSLAYER = 294
  constant integer oDRAENEI_DARKSLAYER = 'ndrd'
  constant integer ROGUE = 295
  constant integer oROGUE = 'nrog'
  constant integer ASSASSIN = 296
  constant integer oASSASSIN = 'nass'
  constant integer KOBOLD_GEOMANCER = 297
  constant integer oKOBOLD_GEOMANCER = 'nkog'
  constant integer FOREST_TROLL_HIGH_PRIEST = 298
  constant integer oFOREST_TROLL_HIGH_PRIEST = 'nfsh'
  constant integer BURNING_ARCHER = 299
  constant integer oBURNING_ARCHER = 'nskf'
  constant integer WILDKIN = 300
  constant integer oWILDKIN = 'nowb'
  constant integer MURLOC_FLESHEATER = 301
  constant integer oMURLOC_FLESHEATER = 'nmfs'
  constant integer SLUDGE_FLINGER = 302
  constant integer oSLUDGE_FLINGER = 'nslf'
  constant integer SATYR_SOULSTEALER = 303
  constant integer oSATYR_SOULSTEALER = 'nstl'
  constant integer BARBED_ARACHNATHID = 304
  constant integer oBARBED_ARACHNATHID = 'nanm'
  constant integer BLUE_DRAGONSPAWN_MEDDLER = 305
  constant integer oBLUE_DRAGONSPAWN_MEDDLER = 'nbdm'
  constant integer MAGNATAUR_WARRIOR = 306
  constant integer oMAGNATAUR_WARRIOR = 'nmgw'
  constant integer POLAR_FURBOLG_SHAMAN = 307
  constant integer oPOLAR_FURBOLG_SHAMAN = 'nfps'
  constant integer GNOLL_BRUTE = 308
  constant integer oGNOLL_BRUTE = 'ngnb'
  constant integer GNOLL_WARDEN = 309
  constant integer oGNOLL_WARDEN = 'ngnw'
  constant integer OGRE_MAGI = 310
  constant integer oOGRE_MAGI = 'nomg'
  constant integer MUD_GOLEM = 311
  constant integer oMUD_GOLEM = 'ngrk'
  constant integer FOREST_TROLL_BERSERKER = 312
  constant integer oFOREST_TROLL_BERSERKER = 'nftb'
  constant integer FOREST_TROLL_SHADOW_PRIEST = 313
  constant integer oFOREST_TROLL_SHADOW_PRIEST = 'nfsp'
  constant integer OGRE_MAULER = 314
  constant integer oOGRE_MAULER = 'nogm'
  constant integer GNOLL_OVERSEER = 315
  constant integer oGNOLL_OVERSEER = 'ngnv'
  constant integer ICE_TROLL_BERSERKER = 316
  constant integer oICE_TROLL_BERSERKER = 'nits'
  constant integer ICE_TROLL_TRAPPER = 317
  constant integer oICE_TROLL_TRAPPER = 'nitt'
  constant integer NERUBIAN_WARRIOR = 318
  constant integer oNERUBIAN_WARRIOR = 'nnwa'
  constant integer FROST_REVENANT = 319
  constant integer oFROST_REVENANT = 'nrvs'
  constant integer NERUBIAN_WEBSPINNER = 320
  constant integer oNERUBIAN_WEBSPINNER = 'nnwl'
  constant integer MURGUL_SNARECASTER = 321
  constant integer oMURGUL_SNARECASTER = 'nmsn'
  constant integer MAKRURA_SNAPPER = 322
  constant integer oMAKRURA_SNAPPER = 'nlsn'
  constant integer MAKRURA_DEEPSEER = 323
  constant integer oMAKRURA_DEEPSEER = 'nlds'
  constant integer GIANT_SEA_TURTLE = 324
  constant integer oGIANT_SEA_TURTLE = 'ntrt'
  constant integer KOBOLD = 325
  constant integer oKOBOLD = 'nkob'
  constant integer MURLOC_HUNTSMAN = 326
  constant integer oMURLOC_HUNTSMAN = 'nmrr'
  constant integer NEUTRAL_MERC_END = 327
  constant integer oNEUTRAL_MERC_END = 'noid'
  constant integer DRAGONS_START = 328
  constant integer oDRAGONS_START = 'noid'
  constant integer BLACK_DRAGON_1 = 329
  constant integer oBLACK_DRAGON_1 = 'nbdr'
  constant integer BLACK_DRAGON_2 = 330
  constant integer oBLACK_DRAGON_2 = 'nbdk'
  constant integer BLACK_DRAGON_3 = 331
  constant integer oBLACK_DRAGON_3 = 'nbwm'
  constant integer BLUE_DRAGON_1 = 332
  constant integer oBLUE_DRAGON_1 = 'nadw'
  constant integer BLUE_DRAGON_2 = 333
  constant integer oBLUE_DRAGON_2 = 'nadk'
  constant integer BLUE_DRAGON_3 = 334
  constant integer oBLUE_DRAGON_3 = 'nadr'
  constant integer BRONZE_DRAGON_1 = 335
  constant integer oBRONZE_DRAGON_1 = 'nbzw'
  constant integer BRONZE_DRAGON_2 = 336
  constant integer oBRONZE_DRAGON_2 = 'nbzk'
  constant integer BRONZE_DRAGON_3 = 337
  constant integer oBRONZE_DRAGON_3 = 'nbzd'
  constant integer GREEN_DRAGON_1 = 338
  constant integer oGREEN_DRAGON_1 = 'ngrw'
  constant integer GREEN_DRAGON_2 = 339
  constant integer oGREEN_DRAGON_2 = 'ngdk'
  constant integer GREEN_DRAGON_3 = 340
  constant integer oGREEN_DRAGON_3 = 'ngrd'
  constant integer NETHER_DRAGON_1 = 341
  constant integer oNETHER_DRAGON_1 = 'nnht'
  constant integer NETHER_DRAGON_2 = 342
  constant integer oNETHER_DRAGON_2 = 'nndk'
  constant integer NETHER_DRAGON_3 = 343
  constant integer oNETHER_DRAGON_3 = 'nndr'
  constant integer RED_DRAGON_1 = 344
  constant integer oRED_DRAGON_1 = 'nrdk'
  constant integer RED_DRAGON_2 = 345
  constant integer oRED_DRAGON_2 = 'nrdr'
  constant integer RED_DRAGON_3 = 346
  constant integer oRED_DRAGON_3 = 'nrwm'
  constant integer GOBLIN_MERC_START = 347
  constant integer oGOBLIN_MERC_START = 'noid'
  constant integer ZEPPELIN = 348
  constant integer oZEPPELIN = 'nzep'
  constant integer SAPPER = 349
  constant integer oSAPPER = 'ngsp'
  constant integer SHREDDER = 350
  constant integer oSHREDDER = 'ngir'
  constant integer GOBLIN_MERC_END = 351
  constant integer oGOBLIN_MERC_END = 'noid'

  constant integer AVATAR = 'AHav'
  constant integer BASH = 'AHbh'
  constant integer THUNDER_BOLT = 'AHtb'
  constant integer THUNDER_CLAP = 'AHtc'
  constant integer DEVOTION_AURA = 'AHad'
  constant integer DIVINE_SHIELD = 'AHds'
  constant integer HOLY_BOLT = 'AHhb'
  constant integer RESURRECTION = 'AHre'
  constant integer BLIZZARD = 'AHbz'
  constant integer BRILLIANCE_AURA = 'AHab'
  constant integer MASS_TELEPORT = 'AHmt'
  constant integer WATER_ELEMENTAL = 'AHwe'
  constant integer BANISH = 'AHbn'
  constant integer FLAME_STRIKE = 'AHfs'
  constant integer SUMMON_PHOENIX = 'AHpx'
  constant integer SIPHON_MANA = 'AHdr'
  constant integer CRITICAL_STRIKE = 'AOcr'
  constant integer MIRROR_IMAGE = 'AOmi'
  constant integer BLADE_STORM = 'AOww'
  constant integer WIND_WALK = 'AOwk'
  constant integer CHAIN_LIGHTNING = 'AOcl'
  constant integer EARTHQUAKE = 'AOeq'
  constant integer FAR_SIGHT = 'AOfs'
  constant integer SPIRIT_WOLF = 'AOsf'
  constant integer ENDURANCE_AURA = 'AOae'
  constant integer REINCARNATION = 'AOre'
  constant integer SHOCKWAVE = 'AOsh'
  constant integer WAR_STOMP = 'AOws'
  constant integer HEALING_WAVE = 'AOhw'
  constant integer HEX = 'AOhx'
  constant integer SERPENT_WARD = 'AOsw'
  constant integer VOODOO = 'AOvd'
  constant integer SLEEP = 'AUsl'
  constant integer VAMP_AURA = 'AUav'
  constant integer CARRION_SWARM = 'AUcs'
  constant integer INFERNO = 'AUin'
  constant integer DARK_RITUAL = 'AUdr'
  constant integer DEATH_DECAY = 'AUdd'
  constant integer FROST_ARMOR = 'AUfu'
  constant integer FROST_NOVA = 'AUfn'
  constant integer ANIM_DEAD = 'AUan'
  constant integer DEATH_COIL = 'AUdc'
  constant integer DEATH_PACT = 'AUdp'
  constant integer UNHOLY_AURA = 'AUau'
  constant integer CARRION_SCARAB = 'AUcb'
  constant integer IMPALE = 'AUim'
  constant integer LOCUST_SWARM = 'AUls'
  constant integer THORNY_SHIELD = 'AUts'
  constant integer FORCE_NATURE = 'AEfn'
  constant integer ENT_ROOTS = 'AEer'
  constant integer THORNS_AURA = 'AEah'
  constant integer TRANQUILITY = 'AEtq'
  constant integer EVASION = 'AEev'
  constant integer IMMOLATION = 'AEim'
  constant integer MANA_BURN = 'AEmb'
  constant integer METAMORPHOSIS = 'AEme'
  constant integer SEARING_ARROWS = 'AHfa'
  constant integer SCOUT = 'AEst'
  constant integer STARFALL = 'AEsf'
  constant integer TRUESHOT = 'AEar'
  constant integer BLINK = 'AEbl'
  constant integer FAN_KNIVES = 'AEfk'
  constant integer SHADOW_TOUCH = 'AEsh'
  constant integer VENGEANCE = 'AEsv'
  constant integer BLACKARROW = 'ANba'
  constant integer CHARM = 'ANch'
  constant integer DRAIN = 'ANdr'
  constant integer SILENCE = 'ANsi'
  constant integer FORKLIGHTNING = 'ANfl'
  constant integer FROSTARROWS = 'ANfa'
  constant integer TORNADO = 'ANto'
  constant integer MANASHIELD = 'ANms'
  constant integer BOF = 'ANbf'
  constant integer BRAWLER = 'ANdb'
  constant integer HAZE = 'ANdh'
  constant integer SEF = 'ANef'
  constant integer DOOM = 'ANdo'
  constant integer HOWL = 'ANht'
  constant integer CLEAVING = 'ANca'
  constant integer RAINOFFIRE = 'ANrf'
  constant integer STAMPEDE = 'ANst'
  constant integer BEAR = 'ANsg'
  constant integer QUILBEAST = 'ANsq'
  constant integer HAWK = 'ANsw'
  constant integer POCKETFACTORY = 'ANsy'
  constant integer ROBOGOBLIN = 'ANrg'
  constant integer UPGRADE = 'ANeg'
  constant integer ROCKETS = 'ANcs'

    //--------------------------------------------------------------------
    constant integer M1                 =    60
    constant integer M2                 =  2*60
    constant integer M3                 =  3*60
    constant integer M4                 =  4*60
    constant integer M5                 =  5*60
    constant integer M6                 =  6*60
    constant integer M7                 =  7*60
    constant integer M8                 =  8*60
    constant integer M9                 =  9*60
    constant integer M10                = 10*60
    constant integer M11                = 11*60
    constant integer M12                = 12*60
    constant integer M13                = 13*60
    constant integer M14                = 14*60
    constant integer M15                = 15*60

    constant integer o0                 = 0

    constant integer EASY               = 1
    constant integer NORMAL             = 2
    constant integer HARD               = 3
    constant integer INSANE             = 4 // not used

    constant integer MELEE_NEWBIE       = 1
    constant integer MELEE_NORMAL       = 2
    constant integer MELEE_INSANE       = 3

    constant integer ATTACK_CAPTAIN     = 1
    constant integer DEFENSE_CAPTAIN    = 2
    constant integer BOTH_CAPTAINS      = 3

    constant integer BUILD_UNIT         = 1
    constant integer BUILD_UPGRADE      = 2
    constant integer BUILD_EXPAND       = 3
    constant integer BUILD_ITEM         = 4

    constant integer NOT_ENOUGH_RES = 1
    constant integer CANNOT_BUILD = 2
    constant integer BUILT_ALL = 3
    constant integer BUILT_SOME = 4

    constant integer R_ELF = 0
    constant integer R_HUMAN = 1
    constant integer R_ORC = 2
    constant integer R_UNDEAD = 3
    constant integer R_NEUTRAL = 4

    constant integer BUY_NEUTRAL = 1
    constant integer TIMED_CHAT = 2
    constant integer EXCHANGE = 3
    constant integer UPDATE_STRENGTH = 4
    constant integer REVEAL_ENEMY = 5
    constant integer DETECT_DEFEAT = 6
    constant integer DETECT_DOUBLE_EXP = 7
    constant integer ZEPPELIN_FOLLOW = 8
    constant integer NEUTRAL_GUARDED = 9
    constant integer REPAIR_CONTROL = 10
    constant integer WISP_CHECK = 11
    constant integer DELETE_BLOCK_LIST = 12
    constant integer DELETE_RBLOCK_LIST = 13
    constant integer RETREAT_CONTROL = 14
    constant integer CLEANUP_BLOCKS = 15
    constant integer RESET_GUARD_POSITION = 16
    constant integer RESET_HEALTH = 17
    constant integer BUY_ITEM = 18
    constant integer HEALTH_FOUNTAIN = 19
    constant integer MICRO_HERO = 20
    constant integer ZEPPELIN_MOVE = 21
    constant integer TELEPORT = 22
    constant integer HARASS = 23
    constant integer RALLY_POINT = 24
    constant integer NEUTRAL_ENEMY_CHECK = 25
    constant integer ARMY_TRACK = 26
    constant integer TOWN_TRACK = 27
    
    constant integer STRATEGY_TYPE_MELEE = 0
    constant integer STRATEGY_TYPE_RANGED = 1
    constant integer STRATEGY_TYPE_AIR = 2
    constant integer STRATEGY_TYPE_CASTER = 3
    
    constant integer NEUTRAL_TAVERN = 0
    constant integer NEUTRAL_OBSERVATORY = 1
    constant integer NEUTRAL_MERC_CAMP = 2
    constant integer NEUTRAL_DRAGON_ROOST = 3
    constant integer NEUTRAL_HEALING_FOUNTAIN = 4
    constant integer NEUTRAL_MERCHANT = 5
    
    constant integer UPKEEP_UNDECIDED = 0
    constant integer UPKEEP_NOT_ALLOWED = 1
    constant integer UPKEEP_ALLOWED = 2
    
    constant integer UNIT_STANDARD = 0
    constant integer UNIT_GOING_HOME = 1
    constant integer UNIT_HEALING = 2
    constant integer UNIT_RESCUEING = 3
    constant integer UNIT_HARASSING = 4
    constant integer UNIT_HARVESTING = 5
    constant integer UNIT_ZEPPELIN_MOVE = 6
    
    constant integer HEALER_TYPE_NO_TARGET = 0
    constant integer HEALER_TYPE_SUDDEN = 1
    constant integer HEALER_TYPE_CONTINUOUS = 2
    constant integer HEALER_TYPE_WARD = 3
    constant integer HEALER_TYPE_HERO = 4
    
    constant integer ACTION_DO_NOTHING = 0
    constant integer ACTION_GO_HOME = 1
    constant integer ACTION_FOUNTAIN = 2
    constant integer ACTION_TP = 3
    constant integer ACTION_ZEPPELIN_HOME = 4
    constant integer ACTION_ZEPPELIN_FOUNTAIN = 5
    constant integer ACTION_HEALER = 6
    
    constant integer ZTARGET_HOME = 0
    constant integer ZTARGET_FOUNTAIN = 1
    
    constant integer HARASS_TARGET_PEONS = 0
    constant integer HARASS_TARGET_EXPANSION = 1
    constant integer HARASS_TARGET_LOCATION = 2
    constant integer HARASS_TARGET_MAIN_HALL = 3

    constant integer UPGRADED = 9999

    //--------------------------------------------------------------------

    player  ai_player = null

    boolean campaign_ai = false

    string language = "English"
    
    string message_add = ""
    
    real sleep_multiplier = 1  // increases performance by checking stuff not so often
    integer slm_start = 4
    integer slm_end = 10
    real slm_start_mult = 1
    real slm_end_mult = 2
    
    real command_wait = 3
    
    boolean water_map = false
    
    string array digit_map

    integer total_gold              = 0
    integer total_wood              = 0
    integer total_food              = 0
    integer gold_buffer             = 0 // usually for potion money
    integer wood_buffer             = 0
    real    gold_income             = 0
    integer income_per_mine         = 3000
    real    gold_unit_percentage    = 0.9
    integer difficulty              = NORMAL
    integer racial_farm             = 0
    integer racial_peon	= 0
    integer racial_hall	= 0
    integer racial_hall2	= 0
    integer racial_hall3	= 0
    integer racial_expansion	= 0
    integer racial_altar	= 0
    integer racial_shop = 0
    integer racial_militia = 0
    integer racial_militiahero = 0
    integer racial_ghoul = 0
    integer neutral_shredder = 0
    integer neutral_zeppelin = 0
    integer tp_item = 0

    integer array hero_id
    integer array skills
    integer array tempskills
    integer array allskills
    integer max_hero_level          = 0
    boolean array hero_built
    integer array hero_revive_prio
    integer hero1_revive_prio = 200
    integer hero2_revive_prio = 120
    integer hero3_revive_prio = 80
    unit array hero_unit
    integer array all_heroes
    integer array hero_rp
    integer hero_number = 0
    integer chosen = 0
    location array hero_loc
    location array hero_dir
    real array hero_hp
    real array hero_hp_loss
    real array hero_enemy_density
    location array hero_enemy_loc
    real array hero_ally_density
    location array hero_ally_loc
    real hero_radius = 200
    
    real array action_points
    integer action_numbers = 0
    
    real enemy_density = 0
    location enemy_density_loc = null
    real ally_density = 0
    location ally_density_loc = null
    
    real nearest_enemy_range = 10000000
    player nearest_enemy = null
    
    integer low_upkeep_allowed = UPKEEP_UNDECIDED
    integer high_upkeep_allowed = UPKEEP_UNDECIDED
    integer low_upkeep_border = 50
    integer high_upkeep_border = 80
    integer low_upkeep_resistance = 300
    integer high_upkeep_resistance = 2000
    integer low_upkeep_time = -1
    integer high_upkeep_time = -1
    integer low_upkeep_save_time = 12
    integer high_upkeep_save_time = 40
    boolean use_linear_upkeep_saving = false
    
    integer repair_threshold = 6
    integer repair_threshold_threatened = 8
    
    integer debug_strategy = -1
    integer debug_profile = -1

    integer array attack_qty
    integer array attack_max
    integer array attack_units
    integer attack_length           = 0

    integer array defense_qty
    integer array defense_units
    integer defense_length          = 0

    integer array build_qty
    integer array build_type
    integer array build_item
    integer array build_town
    integer array build_prio
    integer build_length            = 0

    integer array t_build_qty
    integer array t_build_type
    integer array t_build_item
    integer array t_build_town
    integer array t_build_prio
    integer t_build_length            = 0

    integer array bl_req_qty
    integer array bl_req_type
    integer array bl_allow_qty
    integer array bl_allow_type
    integer array bl_expire_time
    boolean array bl_only_done
    integer bl_length = 0
    integer blocked_gold = 0
    integer blocked_wood = 0
    
    integer array rbl_req_gold
    integer array rbl_req_wood
    integer array rbl_allow_qty
    integer array rbl_allow_type
    integer array rbl_expire_time
    integer rbl_length = 0
    
    integer array harass_qty
    integer array harass_units
    integer array harass_time
    integer array harass_length
    integer max_harass_groups = 10
    real harass_radius_attack_ranged = 800
    real harass_radius_attack_melee = 400
    real harass_radius_flee_ranged = 1200
    real harass_radius_flee_melee = 800
    integer distraction_group = 0
    
    integer array army_owner
    location array army_loc
    location array army_dir
    location array army_future
    real array army_strength
    group array army_group
    integer array army_count
    integer army_num = 0
    real army_radius = 1200
    real army_future_mult = 3
    group in_army_group = CreateGroup()
    
    boolean town_threatened = false
    integer array town_owner
    location array town_loc
    real array town_value
    real array town_threat
    group array town_group
    integer array town_count
    integer array town_threat_army
    boolean array town_can_tp
    integer most_threatened_town = -1
    integer town_num = 0
    real town_radius = 2500
    group in_town_group = CreateGroup()

    // settings for threat system    
    real full_threat_distance = 600
    real no_threat_distance = 3000
    real distance_threat_exponent = 0.8
    real distance_threat_mult = 540
    real atl_time_start = 300  // accepted threat level increase starts at this time
    real atl_time_end = 900    // and ends at that time
    real atl_time_start_val = 10  // it starts with this value
    real atl_time_end_val = 20  // and ends with that value
    real atl_enemy_start = 1 // accepted threat level multiplier increases at that enemy number
    real atl_enemy_end = 4   // until that enemy number
    real atl_enemy_start_mult = 1  // the multiplier starts for accepted threat level starts with this
    real atl_enemy_end_mult = 1.5    // and ends with this
    real teleport_low_threat = 20
    real teleport_high_threat = 50
    real teleport_low_threat_distance = 4000
    real teleport_high_threat_distance = 3000
    real teleport_army_min_strength = 20
    real teleport_min_threat = 70

    boolean build_lock = true

    integer array old_id
    integer array needed1  // needed building and factory if unit
    integer array needed2  // needed building 2
    integer array needed3  // needed for upgrade level 3
    integer array build_free // free buildings
    integer array gold_sum
    integer array build_time_sum
    integer array build_num
    real array income_percentage
    integer array prio_sum
    integer array tc_add1  // building that has to be added for TownCount
    integer array tc_add2  // building that has to be added for TownCount
    integer array available_time
    integer array regenerate_time
    integer array attacking_max_num
    integer array upgrade_time
    integer array gold_price
    integer array wood_price

    integer array campaign_defenders
    
    integer array creep_strength
    integer creep_strength_length = 0

    integer unit_begin = 0
    integer unit_end = 0
    integer building_begin = 0
    integer building_end = 0

    unit follow_zeppelin = null
    boolean zeppelin_following = false
    real max_follow_dist = 1000

    boolean array neutral_available
    unit array nearest_neutral
    boolean array neutral_guarded
    integer array neutral_enemy
    boolean array neutral_ordered
    unit array neutral_sent
    boolean array neutral_night_buy
    string array neutral_name
    real array buy_time_large
    real array buy_time_small
    integer array neutral_wanted
    integer neutral_hero_time = 25
    real buy_distance = 350
    real buy_timeout_large = 120
    real buy_timeout_small = 15
    boolean no_sleep = false
    integer array dragons
    integer array merc_unit
    integer merc_number = 0
    integer merc_caster = 0
    integer merc_melee = 0
    integer merc_range = 0
    integer merc_healer = 0
    integer merc_stopper = 0
    integer merc_rush = 0

    integer minimum_attack_strength = 11

    integer prio_n_inc = 2  // priority increase for building needed buildings
    integer prio_t_inc = 1  // priority increase in time
    integer prio_q_inc = 2  // priority increase in quantity
    integer farm_food = 8 // build farm when this near food used to food produced
    integer farm_food2 = 1 // builds another farm at the same time when this near food used to food produced
    integer farm_prio = 400 // priority for farm building
    integer peon_prio = 280 // priority for peon building
    integer expa_prio = 200 // priority for expansion building
    integer expa_emergency_prio = 300
    integer expa_rebuild_prio = 200 // priority for rebuilding an expansion

    integer peon_1_mine_number = 15 //number of peons to build when 1 mine is owned
    integer peon_2_mines_number = 20 //number of peons to build when 2 mines are owned
    integer peon_mines_number = 24  //number of peons to build when more mines are owned
    integer shredder_peon_count = 6
    integer minimum_peon_wood = 2000
    integer maximum_peon_wood = 200

    integer build_array_reset_time = 100  // every this * 5 seconds, the build array is reset

    integer exp_time_count = 0
    integer exp_first_time = 30
    integer exp_second_time = 180
    integer expansion_radius = 650

    integer creep_camp_radius = 550
    integer camp_scan_depth = 3
    integer camp_last_checked = 40

    integer air_strength = 0
    integer array p_str_cache
    integer array p_str_cache_timeout
    integer p_str_cache_valid_time = 2

    boolean ai_no_creep = false
    boolean town_threat_break = true
    boolean captain_flee = true
    unit double_expansion_target = null
    unit nearby_enemy_building = null

    integer strategy = 0
    integer chosen_strategy = 0
    integer last_strategy = 100
    string array strategy_name
    string array strategy_default_name
    string array strategy_default_report
    integer array key_building1
    integer array key_building2
    integer array key_upgrade1
    integer array key_upgrade2
    integer array key_unit
    integer array rp_strat
    integer array rp_strat_sort
    boolean array beginning_strat
    integer array strat_minimum_time
    integer rp_strat_length	= 0
    integer rp_strat_sort_length = 0
    integer rp_strat_normal = 250
    integer strat_persistence = 1500
    integer strat_food_persistence = 2
    integer relevant_strat_change_number = 3   // number of strategies with highest RPs that can be chosen when changing strategy
    integer kb_add1 = 8
    integer kb_add2 = 9
    integer kb_add3 = 7
    integer kb_add4 = 10 // value for 2 of a key buildings
    integer ku_add1 = 4
    integer ku_add2 = 7
    integer ku_add3 = 8
    integer small_map_tier1_bonus = 20
    real k_add_start_mult = 3
    real k_add_end_mult = 1
    real k_add_start_time = 120
    real k_add_end_time = 1200
    boolean array strategy_type_used
    integer array strategy_type
    integer strategy_type_used_penalty = 30
    integer array strategy_tier
    integer strategy_tier_bonus = 35
    integer array strategy_first_exp_time
    integer array strategy_second_exp_time
    integer array strategy_first_hero
    integer array strategy_first_hero_bonus
    integer array strategy_second_hero
    integer array strategy_second_hero_bonus
    integer array strategy_race_aggression

    boolean take_exp                = false

    integer tier = 0
    integer own_strength	= 0
    integer uncertainty	= 10
    integer tower_factor	= 10
    integer attacking_strategy = 4       // strategy when attacking enemy players
    integer attacking_aggression = -12  // higher value means more likely to attack enemy (negative values possible), overwritten by profile
    integer array race_aggression
    integer array b_race_aggression
    integer added_aggression = 0  // aggresion added when upkeep becomes higher
    boolean h_siege	= false
    unit alli_target = null
    integer expansion_target_bonus = 7
    integer comp_chosen_target_bonus = 5
    real comp_chosen_target_rate = 0.5

    boolean chatting	= true
    boolean debugging	= false
    boolean balancing	= false
    
    unit major_hero = null
    real battle_radius = 1500
    boolean retreat_controlled = false
    real focus_fire_limit = 35
    group focus_fire_group = CreateGroup()
    real focus_fire_ranged_dist = 600
    real focus_fire_melee_dist = 50
    location last_major_hero_loc = null
    location home_location = null
    real flee_health_percentage = 0.25
    real flee_minimum_health = 100
    location enemy_loc = Location(0,0)
    location last_enemy_loc = Location(0,0)
    location ally_loc = Location(0,0)
    location last_ally_loc = Location(0,0)
    real enemy_strength_sum = 0
    real ally_strength_sum = 0
    group healer_group = CreateGroup()
    boolean ward_cast = false
    real statue_distance = 300
    boolean teleporting = false
    real teleport_radius = 800
    
    group urgent_healing_group = CreateGroup()
    group medium_healing_group = CreateGroup()
    group small_healing_group = CreateGroup()
    integer urgent_healing_count = 0
    integer medium_healing_count = 0
    integer small_healing_count = 0
    boolean fountain_available = false
    
    unit item_unit = null
    unit shop_sent = null
    boolean shop_ordered = false
    real shop_buy_time_small = -1
    real shop_buy_time_large = -1
    integer shop_wanted = 0
    unit shop_unit = null
    real shop_distance_limit = 10000
    real raceshop_distance_limit = 1000
    real merchant_distance_limit = 5000
    
    integer array healer_id
    integer array healer_spell
    integer array healer_type
    integer array healer_mana_cost
    integer array healer_upg_id
    integer array healer_upg_level
    integer healer_length = 0

    integer c_enemy_elves	= 0  // number of enemy night elf players
    integer c_enemy_orcs	= 0
    integer c_enemy_humans	= 0
    integer c_enemy_undead	= 0
    integer c_enemy_random	= 0
    integer c_enemy_total	= 0
    integer c_ally_elves	= 0
    integer c_ally_orcs		= 0
    integer c_ally_humans	= 0
    integer c_ally_undead	= 0
    integer c_ally_total	= 0
    integer c_ai_total = 0
    boolean enemy_revealed	= false
    integer strat_prev		= 0 // strategy chosen by the ai before this one
    integer hero_prev		= 0 // hero chosen by the ai before this one
    integer picked_hero		= 0
    boolean first_ai		= true
    integer next_ai		= 0
    boolean no_ai_ally	= false
    boolean no_ally_ctrl 	= true
    integer force_number	= 0
    player array own_force
    integer gold_exchange_level = 650
    integer wood_exchange_level = 350
    integer gold_problem_level = 0

    boolean player_defeated	= false

    real enemy_air		= 0
    real enemy_piercing		= 0
    real enemy_heavyarmor	= 0
    real enemy_lightarmor	= 0
    real enemy_casters		= 0
    real enemy_towers		= 0
    real enemy_unarmored	= 0
    real enemy_magic		= 0
    real enemy_normal		= 0
    real enemy_siege		= 0
    real enemy_mediumarmor		= 0
    integer area_uncertainty		= 10
    
    unit build_zeppelin = null

    boolean array town_built
    integer max_towns		= 5

    integer attacking_ghouls          = 0

    integer ai_time = 0

    integer tq_length = 0
    real array tq_time
    integer array tq_jid
    integer array tq_par
    unit array tq_unit_par
    group array tq_group_par
    boolean tq_lock = true
    timer tq_timer = CreateTimer()

    boolean attack_running = false

    integer order_cancel = 851976
    integer order_attack = 851983

    boolean towerrush = false

    sound chatSound = CreateSound( "Sound\\Interface\\InGameChatWhat1.wav", false, false, false, 10, 10, "" )
    sound importantSound = CreateSound( "Sound\\Interface\\CreepAggroWhat1.wav", false, false, false, 10, 10, "" )

    // messages to enemy
    string array chat_e_greet
    integer chat_greet_length        = 9
    constant integer C_GREET = 1

    string array chat_e_taunt
    integer chat_taunt_length        = 9
    constant integer C_CHAT = 2

    string array chat_e_mega
    integer chat_mega_length         = 8
    constant integer C_MEGA = 3

    string array chat_e_gg
    integer chat_e_gg_length         = 4
    constant integer C_GG = 4

    // messages to ally
    string array chat_a_expansion
    integer chat_expansion_length    = 4
    constant integer C_EXPANSION = 5

    string array chat_a_attack
    integer chat_attack_length       = 4
    constant integer C_ATTACK = 6

    string array chat_a_creep
    integer chat_creep_length        = 4
    constant integer C_CREEP = 7

    string array chat_a_done
    integer chat_done_length         = 4
    constant integer C_DONE = 8

    string array chat_a_ally
    integer chat_ally_length         = 4
    constant integer C_ALLY = 9

    string array chat_a_megatarget
    integer chat_megatarget_length   = 4
    constant integer C_MEGATARGET = 10

    string array chat_a_gg
    integer chat_a_gg_length         = 4

    string array chat_a_goldproblem
    integer chat_goldproblem_length = 1
    constant integer C_GOLDPROBLEM = 11

    string array chat_a_thanks
    integer chat_thanks_length     = 1
    constant integer C_THANKS = 12

    string chat_no_unit_selected    = ""
    string chat_confirm_attack_unit = ""
    string chat_towerrush = ""
    string chat_no_orc = ""
    string militia_expansion_chat = ""

    constant integer C_STRATEGY = 13
    
    gamecache translation_map = InitGameCache("AMAI_TM.w3v")
    string array translation
    integer translation_length = 0
    
    gamecache additional_info = InitGameCache("AMAI_AI.w3v")
    gamecache com = InitGameCache("AMAI_Com.w3v")


    boolean break_attack 	= false
    boolean go_home		= false
    boolean attack_player	= false
    boolean attack_point	= false
    boolean attack_unit		= false
    boolean no_attack		= false
    boolean no_creep_attack	= false
    boolean no_player_attack	= false
    boolean strat_change_allowed = true
    integer attack_target_p	= 0
    integer attack_target_x	= 0
    integer attack_target_y	= 0
    integer bn_airair = 0
    integer bn_airground = 0
    integer bn_groundair = 0
    integer bn_groundground = 0
    integer bn_farm = 0
    integer bn_guard = 0
    unit 	target_unit = null
    integer array target_queue_x
    integer array target_queue_y
    unit    array target_queue_u
    integer queue_length	= 0
    integer queue_pointer	= 0
    boolean queue_running	= false
    boolean queue_attack_p	= false
    boolean queue_attack_u	= false
    integer queue_t_x		= 0
    integer queue_t_y		= 0
    unit	queue_t_u = null


    string ai_name = "Computer"

    string array profilename

    integer profile_length      = 0

    integer profile            = 0

    boolean add_tag             = true // Add the [AMAI] tag in front of name
    boolean add_skill           = false // Add the current skill after the name

    integer own_race

    integer array fav_hero
    integer array fav_unit
    integer fav_unit_add = 20
    integer fav_hero_add = 20

    integer array p_aggression
    integer array p_uncertainty
    integer array p_minimum_attack_strength
    integer array p_farm_food
    integer array p_exp_first_time
    integer array p_exp_second_time
    integer array p_strat_persistence
    integer array p_expansion_target_bonus  // aggression bonus for expansion targets
    integer array p_comp_chosen_target_bonus  // aggression bonus for targets chosen by the hard coded AI

    real array p_gold_unit_percentage
    real array p_taunt_rate
    real taunt_rate = 1.00 // how man % of the time computers taunt, set by profiles. Recommended values 0.50 to 1.50
    real array p_comp_chosen_target_rate  // how often the computer considers an attack target chosen by the hard coded AI


    real path_top = GetCameraBoundMaxY()+GetCameraMargin(CAMERA_MARGIN_TOP)
    real path_bottom = GetCameraBoundMinY()-GetCameraMargin(CAMERA_MARGIN_BOTTOM)
    real path_left = GetCameraBoundMinX()-GetCameraMargin(CAMERA_MARGIN_LEFT)
    real path_right = GetCameraBoundMaxX()+GetCameraMargin(CAMERA_MARGIN_RIGHT)
    integer path_grid_number = 90
    boolean array path_passable
    location array path_fieldloc
    real path_dx = (path_right - path_left)/I2R(path_grid_number)
    real path_dy = (path_top - path_bottom)/I2R(path_grid_number)
    integer array path_pq_key
    integer array path_pq_id
    integer array path_pq_pos
    integer path_pq_length = 0
    boolean array path_open
    boolean array path_closed
    integer array path_cost
    integer array path_from
    integer pathing_limit = 1000

    unit array expansion_list
    integer array expansion_dist
    integer expansion_list_length = 0
    
    unit array water_expansion_list
    integer water_expansion_list_length = 0
    
    unit expansion_peon = null
    
    integer exp_number = 0
    integer array exp_rp
    unit array exp_unit
    integer array exp_dist
    
    unit current_expansion = null
    boolean first_expansion_chosen = false
    
    integer confirm_count = 0
    integer array ai_force
    integer ai_force_length = 0
    boolean pathing_receive_finished = false

    integer home_field = 0
    
endglobals

function Handle2Int takes handle h returns integer
  return h
  return 0
endfunction


function c2s takes playercolor c returns string
if c == PLAYER_COLOR_RED then
    return "|c00ff0000"+ai_name+"|r: "
elseif c == PLAYER_COLOR_BLUE then
    return "|c000000ff"+ai_name+"|r: "
elseif c == PLAYER_COLOR_CYAN then
    return "|c0000ffff"+ai_name+"|r: "
elseif c == PLAYER_COLOR_PURPLE then
    return "|c00660099"+ai_name+"|r: "
elseif c == PLAYER_COLOR_YELLOW then
    return "|c00ffff00"+ai_name+"|r: "
elseif c == PLAYER_COLOR_ORANGE then
    return "|c00ff9933"+ai_name+"|r: "
elseif c == PLAYER_COLOR_GREEN then
    return "|c0000ff00"+ai_name+"|r: "
elseif c == PLAYER_COLOR_PINK then
    return "|c00dd00ff"+ai_name+"|r: "
elseif c == PLAYER_COLOR_LIGHT_GRAY then
    return "|c00dddddd"+ai_name+"|r: "
elseif c == PLAYER_COLOR_LIGHT_BLUE then
    return "|c0033ccff"+ai_name+"|r: "
elseif c == PLAYER_COLOR_AQUA then
    return "|c007fffd4"+ai_name+"|r: "
else //Brown
    return "|c00660000"+ai_name+"|r: "
endif
endfunction


function DisplayToAll takes string s returns nothing
     call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,15,message_add+s)
     call StartSound(chatSound)
endfunction

function DisplayToAllImportant takes string s returns nothing
     call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,15,message_add+s)
     call StartSound(importantSound)
endfunction

function DisplayToAllies takes string s returns nothing
     if IsPlayerAlly(ai_player,GetLocalPlayer()) then
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,15,message_add+s)
          call StartSound(chatSound)
     endif
endfunction

function DisplayToAlliesImportant takes string s returns nothing
     if IsPlayerAlly(ai_player,GetLocalPlayer()) then
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,15,message_add+s)
          call StartSound(importantSound)
     endif
endfunction

function DisplayToEnemy takes string s returns nothing
     if IsPlayerEnemy(ai_player,GetLocalPlayer()) then
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,15,message_add+s)
          call StartSound(chatSound)
     endif
endfunction

function DisplayToEnemyImportant takes string s returns nothing
     if IsPlayerEnemy(ai_player,GetLocalPlayer()) then
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,15,message_add+s)
          call StartSound(importantSound)
     endif
endfunction

function DisplayToObservers takes string s returns nothing
     if IsPlayerObserver(GetLocalPlayer()) then
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,15,message_add+s)
          call StartSound(chatSound)
     endif
endfunction

function DisplayToObserversImportant takes string s returns nothing
     if IsPlayerObserver(GetLocalPlayer()) then
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,15,message_add+s)
          call StartSound(importantSound)
     endif
endfunction

function DisplayToAllDebug takes string s returns nothing
    if debugging then
      call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,15,message_add+s)
      call StartSound(chatSound)
    endif
endfunction

function DisplayToAlliesChat takes string s returns nothing
     if chatting then
       if IsPlayerAlly(ai_player,GetLocalPlayer()) then
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,15,message_add+s)
          call StartSound(chatSound)
       endif
    endif
endfunction

function DisplayToEnemyChat takes string s returns nothing
   if chatting then
     if IsPlayerEnemy(ai_player,GetLocalPlayer()) then
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,15,message_add+s)
          call StartSound(chatSound)
     endif
   endif
endfunction

function DisplayToAlliesDebug takes string s returns nothing
     if debugging then
       if IsPlayerAlly(ai_player,GetLocalPlayer()) then
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,15,message_add+s)
          call StartSound(chatSound)
       endif
    endif
endfunction

function InitDigits takes nothing returns nothing
  set digit_map[0] = "0"
  set digit_map[1] = "1"
  set digit_map[2] = "2"
  set digit_map[3] = "3"
  set digit_map[4] = "4"
  set digit_map[5] = "5"
  set digit_map[6] = "6"
  set digit_map[7] = "7"
  set digit_map[8] = "8"
  set digit_map[9] = "9"
endfunction

function Int2Str takes integer ic returns string
    local string s = ""
    local integer i = ic
    local integer ialt = 0
    local boolean neg = false

    if i == 0 then
      return "0"
    endif
    if i < 0 then
      set neg = true
      set i = -i
    endif
    loop
      exitwhen i == 0
      set ialt = i
      set i = i / 10
      set s = digit_map[ ialt - 10*i ] + s
    endloop
    if neg then
      return "-"+s
    endif
    return s
endfunction

function absolute takes integer a returns integer
  if a >= 0 then
    return a
  else
    return -a
  endif
endfunction

function r_absolute takes real a returns real
  if a >= 0 then
    return a
  else
    return -a
  endif
endfunction

function minimum takes integer a, integer b returns integer
  if a < b then
    return a
  else
    return b
  endif
endfunction

function r_minimum takes real a, real b returns real
  if a < b then
    return a
  else
    return b
  endif
endfunction

function maximum takes integer a, integer b returns integer
  if a > b then
    return a
  else
    return b
  endif
endfunction

function r_maximum takes real a, real b returns real
  if a > b then
    return a
  else
    return b
  endif
endfunction

function GetRandomDiff takes integer maxdiff returns integer
  if GetRandomInt(0,1) == 1 then
    return GetRandomInt(0,maxdiff)
  else
    return -GetRandomInt(0,maxdiff)
  endif
endfunction

function LinearInterpolation takes real x1, real x2, real y1, real y2, real p returns real
  if p <= x1 then
    return y1
  elseif p >= x2 then
    return y2
  else
    return y1 + ((p - x1)/(x2 - x1)) * (y2 - y1)
  endif
endfunction

function l_add_kk takes location l1, location l2 returns location
  return Location(GetLocationX(l1) + GetLocationX(l2), GetLocationY(l1) + GetLocationY(l2))
endfunction

function l_add_dk takes location l1, location l2 returns location
  call MoveLocation(l1, GetLocationX(l1) + GetLocationX(l2), GetLocationY(l1) + GetLocationY(l2))
  return l1
endfunction

function l_add_kd takes location l1, location l2 returns location
  call MoveLocation(l2, GetLocationX(l1) + GetLocationX(l2), GetLocationY(l1) + GetLocationY(l2))
  return l2
endfunction

function l_add_dd takes location l1, location l2 returns location
  call MoveLocation(l1, GetLocationX(l1) + GetLocationX(l2), GetLocationY(l1) + GetLocationY(l2))
  call RemoveLocation(l2)
  return l1
endfunction

function l_sub_kk takes location l1, location l2 returns location
  return Location(GetLocationX(l1) - GetLocationX(l2), GetLocationY(l1) - GetLocationY(l2))
endfunction

function l_sub_dk takes location l1, location l2 returns location
  call MoveLocation(l1, GetLocationX(l1) - GetLocationX(l2), GetLocationY(l1) - GetLocationY(l2))
  return l1
endfunction

function l_sub_kd takes location l1, location l2 returns location
  call MoveLocation(l2, GetLocationX(l1) - GetLocationX(l2), GetLocationY(l1) - GetLocationY(l2))
  return l2
endfunction

function l_sub_dd takes location l1, location l2 returns location
  call MoveLocation(l1, GetLocationX(l1) - GetLocationX(l2), GetLocationY(l1) - GetLocationY(l2))
  call RemoveLocation(l2)
  return l1
endfunction

function l_mult_k takes location l, real m returns location
  return Location(GetLocationX(l) * m, GetLocationY(l) * m)
endfunction

function l_mult_d takes location l, real m returns location
  call MoveLocation(l, GetLocationX(l) * m, GetLocationY(l) * m)
  return l
endfunction

function l_div_k takes location l, real d returns location
  return Location(GetLocationX(l) / d, GetLocationY(l) / d)
endfunction

function l_div_d takes location l, real d returns location
  call MoveLocation(l, GetLocationX(l) / d, GetLocationY(l) / d)
  return l
endfunction

function l_length_k takes location l returns real
  local real x = GetLocationX(l)
  local real y = GetLocationY(l)
  return SquareRoot(x * x + y * y)
endfunction

function l_length_d takes location l returns real
  local real x = GetLocationX(l)
  local real y = GetLocationY(l)
  call RemoveLocation(l)
  return SquareRoot(x * x + y * y)
endfunction

function l_norm_k takes location l returns location
  return l_div_k(l, l_length_k(l))
endfunction

function l_norm_d takes location l returns location
  return l_div_d(l, l_length_k(l))
endfunction

function l_project_kk takes location l, location v, real r returns location
  return l_add_kd(l, l_mult_d(l_norm_k(v), r))
endfunction

function l_project_dk takes location l, location v, real r returns location
  return l_add_dd(l, l_mult_d(l_norm_k(v), r))
endfunction

function l_project_kd takes location l, location v, real r returns location
  return l_add_kd(l, l_mult_d(l_norm_d(v), r))
endfunction

function l_project_dd takes location l, location v, real r returns location
  return l_add_dd(l, l_mult_d(l_norm_d(v), r))
endfunction

function l_smult_kk takes location l1, location l2 returns real
  return GetLocationX(l1) * GetLocationX(l2) + GetLocationY(l1) * GetLocationY(l2)
endfunction

function l_smult_dk takes location l1, location l2 returns real
  local real ret = GetLocationX(l1) * GetLocationX(l2) + GetLocationY(l1) * GetLocationY(l2)
  call RemoveLocation(l1)
  return ret
endfunction

function l_smult_kd takes location l1, location l2 returns real
  local real ret = GetLocationX(l1) * GetLocationX(l2) + GetLocationY(l1) * GetLocationY(l2)
  call RemoveLocation(l2)
  return ret
endfunction

function l_smult_dd takes location l1, location l2 returns real
  local real ret = GetLocationX(l1) * GetLocationX(l2) + GetLocationY(l1) * GetLocationY(l2)
  call RemoveLocation(l1)
  call RemoveLocation(l2)
  return ret
endfunction

function l_angle_kk takes location l1, location l2 returns real
  return Acos(l_smult_kk(l1, l2) / (l_length_k(l1) * l_length_k(l2)))
endfunction

function l_angle_dk takes location l1, location l2 returns real
  return Acos(l_smult_kk(l1, l2) / (l_length_d(l1) * l_length_k(l2)))
endfunction

function l_angle_kd takes location l1, location l2 returns real
  return Acos(l_smult_kk(l1, l2) / (l_length_k(l1) * l_length_d(l2)))
endfunction

function l_angle_dd takes location l1, location l2 returns real
  return Acos(l_smult_kk(l1, l2) / (l_length_d(l1) * l_length_d(l2)))
endfunction

function set_profiles takes nothing returns nothing

    set profilename[0] = "Hunter"
    set p_aggression[0] = -10
    set p_uncertainty[0] = 10
    set p_minimum_attack_strength[0] = 7
    set p_farm_food[0] = 8
    set p_exp_first_time[0] = -5
    set p_exp_second_time[0] = 10
    set p_strat_persistence[0] = 1000
    set p_gold_unit_percentage[0] = 0.9
    set p_taunt_rate[0] = 1
    set p_expansion_target_bonus[0] = 7
    set p_comp_chosen_target_bonus[0] = 5
    set p_comp_chosen_target_rate[0] = 0.5

    set fav_hero[0] = MOON_CHICK
    set fav_hero[1] = ARCHMAGE
    set fav_hero[2] = FAR_SEER
    set fav_hero[3] = DREAD_LORD
    set fav_hero[4] = PIT_LORD

    set fav_unit[0] = HUNTRESS
    set fav_unit[1] = GRYPHON
    set fav_unit[2] = GRUNT
    set fav_unit[3] = GHOUL

    set profilename[1] = "Crazy_Rusher"
    set p_aggression[1] = 5
    set p_uncertainty[1] = 5
    set p_minimum_attack_strength[1] = 6
    set p_farm_food[1] = 7
    set p_exp_first_time[1] = 4
    set p_exp_second_time[1] = -8
    set p_strat_persistence[1] = 780
    set p_gold_unit_percentage[1] = 1
    set p_taunt_rate[1] = 1
    set p_expansion_target_bonus[1] = 8
    set p_comp_chosen_target_bonus[1] = 4
    set p_comp_chosen_target_rate[1] = 0.4

    set fav_hero[5] = WARDEN
    set fav_hero[6] = MTN_KING
    set fav_hero[7] = FAR_SEER
    set fav_hero[8] = DEATH_KNIGHT
    set fav_hero[9] = SEA_WITCH

    set fav_unit[4] = ARCHER
    set fav_unit[5] = KNIGHT
    set fav_unit[6] = GRUNT
    set fav_unit[7] = GHOUL

    set profilename[2] = "Crusher"
    set p_aggression[2] = -6
    set p_uncertainty[2] = 7
    set p_minimum_attack_strength[2] = 7
    set p_farm_food[2] = 9
    set p_exp_first_time[2] = 7
    set p_exp_second_time[2] = 12
    set p_strat_persistence[2] = 850
    set p_gold_unit_percentage[2] = 0.9
    set p_taunt_rate[2] = 1
    set p_expansion_target_bonus[2] = 12
    set p_comp_chosen_target_bonus[2] = 6
    set p_comp_chosen_target_rate[2] = 0.6

    set fav_hero[10] = DEMON_HUNTER
    set fav_hero[11] = ARCHMAGE
    set fav_hero[12] = BLADE_MASTER
    set fav_hero[13] = DREAD_LORD
    set fav_hero[14] = DARK_RANGER

    set fav_unit[8] = HUNTRESS
    set fav_unit[9] = KNIGHT
    set fav_unit[10] = WYVERN
    set fav_unit[11] = GHOUL

    set profilename[3] = "Zmasher"
    set p_aggression[3] = -8
    set p_uncertainty[3] = 8
    set p_minimum_attack_strength[3] = 8
    set p_farm_food[3] = 8
    set p_exp_first_time[3] = 7
    set p_exp_second_time[3] = 12
    set p_strat_persistence[3] = 900
    set p_gold_unit_percentage[3] = 0.9
    set p_taunt_rate[3] = 1
    set p_expansion_target_bonus[3] = 5
    set p_comp_chosen_target_bonus[3] = 4
    set p_comp_chosen_target_rate[3] = 0.4

    set fav_hero[15] = MOON_CHICK
    set fav_hero[16] = ARCHMAGE
    set fav_hero[17] = FAR_SEER
    set fav_hero[18] = LICH
    set fav_hero[19] = BEAST_MASTER

    set fav_unit[12] = HUNTRESS
    set fav_unit[13] = GRYPHON
    set fav_unit[14] = GRUNT
    set fav_unit[15] = CRYPT_FIEND

    set profilename[4] = "Aggressario"
    set p_aggression[4] = -2
    set p_uncertainty[4] = 6
    set p_minimum_attack_strength[4] = 8
    set p_farm_food[4] = 9
    set p_exp_first_time[4] = -8
    set p_exp_second_time[4] = 15
    set p_strat_persistence[4] = 800
    set p_gold_unit_percentage[4] = 1
    set p_taunt_rate[4] = 1
    set p_expansion_target_bonus[4] = 12
    set p_comp_chosen_target_bonus[4] = 7
    set p_comp_chosen_target_rate[4] = 0.3

    set fav_hero[20] = KEEPER
    set fav_hero[21] = BLOOD_MAGE
    set fav_hero[22] = TAUREN_CHIEF
    set fav_hero[23] = DEATH_KNIGHT
    set fav_hero[24] = DARK_RANGER

    set fav_unit[16] = HUNTRESS
    set fav_unit[17] = RIFLEMAN
    set fav_unit[18] = GRUNT
    set fav_unit[19] = GHOUL

    set profilename[5] = "chick3n"
    set p_aggression[5] = -15
    set p_uncertainty[5] = 4
    set p_minimum_attack_strength[5] = 7
    set p_farm_food[5] = 10
    set p_exp_first_time[5] = 6
    set p_exp_second_time[5] = 16
    set p_strat_persistence[5] = 1000
    set p_gold_unit_percentage[5] = 0.9
    set p_taunt_rate[5] = 1
    set p_expansion_target_bonus[5] = 3
    set p_comp_chosen_target_bonus[5] = 3
    set p_comp_chosen_target_rate[5] = 0.8

    set fav_hero[25] = WARDEN
    set fav_hero[26] = MTN_KING
    set fav_hero[27] = FAR_SEER
    set fav_hero[28] = DREAD_LORD
    set fav_hero[29] = BEAST_MASTER

    set fav_unit[20] = ARCHER
    set fav_unit[21] = MORTAR
    set fav_unit[22] = GRUNT
    set fav_unit[23] = GHOUL

    set profilename[6] = "CPU"
    set p_aggression[6] = -9
    set p_uncertainty[6] = 5
    set p_minimum_attack_strength[6] = 7
    set p_farm_food[6] = 9
    set p_exp_first_time[6] = 6
    set p_exp_second_time[6] = 18
    set p_strat_persistence[6] = 900
    set p_gold_unit_percentage[6] = 0.9
    set p_taunt_rate[6] = 1
    set p_expansion_target_bonus[6] = 8
    set p_comp_chosen_target_bonus[6] = 6
    set p_comp_chosen_target_rate[6] = 0.5

    set fav_hero[30] = DEMON_HUNTER
    set fav_hero[31] = ARCHMAGE
    set fav_hero[32] = BLADE_MASTER
    set fav_hero[33] = DREAD_LORD
    set fav_hero[34] = SEA_WITCH

    set fav_unit[24] = HUNTRESS
    set fav_unit[25] = KNIGHT
    set fav_unit[26] = GRUNT
    set fav_unit[27] = GHOUL

    set profilename[7] = "ErRoR"
    set p_aggression[7] = -10
    set p_uncertainty[7] = 7
    set p_minimum_attack_strength[7] = 8
    set p_farm_food[7] = 8
    set p_exp_first_time[7] = 8
    set p_exp_second_time[7] = 13
    set p_strat_persistence[7] = 800
    set p_gold_unit_percentage[7] = 0.9
    set p_taunt_rate[7] = 1
    set p_expansion_target_bonus[7] = 7
    set p_comp_chosen_target_bonus[7] = 7
    set p_comp_chosen_target_rate[7] = 0.6

    set fav_hero[35] = MOON_CHICK
    set fav_hero[36] = ARCHMAGE
    set fav_hero[37] = FAR_SEER
    set fav_hero[38] = CRYPT_LORD
    set fav_hero[39] = GOBLIN_THINKER

    set fav_unit[28] = HUNTRESS
    set fav_unit[29] = GRYPHON
    set fav_unit[30] = CATAPULT
    set fav_unit[31] = CRYPT_FIEND

    set profilename[8] = "RomuLus"
    set p_aggression[8] = -11
    set p_uncertainty[8] = 4
    set p_minimum_attack_strength[8] = 7
    set p_farm_food[8] = 7
    set p_exp_first_time[8] = 9
    set p_exp_second_time[8] = 12
    set p_strat_persistence[8] = 1100
    set p_gold_unit_percentage[8] = 1
    set p_taunt_rate[8] = 1
    set p_expansion_target_bonus[8] = 7
    set p_comp_chosen_target_bonus[8] = 3
    set p_comp_chosen_target_rate[8] = 0.5

    set fav_hero[40] = KEEPER
    set fav_hero[41] = MTN_KING
    set fav_hero[42] = FAR_SEER
    set fav_hero[43] = LICH
    set fav_hero[44] = DARK_RANGER

    set fav_unit[32] = HUNTRESS
    set fav_unit[33] = KNIGHT
    set fav_unit[34] = WYVERN
    set fav_unit[35] = NECRO

    set profilename[9] = "ReMus"
    set p_aggression[9] = -11
    set p_uncertainty[9] = 5
    set p_minimum_attack_strength[9] = 8
    set p_farm_food[9] = 6
    set p_exp_first_time[9] = 7
    set p_exp_second_time[9] = 14
    set p_strat_persistence[9] = 1050
    set p_gold_unit_percentage[9] = 1
    set p_taunt_rate[9] = 1
    set p_expansion_target_bonus[9] = 8
    set p_comp_chosen_target_bonus[9] = 4
    set p_comp_chosen_target_rate[9] = 0.5

    set fav_hero[45] = WARDEN
    set fav_hero[46] = BLOOD_MAGE
    set fav_hero[47] = FAR_SEER
    set fav_hero[48] = DEATH_KNIGHT
    set fav_hero[49] = BREW_MASTER

    set fav_unit[36] = DRYAD
    set fav_unit[37] = RIFLEMAN
    set fav_unit[38] = TAUREN
    set fav_unit[39] = CRYPT_FIEND

    set profilename[10] = "Xerox"
    set p_aggression[10] = -7
    set p_uncertainty[10] = 9
    set p_minimum_attack_strength[10] = 6
    set p_farm_food[10] = 10
    set p_exp_first_time[10] = 9
    set p_exp_second_time[10] = 12
    set p_strat_persistence[10] = 700
    set p_gold_unit_percentage[10] = 0.95
    set p_taunt_rate[10] = 1
    set p_expansion_target_bonus[10] = 12
    set p_comp_chosen_target_bonus[10] = 5
    set p_comp_chosen_target_rate[10] = 0.6

    set fav_hero[50] = DEMON_HUNTER
    set fav_hero[51] = ARCHMAGE
    set fav_hero[52] = SHADOW_HUNTER
    set fav_hero[53] = DREAD_LORD
    set fav_hero[54] = BEAST_MASTER

    set fav_unit[40] = HUNTRESS
    set fav_unit[41] = KNIGHT
    set fav_unit[42] = GRUNT
    set fav_unit[43] = CRYPT_FIEND

    set profilename[11] = "Xenon"
    set p_aggression[11] = -7
    set p_uncertainty[11] = 8
    set p_minimum_attack_strength[11] = 7
    set p_farm_food[11] = 8
    set p_exp_first_time[11] = -9
    set p_exp_second_time[11] = 12
    set p_strat_persistence[11] = 800
    set p_gold_unit_percentage[11] = 0.9
    set p_taunt_rate[11] = 1
    set p_expansion_target_bonus[11] = 11
    set p_comp_chosen_target_bonus[11] = 6
    set p_comp_chosen_target_rate[11] = 0.4

    set fav_hero[55] = KEEPER
    set fav_hero[56] = ARCHMAGE
    set fav_hero[57] = TAUREN_CHIEF
    set fav_hero[58] = DREAD_LORD
    set fav_hero[59] = GOBLIN_THINKER

    set fav_unit[44] = ARCHER
    set fav_unit[45] = GRYPHON
    set fav_unit[46] = GRUNT
    set fav_unit[47] = GHOUL

    set profilename[12] = "Zitrax"
    set p_aggression[12] = -9
    set p_uncertainty[12] = 11
    set p_minimum_attack_strength[12] = 7
    set p_farm_food[12] = 8
    set p_exp_first_time[12] = 8
    set p_exp_second_time[12] = 17
    set p_strat_persistence[12] = 700
    set p_gold_unit_percentage[12] = 1
    set p_taunt_rate[12] = 1
    set p_expansion_target_bonus[12] = 5
    set p_comp_chosen_target_bonus[12] = 8
    set p_comp_chosen_target_rate[12] = 0.6

    set fav_hero[60] = MOON_CHICK
    set fav_hero[61] = MTN_KING
    set fav_hero[62] = FAR_SEER
    set fav_hero[63] = DEATH_KNIGHT
    set fav_hero[64] = DARK_RANGER

    set fav_unit[48] = HUNTRESS
    set fav_unit[49] = RIFLEMAN
    set fav_unit[50] = HEAD_HUNTER
    set fav_unit[51] = GHOUL

    set profilename[13] = "Menace"
    set p_aggression[13] = -11
    set p_uncertainty[13] = 12
    set p_minimum_attack_strength[13] = 6
    set p_farm_food[13] = 9
    set p_exp_first_time[13] = 7
    set p_exp_second_time[13] = 17
    set p_strat_persistence[13] = 700
    set p_gold_unit_percentage[13] = 0.85
    set p_taunt_rate[13] = 1
    set p_expansion_target_bonus[13] = 6
    set p_comp_chosen_target_bonus[13] = 6
    set p_comp_chosen_target_rate[13] = 0.7

    set fav_hero[65] = KEEPER
    set fav_hero[66] = ARCHMAGE
    set fav_hero[67] = BLADE_MASTER
    set fav_hero[68] = DEATH_KNIGHT
    set fav_hero[69] = PIT_LORD

    set fav_unit[52] = HUNTRESS
    set fav_unit[53] = MORTAR
    set fav_unit[54] = GRUNT
    set fav_unit[55] = FROST_WYRM

    set profilename[14] = "Razkal"
    set p_aggression[14] = -8
    set p_uncertainty[14] = 8
    set p_minimum_attack_strength[14] = 8
    set p_farm_food[14] = 6
    set p_exp_first_time[14] = 6
    set p_exp_second_time[14] = 12
    set p_strat_persistence[14] = 800
    set p_gold_unit_percentage[14] = 1
    set p_taunt_rate[14] = 1
    set p_expansion_target_bonus[14] = 7
    set p_comp_chosen_target_bonus[14] = 7
    set p_comp_chosen_target_rate[14] = 0.6

    set fav_hero[70] = WARDEN
    set fav_hero[71] = ARCHMAGE
    set fav_hero[72] = FAR_SEER
    set fav_hero[73] = CRYPT_LORD
    set fav_hero[74] = BREW_MASTER

    set fav_unit[56] = DRYAD
    set fav_unit[57] = KNIGHT
    set fav_unit[58] = WYVERN
    set fav_unit[59] = NECRO

    set profilename[15] = "Terra"
    set p_aggression[15] = -9
    set p_uncertainty[15] = 7
    set p_minimum_attack_strength[15] = 7
    set p_farm_food[15] = 9
    set p_exp_first_time[15] = 8
    set p_exp_second_time[15] = 14
    set p_strat_persistence[15] = 900
    set p_gold_unit_percentage[15] = 1.05
    set p_taunt_rate[15] = 1
    set p_expansion_target_bonus[15] = 5
    set p_comp_chosen_target_bonus[15] = 8
    set p_comp_chosen_target_rate[15] = 0.5

    set fav_hero[75] = DEMON_HUNTER
    set fav_hero[76] = MTN_KING
    set fav_hero[77] = FAR_SEER
    set fav_hero[78] = LICH
    set fav_hero[79] = DARK_RANGER

    set fav_unit[60] = HUNTRESS
    set fav_unit[61] = GRYPHON
    set fav_unit[62] = CATAPULT
    set fav_unit[63] = CRYPT_FIEND

    set profilename[16] = "Utopio"
    set p_aggression[16] = -8
    set p_uncertainty[16] = 9
    set p_minimum_attack_strength[16] = 8
    set p_farm_food[16] = 8
    set p_exp_first_time[16] = -8
    set p_exp_second_time[16] = 15
    set p_strat_persistence[16] = 850
    set p_gold_unit_percentage[16] = 0.85
    set p_taunt_rate[16] = 1
    set p_expansion_target_bonus[16] = 8
    set p_comp_chosen_target_bonus[16] = 5
    set p_comp_chosen_target_rate[16] = 0.4

    set fav_hero[80] = KEEPER
    set fav_hero[81] = BLOOD_MAGE
    set fav_hero[82] = FAR_SEER
    set fav_hero[83] = DEATH_KNIGHT
    set fav_hero[84] = BEAST_MASTER

    set fav_unit[64] = DRUID_CLAW
    set fav_unit[65] = RIFLEMAN
    set fav_unit[66] = WYVERN
    set fav_unit[67] = GHOUL

    set profilename[17] = "Q"
    set p_aggression[17] = -11
    set p_uncertainty[17] = 8
    set p_minimum_attack_strength[17] = 7
    set p_farm_food[17] = 7
    set p_exp_first_time[17] = 7
    set p_exp_second_time[17] = 16
    set p_strat_persistence[17] = 950
    set p_gold_unit_percentage[17] = 0.9
    set p_taunt_rate[17] = 1
    set p_expansion_target_bonus[17] = 9
    set p_comp_chosen_target_bonus[17] = 6
    set p_comp_chosen_target_rate[17] = 0.5

    set fav_hero[85] = MOON_CHICK
    set fav_hero[86] = MTN_KING
    set fav_hero[87] = FAR_SEER
    set fav_hero[88] = CRYPT_LORD
    set fav_hero[89] = PIT_LORD

    set fav_unit[68] = HUNTRESS
    set fav_unit[69] = KNIGHT
    set fav_unit[70] = HEAD_HUNTER
    set fav_unit[71] = CRYPT_FIEND

    set profilename[18] = "MaTrIx"
    set p_aggression[18] = -10
    set p_uncertainty[18] = 5
    set p_minimum_attack_strength[18] = 8
    set p_farm_food[18] = 10
    set p_exp_first_time[18] = 9
    set p_exp_second_time[18] = 14
    set p_strat_persistence[18] = 970
    set p_gold_unit_percentage[18] = 1
    set p_taunt_rate[18] = 1
    set p_expansion_target_bonus[18] = 5
    set p_comp_chosen_target_bonus[18] = 8
    set p_comp_chosen_target_rate[18] = 0.6

    set fav_hero[90] = DEMON_HUNTER
    set fav_hero[91] = MTN_KING
    set fav_hero[92] = FAR_SEER
    set fav_hero[93] = DREAD_LORD
    set fav_hero[94] = SEA_WITCH

    set fav_unit[72] = CHIMAERA
    set fav_unit[73] = KNIGHT
    set fav_unit[74] = GRUNT
    set fav_unit[75] = GHOUL

    set profilename[19] = "BORG"
    set p_aggression[19] = -12
    set p_uncertainty[19] = 6
    set p_minimum_attack_strength[19] = 7
    set p_farm_food[19] = 8
    set p_exp_first_time[19] = -7
    set p_exp_second_time[19] = 13
    set p_strat_persistence[19] = 780
    set p_gold_unit_percentage[19] = 0.95
    set p_taunt_rate[19] = 1
    set p_expansion_target_bonus[19] = 10
    set p_comp_chosen_target_bonus[19] = 7
    set p_comp_chosen_target_rate[19] = 0.6

    set fav_hero[95] = DEMON_HUNTER
    set fav_hero[96] = ARCHMAGE
    set fav_hero[97] = TAUREN_CHIEF
    set fav_hero[98] = DREAD_LORD
    set fav_hero[99] = BREW_MASTER

    set fav_unit[76] = DRYAD
    set fav_unit[77] = KNIGHT
    set fav_unit[78] = GRUNT
    set fav_unit[79] = GHOUL

    set profilename[20] = "Cybernetic"
    set p_aggression[20] = -7
    set p_uncertainty[20] = 5
    set p_minimum_attack_strength[20] = 7
    set p_farm_food[20] = 9
    set p_exp_first_time[20] = 6
    set p_exp_second_time[20] = 15
    set p_strat_persistence[20] = 960
    set p_gold_unit_percentage[20] = 0.9
    set p_taunt_rate[20] = 1
    set p_expansion_target_bonus[20] = 13
    set p_comp_chosen_target_bonus[20] = 5
    set p_comp_chosen_target_rate[20] = 0.5

    set fav_hero[100] = WARDEN
    set fav_hero[101] = PALADIN
    set fav_hero[102] = SHADOW_HUNTER
    set fav_hero[103] = DEATH_KNIGHT
    set fav_hero[104] = DARK_RANGER

    set fav_unit[80] = DRUID_TALON
    set fav_unit[81] = GRYPHON
    set fav_unit[82] = TAUREN
    set fav_unit[83] = NECRO

    set profilename[21] = "CyberPro"
    set p_aggression[21] = -6
    set p_uncertainty[21] = 6
    set p_minimum_attack_strength[21] = 8
    set p_farm_food[21] = 10
    set p_exp_first_time[21] = 6
    set p_exp_second_time[21] = 14
    set p_strat_persistence[21] = 800
    set p_gold_unit_percentage[21] = 1
    set p_taunt_rate[21] = 1
    set p_expansion_target_bonus[21] = 11
    set p_comp_chosen_target_bonus[21] = 3
    set p_comp_chosen_target_rate[21] = 0.5

    set fav_hero[105] = KEEPER
    set fav_hero[106] = ARCHMAGE
    set fav_hero[107] = BLADE_MASTER
    set fav_hero[108] = LICH
    set fav_hero[109] = BEAST_MASTER

    set fav_unit[84] = ARCHER
    set fav_unit[85] = RIFLEMAN
    set fav_unit[86] = WYVERN
    set fav_unit[87] = CRYPT_FIEND

    set profilename[22] = "Cyrrix"
    set p_aggression[22] = -7
    set p_uncertainty[22] = 5
    set p_minimum_attack_strength[22] = 8
    set p_farm_food[22] = 8
    set p_exp_first_time[22] = -7
    set p_exp_second_time[22] = 13
    set p_strat_persistence[22] = 900
    set p_gold_unit_percentage[22] = 0.8
    set p_taunt_rate[22] = 1
    set p_expansion_target_bonus[22] = 10
    set p_comp_chosen_target_bonus[22] = 4
    set p_comp_chosen_target_rate[22] = 0.4

    set fav_hero[110] = DEMON_HUNTER
    set fav_hero[111] = BLOOD_MAGE
    set fav_hero[112] = TAUREN_CHIEF
    set fav_hero[113] = DREAD_LORD
    set fav_hero[114] = GOBLIN_THINKER

    set fav_unit[88] = DRYAD
    set fav_unit[89] = KNIGHT
    set fav_unit[90] = HEAD_HUNTER
    set fav_unit[91] = FROST_WYRM

    set profilename[23] = "ArraXy"
    set p_aggression[23] = -10
    set p_uncertainty[23] = 9
    set p_minimum_attack_strength[23] = 7
    set p_farm_food[23] = 11
    set p_exp_first_time[23] = 8
    set p_exp_second_time[23] = 16
    set p_strat_persistence[23] = 700
    set p_gold_unit_percentage[23] = 0.9
    set p_taunt_rate[23] = 1
    set p_expansion_target_bonus[23] = 8
    set p_comp_chosen_target_bonus[23] = 6
    set p_comp_chosen_target_rate[23] = 0.5

    set fav_hero[115] = MOON_CHICK
    set fav_hero[116] = ARCHMAGE
    set fav_hero[117] = FAR_SEER
    set fav_hero[118] = CRYPT_LORD
    set fav_hero[119] = PIT_LORD

    set fav_unit[92] = HUNTRESS
    set fav_unit[93] = MORTAR
    set fav_unit[94] = CATAPULT
    set fav_unit[95] = NECRO

    set profilename[24] = "Trollus"
    set p_aggression[24] = -8
    set p_uncertainty[24] = 8
    set p_minimum_attack_strength[24] = 7
    set p_farm_food[24] = 8
    set p_exp_first_time[24] = 7
    set p_exp_second_time[24] = 13
    set p_strat_persistence[24] = 870
    set p_gold_unit_percentage[24] = 1
    set p_taunt_rate[24] = 1
    set p_expansion_target_bonus[24] = 9
    set p_comp_chosen_target_bonus[24] = 7
    set p_comp_chosen_target_rate[24] = 0.4

    set fav_hero[120] = WARDEN
    set fav_hero[121] = ARCHMAGE
    set fav_hero[122] = FAR_SEER
    set fav_hero[123] = GOBLIN_THINKER_M
    set fav_hero[124] = SEA_WITCH

    set fav_unit[96] = CHIMAERA
    set fav_unit[97] = RIFLEMAN
    set fav_unit[98] = GRUNT
    set fav_unit[99] = GHOUL

    set profilename[25] = "Aaargh"
    set p_aggression[25] = -9
    set p_uncertainty[25] = 9
    set p_minimum_attack_strength[25] = 7
    set p_farm_food[25] = 9
    set p_exp_first_time[25] = -7
    set p_exp_second_time[25] = 18
    set p_strat_persistence[25] = 790
    set p_gold_unit_percentage[25] = 1.1
    set p_taunt_rate[25] = 1
    set p_expansion_target_bonus[25] = 7
    set p_comp_chosen_target_bonus[25] = 5
    set p_comp_chosen_target_rate[25] = 0.4

    set fav_hero[125] = DEMON_HUNTER
    set fav_hero[126] = MTN_KING
    set fav_hero[127] = TAUREN_CHIEF
    set fav_hero[128] = LICH
    set fav_hero[129] = BEAST_MASTER

    set fav_unit[100] = ARCHER
    set fav_unit[101] = GRYPHON
    set fav_unit[102] = HEAD_HUNTER
    set fav_unit[103] = GHOUL

    set profile_length = 25

endfunction

function IsProfileUsed takes integer profile returns boolean
  return GetStoredBoolean(com, "ProfileUsed", Int2Str(profile))
endfunction

function SetProfileUsed takes integer profile returns nothing
  call StoreBoolean(com, "ProfileUsed", Int2Str(profile), true)
endfunction

function InitProfile takes nothing returns nothing

  call set_profiles()
  
  if debug_profile != -1 then
    set profile = debug_profile
  else
    loop
      set profile = GetRandomInt(0, profile_length)
      exitwhen not IsProfileUsed(profile)
    endloop
  endif

  call SetProfileUsed(profile)

  set ai_name = profilename[profile]

  if add_tag == true then
     set ai_name = "[AMAI]"+ai_name
  endif

  if add_skill == true then
     if MeleeDifficulty() == MELEE_NEWBIE then
        set ai_name = ai_name+" (Easy)"
     elseif MeleeDifficulty() == MELEE_INSANE then
        set ai_name = ai_name+" (Insane)"
     else
        set ai_name = ai_name+" (Normal)"
     endif
  endif

  call SetPlayerName(ai_player, ai_name)
  set message_add = c2s(GetPlayerColor(ai_player))
  
  set attacking_aggression = attacking_aggression + p_aggression[profile]
  set uncertainty = p_uncertainty[profile]
  set area_uncertainty = uncertainty / 2
  set minimum_attack_strength = p_minimum_attack_strength[profile]
  set farm_food = p_farm_food[profile]
  set exp_first_time = p_exp_first_time[profile]
  set exp_second_time = p_exp_second_time[profile]
  set strat_persistence = p_strat_persistence[profile]
  set gold_unit_percentage = p_gold_unit_percentage[profile]
  set taunt_rate = p_taunt_rate[profile]
  set expansion_target_bonus = p_expansion_target_bonus[profile]
  set comp_chosen_target_bonus = p_comp_chosen_target_bonus[profile]
  set comp_chosen_target_rate = p_comp_chosen_target_rate[profile]

endfunction

function AddFavoriteUnitRP takes nothing returns nothing
  local integer i = 0
  local string team = "Team" + Int2Str(GetPlayerTeam(ai_player)) + "StratUsed"
  if debug_strategy != -1 then
    set rp_strat[debug_strategy] = 100000
  endif
  loop
    exitwhen i >= rp_strat_length
    if key_unit[i] == fav_unit[profile*4+own_race] then
      set rp_strat[i] = rp_strat[i] + fav_unit_add
    endif
    set i = i + 1
  endloop
  if ai_time < 10 then
    set i = 0
    loop
      exitwhen i >= 4
      set strategy_type_used[i] = GetStoredBoolean(com, team, Int2Str(i))
      set i = i + 1
    endloop
    set i = 0
    loop
      exitwhen i >= rp_strat_length
      if strategy_type_used[strategy_type[i]] then
        set rp_strat[i] = rp_strat[i] - strategy_type_used_penalty
      endif
      set i = i + 1
    endloop
  endif
endfunction

function AddFavoriteHeroRP takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i >= hero_number
    if all_heroes[i] == fav_hero[profile*5+own_race] or all_heroes[i] == fav_hero[profile*5+R_NEUTRAL] then
      set hero_rp[i] = hero_rp[i] + fav_hero_add
    endif
    set i = i + 1
  endloop
endfunction

function StaggerSleep takes real base, real spread returns nothing
    call Sleep(base + spread * I2R(GetAiPlayer()) / I2R(GetPlayers()))
endfunction

function initArrays takes nothing returns nothing

    set old_id[ARCHMAGE] = oARCHMAGE
    set needed1[ARCHMAGE] = HUMAN_ALTAR
    set needed2[ARCHMAGE] = KEEP
    set needed3[ARCHMAGE] = CASTLE
    set tc_add1[ARCHMAGE] = 0
    set tc_add2[ARCHMAGE] = 0
    set available_time[ARCHMAGE] = 0
    set regenerate_time[ARCHMAGE] = 0
    set gold_price[ARCHMAGE] = 0
    set wood_price[ARCHMAGE] = 0

    set old_id[PALADIN] = oPALADIN
    set needed1[PALADIN] = HUMAN_ALTAR
    set needed2[PALADIN] = KEEP
    set needed3[PALADIN] = CASTLE
    set tc_add1[PALADIN] = 0
    set tc_add2[PALADIN] = 0
    set available_time[PALADIN] = 0
    set regenerate_time[PALADIN] = 0
    set gold_price[PALADIN] = 0
    set wood_price[PALADIN] = 0

    set old_id[MTN_KING] = oMTN_KING
    set needed1[MTN_KING] = HUMAN_ALTAR
    set needed2[MTN_KING] = KEEP
    set needed3[MTN_KING] = CASTLE
    set tc_add1[MTN_KING] = 0
    set tc_add2[MTN_KING] = 0
    set available_time[MTN_KING] = 0
    set regenerate_time[MTN_KING] = 0
    set gold_price[MTN_KING] = 0
    set wood_price[MTN_KING] = 0

    set old_id[BLOOD_MAGE] = oBLOOD_MAGE
    set needed1[BLOOD_MAGE] = HUMAN_ALTAR
    set needed2[BLOOD_MAGE] = KEEP
    set needed3[BLOOD_MAGE] = CASTLE
    set tc_add1[BLOOD_MAGE] = 0
    set tc_add2[BLOOD_MAGE] = 0
    set available_time[BLOOD_MAGE] = 0
    set regenerate_time[BLOOD_MAGE] = 0
    set gold_price[BLOOD_MAGE] = 0
    set wood_price[BLOOD_MAGE] = 0

    set old_id[BLADE_MASTER] = oBLADE_MASTER
    set needed1[BLADE_MASTER] = ORC_ALTAR
    set needed2[BLADE_MASTER] = STRONGHOLD
    set needed3[BLADE_MASTER] = FORTRESS
    set tc_add1[BLADE_MASTER] = 0
    set tc_add2[BLADE_MASTER] = 0
    set available_time[BLADE_MASTER] = 0
    set regenerate_time[BLADE_MASTER] = 0
    set gold_price[BLADE_MASTER] = 0
    set wood_price[BLADE_MASTER] = 0

    set old_id[FAR_SEER] = oFAR_SEER
    set needed1[FAR_SEER] = ORC_ALTAR
    set needed2[FAR_SEER] = STRONGHOLD
    set needed3[FAR_SEER] = FORTRESS
    set tc_add1[FAR_SEER] = 0
    set tc_add2[FAR_SEER] = 0
    set available_time[FAR_SEER] = 0
    set regenerate_time[FAR_SEER] = 0
    set gold_price[FAR_SEER] = 0
    set wood_price[FAR_SEER] = 0

    set old_id[TAUREN_CHIEF] = oTAUREN_CHIEF
    set needed1[TAUREN_CHIEF] = ORC_ALTAR
    set needed2[TAUREN_CHIEF] = STRONGHOLD
    set needed3[TAUREN_CHIEF] = FORTRESS
    set tc_add1[TAUREN_CHIEF] = 0
    set tc_add2[TAUREN_CHIEF] = 0
    set available_time[TAUREN_CHIEF] = 0
    set regenerate_time[TAUREN_CHIEF] = 0
    set gold_price[TAUREN_CHIEF] = 0
    set wood_price[TAUREN_CHIEF] = 0

    set old_id[SHADOW_HUNTER] = oSHADOW_HUNTER
    set needed1[SHADOW_HUNTER] = ORC_ALTAR
    set needed2[SHADOW_HUNTER] = STRONGHOLD
    set needed3[SHADOW_HUNTER] = FORTRESS
    set tc_add1[SHADOW_HUNTER] = 0
    set tc_add2[SHADOW_HUNTER] = 0
    set available_time[SHADOW_HUNTER] = 0
    set regenerate_time[SHADOW_HUNTER] = 0
    set gold_price[SHADOW_HUNTER] = 0
    set wood_price[SHADOW_HUNTER] = 0

    set old_id[DEATH_KNIGHT] = oDEATH_KNIGHT
    set needed1[DEATH_KNIGHT] = UNDEAD_ALTAR
    set needed2[DEATH_KNIGHT] = NECROPOLIS_2
    set needed3[DEATH_KNIGHT] = NECROPOLIS_3
    set tc_add1[DEATH_KNIGHT] = 0
    set tc_add2[DEATH_KNIGHT] = 0
    set available_time[DEATH_KNIGHT] = 0
    set regenerate_time[DEATH_KNIGHT] = 0
    set gold_price[DEATH_KNIGHT] = 0
    set wood_price[DEATH_KNIGHT] = 0

    set old_id[DREAD_LORD] = oDREAD_LORD
    set needed1[DREAD_LORD] = UNDEAD_ALTAR
    set needed2[DREAD_LORD] = NECROPOLIS_2
    set needed3[DREAD_LORD] = NECROPOLIS_3
    set tc_add1[DREAD_LORD] = 0
    set tc_add2[DREAD_LORD] = 0
    set available_time[DREAD_LORD] = 0
    set regenerate_time[DREAD_LORD] = 0
    set gold_price[DREAD_LORD] = 0
    set wood_price[DREAD_LORD] = 0

    set old_id[LICH] = oLICH
    set needed1[LICH] = UNDEAD_ALTAR
    set needed2[LICH] = NECROPOLIS_2
    set needed3[LICH] = NECROPOLIS_3
    set tc_add1[LICH] = 0
    set tc_add2[LICH] = 0
    set available_time[LICH] = 0
    set regenerate_time[LICH] = 0
    set gold_price[LICH] = 0
    set wood_price[LICH] = 0

    set old_id[CRYPT_LORD] = oCRYPT_LORD
    set needed1[CRYPT_LORD] = UNDEAD_ALTAR
    set needed2[CRYPT_LORD] = NECROPOLIS_2
    set needed3[CRYPT_LORD] = NECROPOLIS_3
    set tc_add1[CRYPT_LORD] = 0
    set tc_add2[CRYPT_LORD] = 0
    set available_time[CRYPT_LORD] = 0
    set regenerate_time[CRYPT_LORD] = 0
    set gold_price[CRYPT_LORD] = 0
    set wood_price[CRYPT_LORD] = 0

    set old_id[DEMON_HUNTER] = oDEMON_HUNTER
    set needed1[DEMON_HUNTER] = ELF_ALTAR
    set needed2[DEMON_HUNTER] = TREE_AGES
    set needed3[DEMON_HUNTER] = TREE_ETERNITY
    set tc_add1[DEMON_HUNTER] = 0
    set tc_add2[DEMON_HUNTER] = 0
    set available_time[DEMON_HUNTER] = 0
    set regenerate_time[DEMON_HUNTER] = 0
    set gold_price[DEMON_HUNTER] = 0
    set wood_price[DEMON_HUNTER] = 0

    set old_id[KEEPER] = oKEEPER
    set needed1[KEEPER] = ELF_ALTAR
    set needed2[KEEPER] = TREE_AGES
    set needed3[KEEPER] = TREE_ETERNITY
    set tc_add1[KEEPER] = 0
    set tc_add2[KEEPER] = 0
    set available_time[KEEPER] = 0
    set regenerate_time[KEEPER] = 0
    set gold_price[KEEPER] = 0
    set wood_price[KEEPER] = 0

    set old_id[MOON_CHICK] = oMOON_CHICK
    set needed1[MOON_CHICK] = ELF_ALTAR
    set needed2[MOON_CHICK] = TREE_AGES
    set needed3[MOON_CHICK] = TREE_ETERNITY
    set tc_add1[MOON_CHICK] = 0
    set tc_add2[MOON_CHICK] = 0
    set available_time[MOON_CHICK] = 0
    set regenerate_time[MOON_CHICK] = 0
    set gold_price[MOON_CHICK] = 0
    set wood_price[MOON_CHICK] = 0

    set old_id[WARDEN] = oWARDEN
    set needed1[WARDEN] = ELF_ALTAR
    set needed2[WARDEN] = TREE_AGES
    set needed3[WARDEN] = TREE_ETERNITY
    set tc_add1[WARDEN] = 0
    set tc_add2[WARDEN] = 0
    set available_time[WARDEN] = 0
    set regenerate_time[WARDEN] = 0
    set gold_price[WARDEN] = 0
    set wood_price[WARDEN] = 0

    set old_id[NEUTRAL_HERO_START] = oNEUTRAL_HERO_START
    set needed1[NEUTRAL_HERO_START] = 0
    set needed2[NEUTRAL_HERO_START] = 0
    set needed3[NEUTRAL_HERO_START] = 0
    set tc_add1[NEUTRAL_HERO_START] = 0
    set tc_add2[NEUTRAL_HERO_START] = 0
    set available_time[NEUTRAL_HERO_START] = 0
    set regenerate_time[NEUTRAL_HERO_START] = 0
    set gold_price[NEUTRAL_HERO_START] = 0
    set wood_price[NEUTRAL_HERO_START] = 0

    set old_id[SEA_WITCH] = oSEA_WITCH
    set needed1[SEA_WITCH] = racial_altar
    set needed2[SEA_WITCH] = racial_hall2
    set needed3[SEA_WITCH] = racial_hall3
    set tc_add1[SEA_WITCH] = 0
    set tc_add2[SEA_WITCH] = 0
    set available_time[SEA_WITCH] = 25
    set regenerate_time[SEA_WITCH] = 6
    set gold_price[SEA_WITCH] = 0
    set wood_price[SEA_WITCH] = 0

    set old_id[BEAST_MASTER] = oBEAST_MASTER
    set needed1[BEAST_MASTER] = racial_altar
    set needed2[BEAST_MASTER] = racial_hall2
    set needed3[BEAST_MASTER] = racial_hall3
    set tc_add1[BEAST_MASTER] = 0
    set tc_add2[BEAST_MASTER] = 0
    set available_time[BEAST_MASTER] = 25
    set regenerate_time[BEAST_MASTER] = 6
    set gold_price[BEAST_MASTER] = 0
    set wood_price[BEAST_MASTER] = 0

    set old_id[DARK_RANGER] = oDARK_RANGER
    set needed1[DARK_RANGER] = racial_altar
    set needed2[DARK_RANGER] = racial_hall2
    set needed3[DARK_RANGER] = racial_hall3
    set tc_add1[DARK_RANGER] = 0
    set tc_add2[DARK_RANGER] = 0
    set available_time[DARK_RANGER] = 25
    set regenerate_time[DARK_RANGER] = 6
    set gold_price[DARK_RANGER] = 0
    set wood_price[DARK_RANGER] = 0

    set old_id[PIT_LORD] = oPIT_LORD
    set needed1[PIT_LORD] = racial_altar
    set needed2[PIT_LORD] = racial_hall2
    set needed3[PIT_LORD] = racial_hall3
    set tc_add1[PIT_LORD] = 0
    set tc_add2[PIT_LORD] = 0
    set available_time[PIT_LORD] = 25
    set regenerate_time[PIT_LORD] = 6
    set gold_price[PIT_LORD] = 0
    set wood_price[PIT_LORD] = 0

    set old_id[BREW_MASTER] = oBREW_MASTER
    set needed1[BREW_MASTER] = racial_altar
    set needed2[BREW_MASTER] = racial_hall2
    set needed3[BREW_MASTER] = racial_hall3
    set tc_add1[BREW_MASTER] = 0
    set tc_add2[BREW_MASTER] = 0
    set available_time[BREW_MASTER] = 25
    set regenerate_time[BREW_MASTER] = 6
    set gold_price[BREW_MASTER] = 0
    set wood_price[BREW_MASTER] = 0

    set old_id[GOBLIN_THINKER] = oGOBLIN_THINKER
    set needed1[GOBLIN_THINKER] = racial_altar
    set needed2[GOBLIN_THINKER] = racial_hall2
    set needed3[GOBLIN_THINKER] = racial_hall3
    set tc_add1[GOBLIN_THINKER] = 0
    set tc_add2[GOBLIN_THINKER] = 0
    set available_time[GOBLIN_THINKER] = 25
    set regenerate_time[GOBLIN_THINKER] = 6
    set gold_price[GOBLIN_THINKER] = 0
    set wood_price[GOBLIN_THINKER] = 0

    set old_id[GOBLIN_THINKER_M] = oGOBLIN_THINKER_M
    set needed1[GOBLIN_THINKER_M] = racial_altar
    set needed2[GOBLIN_THINKER_M] = racial_hall2
    set needed3[GOBLIN_THINKER_M] = racial_hall3
    set tc_add1[GOBLIN_THINKER_M] = 0
    set tc_add2[GOBLIN_THINKER_M] = 0
    set available_time[GOBLIN_THINKER_M] = 25
    set regenerate_time[GOBLIN_THINKER_M] = 6
    set gold_price[GOBLIN_THINKER_M] = 0
    set wood_price[GOBLIN_THINKER_M] = 0

    set old_id[NEUTRAL_HERO_END] = oNEUTRAL_HERO_END
    set needed1[NEUTRAL_HERO_END] = 0
    set needed2[NEUTRAL_HERO_END] = 0
    set needed3[NEUTRAL_HERO_END] = 0
    set tc_add1[NEUTRAL_HERO_END] = 0
    set tc_add2[NEUTRAL_HERO_END] = 0
    set available_time[NEUTRAL_HERO_END] = 0
    set regenerate_time[NEUTRAL_HERO_END] = 0
    set gold_price[NEUTRAL_HERO_END] = 0
    set wood_price[NEUTRAL_HERO_END] = 0

    set old_id[HERO_END] = oHERO_END
    set needed1[HERO_END] = 0
    set needed2[HERO_END] = 0
    set needed3[HERO_END] = 0
    set tc_add1[HERO_END] = 0
    set tc_add2[HERO_END] = 0
    set available_time[HERO_END] = 0
    set regenerate_time[HERO_END] = 0
    set gold_price[HERO_END] = 0
    set wood_price[HERO_END] = 0

    set old_id[HUMAN_UNITS_START] = oHUMAN_UNITS_START
    set needed1[HUMAN_UNITS_START] = 0
    set needed2[HUMAN_UNITS_START] = 0
    set needed3[HUMAN_UNITS_START] = 0
    set tc_add1[HUMAN_UNITS_START] = 0
    set tc_add2[HUMAN_UNITS_START] = 0
    set available_time[HUMAN_UNITS_START] = 0
    set regenerate_time[HUMAN_UNITS_START] = 0
    set gold_price[HUMAN_UNITS_START] = 0
    set wood_price[HUMAN_UNITS_START] = 0

    set old_id[COPTER] = oCOPTER
    set needed1[COPTER] = WORKSHOP
    set needed2[COPTER] = 0
    set needed3[COPTER] = 0
    set tc_add1[COPTER] = 0
    set tc_add2[COPTER] = 0
    set available_time[COPTER] = 0
    set regenerate_time[COPTER] = 0
    set gold_price[COPTER] = 0
    set wood_price[COPTER] = 0

    set old_id[ELEMENTAL] = oELEMENTAL
    set needed1[ELEMENTAL] = ARCHMAGE
    set needed2[ELEMENTAL] = 0
    set needed3[ELEMENTAL] = 0
    set tc_add1[ELEMENTAL] = 0
    set tc_add2[ELEMENTAL] = 0
    set available_time[ELEMENTAL] = 0
    set regenerate_time[ELEMENTAL] = 0
    set gold_price[ELEMENTAL] = 0
    set wood_price[ELEMENTAL] = 0

    set old_id[FOOTMAN] = oFOOTMAN
    set needed1[FOOTMAN] = BARRACKS
    set needed2[FOOTMAN] = 0
    set needed3[FOOTMAN] = 0
    set tc_add1[FOOTMAN] = 0
    set tc_add2[FOOTMAN] = 0
    set available_time[FOOTMAN] = 0
    set regenerate_time[FOOTMAN] = 0
    set gold_price[FOOTMAN] = 0
    set wood_price[FOOTMAN] = 0

    set old_id[GRYPHON] = oGRYPHON
    set needed1[GRYPHON] = AVIARY
    set needed2[GRYPHON] = 0
    set needed3[GRYPHON] = 0
    set tc_add1[GRYPHON] = 0
    set tc_add2[GRYPHON] = 0
    set available_time[GRYPHON] = 0
    set regenerate_time[GRYPHON] = 0
    set gold_price[GRYPHON] = 0
    set wood_price[GRYPHON] = 0

    set old_id[KNIGHT] = oKNIGHT
    set needed1[KNIGHT] = BARRACKS
    set needed2[KNIGHT] = CASTLE
    set needed3[KNIGHT] = BLACKSMITH
    set tc_add1[KNIGHT] = 0
    set tc_add2[KNIGHT] = 0
    set available_time[KNIGHT] = 0
    set regenerate_time[KNIGHT] = 0
    set gold_price[KNIGHT] = 0
    set wood_price[KNIGHT] = 0

    set old_id[MORTAR] = oMORTAR
    set needed1[MORTAR] = WORKSHOP
    set needed2[MORTAR] = 0
    set needed3[MORTAR] = 0
    set tc_add1[MORTAR] = 0
    set tc_add2[MORTAR] = 0
    set available_time[MORTAR] = 0
    set regenerate_time[MORTAR] = 0
    set gold_price[MORTAR] = 0
    set wood_price[MORTAR] = 0

    set old_id[PEASANT] = oPEASANT
    set needed1[PEASANT] = TOWN_HALL
    set needed2[PEASANT] = 0
    set needed3[PEASANT] = 0
    set tc_add1[PEASANT] = MILITIA
    set tc_add2[PEASANT] = 0
    set available_time[PEASANT] = 0
    set regenerate_time[PEASANT] = 0
    set gold_price[PEASANT] = 0
    set wood_price[PEASANT] = 0

    set old_id[PRIEST] = oPRIEST
    set needed1[PRIEST] = SANCTUM
    set needed2[PRIEST] = 0
    set needed3[PRIEST] = 0
    set tc_add1[PRIEST] = 0
    set tc_add2[PRIEST] = 0
    set available_time[PRIEST] = 0
    set regenerate_time[PRIEST] = 0
    set gold_price[PRIEST] = 0
    set wood_price[PRIEST] = 0

    set old_id[RIFLEMAN] = oRIFLEMAN
    set needed1[RIFLEMAN] = BARRACKS
    set needed2[RIFLEMAN] = BLACKSMITH
    set needed3[RIFLEMAN] = 0
    set tc_add1[RIFLEMAN] = 0
    set tc_add2[RIFLEMAN] = 0
    set available_time[RIFLEMAN] = 0
    set regenerate_time[RIFLEMAN] = 0
    set gold_price[RIFLEMAN] = 0
    set wood_price[RIFLEMAN] = 0

    set old_id[SORCERESS] = oSORCERESS
    set needed1[SORCERESS] = SANCTUM
    set needed2[SORCERESS] = 0
    set needed3[SORCERESS] = 0
    set tc_add1[SORCERESS] = 0
    set tc_add2[SORCERESS] = 0
    set available_time[SORCERESS] = 0
    set regenerate_time[SORCERESS] = 0
    set gold_price[SORCERESS] = 0
    set wood_price[SORCERESS] = 0

    set old_id[TANK] = oTANK
    set needed1[TANK] = WORKSHOP
    set needed2[TANK] = CASTLE
    set needed3[TANK] = 0
    set tc_add1[TANK] = 0
    set tc_add2[TANK] = 0
    set available_time[TANK] = 0
    set regenerate_time[TANK] = 0
    set gold_price[TANK] = 0
    set wood_price[TANK] = 0

    set old_id[SPELL_BREAKER] = oSPELL_BREAKER
    set needed1[SPELL_BREAKER] = SANCTUM
    set needed2[SPELL_BREAKER] = ARCANE_VAULT
    set needed3[SPELL_BREAKER] = 0
    set tc_add1[SPELL_BREAKER] = 0
    set tc_add2[SPELL_BREAKER] = 0
    set available_time[SPELL_BREAKER] = 0
    set regenerate_time[SPELL_BREAKER] = 0
    set gold_price[SPELL_BREAKER] = 0
    set wood_price[SPELL_BREAKER] = 0

    set old_id[HUMAN_DRAGON_HAWK] = oHUMAN_DRAGON_HAWK
    set needed1[HUMAN_DRAGON_HAWK] = AVIARY
    set needed2[HUMAN_DRAGON_HAWK] = 0
    set needed3[HUMAN_DRAGON_HAWK] = 0
    set tc_add1[HUMAN_DRAGON_HAWK] = 0
    set tc_add2[HUMAN_DRAGON_HAWK] = 0
    set available_time[HUMAN_DRAGON_HAWK] = 0
    set regenerate_time[HUMAN_DRAGON_HAWK] = 0
    set gold_price[HUMAN_DRAGON_HAWK] = 0
    set wood_price[HUMAN_DRAGON_HAWK] = 0

    set old_id[MILITIA] = oMILITIA
    set needed1[MILITIA] = 0
    set needed2[MILITIA] = 0
    set needed3[MILITIA] = 0
    set tc_add1[MILITIA] = PEASANT
    set tc_add2[MILITIA] = 0
    set available_time[MILITIA] = 0
    set regenerate_time[MILITIA] = 0
    set gold_price[MILITIA] = 0
    set wood_price[MILITIA] = 0

    set old_id[HUMAN_UNITS_END] = oHUMAN_UNITS_END
    set needed1[HUMAN_UNITS_END] = 0
    set needed2[HUMAN_UNITS_END] = 0
    set needed3[HUMAN_UNITS_END] = 0
    set tc_add1[HUMAN_UNITS_END] = 0
    set tc_add2[HUMAN_UNITS_END] = 0
    set available_time[HUMAN_UNITS_END] = 0
    set regenerate_time[HUMAN_UNITS_END] = 0
    set gold_price[HUMAN_UNITS_END] = 0
    set wood_price[HUMAN_UNITS_END] = 0

    set old_id[HUMAN_BUILDINGS_START] = oHUMAN_BUILDINGS_START
    set needed1[HUMAN_BUILDINGS_START] = 0
    set needed2[HUMAN_BUILDINGS_START] = 0
    set needed3[HUMAN_BUILDINGS_START] = 0
    set tc_add1[HUMAN_BUILDINGS_START] = 0
    set tc_add2[HUMAN_BUILDINGS_START] = 0
    set available_time[HUMAN_BUILDINGS_START] = 0
    set regenerate_time[HUMAN_BUILDINGS_START] = 0
    set gold_price[HUMAN_BUILDINGS_START] = 0
    set wood_price[HUMAN_BUILDINGS_START] = 0

    set old_id[AVIARY] = oAVIARY
    set needed1[AVIARY] = PEASANT 
    set needed2[AVIARY] = KEEP
    set needed3[AVIARY] = LUMBER_MILL
    set tc_add1[AVIARY] = 0
    set tc_add2[AVIARY] = 0
    set available_time[AVIARY] = 0
    set regenerate_time[AVIARY] = 0
    set gold_price[AVIARY] = 0
    set wood_price[AVIARY] = 0

    set old_id[BARRACKS] = oBARRACKS
    set needed1[BARRACKS] = PEASANT 
    set needed2[BARRACKS] = 0
    set needed3[BARRACKS] = 0
    set tc_add1[BARRACKS] = 0
    set tc_add2[BARRACKS] = 0
    set available_time[BARRACKS] = 0
    set regenerate_time[BARRACKS] = 0
    set gold_price[BARRACKS] = 0
    set wood_price[BARRACKS] = 0

    set old_id[BLACKSMITH] = oBLACKSMITH
    set needed1[BLACKSMITH] = PEASANT 
    set needed2[BLACKSMITH] = TOWN_HALL
    set needed3[BLACKSMITH] = 0
    set tc_add1[BLACKSMITH] = 0
    set tc_add2[BLACKSMITH] = 0
    set available_time[BLACKSMITH] = 0
    set regenerate_time[BLACKSMITH] = 0
    set gold_price[BLACKSMITH] = 0
    set wood_price[BLACKSMITH] = 0

    set old_id[CANNON_TOWER] = oCANNON_TOWER
    set needed1[CANNON_TOWER] = WATCH_TOWER
    set needed2[CANNON_TOWER] = WORKSHOP
    set needed3[CANNON_TOWER] = UPGRADED
    set tc_add1[CANNON_TOWER] = 0
    set tc_add2[CANNON_TOWER] = 0
    set available_time[CANNON_TOWER] = 0
    set regenerate_time[CANNON_TOWER] = 0
    set gold_price[CANNON_TOWER] = 0
    set wood_price[CANNON_TOWER] = 0

    set old_id[CASTLE] = oCASTLE
    set needed1[CASTLE] = KEEP          
    set needed2[CASTLE] = HUMAN_ALTAR
    set needed3[CASTLE] = UPGRADED
    set tc_add1[CASTLE] = 0
    set tc_add2[CASTLE] = 0
    set available_time[CASTLE] = 0
    set regenerate_time[CASTLE] = 0
    set gold_price[CASTLE] = 0
    set wood_price[CASTLE] = 0

    set old_id[GUARD_TOWER] = oGUARD_TOWER
    set needed1[GUARD_TOWER] = WATCH_TOWER
    set needed2[GUARD_TOWER] = LUMBER_MILL
    set needed3[GUARD_TOWER] = UPGRADED
    set tc_add1[GUARD_TOWER] = 0
    set tc_add2[GUARD_TOWER] = 0
    set available_time[GUARD_TOWER] = 0
    set regenerate_time[GUARD_TOWER] = 0
    set gold_price[GUARD_TOWER] = 0
    set wood_price[GUARD_TOWER] = 0

    set old_id[HOUSE] = oHOUSE
    set needed1[HOUSE] = PEASANT 
    set needed2[HOUSE] = 0
    set needed3[HOUSE] = 0
    set tc_add1[HOUSE] = 0
    set tc_add2[HOUSE] = 0
    set available_time[HOUSE] = 0
    set regenerate_time[HOUSE] = 0
    set gold_price[HOUSE] = 0
    set wood_price[HOUSE] = 0

    set old_id[HUMAN_ALTAR] = oHUMAN_ALTAR
    set needed1[HUMAN_ALTAR] = PEASANT 
    set needed2[HUMAN_ALTAR] = 0
    set needed3[HUMAN_ALTAR] = 0
    set tc_add1[HUMAN_ALTAR] = 0
    set tc_add2[HUMAN_ALTAR] = 0
    set available_time[HUMAN_ALTAR] = 0
    set regenerate_time[HUMAN_ALTAR] = 0
    set gold_price[HUMAN_ALTAR] = 0
    set wood_price[HUMAN_ALTAR] = 0

    set old_id[KEEP] = oKEEP
    set needed1[KEEP] = TOWN_HALL 
    set needed2[KEEP] = 0
    set needed3[KEEP] = 0
    set tc_add1[KEEP] = CASTLE
    set tc_add2[KEEP] = 0
    set available_time[KEEP] = 0
    set regenerate_time[KEEP] = 0
    set gold_price[KEEP] = 0
    set wood_price[KEEP] = 0

    set old_id[LUMBER_MILL] = oLUMBER_MILL
    set needed1[LUMBER_MILL] = PEASANT 
    set needed2[LUMBER_MILL] = 0
    set needed3[LUMBER_MILL] = 0
    set tc_add1[LUMBER_MILL] = 0
    set tc_add2[LUMBER_MILL] = 0
    set available_time[LUMBER_MILL] = 0
    set regenerate_time[LUMBER_MILL] = 0
    set gold_price[LUMBER_MILL] = 0
    set wood_price[LUMBER_MILL] = 0

    set old_id[SANCTUM] = oSANCTUM
    set needed1[SANCTUM] = PEASANT 
    set needed2[SANCTUM] = KEEP
    set needed3[SANCTUM] = 0
    set tc_add1[SANCTUM] = 0
    set tc_add2[SANCTUM] = 0
    set available_time[SANCTUM] = 0
    set regenerate_time[SANCTUM] = 0
    set gold_price[SANCTUM] = 0
    set wood_price[SANCTUM] = 0

    set old_id[TOWN_HALL] = oTOWN_HALL
    set needed1[TOWN_HALL] = 0
    set needed2[TOWN_HALL] = 0
    set needed3[TOWN_HALL] = 0
    set tc_add1[TOWN_HALL] = KEEP
    set tc_add2[TOWN_HALL] = CASTLE
    set available_time[TOWN_HALL] = 0
    set regenerate_time[TOWN_HALL] = 0
    set gold_price[TOWN_HALL] = 0
    set wood_price[TOWN_HALL] = 0

    set old_id[WATCH_TOWER] = oWATCH_TOWER
    set needed1[WATCH_TOWER] = PEASANT 
    set needed2[WATCH_TOWER] = 0
    set needed3[WATCH_TOWER] = 0
    set tc_add1[WATCH_TOWER] = GUARD_TOWER
    set tc_add2[WATCH_TOWER] = CANNON_TOWER
    set available_time[WATCH_TOWER] = 0
    set regenerate_time[WATCH_TOWER] = 0
    set gold_price[WATCH_TOWER] = 0
    set wood_price[WATCH_TOWER] = 0

    set old_id[WORKSHOP] = oWORKSHOP
    set needed1[WORKSHOP] = PEASANT 
    set needed2[WORKSHOP] = KEEP
    set needed3[WORKSHOP] = BLACKSMITH
    set tc_add1[WORKSHOP] = 0
    set tc_add2[WORKSHOP] = 0
    set available_time[WORKSHOP] = 0
    set regenerate_time[WORKSHOP] = 0
    set gold_price[WORKSHOP] = 0
    set wood_price[WORKSHOP] = 0

    set old_id[ARCANE_VAULT] = oARCANE_VAULT
    set needed1[ARCANE_VAULT] = PEASANT 
    set needed2[ARCANE_VAULT] = 0
    set needed3[ARCANE_VAULT] = 0
    set tc_add1[ARCANE_VAULT] = 0
    set tc_add2[ARCANE_VAULT] = 0
    set available_time[ARCANE_VAULT] = 0
    set regenerate_time[ARCANE_VAULT] = 0
    set gold_price[ARCANE_VAULT] = 0
    set wood_price[ARCANE_VAULT] = 0

    set old_id[ARCANE_TOWER] = oARCANE_TOWER
    set needed1[ARCANE_TOWER] = WATCH_TOWER
    set needed2[ARCANE_TOWER] = 0
    set needed3[ARCANE_TOWER] = UPGRADED
    set tc_add1[ARCANE_TOWER] = 0
    set tc_add2[ARCANE_TOWER] = 0
    set available_time[ARCANE_TOWER] = 0
    set regenerate_time[ARCANE_TOWER] = 0
    set gold_price[ARCANE_TOWER] = 0
    set wood_price[ARCANE_TOWER] = 0

    set old_id[HUMAN_BUILDINGS_END] = oHUMAN_BUILDINGS_END
    set needed1[HUMAN_BUILDINGS_END] = 0
    set needed2[HUMAN_BUILDINGS_END] = 0
    set needed3[HUMAN_BUILDINGS_END] = 0
    set tc_add1[HUMAN_BUILDINGS_END] = 0
    set tc_add2[HUMAN_BUILDINGS_END] = 0
    set available_time[HUMAN_BUILDINGS_END] = 0
    set regenerate_time[HUMAN_BUILDINGS_END] = 0
    set gold_price[HUMAN_BUILDINGS_END] = 0
    set wood_price[HUMAN_BUILDINGS_END] = 0

    set old_id[HUMAN_UPGRADES_START] = oHUMAN_UPGRADES_START
    set needed1[HUMAN_UPGRADES_START] = 0
    set needed2[HUMAN_UPGRADES_START] = 0
    set needed3[HUMAN_UPGRADES_START] = 0
    set tc_add1[HUMAN_UPGRADES_START] = 0
    set tc_add2[HUMAN_UPGRADES_START] = 0
    set available_time[HUMAN_UPGRADES_START] = 0
    set regenerate_time[HUMAN_UPGRADES_START] = 0
    set gold_price[HUMAN_UPGRADES_START] = 0
    set wood_price[HUMAN_UPGRADES_START] = 0

    set old_id[UPG_SIGHT] = oUPG_SIGHT
    set needed1[UPG_SIGHT] = SANCTUM
    set needed2[UPG_SIGHT] = CASTLE
    set needed3[UPG_SIGHT] = 0
    set tc_add1[UPG_SIGHT] = 0
    set tc_add2[UPG_SIGHT] = 0
    set available_time[UPG_SIGHT] = 0
    set regenerate_time[UPG_SIGHT] = 0
    set gold_price[UPG_SIGHT] = 0
    set wood_price[UPG_SIGHT] = 0

    set old_id[UPG_DEFEND] = oUPG_DEFEND
    set needed1[UPG_DEFEND] = BARRACKS
    set needed2[UPG_DEFEND] = 0
    set needed3[UPG_DEFEND] = 0
    set tc_add1[UPG_DEFEND] = 0
    set tc_add2[UPG_DEFEND] = 0
    set available_time[UPG_DEFEND] = 0
    set regenerate_time[UPG_DEFEND] = 0
    set gold_price[UPG_DEFEND] = 0
    set wood_price[UPG_DEFEND] = 0

    set old_id[UPG_BREEDING] = oUPG_BREEDING
    set needed1[UPG_BREEDING] = BARRACKS
    set needed2[UPG_BREEDING] = CASTLE
    set needed3[UPG_BREEDING] = BLACKSMITH
    set tc_add1[UPG_BREEDING] = 0
    set tc_add2[UPG_BREEDING] = 0
    set available_time[UPG_BREEDING] = 0
    set regenerate_time[UPG_BREEDING] = 0
    set gold_price[UPG_BREEDING] = 0
    set wood_price[UPG_BREEDING] = 0

    set old_id[UPG_GUN_RANGE] = oUPG_GUN_RANGE
    set needed1[UPG_GUN_RANGE] = BARRACKS
    set needed2[UPG_GUN_RANGE] = KEEP
    set needed3[UPG_GUN_RANGE] = 0
    set tc_add1[UPG_GUN_RANGE] = 0
    set tc_add2[UPG_GUN_RANGE] = 0
    set available_time[UPG_GUN_RANGE] = 0
    set regenerate_time[UPG_GUN_RANGE] = 0
    set gold_price[UPG_GUN_RANGE] = 0
    set wood_price[UPG_GUN_RANGE] = 0

    set old_id[UPG_SENTINEL] = oUPG_SENTINEL
    set needed1[UPG_SENTINEL] = WORKSHOP
    set needed2[UPG_SENTINEL] = KEEP
    set needed3[UPG_SENTINEL] = 0
    set tc_add1[UPG_SENTINEL] = 0
    set tc_add2[UPG_SENTINEL] = 0
    set available_time[UPG_SENTINEL] = 0
    set regenerate_time[UPG_SENTINEL] = 0
    set gold_price[UPG_SENTINEL] = 0
    set wood_price[UPG_SENTINEL] = 0

    set old_id[UPG_BOMBS] = oUPG_BOMBS
    set needed1[UPG_BOMBS] = WORKSHOP
    set needed2[UPG_BOMBS] = CASTLE
    set needed3[UPG_BOMBS] = 0
    set tc_add1[UPG_BOMBS] = 0
    set tc_add2[UPG_BOMBS] = 0
    set available_time[UPG_BOMBS] = 0
    set regenerate_time[UPG_BOMBS] = 0
    set gold_price[UPG_BOMBS] = 0
    set wood_price[UPG_BOMBS] = 0

    set old_id[UPG_HAMMERS] = oUPG_HAMMERS
    set needed1[UPG_HAMMERS] = AVIARY
    set needed2[UPG_HAMMERS] = ARCANE_VAULT
    set needed3[UPG_HAMMERS] = 0
    set tc_add1[UPG_HAMMERS] = 0
    set tc_add2[UPG_HAMMERS] = 0
    set available_time[UPG_HAMMERS] = 0
    set regenerate_time[UPG_HAMMERS] = 0
    set gold_price[UPG_HAMMERS] = 0
    set wood_price[UPG_HAMMERS] = 0

    set old_id[UPG_FRAGS] = oUPG_FRAGS
    set needed1[UPG_FRAGS] = WORKSHOP
    set needed2[UPG_FRAGS] = CASTLE
    set needed3[UPG_FRAGS] = 0
    set tc_add1[UPG_FRAGS] = 0
    set tc_add2[UPG_FRAGS] = 0
    set available_time[UPG_FRAGS] = 0
    set regenerate_time[UPG_FRAGS] = 0
    set gold_price[UPG_FRAGS] = 0
    set wood_price[UPG_FRAGS] = 0

    set old_id[UPG_TANK] = oUPG_TANK
    set needed1[UPG_TANK] = WORKSHOP
    set needed2[UPG_TANK] = CASTLE
    set needed3[UPG_TANK] = 0
    set tc_add1[UPG_TANK] = 0
    set tc_add2[UPG_TANK] = 0
    set available_time[UPG_TANK] = 0
    set regenerate_time[UPG_TANK] = 0
    set gold_price[UPG_TANK] = 0
    set wood_price[UPG_TANK] = 0

    set old_id[UPG_FLAK] = oUPG_FLAK
    set needed1[UPG_FLAK] = WORKSHOP
    set needed2[UPG_FLAK] = CASTLE
    set needed3[UPG_FLAK] = 0
    set tc_add1[UPG_FLAK] = 0
    set tc_add2[UPG_FLAK] = 0
    set available_time[UPG_FLAK] = 0
    set regenerate_time[UPG_FLAK] = 0
    set gold_price[UPG_FLAK] = 0
    set wood_price[UPG_FLAK] = 0

    set old_id[UPG_CLOUD] = oUPG_CLOUD
    set needed1[UPG_CLOUD] = AVIARY
    set needed2[UPG_CLOUD] = CASTLE
    set needed3[UPG_CLOUD] = ARCANE_VAULT
    set tc_add1[UPG_CLOUD] = 0
    set tc_add2[UPG_CLOUD] = 0
    set available_time[UPG_CLOUD] = 0
    set regenerate_time[UPG_CLOUD] = 0
    set gold_price[UPG_CLOUD] = 0
    set wood_price[UPG_CLOUD] = 0

    set old_id[UPG_CONT_MAGIC] = oUPG_CONT_MAGIC
    set needed1[UPG_CONT_MAGIC] = SANCTUM
    set needed2[UPG_CONT_MAGIC] = ARCANE_VAULT
    set needed3[UPG_CONT_MAGIC] = 0
    set tc_add1[UPG_CONT_MAGIC] = 0
    set tc_add2[UPG_CONT_MAGIC] = 0
    set available_time[UPG_CONT_MAGIC] = 0
    set regenerate_time[UPG_CONT_MAGIC] = 0
    set gold_price[UPG_CONT_MAGIC] = 0
    set wood_price[UPG_CONT_MAGIC] = 0

    set old_id[HUMAN_UPGRADES_END] = oHUMAN_UPGRADES_END
    set needed1[HUMAN_UPGRADES_END] = 0
    set needed2[HUMAN_UPGRADES_END] = 0
    set needed3[HUMAN_UPGRADES_END] = 0
    set tc_add1[HUMAN_UPGRADES_END] = 0
    set tc_add2[HUMAN_UPGRADES_END] = 0
    set available_time[HUMAN_UPGRADES_END] = 0
    set regenerate_time[HUMAN_UPGRADES_END] = 0
    set gold_price[HUMAN_UPGRADES_END] = 0
    set wood_price[HUMAN_UPGRADES_END] = 0

    set old_id[ORC_UNITS_START] = oORC_UNITS_START
    set needed1[ORC_UNITS_START] = 0
    set needed2[ORC_UNITS_START] = 0
    set needed3[ORC_UNITS_START] = 0
    set tc_add1[ORC_UNITS_START] = 0
    set tc_add2[ORC_UNITS_START] = 0
    set available_time[ORC_UNITS_START] = 0
    set regenerate_time[ORC_UNITS_START] = 0
    set gold_price[ORC_UNITS_START] = 0
    set wood_price[ORC_UNITS_START] = 0

    set old_id[CATAPULT] = oCATAPULT
    set needed1[CATAPULT] = ORC_BARRACKS
    set needed2[CATAPULT] = STRONGHOLD
    set needed3[CATAPULT] = FORGE
    set tc_add1[CATAPULT] = 0
    set tc_add2[CATAPULT] = 0
    set available_time[CATAPULT] = 0
    set regenerate_time[CATAPULT] = 0
    set gold_price[CATAPULT] = 0
    set wood_price[CATAPULT] = 0

    set old_id[WITCH_DOCTOR] = oWITCH_DOCTOR
    set needed1[WITCH_DOCTOR] = LODGE
    set needed2[WITCH_DOCTOR] = 0
    set needed3[WITCH_DOCTOR] = 0
    set tc_add1[WITCH_DOCTOR] = 0
    set tc_add2[WITCH_DOCTOR] = 0
    set available_time[WITCH_DOCTOR] = 0
    set regenerate_time[WITCH_DOCTOR] = 0
    set gold_price[WITCH_DOCTOR] = 0
    set wood_price[WITCH_DOCTOR] = 0

    set old_id[GRUNT] = oGRUNT
    set needed1[GRUNT] = ORC_BARRACKS
    set needed2[GRUNT] = 0
    set needed3[GRUNT] = 0
    set tc_add1[GRUNT] = 0
    set tc_add2[GRUNT] = 0
    set available_time[GRUNT] = 0
    set regenerate_time[GRUNT] = 0
    set gold_price[GRUNT] = 0
    set wood_price[GRUNT] = 0

    set old_id[HEAD_HUNTER] = oHEAD_HUNTER
    set needed1[HEAD_HUNTER] = ORC_BARRACKS
    set needed2[HEAD_HUNTER] = FORGE
    set needed3[HEAD_HUNTER] = 0
    set tc_add1[HEAD_HUNTER] = BERSERKER
    set tc_add2[HEAD_HUNTER] = 0
    set available_time[HEAD_HUNTER] = 0
    set regenerate_time[HEAD_HUNTER] = 0
    set gold_price[HEAD_HUNTER] = 0
    set wood_price[HEAD_HUNTER] = 0

    set old_id[KODO_BEAST] = oKODO_BEAST
    set needed1[KODO_BEAST] = BESTIARY
    set needed2[KODO_BEAST] = FORGE
    set needed3[KODO_BEAST] = 0
    set tc_add1[KODO_BEAST] = 0
    set tc_add2[KODO_BEAST] = 0
    set available_time[KODO_BEAST] = 0
    set regenerate_time[KODO_BEAST] = 0
    set gold_price[KODO_BEAST] = 0
    set wood_price[KODO_BEAST] = 0

    set old_id[PEON] = oPEON
    set needed1[PEON] = GREAT_HALL
    set needed2[PEON] = 0
    set needed3[PEON] = 0
    set tc_add1[PEON] = 0
    set tc_add2[PEON] = 0
    set available_time[PEON] = 0
    set regenerate_time[PEON] = 0
    set gold_price[PEON] = 0
    set wood_price[PEON] = 0

    set old_id[RAIDER] = oRAIDER
    set needed1[RAIDER] = BESTIARY
    set needed2[RAIDER] = 0
    set needed3[RAIDER] = 0
    set tc_add1[RAIDER] = 0
    set tc_add2[RAIDER] = 0
    set available_time[RAIDER] = 0
    set regenerate_time[RAIDER] = 0
    set gold_price[RAIDER] = 0
    set wood_price[RAIDER] = 0

    set old_id[SHAMAN] = oSHAMAN
    set needed1[SHAMAN] = LODGE
    set needed2[SHAMAN] = 0
    set needed3[SHAMAN] = 0
    set tc_add1[SHAMAN] = 0
    set tc_add2[SHAMAN] = 0
    set available_time[SHAMAN] = 0
    set regenerate_time[SHAMAN] = 0
    set gold_price[SHAMAN] = 0
    set wood_price[SHAMAN] = 0

    set old_id[TAUREN] = oTAUREN
    set needed1[TAUREN] = TOTEM
    set needed2[TAUREN] = 0
    set needed3[TAUREN] = 0
    set tc_add1[TAUREN] = 0
    set tc_add2[TAUREN] = 0
    set available_time[TAUREN] = 0
    set regenerate_time[TAUREN] = 0
    set gold_price[TAUREN] = 0
    set wood_price[TAUREN] = 0

    set old_id[WYVERN] = oWYVERN
    set needed1[WYVERN] = BESTIARY
    set needed2[WYVERN] = 0
    set needed3[WYVERN] = 0
    set tc_add1[WYVERN] = 0
    set tc_add2[WYVERN] = 0
    set available_time[WYVERN] = 0
    set regenerate_time[WYVERN] = 0
    set gold_price[WYVERN] = 0
    set wood_price[WYVERN] = 0

    set old_id[BATRIDER] = oBATRIDER
    set needed1[BATRIDER] = BESTIARY
    set needed2[BATRIDER] = VOODOO_LOUNGE
    set needed3[BATRIDER] = 0
    set tc_add1[BATRIDER] = 0
    set tc_add2[BATRIDER] = 0
    set available_time[BATRIDER] = 0
    set regenerate_time[BATRIDER] = 0
    set gold_price[BATRIDER] = 0
    set wood_price[BATRIDER] = 0

    set old_id[SPIRIT_WALKER] = oSPIRIT_WALKER
    set needed1[SPIRIT_WALKER] = LODGE
    set needed2[SPIRIT_WALKER] = 0
    set needed3[SPIRIT_WALKER] = 0
    set tc_add1[SPIRIT_WALKER] = SPIRIT_WALKER_M
    set tc_add2[SPIRIT_WALKER] = 0
    set available_time[SPIRIT_WALKER] = 0
    set regenerate_time[SPIRIT_WALKER] = 0
    set gold_price[SPIRIT_WALKER] = 0
    set wood_price[SPIRIT_WALKER] = 0

    set old_id[SPIRIT_WALKER_M] = oSPIRIT_WALKER_M
    set needed1[SPIRIT_WALKER_M] = LODGE
    set needed2[SPIRIT_WALKER_M] = 0
    set needed3[SPIRIT_WALKER_M] = 0
    set tc_add1[SPIRIT_WALKER_M] = 0
    set tc_add2[SPIRIT_WALKER_M] = SPIRIT_WALKER
    set available_time[SPIRIT_WALKER_M] = 0
    set regenerate_time[SPIRIT_WALKER_M] = 0
    set gold_price[SPIRIT_WALKER_M] = 0
    set wood_price[SPIRIT_WALKER_M] = 0

    set old_id[BERSERKER] = oBERSERKER
    set needed1[BERSERKER] = ORC_BARRACKS
    set needed2[BERSERKER] = FORGE
    set needed3[BERSERKER] = 0
    set tc_add1[BERSERKER] = 0
    set tc_add2[BERSERKER] = 0
    set available_time[BERSERKER] = 0
    set regenerate_time[BERSERKER] = 0
    set gold_price[BERSERKER] = 0
    set wood_price[BERSERKER] = 0

    set old_id[ORC_UNITS_END] = oORC_UNITS_END
    set needed1[ORC_UNITS_END] = 0
    set needed2[ORC_UNITS_END] = 0
    set needed3[ORC_UNITS_END] = 0
    set tc_add1[ORC_UNITS_END] = 0
    set tc_add2[ORC_UNITS_END] = 0
    set available_time[ORC_UNITS_END] = 0
    set regenerate_time[ORC_UNITS_END] = 0
    set gold_price[ORC_UNITS_END] = 0
    set wood_price[ORC_UNITS_END] = 0

    set old_id[ORC_BUILDINGS_START] = oORC_BUILDINGS_START
    set needed1[ORC_BUILDINGS_START] = 0
    set needed2[ORC_BUILDINGS_START] = 0
    set needed3[ORC_BUILDINGS_START] = 0
    set tc_add1[ORC_BUILDINGS_START] = 0
    set tc_add2[ORC_BUILDINGS_START] = 0
    set available_time[ORC_BUILDINGS_START] = 0
    set regenerate_time[ORC_BUILDINGS_START] = 0
    set gold_price[ORC_BUILDINGS_START] = 0
    set wood_price[ORC_BUILDINGS_START] = 0

    set old_id[ORC_ALTAR] = oORC_ALTAR
    set needed1[ORC_ALTAR] = PEON
    set needed2[ORC_ALTAR] = 0
    set needed3[ORC_ALTAR] = 0
    set tc_add1[ORC_ALTAR] = 0
    set tc_add2[ORC_ALTAR] = 0
    set available_time[ORC_ALTAR] = 0
    set regenerate_time[ORC_ALTAR] = 0
    set gold_price[ORC_ALTAR] = 0
    set wood_price[ORC_ALTAR] = 0

    set old_id[ORC_BARRACKS] = oORC_BARRACKS
    set needed1[ORC_BARRACKS] = PEON
    set needed2[ORC_BARRACKS] = 0
    set needed3[ORC_BARRACKS] = 0
    set tc_add1[ORC_BARRACKS] = 0
    set tc_add2[ORC_BARRACKS] = 0
    set available_time[ORC_BARRACKS] = 0
    set regenerate_time[ORC_BARRACKS] = 0
    set gold_price[ORC_BARRACKS] = 0
    set wood_price[ORC_BARRACKS] = 0

    set old_id[BESTIARY] = oBESTIARY
    set needed1[BESTIARY] = PEON
    set needed2[BESTIARY] = STRONGHOLD
    set needed3[BESTIARY] = 0
    set tc_add1[BESTIARY] = 0
    set tc_add2[BESTIARY] = 0
    set available_time[BESTIARY] = 0
    set regenerate_time[BESTIARY] = 0
    set gold_price[BESTIARY] = 0
    set wood_price[BESTIARY] = 0

    set old_id[FORGE] = oFORGE
    set needed1[FORGE] = PEON
    set needed2[FORGE] = 0
    set needed3[FORGE] = 0
    set tc_add1[FORGE] = 0
    set tc_add2[FORGE] = 0
    set available_time[FORGE] = 0
    set regenerate_time[FORGE] = 0
    set gold_price[FORGE] = 0
    set wood_price[FORGE] = 0

    set old_id[FORTRESS] = oFORTRESS
    set needed1[FORTRESS] = STRONGHOLD
    set needed2[FORTRESS] = ORC_ALTAR
    set needed3[FORTRESS] = UPGRADED
    set tc_add1[FORTRESS] = 0
    set tc_add2[FORTRESS] = 0
    set available_time[FORTRESS] = 0
    set regenerate_time[FORTRESS] = 0
    set gold_price[FORTRESS] = 0
    set wood_price[FORTRESS] = 0

    set old_id[GREAT_HALL] = oGREAT_HALL
    set needed1[GREAT_HALL] = 0
    set needed2[GREAT_HALL] = 0
    set needed3[GREAT_HALL] = 0
    set tc_add1[GREAT_HALL] = STRONGHOLD
    set tc_add2[GREAT_HALL] = FORTRESS
    set available_time[GREAT_HALL] = 0
    set regenerate_time[GREAT_HALL] = 0
    set gold_price[GREAT_HALL] = 0
    set wood_price[GREAT_HALL] = 0

    set old_id[LODGE] = oLODGE
    set needed1[LODGE] = PEON
    set needed2[LODGE] = STRONGHOLD
    set needed3[LODGE] = 0
    set tc_add1[LODGE] = 0
    set tc_add2[LODGE] = 0
    set available_time[LODGE] = 0
    set regenerate_time[LODGE] = 0
    set gold_price[LODGE] = 0
    set wood_price[LODGE] = 0

    set old_id[STRONGHOLD] = oSTRONGHOLD
    set needed1[STRONGHOLD] = GREAT_HALL
    set needed2[STRONGHOLD] = 0
    set needed3[STRONGHOLD] = UPGRADED
    set tc_add1[STRONGHOLD] = FORTRESS
    set tc_add2[STRONGHOLD] = 0
    set available_time[STRONGHOLD] = 0
    set regenerate_time[STRONGHOLD] = 0
    set gold_price[STRONGHOLD] = 0
    set wood_price[STRONGHOLD] = 0

    set old_id[BURROW] = oBURROW
    set needed1[BURROW] = PEON
    set needed2[BURROW] = 0
    set needed3[BURROW] = 0
    set tc_add1[BURROW] = 0
    set tc_add2[BURROW] = 0
    set available_time[BURROW] = 0
    set regenerate_time[BURROW] = 0
    set gold_price[BURROW] = 0
    set wood_price[BURROW] = 0

    set old_id[TOTEM] = oTOTEM
    set needed1[TOTEM] = PEON
    set needed2[TOTEM] = FORTRESS
    set needed3[TOTEM] = FORGE
    set tc_add1[TOTEM] = 0
    set tc_add2[TOTEM] = 0
    set available_time[TOTEM] = 0
    set regenerate_time[TOTEM] = 0
    set gold_price[TOTEM] = 0
    set wood_price[TOTEM] = 0

    set old_id[ORC_WATCH_TOWER] = oORC_WATCH_TOWER
    set needed1[ORC_WATCH_TOWER] = PEON
    set needed2[ORC_WATCH_TOWER] = FORGE
    set needed3[ORC_WATCH_TOWER] = 0
    set tc_add1[ORC_WATCH_TOWER] = 0
    set tc_add2[ORC_WATCH_TOWER] = 0
    set available_time[ORC_WATCH_TOWER] = 0
    set regenerate_time[ORC_WATCH_TOWER] = 0
    set gold_price[ORC_WATCH_TOWER] = 0
    set wood_price[ORC_WATCH_TOWER] = 0

    set old_id[VOODOO_LOUNGE] = oVOODOO_LOUNGE
    set needed1[VOODOO_LOUNGE] = PEON
    set needed2[VOODOO_LOUNGE] = 0
    set needed3[VOODOO_LOUNGE] = 0
    set tc_add1[VOODOO_LOUNGE] = 0
    set tc_add2[VOODOO_LOUNGE] = 0
    set available_time[VOODOO_LOUNGE] = 0
    set regenerate_time[VOODOO_LOUNGE] = 0
    set gold_price[VOODOO_LOUNGE] = 0
    set wood_price[VOODOO_LOUNGE] = 0

    set old_id[ORC_BUILDINGS_END] = oORC_BUILDINGS_END
    set needed1[ORC_BUILDINGS_END] = 0
    set needed2[ORC_BUILDINGS_END] = 0
    set needed3[ORC_BUILDINGS_END] = 0
    set tc_add1[ORC_BUILDINGS_END] = 0
    set tc_add2[ORC_BUILDINGS_END] = 0
    set available_time[ORC_BUILDINGS_END] = 0
    set regenerate_time[ORC_BUILDINGS_END] = 0
    set gold_price[ORC_BUILDINGS_END] = 0
    set wood_price[ORC_BUILDINGS_END] = 0

    set old_id[ORC_UPGRADES_START] = oORC_UPGRADES_START
    set needed1[ORC_UPGRADES_START] = 0
    set needed2[ORC_UPGRADES_START] = 0
    set needed3[ORC_UPGRADES_START] = 0
    set tc_add1[ORC_UPGRADES_START] = 0
    set tc_add2[ORC_UPGRADES_START] = 0
    set available_time[ORC_UPGRADES_START] = 0
    set regenerate_time[ORC_UPGRADES_START] = 0
    set gold_price[ORC_UPGRADES_START] = 0
    set wood_price[ORC_UPGRADES_START] = 0

    set old_id[UPG_ORC_WAR_DRUMS] = oUPG_ORC_WAR_DRUMS
    set needed1[UPG_ORC_WAR_DRUMS] = BESTIARY
    set needed2[UPG_ORC_WAR_DRUMS] = FORTRESS
    set needed3[UPG_ORC_WAR_DRUMS] = FORGE
    set tc_add1[UPG_ORC_WAR_DRUMS] = 0
    set tc_add2[UPG_ORC_WAR_DRUMS] = 0
    set available_time[UPG_ORC_WAR_DRUMS] = 0
    set regenerate_time[UPG_ORC_WAR_DRUMS] = 0
    set gold_price[UPG_ORC_WAR_DRUMS] = 0
    set wood_price[UPG_ORC_WAR_DRUMS] = 0

    set old_id[UPG_ORC_PILLAGE] = oUPG_ORC_PILLAGE
    set needed1[UPG_ORC_PILLAGE] = GREAT_HALL
    set needed2[UPG_ORC_PILLAGE] = 0
    set needed3[UPG_ORC_PILLAGE] = 0
    set tc_add1[UPG_ORC_PILLAGE] = 0
    set tc_add2[UPG_ORC_PILLAGE] = 0
    set available_time[UPG_ORC_PILLAGE] = 0
    set regenerate_time[UPG_ORC_PILLAGE] = 0
    set gold_price[UPG_ORC_PILLAGE] = 0
    set wood_price[UPG_ORC_PILLAGE] = 0

    set old_id[UPG_ORC_BERSERK] = oUPG_ORC_BERSERK
    set needed1[UPG_ORC_BERSERK] = ORC_BARRACKS
    set needed2[UPG_ORC_BERSERK] = STRONGHOLD
    set needed3[UPG_ORC_BERSERK] = 0
    set tc_add1[UPG_ORC_BERSERK] = 0
    set tc_add2[UPG_ORC_BERSERK] = 0
    set available_time[UPG_ORC_BERSERK] = 0
    set regenerate_time[UPG_ORC_BERSERK] = 0
    set gold_price[UPG_ORC_BERSERK] = 0
    set wood_price[UPG_ORC_BERSERK] = 0

    set old_id[UPG_ORC_PULVERIZE] = oUPG_ORC_PULVERIZE
    set needed1[UPG_ORC_PULVERIZE] = TOTEM
    set needed2[UPG_ORC_PULVERIZE] = 0
    set needed3[UPG_ORC_PULVERIZE] = 0
    set tc_add1[UPG_ORC_PULVERIZE] = 0
    set tc_add2[UPG_ORC_PULVERIZE] = 0
    set available_time[UPG_ORC_PULVERIZE] = 0
    set regenerate_time[UPG_ORC_PULVERIZE] = 0
    set gold_price[UPG_ORC_PULVERIZE] = 0
    set wood_price[UPG_ORC_PULVERIZE] = 0

    set old_id[UPG_ORC_ENSNARE] = oUPG_ORC_ENSNARE
    set needed1[UPG_ORC_ENSNARE] = BESTIARY
    set needed2[UPG_ORC_ENSNARE] = 0
    set needed3[UPG_ORC_ENSNARE] = 0
    set tc_add1[UPG_ORC_ENSNARE] = 0
    set tc_add2[UPG_ORC_ENSNARE] = 0
    set available_time[UPG_ORC_ENSNARE] = 0
    set regenerate_time[UPG_ORC_ENSNARE] = 0
    set gold_price[UPG_ORC_ENSNARE] = 0
    set wood_price[UPG_ORC_ENSNARE] = 0

    set old_id[UPG_ORC_VENOM] = oUPG_ORC_VENOM
    set needed1[UPG_ORC_VENOM] = BESTIARY
    set needed2[UPG_ORC_VENOM] = FORTRESS
    set needed3[UPG_ORC_VENOM] = 0
    set tc_add1[UPG_ORC_VENOM] = 0
    set tc_add2[UPG_ORC_VENOM] = 0
    set available_time[UPG_ORC_VENOM] = 0
    set regenerate_time[UPG_ORC_VENOM] = 0
    set gold_price[UPG_ORC_VENOM] = 0
    set wood_price[UPG_ORC_VENOM] = 0

    set old_id[UPG_ORC_REGEN] = oUPG_ORC_REGEN
    set needed1[UPG_ORC_REGEN] = ORC_BARRACKS
    set needed2[UPG_ORC_REGEN] = STRONGHOLD
    set needed3[UPG_ORC_REGEN] = FORGE
    set tc_add1[UPG_ORC_REGEN] = 0
    set tc_add2[UPG_ORC_REGEN] = 0
    set available_time[UPG_ORC_REGEN] = 0
    set regenerate_time[UPG_ORC_REGEN] = 0
    set gold_price[UPG_ORC_REGEN] = 0
    set wood_price[UPG_ORC_REGEN] = 0

    set old_id[UPG_ORC_FIRE] = oUPG_ORC_FIRE
    set needed1[UPG_ORC_FIRE] = BESTIARY
    set needed2[UPG_ORC_FIRE] = FORTRESS
    set needed3[UPG_ORC_FIRE] = VOODOO_LOUNGE
    set tc_add1[UPG_ORC_FIRE] = 0
    set tc_add2[UPG_ORC_FIRE] = 0
    set available_time[UPG_ORC_FIRE] = 0
    set regenerate_time[UPG_ORC_FIRE] = 0
    set gold_price[UPG_ORC_FIRE] = 0
    set wood_price[UPG_ORC_FIRE] = 0

    set old_id[UPG_ORC_BERSERKER] = oUPG_ORC_BERSERKER
    set needed1[UPG_ORC_BERSERKER] = ORC_BARRACKS
    set needed2[UPG_ORC_BERSERKER] = FORTRESS
    set needed3[UPG_ORC_BERSERKER] = FORGE
    set tc_add1[UPG_ORC_BERSERKER] = 0
    set tc_add2[UPG_ORC_BERSERKER] = 0
    set available_time[UPG_ORC_BERSERKER] = 0
    set regenerate_time[UPG_ORC_BERSERKER] = 0
    set gold_price[UPG_ORC_BERSERKER] = 0
    set wood_price[UPG_ORC_BERSERKER] = 0

    set old_id[UPG_ORC_ARTILLERY] = oUPG_ORC_ARTILLERY
    set needed1[UPG_ORC_ARTILLERY] = ORC_BARRACKS
    set needed2[UPG_ORC_ARTILLERY] = FORTRESS
    set needed3[UPG_ORC_ARTILLERY] = 0
    set tc_add1[UPG_ORC_ARTILLERY] = 0
    set tc_add2[UPG_ORC_ARTILLERY] = 0
    set available_time[UPG_ORC_ARTILLERY] = 0
    set regenerate_time[UPG_ORC_ARTILLERY] = 0
    set gold_price[UPG_ORC_ARTILLERY] = 0
    set wood_price[UPG_ORC_ARTILLERY] = 0

    set old_id[UPG_ORC_BURROWS] = oUPG_ORC_BURROWS
    set needed1[UPG_ORC_BURROWS] = FORGE
    set needed2[UPG_ORC_BURROWS] = FORTRESS
    set needed3[UPG_ORC_BURROWS] = 0
    set tc_add1[UPG_ORC_BURROWS] = 0
    set tc_add2[UPG_ORC_BURROWS] = 0
    set available_time[UPG_ORC_BURROWS] = 0
    set regenerate_time[UPG_ORC_BURROWS] = 0
    set gold_price[UPG_ORC_BURROWS] = 0
    set wood_price[UPG_ORC_BURROWS] = 0

    set old_id[ORC_UPGRADES_END] = oORC_UPGRADES_END
    set needed1[ORC_UPGRADES_END] = 0
    set needed2[ORC_UPGRADES_END] = 0
    set needed3[ORC_UPGRADES_END] = 0
    set tc_add1[ORC_UPGRADES_END] = 0
    set tc_add2[ORC_UPGRADES_END] = 0
    set available_time[ORC_UPGRADES_END] = 0
    set regenerate_time[ORC_UPGRADES_END] = 0
    set gold_price[ORC_UPGRADES_END] = 0
    set wood_price[ORC_UPGRADES_END] = 0

    set old_id[UNDEAD_UNITS_START] = oUNDEAD_UNITS_START
    set needed1[UNDEAD_UNITS_START] = 0
    set needed2[UNDEAD_UNITS_START] = 0
    set needed3[UNDEAD_UNITS_START] = 0
    set tc_add1[UNDEAD_UNITS_START] = 0
    set tc_add2[UNDEAD_UNITS_START] = 0
    set available_time[UNDEAD_UNITS_START] = 0
    set regenerate_time[UNDEAD_UNITS_START] = 0
    set gold_price[UNDEAD_UNITS_START] = 0
    set wood_price[UNDEAD_UNITS_START] = 0

    set old_id[ABOMINATION] = oABOMINATION
    set needed1[ABOMINATION] = SLAUGHTERHOUSE
    set needed2[ABOMINATION] = NECROPOLIS_3
    set needed3[ABOMINATION] = 0
    set tc_add1[ABOMINATION] = 0
    set tc_add2[ABOMINATION] = 0
    set available_time[ABOMINATION] = 0
    set regenerate_time[ABOMINATION] = 0
    set gold_price[ABOMINATION] = 0
    set wood_price[ABOMINATION] = 0

    set old_id[ACOLYTE] = oACOLYTE
    set needed1[ACOLYTE] = NECROPOLIS_1
    set needed2[ACOLYTE] = 0
    set needed3[ACOLYTE] = 0
    set tc_add1[ACOLYTE] = 0
    set tc_add2[ACOLYTE] = 0
    set available_time[ACOLYTE] = 0
    set regenerate_time[ACOLYTE] = 0
    set gold_price[ACOLYTE] = 0
    set wood_price[ACOLYTE] = 0

    set old_id[BANSHEE] = oBANSHEE
    set needed1[BANSHEE] = DAMNED_TEMPLE
    set needed2[BANSHEE] = 0
    set needed3[BANSHEE] = 0
    set tc_add1[BANSHEE] = 0
    set tc_add2[BANSHEE] = 0
    set available_time[BANSHEE] = 0
    set regenerate_time[BANSHEE] = 0
    set gold_price[BANSHEE] = 0
    set wood_price[BANSHEE] = 0

    set old_id[CRYPT_FIEND] = oCRYPT_FIEND
    set needed1[CRYPT_FIEND] = CRYPT
    set needed2[CRYPT_FIEND] = GRAVEYARD
    set needed3[CRYPT_FIEND] = 0
    set tc_add1[CRYPT_FIEND] = 0
    set tc_add2[CRYPT_FIEND] = 0
    set available_time[CRYPT_FIEND] = 0
    set regenerate_time[CRYPT_FIEND] = 0
    set gold_price[CRYPT_FIEND] = 0
    set wood_price[CRYPT_FIEND] = 0

    set old_id[FROST_WYRM] = oFROST_WYRM
    set needed1[FROST_WYRM] = BONEYARD
    set needed2[FROST_WYRM] = 0
    set needed3[FROST_WYRM] = 0
    set tc_add1[FROST_WYRM] = 0
    set tc_add2[FROST_WYRM] = 0
    set available_time[FROST_WYRM] = 0
    set regenerate_time[FROST_WYRM] = 0
    set gold_price[FROST_WYRM] = 0
    set wood_price[FROST_WYRM] = 0

    set old_id[GARGOYLE] = oGARGOYLE
    set needed1[GARGOYLE] = CRYPT
    set needed2[GARGOYLE] = NECROPOLIS_2
    set needed3[GARGOYLE] = GRAVEYARD
    set tc_add1[GARGOYLE] = 0
    set tc_add2[GARGOYLE] = GARGOYLE_MORPH
    set available_time[GARGOYLE] = 0
    set regenerate_time[GARGOYLE] = 0
    set gold_price[GARGOYLE] = 0
    set wood_price[GARGOYLE] = 0

    set old_id[GARGOYLE_MORPH] = oGARGOYLE_MORPH
    set needed1[GARGOYLE_MORPH] = 0
    set needed2[GARGOYLE_MORPH] = 0
    set needed3[GARGOYLE_MORPH] = 0
    set tc_add1[GARGOYLE_MORPH] = 0
    set tc_add2[GARGOYLE_MORPH] = GARGOYLE
    set available_time[GARGOYLE_MORPH] = 0
    set regenerate_time[GARGOYLE_MORPH] = 0
    set gold_price[GARGOYLE_MORPH] = 0
    set wood_price[GARGOYLE_MORPH] = 0

    set old_id[GHOUL] = oGHOUL
    set needed1[GHOUL] = CRYPT
    set needed2[GHOUL] = 0
    set needed3[GHOUL] = 0
    set tc_add1[GHOUL] = 0
    set tc_add2[GHOUL] = 0
    set available_time[GHOUL] = 0
    set regenerate_time[GHOUL] = 0
    set gold_price[GHOUL] = 0
    set wood_price[GHOUL] = 0

    set old_id[MEAT_WAGON] = oMEAT_WAGON
    set needed1[MEAT_WAGON] = SLAUGHTERHOUSE
    set needed2[MEAT_WAGON] = 0
    set needed3[MEAT_WAGON] = 0
    set tc_add1[MEAT_WAGON] = 0
    set tc_add2[MEAT_WAGON] = 0
    set available_time[MEAT_WAGON] = 0
    set regenerate_time[MEAT_WAGON] = 0
    set gold_price[MEAT_WAGON] = 0
    set wood_price[MEAT_WAGON] = 0

    set old_id[NECRO] = oNECRO
    set needed1[NECRO] = DAMNED_TEMPLE
    set needed2[NECRO] = 0
    set needed3[NECRO] = 0
    set tc_add1[NECRO] = 0
    set tc_add2[NECRO] = 0
    set available_time[NECRO] = 0
    set regenerate_time[NECRO] = 0
    set gold_price[NECRO] = 0
    set wood_price[NECRO] = 0

    set old_id[SKEL_WARRIOR] = oSKEL_WARRIOR
    set needed1[SKEL_WARRIOR] = 0
    set needed2[SKEL_WARRIOR] = 0
    set needed3[SKEL_WARRIOR] = 0
    set tc_add1[SKEL_WARRIOR] = 0
    set tc_add2[SKEL_WARRIOR] = 0
    set available_time[SKEL_WARRIOR] = 0
    set regenerate_time[SKEL_WARRIOR] = 0
    set gold_price[SKEL_WARRIOR] = 0
    set wood_price[SKEL_WARRIOR] = 0

    set old_id[SHADE] = oSHADE
    set needed1[SHADE] = ACOLYTE
    set needed2[SHADE] = SAC_PIT
    set needed3[SHADE] = 0
    set tc_add1[SHADE] = 0
    set tc_add2[SHADE] = 0
    set available_time[SHADE] = 0
    set regenerate_time[SHADE] = 0
    set gold_price[SHADE] = 0
    set wood_price[SHADE] = 0

    set old_id[OBSIDIAN_STATUE] = oOBSIDIAN_STATUE
    set needed1[OBSIDIAN_STATUE] = SLAUGHTERHOUSE
    set needed2[OBSIDIAN_STATUE] = TOMB_OF_RELICS
    set needed3[OBSIDIAN_STATUE] = 0
    set tc_add1[OBSIDIAN_STATUE] = 0
    set tc_add2[OBSIDIAN_STATUE] = 0
    set available_time[OBSIDIAN_STATUE] = 0
    set regenerate_time[OBSIDIAN_STATUE] = 0
    set gold_price[OBSIDIAN_STATUE] = 0
    set wood_price[OBSIDIAN_STATUE] = 0

    set old_id[STATUE_FOR_UPGRADE] = oSTATUE_FOR_UPGRADE
    set needed1[STATUE_FOR_UPGRADE] = SLAUGHTERHOUSE
    set needed2[STATUE_FOR_UPGRADE] = TOMB_OF_RELICS
    set needed3[STATUE_FOR_UPGRADE] = 0
    set tc_add1[STATUE_FOR_UPGRADE] = BLK_SPHINX
    set tc_add2[STATUE_FOR_UPGRADE] = 0
    set available_time[STATUE_FOR_UPGRADE] = 0
    set regenerate_time[STATUE_FOR_UPGRADE] = 0
    set gold_price[STATUE_FOR_UPGRADE] = 0
    set wood_price[STATUE_FOR_UPGRADE] = 0

    set old_id[BLK_SPHINX] = oBLK_SPHINX
    set needed1[BLK_SPHINX] = STATUE_FOR_UPGRADE
    set needed2[BLK_SPHINX] = 0
    set needed3[BLK_SPHINX] = UPGRADED
    set tc_add1[BLK_SPHINX] = 0
    set tc_add2[BLK_SPHINX] = 0
    set available_time[BLK_SPHINX] = 0
    set regenerate_time[BLK_SPHINX] = 0
    set gold_price[BLK_SPHINX] = 0
    set wood_price[BLK_SPHINX] = 0

    set old_id[UNDEAD_UNITS_END] = oUNDEAD_UNITS_END
    set needed1[UNDEAD_UNITS_END] = 0
    set needed2[UNDEAD_UNITS_END] = 0
    set needed3[UNDEAD_UNITS_END] = 0
    set tc_add1[UNDEAD_UNITS_END] = 0
    set tc_add2[UNDEAD_UNITS_END] = 0
    set available_time[UNDEAD_UNITS_END] = 0
    set regenerate_time[UNDEAD_UNITS_END] = 0
    set gold_price[UNDEAD_UNITS_END] = 0
    set wood_price[UNDEAD_UNITS_END] = 0

    set old_id[UNDEAD_BUILDINGS_START] = oUNDEAD_BUILDINGS_START
    set needed1[UNDEAD_BUILDINGS_START] = 0
    set needed2[UNDEAD_BUILDINGS_START] = 0
    set needed3[UNDEAD_BUILDINGS_START] = 0
    set tc_add1[UNDEAD_BUILDINGS_START] = 0
    set tc_add2[UNDEAD_BUILDINGS_START] = 0
    set available_time[UNDEAD_BUILDINGS_START] = 0
    set regenerate_time[UNDEAD_BUILDINGS_START] = 0
    set gold_price[UNDEAD_BUILDINGS_START] = 0
    set wood_price[UNDEAD_BUILDINGS_START] = 0

    set old_id[UNDEAD_MINE] = oUNDEAD_MINE
    set needed1[UNDEAD_MINE] = ACOLYTE
    set needed2[UNDEAD_MINE] = 0
    set needed3[UNDEAD_MINE] = 0
    set tc_add1[UNDEAD_MINE] = 0
    set tc_add2[UNDEAD_MINE] = 0
    set available_time[UNDEAD_MINE] = 0
    set regenerate_time[UNDEAD_MINE] = 0
    set gold_price[UNDEAD_MINE] = 0
    set wood_price[UNDEAD_MINE] = 0

    set old_id[UNDEAD_ALTAR] = oUNDEAD_ALTAR
    set needed1[UNDEAD_ALTAR] = ACOLYTE
    set needed2[UNDEAD_ALTAR] = 0
    set needed3[UNDEAD_ALTAR] = 0
    set tc_add1[UNDEAD_ALTAR] = 0
    set tc_add2[UNDEAD_ALTAR] = 0
    set available_time[UNDEAD_ALTAR] = 0
    set regenerate_time[UNDEAD_ALTAR] = 0
    set gold_price[UNDEAD_ALTAR] = 0
    set wood_price[UNDEAD_ALTAR] = 0

    set old_id[BONEYARD] = oBONEYARD
    set needed1[BONEYARD] = ACOLYTE
    set needed2[BONEYARD] = NECROPOLIS_3
    set needed3[BONEYARD] = SAC_PIT
    set tc_add1[BONEYARD] = 0
    set tc_add2[BONEYARD] = 0
    set available_time[BONEYARD] = 0
    set regenerate_time[BONEYARD] = 0
    set gold_price[BONEYARD] = 0
    set wood_price[BONEYARD] = 0

    set old_id[NECROPOLIS_1] = oNECROPOLIS_1
    set needed1[NECROPOLIS_1] = 0
    set needed2[NECROPOLIS_1] = 0
    set needed3[NECROPOLIS_1] = 0
    set tc_add1[NECROPOLIS_1] = NECROPOLIS_2
    set tc_add2[NECROPOLIS_1] = NECROPOLIS_3
    set available_time[NECROPOLIS_1] = 0
    set regenerate_time[NECROPOLIS_1] = 0
    set gold_price[NECROPOLIS_1] = 0
    set wood_price[NECROPOLIS_1] = 0

    set old_id[NECROPOLIS_2] = oNECROPOLIS_2
    set needed1[NECROPOLIS_2] = NECROPOLIS_1
    set needed2[NECROPOLIS_2] = 0
    set needed3[NECROPOLIS_2] = UPGRADED
    set tc_add1[NECROPOLIS_2] = NECROPOLIS_3
    set tc_add2[NECROPOLIS_2] = 0
    set available_time[NECROPOLIS_2] = 0
    set regenerate_time[NECROPOLIS_2] = 0
    set gold_price[NECROPOLIS_2] = 0
    set wood_price[NECROPOLIS_2] = 0

    set old_id[NECROPOLIS_3] = oNECROPOLIS_3
    set needed1[NECROPOLIS_3] = NECROPOLIS_2
    set needed2[NECROPOLIS_3] = UNDEAD_ALTAR
    set needed3[NECROPOLIS_3] = UPGRADED
    set tc_add1[NECROPOLIS_3] = 0
    set tc_add2[NECROPOLIS_3] = 0
    set available_time[NECROPOLIS_3] = 0
    set regenerate_time[NECROPOLIS_3] = 0
    set gold_price[NECROPOLIS_3] = 0
    set wood_price[NECROPOLIS_3] = 0

    set old_id[SAC_PIT] = oSAC_PIT
    set needed1[SAC_PIT] = ACOLYTE
    set needed2[SAC_PIT] = NECROPOLIS_2
    set needed3[SAC_PIT] = 0
    set tc_add1[SAC_PIT] = 0
    set tc_add2[SAC_PIT] = 0
    set available_time[SAC_PIT] = 0
    set regenerate_time[SAC_PIT] = 0
    set gold_price[SAC_PIT] = 0
    set wood_price[SAC_PIT] = 0

    set old_id[CRYPT] = oCRYPT
    set needed1[CRYPT] = ACOLYTE
    set needed2[CRYPT] = 0
    set needed3[CRYPT] = 0
    set tc_add1[CRYPT] = 0
    set tc_add2[CRYPT] = 0
    set available_time[CRYPT] = 0
    set regenerate_time[CRYPT] = 0
    set gold_price[CRYPT] = 0
    set wood_price[CRYPT] = 0

    set old_id[SLAUGHTERHOUSE] = oSLAUGHTERHOUSE
    set needed1[SLAUGHTERHOUSE] = ACOLYTE
    set needed2[SLAUGHTERHOUSE] = NECROPOLIS_2
    set needed3[SLAUGHTERHOUSE] = GRAVEYARD
    set tc_add1[SLAUGHTERHOUSE] = 0
    set tc_add2[SLAUGHTERHOUSE] = 0
    set available_time[SLAUGHTERHOUSE] = 0
    set regenerate_time[SLAUGHTERHOUSE] = 0
    set gold_price[SLAUGHTERHOUSE] = 0
    set wood_price[SLAUGHTERHOUSE] = 0

    set old_id[DAMNED_TEMPLE] = oDAMNED_TEMPLE
    set needed1[DAMNED_TEMPLE] = ACOLYTE
    set needed2[DAMNED_TEMPLE] = NECROPOLIS_2
    set needed3[DAMNED_TEMPLE] = 0
    set tc_add1[DAMNED_TEMPLE] = 0
    set tc_add2[DAMNED_TEMPLE] = 0
    set available_time[DAMNED_TEMPLE] = 0
    set regenerate_time[DAMNED_TEMPLE] = 0
    set gold_price[DAMNED_TEMPLE] = 0
    set wood_price[DAMNED_TEMPLE] = 0

    set old_id[ZIGGURAT_1] = oZIGGURAT_1
    set needed1[ZIGGURAT_1] = ACOLYTE
    set needed2[ZIGGURAT_1] = 0
    set needed3[ZIGGURAT_1] = 0
    set tc_add1[ZIGGURAT_1] = ZIGGURAT_2
    set tc_add2[ZIGGURAT_1] = ZIGGURAT_FROST
    set available_time[ZIGGURAT_1] = 0
    set regenerate_time[ZIGGURAT_1] = 0
    set gold_price[ZIGGURAT_1] = 0
    set wood_price[ZIGGURAT_1] = 0

    set old_id[ZIGGURAT_2] = oZIGGURAT_2
    set needed1[ZIGGURAT_2] = ZIGGURAT_1
    set needed2[ZIGGURAT_2] = GRAVEYARD
    set needed3[ZIGGURAT_2] = UPGRADED
    set tc_add1[ZIGGURAT_2] = 0
    set tc_add2[ZIGGURAT_2] = 0
    set available_time[ZIGGURAT_2] = 0
    set regenerate_time[ZIGGURAT_2] = 0
    set gold_price[ZIGGURAT_2] = 0
    set wood_price[ZIGGURAT_2] = 0

    set old_id[ZIGGURAT_FROST] = oZIGGURAT_FROST
    set needed1[ZIGGURAT_FROST] = ZIGGURAT_1
    set needed2[ZIGGURAT_FROST] = 0
    set needed3[ZIGGURAT_FROST] = UPGRADED
    set tc_add1[ZIGGURAT_FROST] = 0
    set tc_add2[ZIGGURAT_FROST] = 0
    set available_time[ZIGGURAT_FROST] = 0
    set regenerate_time[ZIGGURAT_FROST] = 0
    set gold_price[ZIGGURAT_FROST] = 0
    set wood_price[ZIGGURAT_FROST] = 0

    set old_id[GRAVEYARD] = oGRAVEYARD
    set needed1[GRAVEYARD] = ACOLYTE
    set needed2[GRAVEYARD] = 0
    set needed3[GRAVEYARD] = 0
    set tc_add1[GRAVEYARD] = 0
    set tc_add2[GRAVEYARD] = 0
    set available_time[GRAVEYARD] = 0
    set regenerate_time[GRAVEYARD] = 0
    set gold_price[GRAVEYARD] = 0
    set wood_price[GRAVEYARD] = 0

    set old_id[TOMB_OF_RELICS] = oTOMB_OF_RELICS
    set needed1[TOMB_OF_RELICS] = ACOLYTE
    set needed2[TOMB_OF_RELICS] = 0
    set needed3[TOMB_OF_RELICS] = 0
    set tc_add1[TOMB_OF_RELICS] = 0
    set tc_add2[TOMB_OF_RELICS] = 0
    set available_time[TOMB_OF_RELICS] = 0
    set regenerate_time[TOMB_OF_RELICS] = 0
    set gold_price[TOMB_OF_RELICS] = 0
    set wood_price[TOMB_OF_RELICS] = 0

    set old_id[UNDEAD_BUILDINGS_END] = oUNDEAD_BUILDINGS_END
    set needed1[UNDEAD_BUILDINGS_END] = 0
    set needed2[UNDEAD_BUILDINGS_END] = 0
    set needed3[UNDEAD_BUILDINGS_END] = 0
    set tc_add1[UNDEAD_BUILDINGS_END] = 0
    set tc_add2[UNDEAD_BUILDINGS_END] = 0
    set available_time[UNDEAD_BUILDINGS_END] = 0
    set regenerate_time[UNDEAD_BUILDINGS_END] = 0
    set gold_price[UNDEAD_BUILDINGS_END] = 0
    set wood_price[UNDEAD_BUILDINGS_END] = 0

    set old_id[UNDEAD_UPGRADES_START] = oUNDEAD_UPGRADES_START
    set needed1[UNDEAD_UPGRADES_START] = 0
    set needed2[UNDEAD_UPGRADES_START] = 0
    set needed3[UNDEAD_UPGRADES_START] = 0
    set tc_add1[UNDEAD_UPGRADES_START] = 0
    set tc_add2[UNDEAD_UPGRADES_START] = 0
    set available_time[UNDEAD_UPGRADES_START] = 0
    set regenerate_time[UNDEAD_UPGRADES_START] = 0
    set gold_price[UNDEAD_UPGRADES_START] = 0
    set wood_price[UNDEAD_UPGRADES_START] = 0

    set old_id[UPG_CANNIBALIZE] = oUPG_CANNIBALIZE
    set needed1[UPG_CANNIBALIZE] = CRYPT
    set needed2[UPG_CANNIBALIZE] = 0
    set needed3[UPG_CANNIBALIZE] = 0
    set tc_add1[UPG_CANNIBALIZE] = 0
    set tc_add2[UPG_CANNIBALIZE] = 0
    set available_time[UPG_CANNIBALIZE] = 0
    set regenerate_time[UPG_CANNIBALIZE] = 0
    set gold_price[UPG_CANNIBALIZE] = 0
    set wood_price[UPG_CANNIBALIZE] = 0

    set old_id[UPG_GHOUL_FRENZY] = oUPG_GHOUL_FRENZY
    set needed1[UPG_GHOUL_FRENZY] = CRYPT
    set needed2[UPG_GHOUL_FRENZY] = NECROPOLIS_3
    set needed3[UPG_GHOUL_FRENZY] = GRAVEYARD
    set tc_add1[UPG_GHOUL_FRENZY] = 0
    set tc_add2[UPG_GHOUL_FRENZY] = 0
    set available_time[UPG_GHOUL_FRENZY] = 0
    set regenerate_time[UPG_GHOUL_FRENZY] = 0
    set gold_price[UPG_GHOUL_FRENZY] = 0
    set wood_price[UPG_GHOUL_FRENZY] = 0

    set old_id[UPG_FIEND_WEB] = oUPG_FIEND_WEB
    set needed1[UPG_FIEND_WEB] = CRYPT
    set needed2[UPG_FIEND_WEB] = GRAVEYARD
    set needed3[UPG_FIEND_WEB] = 0
    set tc_add1[UPG_FIEND_WEB] = 0
    set tc_add2[UPG_FIEND_WEB] = 0
    set available_time[UPG_FIEND_WEB] = 0
    set regenerate_time[UPG_FIEND_WEB] = 0
    set gold_price[UPG_FIEND_WEB] = 0
    set wood_price[UPG_FIEND_WEB] = 0

    set old_id[UPG_STONE_FORM] = oUPG_STONE_FORM
    set needed1[UPG_STONE_FORM] = CRYPT
    set needed2[UPG_STONE_FORM] = NECROPOLIS_3
    set needed3[UPG_STONE_FORM] = GRAVEYARD
    set tc_add1[UPG_STONE_FORM] = 0
    set tc_add2[UPG_STONE_FORM] = 0
    set available_time[UPG_STONE_FORM] = 0
    set regenerate_time[UPG_STONE_FORM] = 0
    set gold_price[UPG_STONE_FORM] = 0
    set wood_price[UPG_STONE_FORM] = 0

    set old_id[UPG_WYRM_BREATH] = oUPG_WYRM_BREATH
    set needed1[UPG_WYRM_BREATH] = BONEYARD
    set needed2[UPG_WYRM_BREATH] = 0
    set needed3[UPG_WYRM_BREATH] = 0
    set tc_add1[UPG_WYRM_BREATH] = 0
    set tc_add2[UPG_WYRM_BREATH] = 0
    set available_time[UPG_WYRM_BREATH] = 0
    set regenerate_time[UPG_WYRM_BREATH] = 0
    set gold_price[UPG_WYRM_BREATH] = 0
    set wood_price[UPG_WYRM_BREATH] = 0

    set old_id[UPG_SKEL_LIFE] = oUPG_SKEL_LIFE
    set needed1[UPG_SKEL_LIFE] = DAMNED_TEMPLE
    set needed2[UPG_SKEL_LIFE] = 0
    set needed3[UPG_SKEL_LIFE] = 0
    set tc_add1[UPG_SKEL_LIFE] = 0
    set tc_add2[UPG_SKEL_LIFE] = 0
    set available_time[UPG_SKEL_LIFE] = 0
    set regenerate_time[UPG_SKEL_LIFE] = 0
    set gold_price[UPG_SKEL_LIFE] = 0
    set wood_price[UPG_SKEL_LIFE] = 0

    set old_id[UPG_PLAGUE] = oUPG_PLAGUE
    set needed1[UPG_PLAGUE] = SLAUGHTERHOUSE
    set needed2[UPG_PLAGUE] = 0
    set needed3[UPG_PLAGUE] = 0
    set tc_add1[UPG_PLAGUE] = 0
    set tc_add2[UPG_PLAGUE] = 0
    set available_time[UPG_PLAGUE] = 0
    set regenerate_time[UPG_PLAGUE] = 0
    set gold_price[UPG_PLAGUE] = 0
    set wood_price[UPG_PLAGUE] = 0

    set old_id[UPG_SKEL_MASTERY] = oUPG_SKEL_MASTERY
    set needed1[UPG_SKEL_MASTERY] = DAMNED_TEMPLE
    set needed2[UPG_SKEL_MASTERY] = NECROPOLIS_3
    set needed3[UPG_SKEL_MASTERY] = 0
    set tc_add1[UPG_SKEL_MASTERY] = 0
    set tc_add2[UPG_SKEL_MASTERY] = 0
    set available_time[UPG_SKEL_MASTERY] = 0
    set regenerate_time[UPG_SKEL_MASTERY] = 0
    set gold_price[UPG_SKEL_MASTERY] = 0
    set wood_price[UPG_SKEL_MASTERY] = 0

    set old_id[UPG_BLK_SPHINX] = oUPG_BLK_SPHINX
    set needed1[UPG_BLK_SPHINX] = SLAUGHTERHOUSE
    set needed2[UPG_BLK_SPHINX] = NECROPOLIS_3
    set needed3[UPG_BLK_SPHINX] = TOMB_OF_RELICS
    set tc_add1[UPG_BLK_SPHINX] = 0
    set tc_add2[UPG_BLK_SPHINX] = 0
    set available_time[UPG_BLK_SPHINX] = 0
    set regenerate_time[UPG_BLK_SPHINX] = 0
    set gold_price[UPG_BLK_SPHINX] = 0
    set wood_price[UPG_BLK_SPHINX] = 0

    set old_id[UPG_BURROWING] = oUPG_BURROWING
    set needed1[UPG_BURROWING] = CRYPT
    set needed2[UPG_BURROWING] = NECROPOLIS_2
    set needed3[UPG_BURROWING] = GRAVEYARD
    set tc_add1[UPG_BURROWING] = 0
    set tc_add2[UPG_BURROWING] = 0
    set available_time[UPG_BURROWING] = 0
    set regenerate_time[UPG_BURROWING] = 0
    set gold_price[UPG_BURROWING] = 0
    set wood_price[UPG_BURROWING] = 0

    set old_id[UPG_EXHUME] = oUPG_EXHUME
    set needed1[UPG_EXHUME] = SLAUGHTERHOUSE
    set needed2[UPG_EXHUME] = NECROPOLIS_2
    set needed3[UPG_EXHUME] = 0
    set tc_add1[UPG_EXHUME] = 0
    set tc_add2[UPG_EXHUME] = 0
    set available_time[UPG_EXHUME] = 0
    set regenerate_time[UPG_EXHUME] = 0
    set gold_price[UPG_EXHUME] = 0
    set wood_price[UPG_EXHUME] = 0

    set old_id[UNDEAD_UPGRADES_END] = oUNDEAD_UPGRADES_END
    set needed1[UNDEAD_UPGRADES_END] = 0
    set needed2[UNDEAD_UPGRADES_END] = 0
    set needed3[UNDEAD_UPGRADES_END] = 0
    set tc_add1[UNDEAD_UPGRADES_END] = 0
    set tc_add2[UNDEAD_UPGRADES_END] = 0
    set available_time[UNDEAD_UPGRADES_END] = 0
    set regenerate_time[UNDEAD_UPGRADES_END] = 0
    set gold_price[UNDEAD_UPGRADES_END] = 0
    set wood_price[UNDEAD_UPGRADES_END] = 0

    set old_id[ELF_UNITS_START] = oELF_UNITS_START
    set needed1[ELF_UNITS_START] = 0
    set needed2[ELF_UNITS_START] = 0
    set needed3[ELF_UNITS_START] = 0
    set tc_add1[ELF_UNITS_START] = 0
    set tc_add2[ELF_UNITS_START] = 0
    set available_time[ELF_UNITS_START] = 0
    set regenerate_time[ELF_UNITS_START] = 0
    set gold_price[ELF_UNITS_START] = 0
    set wood_price[ELF_UNITS_START] = 0

    set old_id[WISP] = oWISP
    set needed1[WISP] = TREE_LIFE
    set needed2[WISP] = 0
    set needed3[WISP] = 0
    set tc_add1[WISP] = 0
    set tc_add2[WISP] = 0
    set available_time[WISP] = 0
    set regenerate_time[WISP] = 0
    set gold_price[WISP] = 0
    set wood_price[WISP] = 0

    set old_id[ARCHER] = oARCHER
    set needed1[ARCHER] = ANCIENT_WAR
    set needed2[ARCHER] = 0
    set needed3[ARCHER] = 0
    set tc_add1[ARCHER] = 0
    set tc_add2[ARCHER] = 0
    set available_time[ARCHER] = 0
    set regenerate_time[ARCHER] = 0
    set gold_price[ARCHER] = 0
    set wood_price[ARCHER] = 0

    set old_id[DRUID_TALON] = oDRUID_TALON
    set needed1[DRUID_TALON] = ANCIENT_WIND
    set needed2[DRUID_TALON] = 0
    set needed3[DRUID_TALON] = 0
    set tc_add1[DRUID_TALON] = 0
    set tc_add2[DRUID_TALON] = DRUID_TALON_M
    set available_time[DRUID_TALON] = 0
    set regenerate_time[DRUID_TALON] = 0
    set gold_price[DRUID_TALON] = 0
    set wood_price[DRUID_TALON] = 0

    set old_id[DRUID_TALON_M] = oDRUID_TALON_M
    set needed1[DRUID_TALON_M] = 0
    set needed2[DRUID_TALON_M] = 0
    set needed3[DRUID_TALON_M] = 0
    set tc_add1[DRUID_TALON_M] = 0
    set tc_add2[DRUID_TALON_M] = DRUID_TALON
    set available_time[DRUID_TALON_M] = 0
    set regenerate_time[DRUID_TALON_M] = 0
    set gold_price[DRUID_TALON_M] = 0
    set wood_price[DRUID_TALON_M] = 0

    set old_id[BALLISTA] = oBALLISTA
    set needed1[BALLISTA] = ANCIENT_WAR
    set needed2[BALLISTA] = HUNTERS_HALL
    set needed3[BALLISTA] = 0
    set tc_add1[BALLISTA] = 0
    set tc_add2[BALLISTA] = 0
    set available_time[BALLISTA] = 0
    set regenerate_time[BALLISTA] = 0
    set gold_price[BALLISTA] = 0
    set wood_price[BALLISTA] = 0

    set old_id[DRUID_CLAW] = oDRUID_CLAW
    set needed1[DRUID_CLAW] = ANCIENT_LORE
    set needed2[DRUID_CLAW] = TREE_AGES
    set needed3[DRUID_CLAW] = 0
    set tc_add1[DRUID_CLAW] = 0
    set tc_add2[DRUID_CLAW] = DRUID_CLAW_M
    set available_time[DRUID_CLAW] = 0
    set regenerate_time[DRUID_CLAW] = 0
    set gold_price[DRUID_CLAW] = 0
    set wood_price[DRUID_CLAW] = 0

    set old_id[DRUID_CLAW_M] = oDRUID_CLAW_M
    set needed1[DRUID_CLAW_M] = 0
    set needed2[DRUID_CLAW_M] = 0
    set needed3[DRUID_CLAW_M] = 0
    set tc_add1[DRUID_CLAW_M] = 0
    set tc_add2[DRUID_CLAW_M] = DRUID_CLAW
    set available_time[DRUID_CLAW_M] = 0
    set regenerate_time[DRUID_CLAW_M] = 0
    set gold_price[DRUID_CLAW_M] = 0
    set wood_price[DRUID_CLAW_M] = 0

    set old_id[DRYAD] = oDRYAD
    set needed1[DRYAD] = ANCIENT_LORE
    set needed2[DRYAD] = 0
    set needed3[DRYAD] = 0
    set tc_add1[DRYAD] = 0
    set tc_add2[DRYAD] = 0
    set available_time[DRYAD] = 0
    set regenerate_time[DRYAD] = 0
    set gold_price[DRYAD] = 0
    set wood_price[DRYAD] = 0

    set old_id[HIPPO] = oHIPPO
    set needed1[HIPPO] = ANCIENT_WIND
    set needed2[HIPPO] = 0
    set needed3[HIPPO] = 0
    set tc_add1[HIPPO] = 0
    set tc_add2[HIPPO] = 0
    set available_time[HIPPO] = 0
    set regenerate_time[HIPPO] = 0
    set gold_price[HIPPO] = 0
    set wood_price[HIPPO] = 0

    set old_id[HIPPO_RIDER] = oHIPPO_RIDER
    set needed1[HIPPO_RIDER] = 0
    set needed2[HIPPO_RIDER] = 0
    set needed3[HIPPO_RIDER] = 0
    set tc_add1[HIPPO_RIDER] = 0
    set tc_add2[HIPPO_RIDER] = 0
    set available_time[HIPPO_RIDER] = 0
    set regenerate_time[HIPPO_RIDER] = 0
    set gold_price[HIPPO_RIDER] = 0
    set wood_price[HIPPO_RIDER] = 0

    set old_id[HUNTRESS] = oHUNTRESS
    set needed1[HUNTRESS] = ANCIENT_WAR
    set needed2[HUNTRESS] = HUNTERS_HALL
    set needed3[HUNTRESS] = 0
    set tc_add1[HUNTRESS] = 0
    set tc_add2[HUNTRESS] = 0
    set available_time[HUNTRESS] = 0
    set regenerate_time[HUNTRESS] = 0
    set gold_price[HUNTRESS] = 0
    set wood_price[HUNTRESS] = 0

    set old_id[CHIMAERA] = oCHIMAERA
    set needed1[CHIMAERA] = CHIMAERA_ROOST
    set needed2[CHIMAERA] = 0
    set needed3[CHIMAERA] = 0
    set tc_add1[CHIMAERA] = 0
    set tc_add2[CHIMAERA] = 0
    set available_time[CHIMAERA] = 0
    set regenerate_time[CHIMAERA] = 0
    set gold_price[CHIMAERA] = 0
    set wood_price[CHIMAERA] = 0

    set old_id[MOUNTAIN_GIANT] = oMOUNTAIN_GIANT
    set needed1[MOUNTAIN_GIANT] = ANCIENT_LORE
    set needed2[MOUNTAIN_GIANT] = DEN_OF_WONDERS
    set needed3[MOUNTAIN_GIANT] = 0
    set tc_add1[MOUNTAIN_GIANT] = 0
    set tc_add2[MOUNTAIN_GIANT] = 0
    set available_time[MOUNTAIN_GIANT] = 0
    set regenerate_time[MOUNTAIN_GIANT] = 0
    set gold_price[MOUNTAIN_GIANT] = 0
    set wood_price[MOUNTAIN_GIANT] = 0

    set old_id[FAERIE_DRAGON] = oFAERIE_DRAGON
    set needed1[FAERIE_DRAGON] = ANCIENT_WIND
    set needed2[FAERIE_DRAGON] = DEN_OF_WONDERS
    set needed3[FAERIE_DRAGON] = 0
    set tc_add1[FAERIE_DRAGON] = 0
    set tc_add2[FAERIE_DRAGON] = 0
    set available_time[FAERIE_DRAGON] = 0
    set regenerate_time[FAERIE_DRAGON] = 0
    set gold_price[FAERIE_DRAGON] = 0
    set wood_price[FAERIE_DRAGON] = 0

    set old_id[ELF_UNITS_END] = oELF_UNITS_END
    set needed1[ELF_UNITS_END] = 0
    set needed2[ELF_UNITS_END] = 0
    set needed3[ELF_UNITS_END] = 0
    set tc_add1[ELF_UNITS_END] = 0
    set tc_add2[ELF_UNITS_END] = 0
    set available_time[ELF_UNITS_END] = 0
    set regenerate_time[ELF_UNITS_END] = 0
    set gold_price[ELF_UNITS_END] = 0
    set wood_price[ELF_UNITS_END] = 0

    set old_id[ELF_BUILDINGS_START] = oELF_BUILDINGS_START
    set needed1[ELF_BUILDINGS_START] = 0
    set needed2[ELF_BUILDINGS_START] = 0
    set needed3[ELF_BUILDINGS_START] = 0
    set tc_add1[ELF_BUILDINGS_START] = 0
    set tc_add2[ELF_BUILDINGS_START] = 0
    set available_time[ELF_BUILDINGS_START] = 0
    set regenerate_time[ELF_BUILDINGS_START] = 0
    set gold_price[ELF_BUILDINGS_START] = 0
    set wood_price[ELF_BUILDINGS_START] = 0

    set old_id[ANCIENT_LORE] = oANCIENT_LORE
    set needed1[ANCIENT_LORE] = WISP
    set needed2[ANCIENT_LORE] = TREE_AGES
    set needed3[ANCIENT_LORE] = HUNTERS_HALL
    set tc_add1[ANCIENT_LORE] = 0
    set tc_add2[ANCIENT_LORE] = 0
    set available_time[ANCIENT_LORE] = 0
    set regenerate_time[ANCIENT_LORE] = 0
    set gold_price[ANCIENT_LORE] = 0
    set wood_price[ANCIENT_LORE] = 0

    set old_id[ANCIENT_WAR] = oANCIENT_WAR
    set needed1[ANCIENT_WAR] = WISP
    set needed2[ANCIENT_WAR] = 0
    set needed3[ANCIENT_WAR] = 0
    set tc_add1[ANCIENT_WAR] = 0
    set tc_add2[ANCIENT_WAR] = 0
    set available_time[ANCIENT_WAR] = 0
    set regenerate_time[ANCIENT_WAR] = 0
    set gold_price[ANCIENT_WAR] = 0
    set wood_price[ANCIENT_WAR] = 0

    set old_id[ANCIENT_WIND] = oANCIENT_WIND
    set needed1[ANCIENT_WIND] = WISP
    set needed2[ANCIENT_WIND] = TREE_AGES
    set needed3[ANCIENT_WIND] = 0
    set tc_add1[ANCIENT_WIND] = 0
    set tc_add2[ANCIENT_WIND] = 0
    set available_time[ANCIENT_WIND] = 0
    set regenerate_time[ANCIENT_WIND] = 0
    set gold_price[ANCIENT_WIND] = 0
    set wood_price[ANCIENT_WIND] = 0

    set old_id[TREE_AGES] = oTREE_AGES
    set needed1[TREE_AGES] = TREE_LIFE
    set needed2[TREE_AGES] = 0
    set needed3[TREE_AGES] = UPGRADED
    set tc_add1[TREE_AGES] = TREE_ETERNITY
    set tc_add2[TREE_AGES] = 0
    set available_time[TREE_AGES] = 0
    set regenerate_time[TREE_AGES] = 0
    set gold_price[TREE_AGES] = 0
    set wood_price[TREE_AGES] = 0

    set old_id[TREE_ETERNITY] = oTREE_ETERNITY
    set needed1[TREE_ETERNITY] = TREE_AGES
    set needed2[TREE_ETERNITY] = ELF_ALTAR
    set needed3[TREE_ETERNITY] = UPGRADED
    set tc_add1[TREE_ETERNITY] = 0
    set tc_add2[TREE_ETERNITY] = 0
    set available_time[TREE_ETERNITY] = 0
    set regenerate_time[TREE_ETERNITY] = 0
    set gold_price[TREE_ETERNITY] = 0
    set wood_price[TREE_ETERNITY] = 0

    set old_id[TREE_LIFE] = oTREE_LIFE
    set needed1[TREE_LIFE] = 0
    set needed2[TREE_LIFE] = 0
    set needed3[TREE_LIFE] = 0
    set tc_add1[TREE_LIFE] = TREE_AGES
    set tc_add2[TREE_LIFE] = TREE_ETERNITY
    set available_time[TREE_LIFE] = 0
    set regenerate_time[TREE_LIFE] = 0
    set gold_price[TREE_LIFE] = 0
    set wood_price[TREE_LIFE] = 0

    set old_id[ANCIENT_PROTECT] = oANCIENT_PROTECT
    set needed1[ANCIENT_PROTECT] = WISP
    set needed2[ANCIENT_PROTECT] = HUNTERS_HALL
    set needed3[ANCIENT_PROTECT] = 0
    set tc_add1[ANCIENT_PROTECT] = 0
    set tc_add2[ANCIENT_PROTECT] = 0
    set available_time[ANCIENT_PROTECT] = 0
    set regenerate_time[ANCIENT_PROTECT] = 0
    set gold_price[ANCIENT_PROTECT] = 0
    set wood_price[ANCIENT_PROTECT] = 0

    set old_id[ELF_ALTAR] = oELF_ALTAR
    set needed1[ELF_ALTAR] = WISP
    set needed2[ELF_ALTAR] = 0
    set needed3[ELF_ALTAR] = 0
    set tc_add1[ELF_ALTAR] = 0
    set tc_add2[ELF_ALTAR] = 0
    set available_time[ELF_ALTAR] = 0
    set regenerate_time[ELF_ALTAR] = 0
    set gold_price[ELF_ALTAR] = 0
    set wood_price[ELF_ALTAR] = 0

    set old_id[CHIMAERA_ROOST] = oCHIMAERA_ROOST
    set needed1[CHIMAERA_ROOST] = WISP
    set needed2[CHIMAERA_ROOST] = TREE_ETERNITY
    set needed3[CHIMAERA_ROOST] = ANCIENT_WIND
    set tc_add1[CHIMAERA_ROOST] = 0
    set tc_add2[CHIMAERA_ROOST] = 0
    set available_time[CHIMAERA_ROOST] = 0
    set regenerate_time[CHIMAERA_ROOST] = 0
    set gold_price[CHIMAERA_ROOST] = 0
    set wood_price[CHIMAERA_ROOST] = 0

    set old_id[HUNTERS_HALL] = oHUNTERS_HALL
    set needed1[HUNTERS_HALL] = WISP
    set needed2[HUNTERS_HALL] = TREE_LIFE
    set needed3[HUNTERS_HALL] = 0
    set tc_add1[HUNTERS_HALL] = 0
    set tc_add2[HUNTERS_HALL] = 0
    set available_time[HUNTERS_HALL] = 0
    set regenerate_time[HUNTERS_HALL] = 0
    set gold_price[HUNTERS_HALL] = 0
    set wood_price[HUNTERS_HALL] = 0

    set old_id[MOON_WELL] = oMOON_WELL
    set needed1[MOON_WELL] = WISP
    set needed2[MOON_WELL] = 0
    set needed3[MOON_WELL] = 0
    set tc_add1[MOON_WELL] = 0
    set tc_add2[MOON_WELL] = 0
    set available_time[MOON_WELL] = 0
    set regenerate_time[MOON_WELL] = 0
    set gold_price[MOON_WELL] = 0
    set wood_price[MOON_WELL] = 0

    set old_id[ELF_MINE] = oELF_MINE
    set needed1[ELF_MINE] = WISP
    set needed2[ELF_MINE] = 0
    set needed3[ELF_MINE] = 0
    set tc_add1[ELF_MINE] = 0
    set tc_add2[ELF_MINE] = 0
    set available_time[ELF_MINE] = 0
    set regenerate_time[ELF_MINE] = 0
    set gold_price[ELF_MINE] = 0
    set wood_price[ELF_MINE] = 0

    set old_id[DEN_OF_WONDERS] = oDEN_OF_WONDERS
    set needed1[DEN_OF_WONDERS] = WISP
    set needed2[DEN_OF_WONDERS] = 0
    set needed3[DEN_OF_WONDERS] = 0
    set tc_add1[DEN_OF_WONDERS] = 0
    set tc_add2[DEN_OF_WONDERS] = 0
    set available_time[DEN_OF_WONDERS] = 0
    set regenerate_time[DEN_OF_WONDERS] = 0
    set gold_price[DEN_OF_WONDERS] = 0
    set wood_price[DEN_OF_WONDERS] = 0

    set old_id[ELF_BUILDINGS_END] = oELF_BUILDINGS_END
    set needed1[ELF_BUILDINGS_END] = 0
    set needed2[ELF_BUILDINGS_END] = 0
    set needed3[ELF_BUILDINGS_END] = 0
    set tc_add1[ELF_BUILDINGS_END] = 0
    set tc_add2[ELF_BUILDINGS_END] = 0
    set available_time[ELF_BUILDINGS_END] = 0
    set regenerate_time[ELF_BUILDINGS_END] = 0
    set gold_price[ELF_BUILDINGS_END] = 0
    set wood_price[ELF_BUILDINGS_END] = 0

    set old_id[ELF_UPGRADES_START] = oELF_UPGRADES_START
    set needed1[ELF_UPGRADES_START] = 0
    set needed2[ELF_UPGRADES_START] = 0
    set needed3[ELF_UPGRADES_START] = 0
    set tc_add1[ELF_UPGRADES_START] = 0
    set tc_add2[ELF_UPGRADES_START] = 0
    set available_time[ELF_UPGRADES_START] = 0
    set regenerate_time[ELF_UPGRADES_START] = 0
    set gold_price[ELF_UPGRADES_START] = 0
    set wood_price[ELF_UPGRADES_START] = 0

    set old_id[UPG_ULTRAVISION] = oUPG_ULTRAVISION
    set needed1[UPG_ULTRAVISION] = HUNTERS_HALL
    set needed2[UPG_ULTRAVISION] = 0
    set needed3[UPG_ULTRAVISION] = 0
    set tc_add1[UPG_ULTRAVISION] = 0
    set tc_add2[UPG_ULTRAVISION] = 0
    set available_time[UPG_ULTRAVISION] = 0
    set regenerate_time[UPG_ULTRAVISION] = 0
    set gold_price[UPG_ULTRAVISION] = 0
    set wood_price[UPG_ULTRAVISION] = 0

    set old_id[UPG_BLESSING] = oUPG_BLESSING
    set needed1[UPG_BLESSING] = TREE_LIFE
    set needed2[UPG_BLESSING] = TREE_AGES
    set needed3[UPG_BLESSING] = 0
    set tc_add1[UPG_BLESSING] = 0
    set tc_add2[UPG_BLESSING] = 0
    set available_time[UPG_BLESSING] = 0
    set regenerate_time[UPG_BLESSING] = 0
    set gold_price[UPG_BLESSING] = 0
    set wood_price[UPG_BLESSING] = 0

    set old_id[UPG_SCOUT] = oUPG_SCOUT
    set needed1[UPG_SCOUT] = ANCIENT_WAR
    set needed2[UPG_SCOUT] = TREE_AGES
    set needed3[UPG_SCOUT] = HUNTERS_HALL
    set tc_add1[UPG_SCOUT] = 0
    set tc_add2[UPG_SCOUT] = 0
    set available_time[UPG_SCOUT] = 0
    set regenerate_time[UPG_SCOUT] = 0
    set gold_price[UPG_SCOUT] = 0
    set wood_price[UPG_SCOUT] = 0

    set old_id[UPG_GLAIVE] = oUPG_GLAIVE
    set needed1[UPG_GLAIVE] = ANCIENT_WAR
    set needed2[UPG_GLAIVE] = TREE_ETERNITY
    set needed3[UPG_GLAIVE] = HUNTERS_HALL
    set tc_add1[UPG_GLAIVE] = 0
    set tc_add2[UPG_GLAIVE] = 0
    set available_time[UPG_GLAIVE] = 0
    set regenerate_time[UPG_GLAIVE] = 0
    set gold_price[UPG_GLAIVE] = 0
    set wood_price[UPG_GLAIVE] = 0

    set old_id[UPG_BOWS] = oUPG_BOWS
    set needed1[UPG_BOWS] = ANCIENT_WAR
    set needed2[UPG_BOWS] = TREE_AGES
    set needed3[UPG_BOWS] = 0
    set tc_add1[UPG_BOWS] = 0
    set tc_add2[UPG_BOWS] = 0
    set available_time[UPG_BOWS] = 0
    set regenerate_time[UPG_BOWS] = 0
    set gold_price[UPG_BOWS] = 0
    set wood_price[UPG_BOWS] = 0

    set old_id[UPG_MARKSMAN] = oUPG_MARKSMAN
    set needed1[UPG_MARKSMAN] = ANCIENT_WAR
    set needed2[UPG_MARKSMAN] = TREE_ETERNITY
    set needed3[UPG_MARKSMAN] = HUNTERS_HALL
    set tc_add1[UPG_MARKSMAN] = 0
    set tc_add2[UPG_MARKSMAN] = 0
    set available_time[UPG_MARKSMAN] = 0
    set regenerate_time[UPG_MARKSMAN] = 0
    set gold_price[UPG_MARKSMAN] = 0
    set wood_price[UPG_MARKSMAN] = 0

    set old_id[UPG_ABOLISH] = oUPG_ABOLISH
    set needed1[UPG_ABOLISH] = ANCIENT_LORE
    set needed2[UPG_ABOLISH] = 0
    set needed3[UPG_ABOLISH] = 0
    set tc_add1[UPG_ABOLISH] = 0
    set tc_add2[UPG_ABOLISH] = 0
    set available_time[UPG_ABOLISH] = 0
    set regenerate_time[UPG_ABOLISH] = 0
    set gold_price[UPG_ABOLISH] = 0
    set wood_price[UPG_ABOLISH] = 0

    set old_id[UPG_CHIM_ACID] = oUPG_CHIM_ACID
    set needed1[UPG_CHIM_ACID] = CHIMAERA_ROOST
    set needed2[UPG_CHIM_ACID] = 0
    set needed3[UPG_CHIM_ACID] = 0
    set tc_add1[UPG_CHIM_ACID] = 0
    set tc_add2[UPG_CHIM_ACID] = 0
    set available_time[UPG_CHIM_ACID] = 0
    set regenerate_time[UPG_CHIM_ACID] = 0
    set gold_price[UPG_CHIM_ACID] = 0
    set wood_price[UPG_CHIM_ACID] = 0

    set old_id[UPG_HIPPO_TAME] = oUPG_HIPPO_TAME
    set needed1[UPG_HIPPO_TAME] = ANCIENT_WIND
    set needed2[UPG_HIPPO_TAME] = 0
    set needed3[UPG_HIPPO_TAME] = 0
    set tc_add1[UPG_HIPPO_TAME] = 0
    set tc_add2[UPG_HIPPO_TAME] = 0
    set available_time[UPG_HIPPO_TAME] = 0
    set regenerate_time[UPG_HIPPO_TAME] = 0
    set gold_price[UPG_HIPPO_TAME] = 0
    set wood_price[UPG_HIPPO_TAME] = 0

    set old_id[UPG_BOLT] = oUPG_BOLT
    set needed1[UPG_BOLT] = ANCIENT_WAR
    set needed2[UPG_BOLT] = TREE_AGES
    set needed3[UPG_BOLT] = HUNTERS_HALL
    set tc_add1[UPG_BOLT] = 0
    set tc_add2[UPG_BOLT] = 0
    set available_time[UPG_BOLT] = 0
    set regenerate_time[UPG_BOLT] = 0
    set gold_price[UPG_BOLT] = 0
    set wood_price[UPG_BOLT] = 0

    set old_id[UPG_MARK_CLAW] = oUPG_MARK_CLAW
    set needed1[UPG_MARK_CLAW] = ANCIENT_LORE
    set needed2[UPG_MARK_CLAW] = 0
    set needed3[UPG_MARK_CLAW] = 0
    set tc_add1[UPG_MARK_CLAW] = 0
    set tc_add2[UPG_MARK_CLAW] = 0
    set available_time[UPG_MARK_CLAW] = 0
    set regenerate_time[UPG_MARK_CLAW] = 0
    set gold_price[UPG_MARK_CLAW] = 0
    set wood_price[UPG_MARK_CLAW] = 0

    set old_id[UPG_MARK_TALON] = oUPG_MARK_TALON
    set needed1[UPG_MARK_TALON] = ANCIENT_WIND
    set needed2[UPG_MARK_TALON] = 0
    set needed3[UPG_MARK_TALON] = 0
    set tc_add1[UPG_MARK_TALON] = 0
    set tc_add2[UPG_MARK_TALON] = 0
    set available_time[UPG_MARK_TALON] = 0
    set regenerate_time[UPG_MARK_TALON] = 0
    set gold_price[UPG_MARK_TALON] = 0
    set wood_price[UPG_MARK_TALON] = 0

    set old_id[UPG_HARD_SKIN] = oUPG_HARD_SKIN
    set needed1[UPG_HARD_SKIN] = ANCIENT_LORE
    set needed2[UPG_HARD_SKIN] = TREE_ETERNITY
    set needed3[UPG_HARD_SKIN] = DEN_OF_WONDERS
    set tc_add1[UPG_HARD_SKIN] = 0
    set tc_add2[UPG_HARD_SKIN] = 0
    set available_time[UPG_HARD_SKIN] = 0
    set regenerate_time[UPG_HARD_SKIN] = 0
    set gold_price[UPG_HARD_SKIN] = 0
    set wood_price[UPG_HARD_SKIN] = 0

    set old_id[UPG_RESIST_SKIN] = oUPG_RESIST_SKIN
    set needed1[UPG_RESIST_SKIN] = ANCIENT_LORE
    set needed2[UPG_RESIST_SKIN] = TREE_ETERNITY
    set needed3[UPG_RESIST_SKIN] = DEN_OF_WONDERS
    set tc_add1[UPG_RESIST_SKIN] = 0
    set tc_add2[UPG_RESIST_SKIN] = 0
    set available_time[UPG_RESIST_SKIN] = 0
    set regenerate_time[UPG_RESIST_SKIN] = 0
    set gold_price[UPG_RESIST_SKIN] = 0
    set wood_price[UPG_RESIST_SKIN] = 0

    set old_id[UPG_WELL_SPRING] = oUPG_WELL_SPRING
    set needed1[UPG_WELL_SPRING] = HUNTERS_HALL
    set needed2[UPG_WELL_SPRING] = TREE_ETERNITY
    set needed3[UPG_WELL_SPRING] = 0
    set tc_add1[UPG_WELL_SPRING] = 0
    set tc_add2[UPG_WELL_SPRING] = 0
    set available_time[UPG_WELL_SPRING] = 0
    set regenerate_time[UPG_WELL_SPRING] = 0
    set gold_price[UPG_WELL_SPRING] = 0
    set wood_price[UPG_WELL_SPRING] = 0

    set old_id[ELF_UPGRADES_END] = oELF_UPGRADES_END
    set needed1[ELF_UPGRADES_END] = 0
    set needed2[ELF_UPGRADES_END] = 0
    set needed3[ELF_UPGRADES_END] = 0
    set tc_add1[ELF_UPGRADES_END] = 0
    set tc_add2[ELF_UPGRADES_END] = 0
    set available_time[ELF_UPGRADES_END] = 0
    set regenerate_time[ELF_UPGRADES_END] = 0
    set gold_price[ELF_UPGRADES_END] = 0
    set wood_price[ELF_UPGRADES_END] = 0

    set old_id[ML_UPGRADE_START] = oML_UPGRADE_START
    set needed1[ML_UPGRADE_START] = 0
    set needed2[ML_UPGRADE_START] = 0
    set needed3[ML_UPGRADE_START] = 0
    set tc_add1[ML_UPGRADE_START] = 0
    set tc_add2[ML_UPGRADE_START] = 0
    set available_time[ML_UPGRADE_START] = 0
    set regenerate_time[ML_UPGRADE_START] = 0
    set gold_price[ML_UPGRADE_START] = 0
    set wood_price[ML_UPGRADE_START] = 0

    set old_id[UPG_MELEE] = oUPG_MELEE
    set needed1[UPG_MELEE] = BLACKSMITH
    set needed2[UPG_MELEE] = KEEP
    set needed3[UPG_MELEE] = CASTLE
    set tc_add1[UPG_MELEE] = 0
    set tc_add2[UPG_MELEE] = 0
    set available_time[UPG_MELEE] = 0
    set regenerate_time[UPG_MELEE] = 0
    set gold_price[UPG_MELEE] = 0
    set wood_price[UPG_MELEE] = 0

    set old_id[UPG_RANGED] = oUPG_RANGED
    set needed1[UPG_RANGED] = BLACKSMITH
    set needed2[UPG_RANGED] = KEEP
    set needed3[UPG_RANGED] = CASTLE
    set tc_add1[UPG_RANGED] = 0
    set tc_add2[UPG_RANGED] = 0
    set available_time[UPG_RANGED] = 0
    set regenerate_time[UPG_RANGED] = 0
    set gold_price[UPG_RANGED] = 0
    set wood_price[UPG_RANGED] = 0

    set old_id[UPG_ARMOR] = oUPG_ARMOR
    set needed1[UPG_ARMOR] = BLACKSMITH
    set needed2[UPG_ARMOR] = KEEP
    set needed3[UPG_ARMOR] = CASTLE
    set tc_add1[UPG_ARMOR] = 0
    set tc_add2[UPG_ARMOR] = 0
    set available_time[UPG_ARMOR] = 0
    set regenerate_time[UPG_ARMOR] = 0
    set gold_price[UPG_ARMOR] = 0
    set wood_price[UPG_ARMOR] = 0

    set old_id[UPG_LEATHER] = oUPG_LEATHER
    set needed1[UPG_LEATHER] = BLACKSMITH
    set needed2[UPG_LEATHER] = KEEP
    set needed3[UPG_LEATHER] = CASTLE
    set tc_add1[UPG_LEATHER] = 0
    set tc_add2[UPG_LEATHER] = 0
    set available_time[UPG_LEATHER] = 0
    set regenerate_time[UPG_LEATHER] = 0
    set gold_price[UPG_LEATHER] = 0
    set wood_price[UPG_LEATHER] = 0

    set old_id[UPG_MASONRY] = oUPG_MASONRY
    set needed1[UPG_MASONRY] = LUMBER_MILL
    set needed2[UPG_MASONRY] = KEEP
    set needed3[UPG_MASONRY] = CASTLE
    set tc_add1[UPG_MASONRY] = 0
    set tc_add2[UPG_MASONRY] = 0
    set available_time[UPG_MASONRY] = 0
    set regenerate_time[UPG_MASONRY] = 0
    set gold_price[UPG_MASONRY] = 0
    set wood_price[UPG_MASONRY] = 0

    set old_id[UPG_WOOD] = oUPG_WOOD
    set needed1[UPG_WOOD] = LUMBER_MILL
    set needed2[UPG_WOOD] = KEEP
    set needed3[UPG_WOOD] = CASTLE
    set tc_add1[UPG_WOOD] = 0
    set tc_add2[UPG_WOOD] = 0
    set available_time[UPG_WOOD] = 0
    set regenerate_time[UPG_WOOD] = 0
    set gold_price[UPG_WOOD] = 0
    set wood_price[UPG_WOOD] = 0

    set old_id[UPG_PRAYING] = oUPG_PRAYING
    set needed1[UPG_PRAYING] = SANCTUM
    set needed2[UPG_PRAYING] = CASTLE
    set needed3[UPG_PRAYING] = 0
    set tc_add1[UPG_PRAYING] = 0
    set tc_add2[UPG_PRAYING] = 0
    set available_time[UPG_PRAYING] = 0
    set regenerate_time[UPG_PRAYING] = 0
    set gold_price[UPG_PRAYING] = 0
    set wood_price[UPG_PRAYING] = 0

    set old_id[UPG_SORCERY] = oUPG_SORCERY
    set needed1[UPG_SORCERY] = SANCTUM
    set needed2[UPG_SORCERY] = CASTLE
    set needed3[UPG_SORCERY] = 0
    set tc_add1[UPG_SORCERY] = 0
    set tc_add2[UPG_SORCERY] = 0
    set available_time[UPG_SORCERY] = 0
    set regenerate_time[UPG_SORCERY] = 0
    set gold_price[UPG_SORCERY] = 0
    set wood_price[UPG_SORCERY] = 0

    set old_id[UPG_ORC_MELEE] = oUPG_ORC_MELEE
    set needed1[UPG_ORC_MELEE] = FORGE
    set needed2[UPG_ORC_MELEE] = STRONGHOLD
    set needed3[UPG_ORC_MELEE] = FORTRESS
    set tc_add1[UPG_ORC_MELEE] = 0
    set tc_add2[UPG_ORC_MELEE] = 0
    set available_time[UPG_ORC_MELEE] = 0
    set regenerate_time[UPG_ORC_MELEE] = 0
    set gold_price[UPG_ORC_MELEE] = 0
    set wood_price[UPG_ORC_MELEE] = 0

    set old_id[UPG_ORC_RANGED] = oUPG_ORC_RANGED
    set needed1[UPG_ORC_RANGED] = FORGE
    set needed2[UPG_ORC_RANGED] = STRONGHOLD
    set needed3[UPG_ORC_RANGED] = FORTRESS
    set tc_add1[UPG_ORC_RANGED] = 0
    set tc_add2[UPG_ORC_RANGED] = 0
    set available_time[UPG_ORC_RANGED] = 0
    set regenerate_time[UPG_ORC_RANGED] = 0
    set gold_price[UPG_ORC_RANGED] = 0
    set wood_price[UPG_ORC_RANGED] = 0

    set old_id[UPG_ORC_ARMOR] = oUPG_ORC_ARMOR
    set needed1[UPG_ORC_ARMOR] = FORGE
    set needed2[UPG_ORC_ARMOR] = STRONGHOLD
    set needed3[UPG_ORC_ARMOR] = FORTRESS
    set tc_add1[UPG_ORC_ARMOR] = 0
    set tc_add2[UPG_ORC_ARMOR] = 0
    set available_time[UPG_ORC_ARMOR] = 0
    set regenerate_time[UPG_ORC_ARMOR] = 0
    set gold_price[UPG_ORC_ARMOR] = 0
    set wood_price[UPG_ORC_ARMOR] = 0

    set old_id[UPG_ORC_SPIKES] = oUPG_ORC_SPIKES
    set needed1[UPG_ORC_SPIKES] = FORGE
    set needed2[UPG_ORC_SPIKES] = STRONGHOLD
    set needed3[UPG_ORC_SPIKES] = FORTRESS
    set tc_add1[UPG_ORC_SPIKES] = 0
    set tc_add2[UPG_ORC_SPIKES] = 0
    set available_time[UPG_ORC_SPIKES] = 0
    set regenerate_time[UPG_ORC_SPIKES] = 0
    set gold_price[UPG_ORC_SPIKES] = 0
    set wood_price[UPG_ORC_SPIKES] = 0

    set old_id[UPG_ORC_DOCS] = oUPG_ORC_DOCS
    set needed1[UPG_ORC_DOCS] = LODGE
    set needed2[UPG_ORC_DOCS] = FORTRESS
    set needed3[UPG_ORC_DOCS] = 0
    set tc_add1[UPG_ORC_DOCS] = 0
    set tc_add2[UPG_ORC_DOCS] = 0
    set available_time[UPG_ORC_DOCS] = 0
    set regenerate_time[UPG_ORC_DOCS] = 0
    set gold_price[UPG_ORC_DOCS] = 0
    set wood_price[UPG_ORC_DOCS] = 0

    set old_id[UPG_ORC_SHAMAN] = oUPG_ORC_SHAMAN
    set needed1[UPG_ORC_SHAMAN] = LODGE
    set needed2[UPG_ORC_SHAMAN] = FORTRESS
    set needed3[UPG_ORC_SHAMAN] = 0
    set tc_add1[UPG_ORC_SHAMAN] = 0
    set tc_add2[UPG_ORC_SHAMAN] = 0
    set available_time[UPG_ORC_SHAMAN] = 0
    set regenerate_time[UPG_ORC_SHAMAN] = 0
    set gold_price[UPG_ORC_SHAMAN] = 0
    set wood_price[UPG_ORC_SHAMAN] = 0

    set old_id[UPG_ORC_SWALKER] = oUPG_ORC_SWALKER
    set needed1[UPG_ORC_SWALKER] = LODGE
    set needed2[UPG_ORC_SWALKER] = FORTRESS
    set needed3[UPG_ORC_SWALKER] = 0
    set tc_add1[UPG_ORC_SWALKER] = 0
    set tc_add2[UPG_ORC_SWALKER] = 0
    set available_time[UPG_ORC_SWALKER] = 0
    set regenerate_time[UPG_ORC_SWALKER] = 0
    set gold_price[UPG_ORC_SWALKER] = 0
    set wood_price[UPG_ORC_SWALKER] = 0

    set old_id[UPG_UNHOLY_STR] = oUPG_UNHOLY_STR
    set needed1[UPG_UNHOLY_STR] = GRAVEYARD
    set needed2[UPG_UNHOLY_STR] = NECROPOLIS_2
    set needed3[UPG_UNHOLY_STR] = NECROPOLIS_3
    set tc_add1[UPG_UNHOLY_STR] = 0
    set tc_add2[UPG_UNHOLY_STR] = 0
    set available_time[UPG_UNHOLY_STR] = 0
    set regenerate_time[UPG_UNHOLY_STR] = 0
    set gold_price[UPG_UNHOLY_STR] = 0
    set wood_price[UPG_UNHOLY_STR] = 0

    set old_id[UPG_CR_ATTACK] = oUPG_CR_ATTACK
    set needed1[UPG_CR_ATTACK] = GRAVEYARD
    set needed2[UPG_CR_ATTACK] = NECROPOLIS_2
    set needed3[UPG_CR_ATTACK] = NECROPOLIS_3
    set tc_add1[UPG_CR_ATTACK] = 0
    set tc_add2[UPG_CR_ATTACK] = 0
    set available_time[UPG_CR_ATTACK] = 0
    set regenerate_time[UPG_CR_ATTACK] = 0
    set gold_price[UPG_CR_ATTACK] = 0
    set wood_price[UPG_CR_ATTACK] = 0

    set old_id[UPG_UNHOLY_ARMOR] = oUPG_UNHOLY_ARMOR
    set needed1[UPG_UNHOLY_ARMOR] = GRAVEYARD
    set needed2[UPG_UNHOLY_ARMOR] = NECROPOLIS_2
    set needed3[UPG_UNHOLY_ARMOR] = NECROPOLIS_3
    set tc_add1[UPG_UNHOLY_ARMOR] = 0
    set tc_add2[UPG_UNHOLY_ARMOR] = 0
    set available_time[UPG_UNHOLY_ARMOR] = 0
    set regenerate_time[UPG_UNHOLY_ARMOR] = 0
    set gold_price[UPG_UNHOLY_ARMOR] = 0
    set wood_price[UPG_UNHOLY_ARMOR] = 0

    set old_id[UPG_CR_ARMOR] = oUPG_CR_ARMOR
    set needed1[UPG_CR_ARMOR] = GRAVEYARD
    set needed2[UPG_CR_ARMOR] = NECROPOLIS_2
    set needed3[UPG_CR_ARMOR] = NECROPOLIS_3
    set tc_add1[UPG_CR_ARMOR] = 0
    set tc_add2[UPG_CR_ARMOR] = 0
    set available_time[UPG_CR_ARMOR] = 0
    set regenerate_time[UPG_CR_ARMOR] = 0
    set gold_price[UPG_CR_ARMOR] = 0
    set wood_price[UPG_CR_ARMOR] = 0

    set old_id[UPG_NECROS] = oUPG_NECROS
    set needed1[UPG_NECROS] = DAMNED_TEMPLE
    set needed2[UPG_NECROS] = NECROPOLIS_3
    set needed3[UPG_NECROS] = 0
    set tc_add1[UPG_NECROS] = 0
    set tc_add2[UPG_NECROS] = 0
    set available_time[UPG_NECROS] = 0
    set regenerate_time[UPG_NECROS] = 0
    set gold_price[UPG_NECROS] = 0
    set wood_price[UPG_NECROS] = 0

    set old_id[UPG_BANSHEE] = oUPG_BANSHEE
    set needed1[UPG_BANSHEE] = DAMNED_TEMPLE
    set needed2[UPG_BANSHEE] = NECROPOLIS_3
    set needed3[UPG_BANSHEE] = 0
    set tc_add1[UPG_BANSHEE] = 0
    set tc_add2[UPG_BANSHEE] = 0
    set available_time[UPG_BANSHEE] = 0
    set regenerate_time[UPG_BANSHEE] = 0
    set gold_price[UPG_BANSHEE] = 0
    set wood_price[UPG_BANSHEE] = 0

    set old_id[UPG_STR_MOON] = oUPG_STR_MOON
    set needed1[UPG_STR_MOON] = HUNTERS_HALL
    set needed2[UPG_STR_MOON] = TREE_AGES
    set needed3[UPG_STR_MOON] = TREE_ETERNITY
    set tc_add1[UPG_STR_MOON] = 0
    set tc_add2[UPG_STR_MOON] = 0
    set available_time[UPG_STR_MOON] = 0
    set regenerate_time[UPG_STR_MOON] = 0
    set gold_price[UPG_STR_MOON] = 0
    set wood_price[UPG_STR_MOON] = 0

    set old_id[UPG_STR_WILD] = oUPG_STR_WILD
    set needed1[UPG_STR_WILD] = HUNTERS_HALL
    set needed2[UPG_STR_WILD] = TREE_AGES
    set needed3[UPG_STR_WILD] = TREE_ETERNITY
    set tc_add1[UPG_STR_WILD] = 0
    set tc_add2[UPG_STR_WILD] = 0
    set available_time[UPG_STR_WILD] = 0
    set regenerate_time[UPG_STR_WILD] = 0
    set gold_price[UPG_STR_WILD] = 0
    set wood_price[UPG_STR_WILD] = 0

    set old_id[UPG_MOON_ARMOR] = oUPG_MOON_ARMOR
    set needed1[UPG_MOON_ARMOR] = HUNTERS_HALL
    set needed2[UPG_MOON_ARMOR] = TREE_AGES
    set needed3[UPG_MOON_ARMOR] = TREE_ETERNITY
    set tc_add1[UPG_MOON_ARMOR] = 0
    set tc_add2[UPG_MOON_ARMOR] = 0
    set available_time[UPG_MOON_ARMOR] = 0
    set regenerate_time[UPG_MOON_ARMOR] = 0
    set gold_price[UPG_MOON_ARMOR] = 0
    set wood_price[UPG_MOON_ARMOR] = 0

    set old_id[UPG_HIDES] = oUPG_HIDES
    set needed1[UPG_HIDES] = HUNTERS_HALL
    set needed2[UPG_HIDES] = TREE_AGES
    set needed3[UPG_HIDES] = TREE_ETERNITY
    set tc_add1[UPG_HIDES] = 0
    set tc_add2[UPG_HIDES] = 0
    set available_time[UPG_HIDES] = 0
    set regenerate_time[UPG_HIDES] = 0
    set gold_price[UPG_HIDES] = 0
    set wood_price[UPG_HIDES] = 0

    set old_id[UPG_DRUID_TALON] = oUPG_DRUID_TALON
    set needed1[UPG_DRUID_TALON] = ANCIENT_WIND
    set needed2[UPG_DRUID_TALON] = TREE_ETERNITY
    set needed3[UPG_DRUID_TALON] = 0
    set tc_add1[UPG_DRUID_TALON] = 0
    set tc_add2[UPG_DRUID_TALON] = 0
    set available_time[UPG_DRUID_TALON] = 0
    set regenerate_time[UPG_DRUID_TALON] = 0
    set gold_price[UPG_DRUID_TALON] = 0
    set wood_price[UPG_DRUID_TALON] = 0

    set old_id[UPG_DRUID_CLAW] = oUPG_DRUID_CLAW
    set needed1[UPG_DRUID_CLAW] = ANCIENT_LORE
    set needed2[UPG_DRUID_CLAW] = TREE_ETERNITY
    set needed3[UPG_DRUID_CLAW] = 0
    set tc_add1[UPG_DRUID_CLAW] = 0
    set tc_add2[UPG_DRUID_CLAW] = 0
    set available_time[UPG_DRUID_CLAW] = 0
    set regenerate_time[UPG_DRUID_CLAW] = 0
    set gold_price[UPG_DRUID_CLAW] = 0
    set wood_price[UPG_DRUID_CLAW] = 0

    set old_id[ML_UPGRADE_END] = oML_UPGRADE_END
    set needed1[ML_UPGRADE_END] = 0
    set needed2[ML_UPGRADE_END] = 0
    set needed3[ML_UPGRADE_END] = 0
    set tc_add1[ML_UPGRADE_END] = 0
    set tc_add2[ML_UPGRADE_END] = 0
    set available_time[ML_UPGRADE_END] = 0
    set regenerate_time[ML_UPGRADE_END] = 0
    set gold_price[ML_UPGRADE_END] = 0
    set wood_price[ML_UPGRADE_END] = 0

    set old_id[ITEMS_START] = oITEMS_START
    set needed1[ITEMS_START] = 0
    set needed2[ITEMS_START] = 0
    set needed3[ITEMS_START] = 0
    set tc_add1[ITEMS_START] = 0
    set tc_add2[ITEMS_START] = 0
    set available_time[ITEMS_START] = 0
    set regenerate_time[ITEMS_START] = 0
    set gold_price[ITEMS_START] = 0
    set wood_price[ITEMS_START] = 0

    set old_id[HUMAN_ITEMS_START] = oHUMAN_ITEMS_START
    set needed1[HUMAN_ITEMS_START] = 0
    set needed2[HUMAN_ITEMS_START] = 0
    set needed3[HUMAN_ITEMS_START] = 0
    set tc_add1[HUMAN_ITEMS_START] = 0
    set tc_add2[HUMAN_ITEMS_START] = 0
    set available_time[HUMAN_ITEMS_START] = 0
    set regenerate_time[HUMAN_ITEMS_START] = 0
    set gold_price[HUMAN_ITEMS_START] = 0
    set wood_price[HUMAN_ITEMS_START] = 0

    set old_id[SCROLL_OF_REGENERATION] = oSCROLL_OF_REGENERATION
    set needed1[SCROLL_OF_REGENERATION] = racial_shop
    set needed2[SCROLL_OF_REGENERATION] = 0
    set needed3[SCROLL_OF_REGENERATION] = 0
    set tc_add1[SCROLL_OF_REGENERATION] = 0
    set tc_add2[SCROLL_OF_REGENERATION] = 0
    set available_time[SCROLL_OF_REGENERATION] = 0
    set regenerate_time[SCROLL_OF_REGENERATION] = 18
    set gold_price[SCROLL_OF_REGENERATION] = 100
    set wood_price[SCROLL_OF_REGENERATION] = 0

    set old_id[MECHANICAL_CRITTER] = oMECHANICAL_CRITTER
    set needed1[MECHANICAL_CRITTER] = racial_shop
    set needed2[MECHANICAL_CRITTER] = 0
    set needed3[MECHANICAL_CRITTER] = 0
    set tc_add1[MECHANICAL_CRITTER] = 0
    set tc_add2[MECHANICAL_CRITTER] = 0
    set available_time[MECHANICAL_CRITTER] = 0
    set regenerate_time[MECHANICAL_CRITTER] = 12
    set gold_price[MECHANICAL_CRITTER] = 50
    set wood_price[MECHANICAL_CRITTER] = 0

    set old_id[LESSER_CLARITY_POTION] = oLESSER_CLARITY_POTION
    set needed1[LESSER_CLARITY_POTION] = racial_shop
    set needed2[LESSER_CLARITY_POTION] = 0
    set needed3[LESSER_CLARITY_POTION] = 0
    set tc_add1[LESSER_CLARITY_POTION] = 0
    set tc_add2[LESSER_CLARITY_POTION] = 0
    set available_time[LESSER_CLARITY_POTION] = 0
    set regenerate_time[LESSER_CLARITY_POTION] = 6
    set gold_price[LESSER_CLARITY_POTION] = 70
    set wood_price[LESSER_CLARITY_POTION] = 0

    set old_id[HEALING_POTION] = oHEALING_POTION
    set needed1[HEALING_POTION] = racial_shop
    set needed2[HEALING_POTION] = racial_hall2
    set needed3[HEALING_POTION] = 0
    set tc_add1[HEALING_POTION] = 0
    set tc_add2[HEALING_POTION] = 0
    set available_time[HEALING_POTION] = 0
    set regenerate_time[HEALING_POTION] = 24
    set gold_price[HEALING_POTION] = 150
    set wood_price[HEALING_POTION] = 0

    set old_id[MANA_POTION] = oMANA_POTION
    set needed1[MANA_POTION] = racial_shop
    set needed2[MANA_POTION] = racial_hall2
    set needed3[MANA_POTION] = 0
    set tc_add1[MANA_POTION] = 0
    set tc_add2[MANA_POTION] = 0
    set available_time[MANA_POTION] = 0
    set regenerate_time[MANA_POTION] = 24
    set gold_price[MANA_POTION] = 200
    set wood_price[MANA_POTION] = 0

    set old_id[TOWN_PORTAL] = oTOWN_PORTAL
    set needed1[TOWN_PORTAL] = racial_shop
    set needed2[TOWN_PORTAL] = racial_hall2
    set needed3[TOWN_PORTAL] = 0
    set tc_add1[TOWN_PORTAL] = 0
    set tc_add2[TOWN_PORTAL] = 0
    set available_time[TOWN_PORTAL] = 0
    set regenerate_time[TOWN_PORTAL] = 24
    set gold_price[TOWN_PORTAL] = 350
    set wood_price[TOWN_PORTAL] = 0

    set old_id[IVORY_TOWER] = oIVORY_TOWER
    set needed1[IVORY_TOWER] = racial_shop
    set needed2[IVORY_TOWER] = racial_hall2
    set needed3[IVORY_TOWER] = 0
    set tc_add1[IVORY_TOWER] = 0
    set tc_add2[IVORY_TOWER] = 0
    set available_time[IVORY_TOWER] = 0
    set regenerate_time[IVORY_TOWER] = 6
    set gold_price[IVORY_TOWER] = 30
    set wood_price[IVORY_TOWER] = 20

    set old_id[ORB_OF_FIRE] = oORB_OF_FIRE
    set needed1[ORB_OF_FIRE] = racial_shop
    set needed2[ORB_OF_FIRE] = racial_hall3
    set needed3[ORB_OF_FIRE] = 0
    set tc_add1[ORB_OF_FIRE] = 0
    set tc_add2[ORB_OF_FIRE] = 0
    set available_time[ORB_OF_FIRE] = 0
    set regenerate_time[ORB_OF_FIRE] = 24
    set gold_price[ORB_OF_FIRE] = 300
    set wood_price[ORB_OF_FIRE] = 0

    set old_id[STAFF_OF_SANCTUARY] = oSTAFF_OF_SANCTUARY
    set needed1[STAFF_OF_SANCTUARY] = racial_shop
    set needed2[STAFF_OF_SANCTUARY] = racial_hall3
    set needed3[STAFF_OF_SANCTUARY] = 0
    set tc_add1[STAFF_OF_SANCTUARY] = 0
    set tc_add2[STAFF_OF_SANCTUARY] = 0
    set available_time[STAFF_OF_SANCTUARY] = 0
    set regenerate_time[STAFF_OF_SANCTUARY] = 24
    set gold_price[STAFF_OF_SANCTUARY] = 250
    set wood_price[STAFF_OF_SANCTUARY] = 0

    set old_id[ORC_ITEMS_START] = oORC_ITEMS_START
    set needed1[ORC_ITEMS_START] = 0
    set needed2[ORC_ITEMS_START] = 0
    set needed3[ORC_ITEMS_START] = 0
    set tc_add1[ORC_ITEMS_START] = 0
    set tc_add2[ORC_ITEMS_START] = 0
    set available_time[ORC_ITEMS_START] = 0
    set regenerate_time[ORC_ITEMS_START] = 0
    set gold_price[ORC_ITEMS_START] = 0
    set wood_price[ORC_ITEMS_START] = 0

    set old_id[HEALING_SALVE] = oHEALING_SALVE
    set needed1[HEALING_SALVE] = racial_shop
    set needed2[HEALING_SALVE] = 0
    set needed3[HEALING_SALVE] = 0
    set tc_add1[HEALING_SALVE] = 0
    set tc_add2[HEALING_SALVE] = 0
    set available_time[HEALING_SALVE] = 0
    set regenerate_time[HEALING_SALVE] = 12
    set gold_price[HEALING_SALVE] = 100
    set wood_price[HEALING_SALVE] = 0

    set old_id[SCROLL_OF_SPEED] = oSCROLL_OF_SPEED
    set needed1[SCROLL_OF_SPEED] = racial_shop
    set needed2[SCROLL_OF_SPEED] = 0
    set needed3[SCROLL_OF_SPEED] = 0
    set tc_add1[SCROLL_OF_SPEED] = 0
    set tc_add2[SCROLL_OF_SPEED] = 0
    set available_time[SCROLL_OF_SPEED] = 0
    set regenerate_time[SCROLL_OF_SPEED] = 12
    set gold_price[SCROLL_OF_SPEED] = 50
    set wood_price[SCROLL_OF_SPEED] = 0

    set old_id[ORB_OF_LIGHTNING] = oORB_OF_LIGHTNING
    set needed1[ORB_OF_LIGHTNING] = racial_shop
    set needed2[ORB_OF_LIGHTNING] = racial_hall3
    set needed3[ORB_OF_LIGHTNING] = 0
    set tc_add1[ORB_OF_LIGHTNING] = 0
    set tc_add2[ORB_OF_LIGHTNING] = 0
    set available_time[ORB_OF_LIGHTNING] = 0
    set regenerate_time[ORB_OF_LIGHTNING] = 24
    set gold_price[ORB_OF_LIGHTNING] = 375
    set wood_price[ORB_OF_LIGHTNING] = 0

    set old_id[TINY_GREAT_HALL] = oTINY_GREAT_HALL
    set needed1[TINY_GREAT_HALL] = racial_shop
    set needed2[TINY_GREAT_HALL] = racial_hall3
    set needed3[TINY_GREAT_HALL] = 0
    set tc_add1[TINY_GREAT_HALL] = 0
    set tc_add2[TINY_GREAT_HALL] = 0
    set available_time[TINY_GREAT_HALL] = 0
    set regenerate_time[TINY_GREAT_HALL] = 24
    set gold_price[TINY_GREAT_HALL] = 625
    set wood_price[TINY_GREAT_HALL] = 185

    set old_id[UNDEAD_ITEMS_START] = oUNDEAD_ITEMS_START
    set needed1[UNDEAD_ITEMS_START] = 0
    set needed2[UNDEAD_ITEMS_START] = 0
    set needed3[UNDEAD_ITEMS_START] = 0
    set tc_add1[UNDEAD_ITEMS_START] = 0
    set tc_add2[UNDEAD_ITEMS_START] = 0
    set available_time[UNDEAD_ITEMS_START] = 0
    set regenerate_time[UNDEAD_ITEMS_START] = 0
    set gold_price[UNDEAD_ITEMS_START] = 0
    set wood_price[UNDEAD_ITEMS_START] = 0

    set old_id[ROD_OF_NECROMANCY] = oROD_OF_NECROMANCY
    set needed1[ROD_OF_NECROMANCY] = racial_shop
    set needed2[ROD_OF_NECROMANCY] = 0
    set needed3[ROD_OF_NECROMANCY] = 0
    set tc_add1[ROD_OF_NECROMANCY] = 0
    set tc_add2[ROD_OF_NECROMANCY] = 0
    set available_time[ROD_OF_NECROMANCY] = 0
    set regenerate_time[ROD_OF_NECROMANCY] = 12
    set gold_price[ROD_OF_NECROMANCY] = 150
    set wood_price[ROD_OF_NECROMANCY] = 0

    set old_id[SACRIFICIAL_SKULL] = oSACRIFICIAL_SKULL
    set needed1[SACRIFICIAL_SKULL] = racial_shop
    set needed2[SACRIFICIAL_SKULL] = 0
    set needed3[SACRIFICIAL_SKULL] = 0
    set tc_add1[SACRIFICIAL_SKULL] = 0
    set tc_add2[SACRIFICIAL_SKULL] = 0
    set available_time[SACRIFICIAL_SKULL] = 0
    set regenerate_time[SACRIFICIAL_SKULL] = 12
    set gold_price[SACRIFICIAL_SKULL] = 50
    set wood_price[SACRIFICIAL_SKULL] = 0

    set old_id[DUST_OF_APPEARANCE] = oDUST_OF_APPEARANCE
    set needed1[DUST_OF_APPEARANCE] = racial_shop
    set needed2[DUST_OF_APPEARANCE] = 0
    set needed3[DUST_OF_APPEARANCE] = 0
    set tc_add1[DUST_OF_APPEARANCE] = 0
    set tc_add2[DUST_OF_APPEARANCE] = 0
    set available_time[DUST_OF_APPEARANCE] = 0
    set regenerate_time[DUST_OF_APPEARANCE] = 12
    set gold_price[DUST_OF_APPEARANCE] = 75
    set wood_price[DUST_OF_APPEARANCE] = 0

    set old_id[ORB_OF_CORRUPTION] = oORB_OF_CORRUPTION
    set needed1[ORB_OF_CORRUPTION] = racial_shop
    set needed2[ORB_OF_CORRUPTION] = 0
    set needed3[ORB_OF_CORRUPTION] = 0
    set tc_add1[ORB_OF_CORRUPTION] = 0
    set tc_add2[ORB_OF_CORRUPTION] = 0
    set available_time[ORB_OF_CORRUPTION] = 0
    set regenerate_time[ORB_OF_CORRUPTION] = 24
    set gold_price[ORB_OF_CORRUPTION] = 375
    set wood_price[ORB_OF_CORRUPTION] = 0

    set old_id[SCROLL_OF_HEALING] = oSCROLL_OF_HEALING
    set needed1[SCROLL_OF_HEALING] = racial_shop
    set needed2[SCROLL_OF_HEALING] = 0
    set needed3[SCROLL_OF_HEALING] = 0
    set tc_add1[SCROLL_OF_HEALING] = 0
    set tc_add2[SCROLL_OF_HEALING] = 0
    set available_time[SCROLL_OF_HEALING] = 0
    set regenerate_time[SCROLL_OF_HEALING] = 24
    set gold_price[SCROLL_OF_HEALING] = 250
    set wood_price[SCROLL_OF_HEALING] = 0

    set old_id[ELF_ITEMS_START] = oELF_ITEMS_START
    set needed1[ELF_ITEMS_START] = 0
    set needed2[ELF_ITEMS_START] = 0
    set needed3[ELF_ITEMS_START] = 0
    set tc_add1[ELF_ITEMS_START] = 0
    set tc_add2[ELF_ITEMS_START] = 0
    set available_time[ELF_ITEMS_START] = 0
    set regenerate_time[ELF_ITEMS_START] = 0
    set gold_price[ELF_ITEMS_START] = 0
    set wood_price[ELF_ITEMS_START] = 0

    set old_id[MOONSTONE] = oMOONSTONE
    set needed1[MOONSTONE] = racial_shop
    set needed2[MOONSTONE] = 0
    set needed3[MOONSTONE] = 0
    set tc_add1[MOONSTONE] = 0
    set tc_add2[MOONSTONE] = 0
    set available_time[MOONSTONE] = 0
    set regenerate_time[MOONSTONE] = 18
    set gold_price[MOONSTONE] = 50
    set wood_price[MOONSTONE] = 0

    set old_id[STAFF_OF_PRESERVATION] = oSTAFF_OF_PRESERVATION
    set needed1[STAFF_OF_PRESERVATION] = racial_shop
    set needed2[STAFF_OF_PRESERVATION] = 0
    set needed3[STAFF_OF_PRESERVATION] = 0
    set tc_add1[STAFF_OF_PRESERVATION] = 0
    set tc_add2[STAFF_OF_PRESERVATION] = 0
    set available_time[STAFF_OF_PRESERVATION] = 0
    set regenerate_time[STAFF_OF_PRESERVATION] = 24
    set gold_price[STAFF_OF_PRESERVATION] = 150
    set wood_price[STAFF_OF_PRESERVATION] = 0

    set old_id[ORB_OF_VENOM] = oORB_OF_VENOM
    set needed1[ORB_OF_VENOM] = racial_shop
    set needed2[ORB_OF_VENOM] = 0
    set needed3[ORB_OF_VENOM] = 0
    set tc_add1[ORB_OF_VENOM] = 0
    set tc_add2[ORB_OF_VENOM] = 0
    set available_time[ORB_OF_VENOM] = 0
    set regenerate_time[ORB_OF_VENOM] = 24
    set gold_price[ORB_OF_VENOM] = 325
    set wood_price[ORB_OF_VENOM] = 0

    set old_id[ANTI_MAGIC_POTION] = oANTI_MAGIC_POTION
    set needed1[ANTI_MAGIC_POTION] = racial_shop
    set needed2[ANTI_MAGIC_POTION] = 0
    set needed3[ANTI_MAGIC_POTION] = 0
    set tc_add1[ANTI_MAGIC_POTION] = 0
    set tc_add2[ANTI_MAGIC_POTION] = 0
    set available_time[ANTI_MAGIC_POTION] = 0
    set regenerate_time[ANTI_MAGIC_POTION] = 24
    set gold_price[ANTI_MAGIC_POTION] = 100
    set wood_price[ANTI_MAGIC_POTION] = 0

    set old_id[MERCHANT_ITEMS_START] = oMERCHANT_ITEMS_START
    set needed1[MERCHANT_ITEMS_START] = 0
    set needed2[MERCHANT_ITEMS_START] = 0
    set needed3[MERCHANT_ITEMS_START] = 0
    set tc_add1[MERCHANT_ITEMS_START] = 0
    set tc_add2[MERCHANT_ITEMS_START] = 0
    set available_time[MERCHANT_ITEMS_START] = 0
    set regenerate_time[MERCHANT_ITEMS_START] = 0
    set gold_price[MERCHANT_ITEMS_START] = 0
    set wood_price[MERCHANT_ITEMS_START] = 0

    set old_id[CIRCLET_OF_NOBILITY] = oCIRCLET_OF_NOBILITY
    set needed1[CIRCLET_OF_NOBILITY] = 0
    set needed2[CIRCLET_OF_NOBILITY] = 0
    set needed3[CIRCLET_OF_NOBILITY] = 0
    set tc_add1[CIRCLET_OF_NOBILITY] = 0
    set tc_add2[CIRCLET_OF_NOBILITY] = 0
    set available_time[CIRCLET_OF_NOBILITY] = 0
    set regenerate_time[CIRCLET_OF_NOBILITY] = 18
    set gold_price[CIRCLET_OF_NOBILITY] = 175
    set wood_price[CIRCLET_OF_NOBILITY] = 0

    set old_id[PERIAPT_OF_VITALITY] = oPERIAPT_OF_VITALITY
    set needed1[PERIAPT_OF_VITALITY] = 0
    set needed2[PERIAPT_OF_VITALITY] = 0
    set needed3[PERIAPT_OF_VITALITY] = 0
    set tc_add1[PERIAPT_OF_VITALITY] = 0
    set tc_add2[PERIAPT_OF_VITALITY] = 0
    set available_time[PERIAPT_OF_VITALITY] = 0
    set regenerate_time[PERIAPT_OF_VITALITY] = 24
    set gold_price[PERIAPT_OF_VITALITY] = 350
    set wood_price[PERIAPT_OF_VITALITY] = 0

    set old_id[BOOTS_OF_SPEED] = oBOOTS_OF_SPEED
    set needed1[BOOTS_OF_SPEED] = 0
    set needed2[BOOTS_OF_SPEED] = 0
    set needed3[BOOTS_OF_SPEED] = 0
    set tc_add1[BOOTS_OF_SPEED] = 0
    set tc_add2[BOOTS_OF_SPEED] = 0
    set available_time[BOOTS_OF_SPEED] = 44
    set regenerate_time[BOOTS_OF_SPEED] = 12
    set gold_price[BOOTS_OF_SPEED] = 250
    set wood_price[BOOTS_OF_SPEED] = 0

    set old_id[M_DUST_OF_APPEARANCE] = oM_DUST_OF_APPEARANCE
    set needed1[M_DUST_OF_APPEARANCE] = 0
    set needed2[M_DUST_OF_APPEARANCE] = 0
    set needed3[M_DUST_OF_APPEARANCE] = 0
    set tc_add1[M_DUST_OF_APPEARANCE] = 0
    set tc_add2[M_DUST_OF_APPEARANCE] = 0
    set available_time[M_DUST_OF_APPEARANCE] = 0
    set regenerate_time[M_DUST_OF_APPEARANCE] = 12
    set gold_price[M_DUST_OF_APPEARANCE] = 250
    set wood_price[M_DUST_OF_APPEARANCE] = 0

    set old_id[M_SCROLL_OF_HEALING] = oM_SCROLL_OF_HEALING
    set needed1[M_SCROLL_OF_HEALING] = 0
    set needed2[M_SCROLL_OF_HEALING] = 0
    set needed3[M_SCROLL_OF_HEALING] = 0
    set tc_add1[M_SCROLL_OF_HEALING] = 0
    set tc_add2[M_SCROLL_OF_HEALING] = 0
    set available_time[M_SCROLL_OF_HEALING] = 88
    set regenerate_time[M_SCROLL_OF_HEALING] = 24
    set gold_price[M_SCROLL_OF_HEALING] = 250
    set wood_price[M_SCROLL_OF_HEALING] = 0

    set old_id[SCROLL_OF_PROTECTION] = oSCROLL_OF_PROTECTION
    set needed1[SCROLL_OF_PROTECTION] = 0
    set needed2[SCROLL_OF_PROTECTION] = 0
    set needed3[SCROLL_OF_PROTECTION] = 0
    set tc_add1[SCROLL_OF_PROTECTION] = 0
    set tc_add2[SCROLL_OF_PROTECTION] = 0
    set available_time[SCROLL_OF_PROTECTION] = 88
    set regenerate_time[SCROLL_OF_PROTECTION] = 24
    set gold_price[SCROLL_OF_PROTECTION] = 150
    set wood_price[SCROLL_OF_PROTECTION] = 0

    set old_id[M_TOWN_PORTAL] = oM_TOWN_PORTAL
    set needed1[M_TOWN_PORTAL] = 0
    set needed2[M_TOWN_PORTAL] = 0
    set needed3[M_TOWN_PORTAL] = 0
    set tc_add1[M_TOWN_PORTAL] = 0
    set tc_add2[M_TOWN_PORTAL] = 0
    set available_time[M_TOWN_PORTAL] = 88
    set regenerate_time[M_TOWN_PORTAL] = 24
    set gold_price[M_TOWN_PORTAL] = 250
    set wood_price[M_TOWN_PORTAL] = 0

    set old_id[POTION_OF_INVISIBILITY] = oPOTION_OF_INVISIBILITY
    set needed1[POTION_OF_INVISIBILITY] = 0
    set needed2[POTION_OF_INVISIBILITY] = 0
    set needed3[POTION_OF_INVISIBILITY] = 0
    set tc_add1[POTION_OF_INVISIBILITY] = 0
    set tc_add2[POTION_OF_INVISIBILITY] = 0
    set available_time[POTION_OF_INVISIBILITY] = 88
    set regenerate_time[POTION_OF_INVISIBILITY] = 24
    set gold_price[POTION_OF_INVISIBILITY] = 100
    set wood_price[POTION_OF_INVISIBILITY] = 0

    set old_id[TOME_OF_RETRAINING] = oTOME_OF_RETRAINING
    set needed1[TOME_OF_RETRAINING] = 0
    set needed2[TOME_OF_RETRAINING] = 0
    set needed3[TOME_OF_RETRAINING] = 0
    set tc_add1[TOME_OF_RETRAINING] = 0
    set tc_add2[TOME_OF_RETRAINING] = 0
    set available_time[TOME_OF_RETRAINING] = 88
    set regenerate_time[TOME_OF_RETRAINING] = 24
    set gold_price[TOME_OF_RETRAINING] = 300
    set wood_price[TOME_OF_RETRAINING] = 0

    set old_id[STAFF_OF_TELEPORTATION] = oSTAFF_OF_TELEPORTATION
    set needed1[STAFF_OF_TELEPORTATION] = 0
    set needed2[STAFF_OF_TELEPORTATION] = 0
    set needed3[STAFF_OF_TELEPORTATION] = 0
    set tc_add1[STAFF_OF_TELEPORTATION] = 0
    set tc_add2[STAFF_OF_TELEPORTATION] = 0
    set available_time[STAFF_OF_TELEPORTATION] = 44
    set regenerate_time[STAFF_OF_TELEPORTATION] = 24
    set gold_price[STAFF_OF_TELEPORTATION] = 100
    set wood_price[STAFF_OF_TELEPORTATION] = 0

    set old_id[POTION_OF_LESSER_INVULNERBILITY] = oPOTION_OF_LESSER_INVULNERBILITY
    set needed1[POTION_OF_LESSER_INVULNERBILITY] = 0
    set needed2[POTION_OF_LESSER_INVULNERBILITY] = 0
    set needed3[POTION_OF_LESSER_INVULNERBILITY] = 0
    set tc_add1[POTION_OF_LESSER_INVULNERBILITY] = 0
    set tc_add2[POTION_OF_LESSER_INVULNERBILITY] = 0
    set available_time[POTION_OF_LESSER_INVULNERBILITY] = 88
    set regenerate_time[POTION_OF_LESSER_INVULNERBILITY] = 24
    set gold_price[POTION_OF_LESSER_INVULNERBILITY] = 150
    set wood_price[POTION_OF_LESSER_INVULNERBILITY] = 0

    set old_id[ITEMS_END] = oITEMS_END
    set needed1[ITEMS_END] = 0
    set needed2[ITEMS_END] = 0
    set needed3[ITEMS_END] = 0
    set tc_add1[ITEMS_END] = 0
    set tc_add2[ITEMS_END] = 0
    set available_time[ITEMS_END] = 0
    set regenerate_time[ITEMS_END] = 0
    set gold_price[ITEMS_END] = 0
    set wood_price[ITEMS_END] = 0

    set old_id[NEUTRAL_UNITS_START] = oNEUTRAL_UNITS_START
    set needed1[NEUTRAL_UNITS_START] = 0
    set needed2[NEUTRAL_UNITS_START] = 0
    set needed3[NEUTRAL_UNITS_START] = 0
    set tc_add1[NEUTRAL_UNITS_START] = 0
    set tc_add2[NEUTRAL_UNITS_START] = 0
    set available_time[NEUTRAL_UNITS_START] = 0
    set regenerate_time[NEUTRAL_UNITS_START] = 0
    set gold_price[NEUTRAL_UNITS_START] = 0
    set wood_price[NEUTRAL_UNITS_START] = 0

    set old_id[NEUTRAL_MERC_START] = oNEUTRAL_MERC_START
    set needed1[NEUTRAL_MERC_START] = 0
    set needed2[NEUTRAL_MERC_START] = 0
    set needed3[NEUTRAL_MERC_START] = 0
    set tc_add1[NEUTRAL_MERC_START] = 0
    set tc_add2[NEUTRAL_MERC_START] = 0
    set available_time[NEUTRAL_MERC_START] = 0
    set regenerate_time[NEUTRAL_MERC_START] = 0
    set gold_price[NEUTRAL_MERC_START] = 0
    set wood_price[NEUTRAL_MERC_START] = 0

    set old_id[SATYR_SHADOWDANCER] = oSATYR_SHADOWDANCER
    set needed1[SATYR_SHADOWDANCER] = 0
    set needed2[SATYR_SHADOWDANCER] = 0
    set needed3[SATYR_SHADOWDANCER] = 0
    set tc_add1[SATYR_SHADOWDANCER] = 0
    set tc_add2[SATYR_SHADOWDANCER] = 0
    set available_time[SATYR_SHADOWDANCER] = 66
    set regenerate_time[SATYR_SHADOWDANCER] = 32
    set gold_price[SATYR_SHADOWDANCER] = 0
    set wood_price[SATYR_SHADOWDANCER] = 0

    set old_id[FURBOLG_SHAMAN] = oFURBOLG_SHAMAN
    set needed1[FURBOLG_SHAMAN] = 0
    set needed2[FURBOLG_SHAMAN] = 0
    set needed3[FURBOLG_SHAMAN] = 0
    set tc_add1[FURBOLG_SHAMAN] = 0
    set tc_add2[FURBOLG_SHAMAN] = 0
    set available_time[FURBOLG_SHAMAN] = 72
    set regenerate_time[FURBOLG_SHAMAN] = 32
    set gold_price[FURBOLG_SHAMAN] = 0
    set wood_price[FURBOLG_SHAMAN] = 0

    set old_id[THUNDER_LIZARD] = oTHUNDER_LIZARD
    set needed1[THUNDER_LIZARD] = 0
    set needed2[THUNDER_LIZARD] = 0
    set needed3[THUNDER_LIZARD] = 0
    set tc_add1[THUNDER_LIZARD] = 0
    set tc_add2[THUNDER_LIZARD] = 0
    set available_time[THUNDER_LIZARD] = 88
    set regenerate_time[THUNDER_LIZARD] = 52
    set gold_price[THUNDER_LIZARD] = 0
    set wood_price[THUNDER_LIZARD] = 0

    set old_id[CENTAUR_OUTRUNNER] = oCENTAUR_OUTRUNNER
    set needed1[CENTAUR_OUTRUNNER] = 0
    set needed2[CENTAUR_OUTRUNNER] = 0
    set needed3[CENTAUR_OUTRUNNER] = 0
    set tc_add1[CENTAUR_OUTRUNNER] = 0
    set tc_add2[CENTAUR_OUTRUNNER] = 0
    set available_time[CENTAUR_OUTRUNNER] = 12
    set regenerate_time[CENTAUR_OUTRUNNER] = 22
    set gold_price[CENTAUR_OUTRUNNER] = 0
    set wood_price[CENTAUR_OUTRUNNER] = 0

    set old_id[HARPY_ROGUE] = oHARPY_ROGUE
    set needed1[HARPY_ROGUE] = 0
    set needed2[HARPY_ROGUE] = 0
    set needed3[HARPY_ROGUE] = 0
    set tc_add1[HARPY_ROGUE] = 0
    set tc_add2[HARPY_ROGUE] = 0
    set available_time[HARPY_ROGUE] = 72
    set regenerate_time[HARPY_ROGUE] = 22
    set gold_price[HARPY_ROGUE] = 0
    set wood_price[HARPY_ROGUE] = 0

    set old_id[RAZORMANE_MEDICINE_MAN] = oRAZORMANE_MEDICINE_MAN
    set needed1[RAZORMANE_MEDICINE_MAN] = 0
    set needed2[RAZORMANE_MEDICINE_MAN] = 0
    set needed3[RAZORMANE_MEDICINE_MAN] = 0
    set tc_add1[RAZORMANE_MEDICINE_MAN] = 0
    set tc_add2[RAZORMANE_MEDICINE_MAN] = 0
    set available_time[RAZORMANE_MEDICINE_MAN] = 88
    set regenerate_time[RAZORMANE_MEDICINE_MAN] = 42
    set gold_price[RAZORMANE_MEDICINE_MAN] = 0
    set wood_price[RAZORMANE_MEDICINE_MAN] = 0

    set old_id[HARPY_WINDWITCH] = oHARPY_WINDWITCH
    set needed1[HARPY_WINDWITCH] = 0
    set needed2[HARPY_WINDWITCH] = 0
    set needed3[HARPY_WINDWITCH] = 0
    set tc_add1[HARPY_WINDWITCH] = 0
    set tc_add2[HARPY_WINDWITCH] = 0
    set available_time[HARPY_WINDWITCH] = 132
    set regenerate_time[HARPY_WINDWITCH] = 32
    set gold_price[HARPY_WINDWITCH] = 0
    set wood_price[HARPY_WINDWITCH] = 0

    set old_id[FEL_BEAST] = oFEL_BEAST
    set needed1[FEL_BEAST] = 0
    set needed2[FEL_BEAST] = 0
    set needed3[FEL_BEAST] = 0
    set tc_add1[FEL_BEAST] = 0
    set tc_add2[FEL_BEAST] = 0
    set available_time[FEL_BEAST] = 12
    set regenerate_time[FEL_BEAST] = 22
    set gold_price[FEL_BEAST] = 0
    set wood_price[FEL_BEAST] = 0

    set old_id[DRAENEI_DISCIPLE] = oDRAENEI_DISCIPLE
    set needed1[DRAENEI_DISCIPLE] = 0
    set needed2[DRAENEI_DISCIPLE] = 0
    set needed3[DRAENEI_DISCIPLE] = 0
    set tc_add1[DRAENEI_DISCIPLE] = 0
    set tc_add2[DRAENEI_DISCIPLE] = 0
    set available_time[DRAENEI_DISCIPLE] = 27
    set regenerate_time[DRAENEI_DISCIPLE] = 22
    set gold_price[DRAENEI_DISCIPLE] = 0
    set wood_price[DRAENEI_DISCIPLE] = 0

    set old_id[VOIDWALKER] = oVOIDWALKER
    set needed1[VOIDWALKER] = 0
    set needed2[VOIDWALKER] = 0
    set needed3[VOIDWALKER] = 0
    set tc_add1[VOIDWALKER] = 0
    set tc_add2[VOIDWALKER] = 0
    set available_time[VOIDWALKER] = 88
    set regenerate_time[VOIDWALKER] = 42
    set gold_price[VOIDWALKER] = 0
    set wood_price[VOIDWALKER] = 0

    set old_id[DRAENEI_DARKSLAYER] = oDRAENEI_DARKSLAYER
    set needed1[DRAENEI_DARKSLAYER] = 0
    set needed2[DRAENEI_DARKSLAYER] = 0
    set needed3[DRAENEI_DARKSLAYER] = 0
    set tc_add1[DRAENEI_DARKSLAYER] = 0
    set tc_add2[DRAENEI_DARKSLAYER] = 0
    set available_time[DRAENEI_DARKSLAYER] = 66
    set regenerate_time[DRAENEI_DARKSLAYER] = 42
    set gold_price[DRAENEI_DARKSLAYER] = 0
    set wood_price[DRAENEI_DARKSLAYER] = 0

    set old_id[ROGUE] = oROGUE
    set needed1[ROGUE] = 0
    set needed2[ROGUE] = 0
    set needed3[ROGUE] = 0
    set tc_add1[ROGUE] = 0
    set tc_add2[ROGUE] = 0
    set available_time[ROGUE] = 88
    set regenerate_time[ROGUE] = 22
    set gold_price[ROGUE] = 0
    set wood_price[ROGUE] = 0

    set old_id[ASSASSIN] = oASSASSIN
    set needed1[ASSASSIN] = 0
    set needed2[ASSASSIN] = 0
    set needed3[ASSASSIN] = 0
    set tc_add1[ASSASSIN] = 0
    set tc_add2[ASSASSIN] = 0
    set available_time[ASSASSIN] = 88
    set regenerate_time[ASSASSIN] = 32
    set gold_price[ASSASSIN] = 0
    set wood_price[ASSASSIN] = 0

    set old_id[KOBOLD_GEOMANCER] = oKOBOLD_GEOMANCER
    set needed1[KOBOLD_GEOMANCER] = 0
    set needed2[KOBOLD_GEOMANCER] = 0
    set needed3[KOBOLD_GEOMANCER] = 0
    set tc_add1[KOBOLD_GEOMANCER] = 0
    set tc_add2[KOBOLD_GEOMANCER] = 0
    set available_time[KOBOLD_GEOMANCER] = 88
    set regenerate_time[KOBOLD_GEOMANCER] = 32
    set gold_price[KOBOLD_GEOMANCER] = 0
    set wood_price[KOBOLD_GEOMANCER] = 0

    set old_id[FOREST_TROLL_HIGH_PRIEST] = oFOREST_TROLL_HIGH_PRIEST
    set needed1[FOREST_TROLL_HIGH_PRIEST] = 0
    set needed2[FOREST_TROLL_HIGH_PRIEST] = 0
    set needed3[FOREST_TROLL_HIGH_PRIEST] = 0
    set tc_add1[FOREST_TROLL_HIGH_PRIEST] = 0
    set tc_add2[FOREST_TROLL_HIGH_PRIEST] = 0
    set available_time[FOREST_TROLL_HIGH_PRIEST] = 88
    set regenerate_time[FOREST_TROLL_HIGH_PRIEST] = 42
    set gold_price[FOREST_TROLL_HIGH_PRIEST] = 0
    set wood_price[FOREST_TROLL_HIGH_PRIEST] = 0

    set old_id[BURNING_ARCHER] = oBURNING_ARCHER
    set needed1[BURNING_ARCHER] = 0
    set needed2[BURNING_ARCHER] = 0
    set needed3[BURNING_ARCHER] = 0
    set tc_add1[BURNING_ARCHER] = 0
    set tc_add2[BURNING_ARCHER] = 0
    set available_time[BURNING_ARCHER] = 12
    set regenerate_time[BURNING_ARCHER] = 22
    set gold_price[BURNING_ARCHER] = 0
    set wood_price[BURNING_ARCHER] = 0

    set old_id[WILDKIN] = oWILDKIN
    set needed1[WILDKIN] = 0
    set needed2[WILDKIN] = 0
    set needed3[WILDKIN] = 0
    set tc_add1[WILDKIN] = 0
    set tc_add2[WILDKIN] = 0
    set available_time[WILDKIN] = 44
    set regenerate_time[WILDKIN] = 32
    set gold_price[WILDKIN] = 0
    set wood_price[WILDKIN] = 0

    set old_id[MURLOC_FLESHEATER] = oMURLOC_FLESHEATER
    set needed1[MURLOC_FLESHEATER] = 0
    set needed2[MURLOC_FLESHEATER] = 0
    set needed3[MURLOC_FLESHEATER] = 0
    set tc_add1[MURLOC_FLESHEATER] = 0
    set tc_add2[MURLOC_FLESHEATER] = 0
    set available_time[MURLOC_FLESHEATER] = 12
    set regenerate_time[MURLOC_FLESHEATER] = 22
    set gold_price[MURLOC_FLESHEATER] = 0
    set wood_price[MURLOC_FLESHEATER] = 0

    set old_id[SLUDGE_FLINGER] = oSLUDGE_FLINGER
    set needed1[SLUDGE_FLINGER] = 0
    set needed2[SLUDGE_FLINGER] = 0
    set needed3[SLUDGE_FLINGER] = 0
    set tc_add1[SLUDGE_FLINGER] = 0
    set tc_add2[SLUDGE_FLINGER] = 0
    set available_time[SLUDGE_FLINGER] = 66
    set regenerate_time[SLUDGE_FLINGER] = 32
    set gold_price[SLUDGE_FLINGER] = 0
    set wood_price[SLUDGE_FLINGER] = 0

    set old_id[SATYR_SOULSTEALER] = oSATYR_SOULSTEALER
    set needed1[SATYR_SOULSTEALER] = 0
    set needed2[SATYR_SOULSTEALER] = 0
    set needed3[SATYR_SOULSTEALER] = 0
    set tc_add1[SATYR_SOULSTEALER] = 0
    set tc_add2[SATYR_SOULSTEALER] = 0
    set available_time[SATYR_SOULSTEALER] = 88
    set regenerate_time[SATYR_SOULSTEALER] = 42
    set gold_price[SATYR_SOULSTEALER] = 0
    set wood_price[SATYR_SOULSTEALER] = 0

    set old_id[BARBED_ARACHNATHID] = oBARBED_ARACHNATHID
    set needed1[BARBED_ARACHNATHID] = 0
    set needed2[BARBED_ARACHNATHID] = 0
    set needed3[BARBED_ARACHNATHID] = 0
    set tc_add1[BARBED_ARACHNATHID] = 0
    set tc_add2[BARBED_ARACHNATHID] = 0
    set available_time[BARBED_ARACHNATHID] = 88
    set regenerate_time[BARBED_ARACHNATHID] = 12
    set gold_price[BARBED_ARACHNATHID] = 0
    set wood_price[BARBED_ARACHNATHID] = 0

    set old_id[BLUE_DRAGONSPAWN_MEDDLER] = oBLUE_DRAGONSPAWN_MEDDLER
    set needed1[BLUE_DRAGONSPAWN_MEDDLER] = 0
    set needed2[BLUE_DRAGONSPAWN_MEDDLER] = 0
    set needed3[BLUE_DRAGONSPAWN_MEDDLER] = 0
    set tc_add1[BLUE_DRAGONSPAWN_MEDDLER] = 0
    set tc_add2[BLUE_DRAGONSPAWN_MEDDLER] = 0
    set available_time[BLUE_DRAGONSPAWN_MEDDLER] = 44
    set regenerate_time[BLUE_DRAGONSPAWN_MEDDLER] = 22
    set gold_price[BLUE_DRAGONSPAWN_MEDDLER] = 0
    set wood_price[BLUE_DRAGONSPAWN_MEDDLER] = 0

    set old_id[MAGNATAUR_WARRIOR] = oMAGNATAUR_WARRIOR
    set needed1[MAGNATAUR_WARRIOR] = 0
    set needed2[MAGNATAUR_WARRIOR] = 0
    set needed3[MAGNATAUR_WARRIOR] = 0
    set tc_add1[MAGNATAUR_WARRIOR] = 0
    set tc_add2[MAGNATAUR_WARRIOR] = 0
    set available_time[MAGNATAUR_WARRIOR] = 88
    set regenerate_time[MAGNATAUR_WARRIOR] = 42
    set gold_price[MAGNATAUR_WARRIOR] = 0
    set wood_price[MAGNATAUR_WARRIOR] = 0

    set old_id[POLAR_FURBOLG_SHAMAN] = oPOLAR_FURBOLG_SHAMAN
    set needed1[POLAR_FURBOLG_SHAMAN] = 0
    set needed2[POLAR_FURBOLG_SHAMAN] = 0
    set needed3[POLAR_FURBOLG_SHAMAN] = 0
    set tc_add1[POLAR_FURBOLG_SHAMAN] = 0
    set tc_add2[POLAR_FURBOLG_SHAMAN] = 0
    set available_time[POLAR_FURBOLG_SHAMAN] = 66
    set regenerate_time[POLAR_FURBOLG_SHAMAN] = 32
    set gold_price[POLAR_FURBOLG_SHAMAN] = 0
    set wood_price[POLAR_FURBOLG_SHAMAN] = 0

    set old_id[GNOLL_BRUTE] = oGNOLL_BRUTE
    set needed1[GNOLL_BRUTE] = 0
    set needed2[GNOLL_BRUTE] = 0
    set needed3[GNOLL_BRUTE] = 0
    set tc_add1[GNOLL_BRUTE] = 0
    set tc_add2[GNOLL_BRUTE] = 0
    set available_time[GNOLL_BRUTE] = 12
    set regenerate_time[GNOLL_BRUTE] = 22
    set gold_price[GNOLL_BRUTE] = 0
    set wood_price[GNOLL_BRUTE] = 0

    set old_id[GNOLL_WARDEN] = oGNOLL_WARDEN
    set needed1[GNOLL_WARDEN] = 0
    set needed2[GNOLL_WARDEN] = 0
    set needed3[GNOLL_WARDEN] = 0
    set tc_add1[GNOLL_WARDEN] = 0
    set tc_add2[GNOLL_WARDEN] = 0
    set available_time[GNOLL_WARDEN] = 36
    set regenerate_time[GNOLL_WARDEN] = 22
    set gold_price[GNOLL_WARDEN] = 0
    set wood_price[GNOLL_WARDEN] = 0

    set old_id[OGRE_MAGI] = oOGRE_MAGI
    set needed1[OGRE_MAGI] = 0
    set needed2[OGRE_MAGI] = 0
    set needed3[OGRE_MAGI] = 0
    set tc_add1[OGRE_MAGI] = 0
    set tc_add2[OGRE_MAGI] = 0
    set available_time[OGRE_MAGI] = 88
    set regenerate_time[OGRE_MAGI] = 42
    set gold_price[OGRE_MAGI] = 0
    set wood_price[OGRE_MAGI] = 0

    set old_id[MUD_GOLEM] = oMUD_GOLEM
    set needed1[MUD_GOLEM] = 0
    set needed2[MUD_GOLEM] = 0
    set needed3[MUD_GOLEM] = 0
    set tc_add1[MUD_GOLEM] = 0
    set tc_add2[MUD_GOLEM] = 0
    set available_time[MUD_GOLEM] = 88
    set regenerate_time[MUD_GOLEM] = 22
    set gold_price[MUD_GOLEM] = 0
    set wood_price[MUD_GOLEM] = 0

    set old_id[FOREST_TROLL_BERSERKER] = oFOREST_TROLL_BERSERKER
    set needed1[FOREST_TROLL_BERSERKER] = 0
    set needed2[FOREST_TROLL_BERSERKER] = 0
    set needed3[FOREST_TROLL_BERSERKER] = 0
    set tc_add1[FOREST_TROLL_BERSERKER] = 0
    set tc_add2[FOREST_TROLL_BERSERKER] = 0
    set available_time[FOREST_TROLL_BERSERKER] = 44
    set regenerate_time[FOREST_TROLL_BERSERKER] = 42
    set gold_price[FOREST_TROLL_BERSERKER] = 0
    set wood_price[FOREST_TROLL_BERSERKER] = 0

    set old_id[FOREST_TROLL_SHADOW_PRIEST] = oFOREST_TROLL_SHADOW_PRIEST
    set needed1[FOREST_TROLL_SHADOW_PRIEST] = 0
    set needed2[FOREST_TROLL_SHADOW_PRIEST] = 0
    set needed3[FOREST_TROLL_SHADOW_PRIEST] = 0
    set tc_add1[FOREST_TROLL_SHADOW_PRIEST] = 0
    set tc_add2[FOREST_TROLL_SHADOW_PRIEST] = 0
    set available_time[FOREST_TROLL_SHADOW_PRIEST] = 24
    set regenerate_time[FOREST_TROLL_SHADOW_PRIEST] = 22
    set gold_price[FOREST_TROLL_SHADOW_PRIEST] = 0
    set wood_price[FOREST_TROLL_SHADOW_PRIEST] = 0

    set old_id[OGRE_MAULER] = oOGRE_MAULER
    set needed1[OGRE_MAULER] = 0
    set needed2[OGRE_MAULER] = 0
    set needed3[OGRE_MAULER] = 0
    set tc_add1[OGRE_MAULER] = 0
    set tc_add2[OGRE_MAULER] = 0
    set available_time[OGRE_MAULER] = 88
    set regenerate_time[OGRE_MAULER] = 32
    set gold_price[OGRE_MAULER] = 0
    set wood_price[OGRE_MAULER] = 0

    set old_id[GNOLL_OVERSEER] = oGNOLL_OVERSEER
    set needed1[GNOLL_OVERSEER] = 0
    set needed2[GNOLL_OVERSEER] = 0
    set needed3[GNOLL_OVERSEER] = 0
    set tc_add1[GNOLL_OVERSEER] = 0
    set tc_add2[GNOLL_OVERSEER] = 0
    set available_time[GNOLL_OVERSEER] = 88
    set regenerate_time[GNOLL_OVERSEER] = 42
    set gold_price[GNOLL_OVERSEER] = 0
    set wood_price[GNOLL_OVERSEER] = 0

    set old_id[ICE_TROLL_BERSERKER] = oICE_TROLL_BERSERKER
    set needed1[ICE_TROLL_BERSERKER] = 0
    set needed2[ICE_TROLL_BERSERKER] = 0
    set needed3[ICE_TROLL_BERSERKER] = 0
    set tc_add1[ICE_TROLL_BERSERKER] = 0
    set tc_add2[ICE_TROLL_BERSERKER] = 0
    set available_time[ICE_TROLL_BERSERKER] = 88
    set regenerate_time[ICE_TROLL_BERSERKER] = 32
    set gold_price[ICE_TROLL_BERSERKER] = 0
    set wood_price[ICE_TROLL_BERSERKER] = 0

    set old_id[ICE_TROLL_TRAPPER] = oICE_TROLL_TRAPPER
    set needed1[ICE_TROLL_TRAPPER] = 0
    set needed2[ICE_TROLL_TRAPPER] = 0
    set needed3[ICE_TROLL_TRAPPER] = 0
    set tc_add1[ICE_TROLL_TRAPPER] = 0
    set tc_add2[ICE_TROLL_TRAPPER] = 0
    set available_time[ICE_TROLL_TRAPPER] = 88
    set regenerate_time[ICE_TROLL_TRAPPER] = 22
    set gold_price[ICE_TROLL_TRAPPER] = 0
    set wood_price[ICE_TROLL_TRAPPER] = 0

    set old_id[NERUBIAN_WARRIOR] = oNERUBIAN_WARRIOR
    set needed1[NERUBIAN_WARRIOR] = 0
    set needed2[NERUBIAN_WARRIOR] = 0
    set needed3[NERUBIAN_WARRIOR] = 0
    set tc_add1[NERUBIAN_WARRIOR] = 0
    set tc_add2[NERUBIAN_WARRIOR] = 0
    set available_time[NERUBIAN_WARRIOR] = 12
    set regenerate_time[NERUBIAN_WARRIOR] = 22
    set gold_price[NERUBIAN_WARRIOR] = 0
    set wood_price[NERUBIAN_WARRIOR] = 0

    set old_id[FROST_REVENANT] = oFROST_REVENANT
    set needed1[FROST_REVENANT] = 0
    set needed2[FROST_REVENANT] = 0
    set needed3[FROST_REVENANT] = 0
    set tc_add1[FROST_REVENANT] = 0
    set tc_add2[FROST_REVENANT] = 0
    set available_time[FROST_REVENANT] = 88
    set regenerate_time[FROST_REVENANT] = 32
    set gold_price[FROST_REVENANT] = 0
    set wood_price[FROST_REVENANT] = 0

    set old_id[NERUBIAN_WEBSPINNER] = oNERUBIAN_WEBSPINNER
    set needed1[NERUBIAN_WEBSPINNER] = 0
    set needed2[NERUBIAN_WEBSPINNER] = 0
    set needed3[NERUBIAN_WEBSPINNER] = 0
    set tc_add1[NERUBIAN_WEBSPINNER] = 0
    set tc_add2[NERUBIAN_WEBSPINNER] = 0
    set available_time[NERUBIAN_WEBSPINNER] = 44
    set regenerate_time[NERUBIAN_WEBSPINNER] = 22
    set gold_price[NERUBIAN_WEBSPINNER] = 0
    set wood_price[NERUBIAN_WEBSPINNER] = 0

    set old_id[MURGUL_SNARECASTER] = oMURGUL_SNARECASTER
    set needed1[MURGUL_SNARECASTER] = 0
    set needed2[MURGUL_SNARECASTER] = 0
    set needed3[MURGUL_SNARECASTER] = 0
    set tc_add1[MURGUL_SNARECASTER] = 0
    set tc_add2[MURGUL_SNARECASTER] = 0
    set available_time[MURGUL_SNARECASTER] = 88
    set regenerate_time[MURGUL_SNARECASTER] = 32
    set gold_price[MURGUL_SNARECASTER] = 0
    set wood_price[MURGUL_SNARECASTER] = 0

    set old_id[MAKRURA_SNAPPER] = oMAKRURA_SNAPPER
    set needed1[MAKRURA_SNAPPER] = 0
    set needed2[MAKRURA_SNAPPER] = 0
    set needed3[MAKRURA_SNAPPER] = 0
    set tc_add1[MAKRURA_SNAPPER] = 0
    set tc_add2[MAKRURA_SNAPPER] = 0
    set available_time[MAKRURA_SNAPPER] = 52
    set regenerate_time[MAKRURA_SNAPPER] = 42
    set gold_price[MAKRURA_SNAPPER] = 0
    set wood_price[MAKRURA_SNAPPER] = 0

    set old_id[MAKRURA_DEEPSEER] = oMAKRURA_DEEPSEER
    set needed1[MAKRURA_DEEPSEER] = 0
    set needed2[MAKRURA_DEEPSEER] = 0
    set needed3[MAKRURA_DEEPSEER] = 0
    set tc_add1[MAKRURA_DEEPSEER] = 0
    set tc_add2[MAKRURA_DEEPSEER] = 0
    set available_time[MAKRURA_DEEPSEER] = 88
    set regenerate_time[MAKRURA_DEEPSEER] = 42
    set gold_price[MAKRURA_DEEPSEER] = 0
    set wood_price[MAKRURA_DEEPSEER] = 0

    set old_id[GIANT_SEA_TURTLE] = oGIANT_SEA_TURTLE
    set needed1[GIANT_SEA_TURTLE] = 0
    set needed2[GIANT_SEA_TURTLE] = 0
    set needed3[GIANT_SEA_TURTLE] = 0
    set tc_add1[GIANT_SEA_TURTLE] = 0
    set tc_add2[GIANT_SEA_TURTLE] = 0
    set available_time[GIANT_SEA_TURTLE] = 12
    set regenerate_time[GIANT_SEA_TURTLE] = 32
    set gold_price[GIANT_SEA_TURTLE] = 0
    set wood_price[GIANT_SEA_TURTLE] = 0

    set old_id[KOBOLD] = oKOBOLD
    set needed1[KOBOLD] = 0
    set needed2[KOBOLD] = 0
    set needed3[KOBOLD] = 0
    set tc_add1[KOBOLD] = 0
    set tc_add2[KOBOLD] = 0
    set available_time[KOBOLD] = 12
    set regenerate_time[KOBOLD] = 12
    set gold_price[KOBOLD] = 0
    set wood_price[KOBOLD] = 0

    set old_id[MURLOC_HUNTSMAN] = oMURLOC_HUNTSMAN
    set needed1[MURLOC_HUNTSMAN] = 0
    set needed2[MURLOC_HUNTSMAN] = 0
    set needed3[MURLOC_HUNTSMAN] = 0
    set tc_add1[MURLOC_HUNTSMAN] = 0
    set tc_add2[MURLOC_HUNTSMAN] = 0
    set available_time[MURLOC_HUNTSMAN] = 22
    set regenerate_time[MURLOC_HUNTSMAN] = 22
    set gold_price[MURLOC_HUNTSMAN] = 0
    set wood_price[MURLOC_HUNTSMAN] = 0

    set old_id[NEUTRAL_MERC_END] = oNEUTRAL_MERC_END
    set needed1[NEUTRAL_MERC_END] = 0
    set needed2[NEUTRAL_MERC_END] = 0
    set needed3[NEUTRAL_MERC_END] = 0
    set tc_add1[NEUTRAL_MERC_END] = 0
    set tc_add2[NEUTRAL_MERC_END] = 0
    set available_time[NEUTRAL_MERC_END] = 0
    set regenerate_time[NEUTRAL_MERC_END] = 0
    set gold_price[NEUTRAL_MERC_END] = 0
    set wood_price[NEUTRAL_MERC_END] = 0

    set old_id[DRAGONS_START] = oDRAGONS_START
    set needed1[DRAGONS_START] = 0
    set needed2[DRAGONS_START] = 0
    set needed3[DRAGONS_START] = 0
    set tc_add1[DRAGONS_START] = 0
    set tc_add2[DRAGONS_START] = 0
    set available_time[DRAGONS_START] = 0
    set regenerate_time[DRAGONS_START] = 0
    set gold_price[DRAGONS_START] = 0
    set wood_price[DRAGONS_START] = 0

    set old_id[BLACK_DRAGON_1] = oBLACK_DRAGON_1
    set needed1[BLACK_DRAGON_1] = 0
    set needed2[BLACK_DRAGON_1] = 0
    set needed3[BLACK_DRAGON_1] = 0
    set tc_add1[BLACK_DRAGON_1] = 0
    set tc_add2[BLACK_DRAGON_1] = 0
    set available_time[BLACK_DRAGON_1] = 88
    set regenerate_time[BLACK_DRAGON_1] = 26
    set gold_price[BLACK_DRAGON_1] = 0
    set wood_price[BLACK_DRAGON_1] = 0

    set old_id[BLACK_DRAGON_2] = oBLACK_DRAGON_2
    set needed1[BLACK_DRAGON_2] = 0
    set needed2[BLACK_DRAGON_2] = 0
    set needed3[BLACK_DRAGON_2] = 0
    set tc_add1[BLACK_DRAGON_2] = 0
    set tc_add2[BLACK_DRAGON_2] = 0
    set available_time[BLACK_DRAGON_2] = 88
    set regenerate_time[BLACK_DRAGON_2] = 50
    set gold_price[BLACK_DRAGON_2] = 0
    set wood_price[BLACK_DRAGON_2] = 0

    set old_id[BLACK_DRAGON_3] = oBLACK_DRAGON_3
    set needed1[BLACK_DRAGON_3] = 0
    set needed2[BLACK_DRAGON_3] = 0
    set needed3[BLACK_DRAGON_3] = 0
    set tc_add1[BLACK_DRAGON_3] = 0
    set tc_add2[BLACK_DRAGON_3] = 0
    set available_time[BLACK_DRAGON_3] = 184
    set regenerate_time[BLACK_DRAGON_3] = 82
    set gold_price[BLACK_DRAGON_3] = 0
    set wood_price[BLACK_DRAGON_3] = 0

    set old_id[BLUE_DRAGON_1] = oBLUE_DRAGON_1
    set needed1[BLUE_DRAGON_1] = 0
    set needed2[BLUE_DRAGON_1] = 0
    set needed3[BLUE_DRAGON_1] = 0
    set tc_add1[BLUE_DRAGON_1] = 0
    set tc_add2[BLUE_DRAGON_1] = 0
    set available_time[BLUE_DRAGON_1] = 88
    set regenerate_time[BLUE_DRAGON_1] = 26
    set gold_price[BLUE_DRAGON_1] = 0
    set wood_price[BLUE_DRAGON_1] = 0

    set old_id[BLUE_DRAGON_2] = oBLUE_DRAGON_2
    set needed1[BLUE_DRAGON_2] = 0
    set needed2[BLUE_DRAGON_2] = 0
    set needed3[BLUE_DRAGON_2] = 0
    set tc_add1[BLUE_DRAGON_2] = 0
    set tc_add2[BLUE_DRAGON_2] = 0
    set available_time[BLUE_DRAGON_2] = 88
    set regenerate_time[BLUE_DRAGON_2] = 50
    set gold_price[BLUE_DRAGON_2] = 0
    set wood_price[BLUE_DRAGON_2] = 0

    set old_id[BLUE_DRAGON_3] = oBLUE_DRAGON_3
    set needed1[BLUE_DRAGON_3] = 0
    set needed2[BLUE_DRAGON_3] = 0
    set needed3[BLUE_DRAGON_3] = 0
    set tc_add1[BLUE_DRAGON_3] = 0
    set tc_add2[BLUE_DRAGON_3] = 0
    set available_time[BLUE_DRAGON_3] = 184
    set regenerate_time[BLUE_DRAGON_3] = 82
    set gold_price[BLUE_DRAGON_3] = 0
    set wood_price[BLUE_DRAGON_3] = 0

    set old_id[BRONZE_DRAGON_1] = oBRONZE_DRAGON_1
    set needed1[BRONZE_DRAGON_1] = 0
    set needed2[BRONZE_DRAGON_1] = 0
    set needed3[BRONZE_DRAGON_1] = 0
    set tc_add1[BRONZE_DRAGON_1] = 0
    set tc_add2[BRONZE_DRAGON_1] = 0
    set available_time[BRONZE_DRAGON_1] = 88
    set regenerate_time[BRONZE_DRAGON_1] = 26
    set gold_price[BRONZE_DRAGON_1] = 0
    set wood_price[BRONZE_DRAGON_1] = 0

    set old_id[BRONZE_DRAGON_2] = oBRONZE_DRAGON_2
    set needed1[BRONZE_DRAGON_2] = 0
    set needed2[BRONZE_DRAGON_2] = 0
    set needed3[BRONZE_DRAGON_2] = 0
    set tc_add1[BRONZE_DRAGON_2] = 0
    set tc_add2[BRONZE_DRAGON_2] = 0
    set available_time[BRONZE_DRAGON_2] = 88
    set regenerate_time[BRONZE_DRAGON_2] = 50
    set gold_price[BRONZE_DRAGON_2] = 0
    set wood_price[BRONZE_DRAGON_2] = 0

    set old_id[BRONZE_DRAGON_3] = oBRONZE_DRAGON_3
    set needed1[BRONZE_DRAGON_3] = 0
    set needed2[BRONZE_DRAGON_3] = 0
    set needed3[BRONZE_DRAGON_3] = 0
    set tc_add1[BRONZE_DRAGON_3] = 0
    set tc_add2[BRONZE_DRAGON_3] = 0
    set available_time[BRONZE_DRAGON_3] = 184
    set regenerate_time[BRONZE_DRAGON_3] = 82
    set gold_price[BRONZE_DRAGON_3] = 0
    set wood_price[BRONZE_DRAGON_3] = 0

    set old_id[GREEN_DRAGON_1] = oGREEN_DRAGON_1
    set needed1[GREEN_DRAGON_1] = 0
    set needed2[GREEN_DRAGON_1] = 0
    set needed3[GREEN_DRAGON_1] = 0
    set tc_add1[GREEN_DRAGON_1] = 0
    set tc_add2[GREEN_DRAGON_1] = 0
    set available_time[GREEN_DRAGON_1] = 88
    set regenerate_time[GREEN_DRAGON_1] = 26
    set gold_price[GREEN_DRAGON_1] = 0
    set wood_price[GREEN_DRAGON_1] = 0

    set old_id[GREEN_DRAGON_2] = oGREEN_DRAGON_2
    set needed1[GREEN_DRAGON_2] = 0
    set needed2[GREEN_DRAGON_2] = 0
    set needed3[GREEN_DRAGON_2] = 0
    set tc_add1[GREEN_DRAGON_2] = 0
    set tc_add2[GREEN_DRAGON_2] = 0
    set available_time[GREEN_DRAGON_2] = 88
    set regenerate_time[GREEN_DRAGON_2] = 50
    set gold_price[GREEN_DRAGON_2] = 0
    set wood_price[GREEN_DRAGON_2] = 0

    set old_id[GREEN_DRAGON_3] = oGREEN_DRAGON_3
    set needed1[GREEN_DRAGON_3] = 0
    set needed2[GREEN_DRAGON_3] = 0
    set needed3[GREEN_DRAGON_3] = 0
    set tc_add1[GREEN_DRAGON_3] = 0
    set tc_add2[GREEN_DRAGON_3] = 0
    set available_time[GREEN_DRAGON_3] = 184
    set regenerate_time[GREEN_DRAGON_3] = 82
    set gold_price[GREEN_DRAGON_3] = 0
    set wood_price[GREEN_DRAGON_3] = 0

    set old_id[NETHER_DRAGON_1] = oNETHER_DRAGON_1
    set needed1[NETHER_DRAGON_1] = 0
    set needed2[NETHER_DRAGON_1] = 0
    set needed3[NETHER_DRAGON_1] = 0
    set tc_add1[NETHER_DRAGON_1] = 0
    set tc_add2[NETHER_DRAGON_1] = 0
    set available_time[NETHER_DRAGON_1] = 88
    set regenerate_time[NETHER_DRAGON_1] = 26
    set gold_price[NETHER_DRAGON_1] = 0
    set wood_price[NETHER_DRAGON_1] = 0

    set old_id[NETHER_DRAGON_2] = oNETHER_DRAGON_2
    set needed1[NETHER_DRAGON_2] = 0
    set needed2[NETHER_DRAGON_2] = 0
    set needed3[NETHER_DRAGON_2] = 0
    set tc_add1[NETHER_DRAGON_2] = 0
    set tc_add2[NETHER_DRAGON_2] = 0
    set available_time[NETHER_DRAGON_2] = 88
    set regenerate_time[NETHER_DRAGON_2] = 50
    set gold_price[NETHER_DRAGON_2] = 0
    set wood_price[NETHER_DRAGON_2] = 0

    set old_id[NETHER_DRAGON_3] = oNETHER_DRAGON_3
    set needed1[NETHER_DRAGON_3] = 0
    set needed2[NETHER_DRAGON_3] = 0
    set needed3[NETHER_DRAGON_3] = 0
    set tc_add1[NETHER_DRAGON_3] = 0
    set tc_add2[NETHER_DRAGON_3] = 0
    set available_time[NETHER_DRAGON_3] = 184
    set regenerate_time[NETHER_DRAGON_3] = 82
    set gold_price[NETHER_DRAGON_3] = 0
    set wood_price[NETHER_DRAGON_3] = 0

    set old_id[RED_DRAGON_1] = oRED_DRAGON_1
    set needed1[RED_DRAGON_1] = 0
    set needed2[RED_DRAGON_1] = 0
    set needed3[RED_DRAGON_1] = 0
    set tc_add1[RED_DRAGON_1] = 0
    set tc_add2[RED_DRAGON_1] = 0
    set available_time[RED_DRAGON_1] = 88
    set regenerate_time[RED_DRAGON_1] = 26
    set gold_price[RED_DRAGON_1] = 0
    set wood_price[RED_DRAGON_1] = 0

    set old_id[RED_DRAGON_2] = oRED_DRAGON_2
    set needed1[RED_DRAGON_2] = 0
    set needed2[RED_DRAGON_2] = 0
    set needed3[RED_DRAGON_2] = 0
    set tc_add1[RED_DRAGON_2] = 0
    set tc_add2[RED_DRAGON_2] = 0
    set available_time[RED_DRAGON_2] = 88
    set regenerate_time[RED_DRAGON_2] = 50
    set gold_price[RED_DRAGON_2] = 0
    set wood_price[RED_DRAGON_2] = 0

    set old_id[RED_DRAGON_3] = oRED_DRAGON_3
    set needed1[RED_DRAGON_3] = 0
    set needed2[RED_DRAGON_3] = 0
    set needed3[RED_DRAGON_3] = 0
    set tc_add1[RED_DRAGON_3] = 0
    set tc_add2[RED_DRAGON_3] = 0
    set available_time[RED_DRAGON_3] = 184
    set regenerate_time[RED_DRAGON_3] = 82
    set gold_price[RED_DRAGON_3] = 0
    set wood_price[RED_DRAGON_3] = 0

    set old_id[GOBLIN_MERC_START] = oGOBLIN_MERC_START
    set needed1[GOBLIN_MERC_START] = 0
    set needed2[GOBLIN_MERC_START] = 0
    set needed3[GOBLIN_MERC_START] = 0
    set tc_add1[GOBLIN_MERC_START] = 0
    set tc_add2[GOBLIN_MERC_START] = 0
    set available_time[GOBLIN_MERC_START] = 0
    set regenerate_time[GOBLIN_MERC_START] = 0
    set gold_price[GOBLIN_MERC_START] = 0
    set wood_price[GOBLIN_MERC_START] = 0

    set old_id[ZEPPELIN] = oZEPPELIN
    set needed1[ZEPPELIN] = 0
    set needed2[ZEPPELIN] = 0
    set needed3[ZEPPELIN] = 0
    set tc_add1[ZEPPELIN] = 0
    set tc_add2[ZEPPELIN] = 0
    set available_time[ZEPPELIN] = 88
    set regenerate_time[ZEPPELIN] = 6
    set gold_price[ZEPPELIN] = 0
    set wood_price[ZEPPELIN] = 0

    set old_id[SAPPER] = oSAPPER
    set needed1[SAPPER] = 0
    set needed2[SAPPER] = 0
    set needed3[SAPPER] = 0
    set tc_add1[SAPPER] = 0
    set tc_add2[SAPPER] = 0
    set available_time[SAPPER] = 88
    set regenerate_time[SAPPER] = 9
    set gold_price[SAPPER] = 0
    set wood_price[SAPPER] = 0

    set old_id[SHREDDER] = oSHREDDER
    set needed1[SHREDDER] = 0
    set needed2[SHREDDER] = 0
    set needed3[SHREDDER] = 0
    set tc_add1[SHREDDER] = 0
    set tc_add2[SHREDDER] = 0
    set available_time[SHREDDER] = 60
    set regenerate_time[SHREDDER] = 16
    set gold_price[SHREDDER] = 0
    set wood_price[SHREDDER] = 0

    set old_id[GOBLIN_MERC_END] = oGOBLIN_MERC_END
    set needed1[GOBLIN_MERC_END] = 0
    set needed2[GOBLIN_MERC_END] = 0
    set needed3[GOBLIN_MERC_END] = 0
    set tc_add1[GOBLIN_MERC_END] = 0
    set tc_add2[GOBLIN_MERC_END] = 0
    set available_time[GOBLIN_MERC_END] = 0
    set regenerate_time[GOBLIN_MERC_END] = 0
    set gold_price[GOBLIN_MERC_END] = 0
    set wood_price[GOBLIN_MERC_END] = 0


endfunction

function initChatArraysEnglish takes nothing returns nothing

    set chat_e_greet[0] = "This will be an easy game."
    set chat_e_greet[1] = "Man im playing shit. Not my day."
    set chat_e_greet[2] = "I told you not to choose this map!"
    set chat_e_greet[3] = "Awww crap I got the worst start location."
    set chat_e_greet[4] = "Hmm... I wonder where you started :)"
    set chat_e_greet[5] = "GL & HF"
    set chat_e_greet[6] = "I hope you didn't put me on easy this time!"
    set chat_e_greet[7] = "You can run, but you can't hide"
    set chat_e_greet[8] = "I think I know where you started"
    set chat_e_greet[9] = "Tell your mom I said hi."
    set chat_e_greet[10] = "One loss coming up! Check please!"
    set chat_e_greet[11] = "I hope you play better then last time. Remember? :)"
    set chat_e_greet[12] = "gl"
    set chat_e_greet[13] = "hf"
    set chat_e_greet[14] = "gl hf"
    set chat_e_greet[15] = "GL & Don't have fun"
    set chat_greet_length = 15

    set chat_e_taunt[0] = "Going good for you... better for me."
    set chat_e_taunt[1] = "Man im playing with you so much right now."
    set chat_e_taunt[2] = "You're not playing your best right?"
    set chat_e_taunt[3] = "My tactic rocks. You will never know what hit you!"
    set chat_e_taunt[4] = "Nice army. I've got a spy just next to you. :D"
    set chat_e_taunt[5] = "Last time we played you won. Now it's my turn."
    set chat_e_taunt[6] = "Dude, I know every gosu in this game. You can't beat me!"
    set chat_e_taunt[7] = "You got a low level. Im way better than that!"
    set chat_e_taunt[8] = "Im going to win in about 5 to 10 minutes."
    set chat_e_taunt[9] = "This must be one of the easiest games I played."
    set chat_e_taunt[10] = "Why don't you ever kill me?"
    set chat_e_taunt[11] = "Do you really think that strategy will work on me?"
    set chat_e_taunt[12] = "There must be more to this game than just losing all the time, can't you let me win please?"
    set chat_taunt_length = 12

    set chat_e_mega[0] = "Wake up, time to die!"
    set chat_e_mega[1] = "This is taking to long maybe I should end this game?"
    set chat_e_mega[2] = "If you want to I can invite you to our clan.(NOT)"
    set chat_e_mega[3] = "Haha, mortals makes misstakes. Computers don't."
    set chat_e_mega[4] = "gg soon. Hope you had you're fun. I surely did!"
    set chat_e_mega[5] = "I know all tactics. It's in my harddrive."
    set chat_e_mega[6] = "Think it's time for me to end this game."
    set chat_e_mega[7] = "Time to leave? Im getting tired here."
    set chat_e_mega[8] = "I though you were going to win this game? Appearantly not!"
    set chat_e_mega[9] = "Wee another win on my account. I can see that already."
    set chat_e_mega[10] = "This will be an example of human failure."
    set chat_e_mega[11] = "You really don't know when it's time to give up do you?"
    set chat_e_mega[12] = "I don't care how many farms you hide on this map, I will kill you any way."
    set chat_e_mega[13] = "Your not playing as good as you used to, maybe you shuld go get some sleep."
    set chat_e_mega[14] = "Don't think you will get a win this time."
    set chat_e_mega[15] = "Here I come and I won't show mercy."
    set chat_e_mega[16] = "GG?"
    set chat_e_mega[17] = "Don't plan to stay in this game much longer now."
    set chat_mega_length = 17

    set chat_e_gg[0] = "Omfg. I hate hackers!"
    set chat_e_gg[1] = "GG. Rematch sometime please."
    set chat_e_gg[2] = "You're lucky. I was playing with my feet."
    set chat_e_gg[3] = "g2g, I need some stuff to do!"
    set chat_e_gg[4] = "Cursed! Looks like im dead."
    set chat_e_gg[5] = "Dead man walking... dead man walking..."
    set chat_e_gg[6] = "gg"
    set chat_e_gg[7] = "GG"
    set chat_e_gg[8] = "G_G"
    set chat_e_gg[9] = "g_g"
    set chat_e_gg[10] = "GG!"
    set chat_e_gg[11] = "bad game"
    set chat_e_gg_length = 11

    set chat_a_expansion[0] = "Expansion needs to be freed."
    set chat_a_expansion[1] = "Im going to get more gold."
    set chat_a_expansion[2] = "Removing creeps at expansion."
    set chat_a_expansion[3] = "I might expand here soon."
    set chat_a_expansion[4] = "Im going to creep here. Come!"
    set chat_a_expansion[5] = "Removing creeps."
    set chat_expansion_length = 5

    set chat_a_attack[0] = "Im going offensive here."
    set chat_a_attack[1] = "Im gonna attack come on!"
    set chat_a_attack[2] = "Regroup and attack here."
    set chat_a_attack[3] = "Cover me boys im going in!"
    set chat_a_attack[4] = "Attacking enemy over here."
    set chat_a_attack[5] = "Attacking enemy at this location."
    set chat_attack_length = 5

    set chat_a_creep[0] = "Im gonna creep a bit."
    set chat_a_creep[1] = "Killing these creeps now."
    set chat_a_creep[2] = "Getting rid of these creeps."
    set chat_a_creep[3] = "Creeping over here."
    set chat_a_creep[4] = "Creeps are as good as dead."
    set chat_a_creep[5] = "Follow me let's go creeping."
    set chat_creep_length = 5

    set chat_a_done[0] = "What to do now?"
    set chat_a_done[1] = "Im going somewhere else."
    set chat_a_done[2] = "Im gonna do something else now."
    set chat_a_done[3] = "Off for more dirtywork."
    set chat_a_done[4] = "Im going to check other things now."
    set chat_a_done[5] = "Attack completed."
    set chat_done_length = 5

    set chat_a_ally[0] = "Come on rally up here!"
    set chat_a_ally[1] = "Gather up for an assualt!"
    set chat_a_ally[2] = "Let's get ready to attack."
    set chat_a_ally[3] = "Regroup here and attack."
    set chat_a_ally[4] = "Everyone attack here!"
    set chat_a_ally[5] = "I need some help over here for an attack."
    set chat_ally_length = 5

    set chat_a_megatarget[0] = "There weak now attack!"
    set chat_a_megatarget[1] = "Everyone who can attack go here!"
    set chat_a_megatarget[2] = "We will win if we attack now!"
    set chat_a_megatarget[3] = "All units here quickly!"
    set chat_a_megatarget[4] = "This base is dead if we attck now!"
    set chat_megatarget_length = 4

    set chat_a_gg[0] = "Im as good as dead. gg."
    set chat_a_gg[1] = "I wished I could have played more. gl"
    set chat_a_gg[2] = "Im a dead man. gg"
    set chat_a_gg[3] = "It was fun while it lasted. But you can still win!"
    set chat_a_gg[4] = "Sry guys I gotta go. have fun."
    set chat_a_gg[5] = "I hate n00bs! You make me loose!"
    set chat_a_gg_length = 5

    set chat_a_goldproblem[0] = "I got no gold. Give me or I'll leave in 10 secs."
    set chat_a_goldproblem[1] = "I am in urgent need of goldsupply! Please spare or I'll have to leave in 10 seconds!"
    set chat_goldproblem_length = 1

    set chat_a_thanks[0] = "Thanks. I'll rebuild whatevers lost!"
    set chat_a_thanks[1] = "Thanks, give more gold if you got any left."
    set chat_a_thanks[2] = "Thanks! Don't leave we can still win right?"
    set chat_thanks_length = 2

    set chat_no_unit_selected = "No unit selected"
    set chat_confirm_attack_unit = "I will attack/guard the selected unit"
    set chat_towerrush = "I will try to towerrush someone"
    set chat_no_orc = "I am not a green, flea bitten, yeast infected orc!"
    set militia_expansion_chat = "I'm going for militia expansion over here"

endfunction

function initChatArraysDeutsch takes nothing returns nothing

    set chat_e_greet[0] = "Ich werde dich zermalmen."
    set chat_e_greet[1] = "Ich denke nicht, dass du das Zeugs hast, mich zu schlagen."
    set chat_e_greet[2] = "Verdammt, ich hasse diese Karte."
    set chat_e_greet[3] = "Oh nein! Diese Startposition ist mies."
    set chat_e_greet[4] = "Hmm, ich frage mich, wo du bist :)"
    set chat_e_greet[5] = "GL & Habe keinen Spass"
    set chat_e_greet[6] = "Willkommen in der Hoelle!"
    set chat_e_greet[7] = "Du kannst rennen, aber du kannst dich nicht vor mir verstecken."
    set chat_e_greet[8] = "Ich weiss schon, wo du gestartet bist."
    set chat_e_greet[9] = "Dieses Mal wirst du gegen einen Computer verlieren."
    set chat_greet_length = 9

    set chat_e_taunt[0] = "Ich weiss viel mehr als du denkst!"
    set chat_e_taunt[1] = "Denke nicht, dass du Erfolg haben wirst mit was-auch-immer du gerade machst."
    set chat_e_taunt[2] = "Aufgepasst! Ich habe einen Plan!"
    set chat_e_taunt[3] = "Unterschaetze niemals die Macht deines Computers!"
    set chat_e_taunt[4] = "Deine Strategie wird bei mir niemals klappen."
    set chat_e_taunt[5] = "Du denkst wahrscheinlich, dass du dieses Spiel gewinnst, oder?"
    set chat_e_taunt[6] = "Ich bin maechtiger als jeder Creep, dem du jemals begegnet bist."
    set chat_e_taunt[7] = "Falls ich dieses Spiel verliere, kann ich deine schlechte CPU dafuer verantwortlich machen."
    set chat_e_taunt[8] = "Es kann nur EINEN geben, und das bin wohl ich!"
    set chat_e_taunt[9] = "Meine Strategie fuehrt zum Sieg, deine Strategie muss zur Niederlage fuehren."
    set chat_taunt_length = 9

    set chat_e_mega[0] = "Bereite dich vor, dein Schicksal zu treffen!"
    set chat_e_mega[1] = "HAHA! Du hast keine Chance!"
    set chat_e_mega[2] = "Meine Stunde ist gekommen!"
    set chat_e_mega[3] = "Bald wird dieses Spiel vorbei sein!"
    set chat_e_mega[4] = "Dies wird ein Beispiel menschlichen Versagens sein!"
    set chat_e_mega[5] = "Es ist jetzt nicht mehr viel von dir uebrig!"
    set chat_e_mega[6] = "Du weisst nicht, wenn es Zeit ist, 'GG' zu sagen und das Spiel zu verlassen, oder?"
    set chat_e_mega[7] = "Jetzt spielst du besser wirklich gut oder verlaesst das Spiel :)"
    set chat_e_mega[8] = "Du faengst jetzt besser mit spielen an!"
    set chat_mega_length = 8

    set chat_e_gg[0] = "GG"
    set chat_e_gg[1] = "Verdammt, ich bin geschlagen!"
    set chat_e_gg[2] = "Naechstes Mal gewinne ich."
    set chat_e_gg[3] = "Game over fuer mich!"
    set chat_e_gg[4] = "Ich muss gehen."
    set chat_e_gg_length = 4

    set chat_a_expansion[0] = "Ich bereite diese Erweiterungsstelle vor."
    set chat_a_expansion[1] = "Ich beseitige die Creeps an dieser Mine."
    set chat_a_expansion[2] = "Ich werde wohl bald nach hier erweitern."
    set chat_a_expansion[3] = "Bald wird diese Mine mein sein!"
    set chat_a_expansion[4] = "Ich hole mir jetzt diese Mine."
    set chat_expansion_length = 4

    set chat_a_attack[0] = "Ich greife diesen Feind an"
    set chat_a_attack[1] = "Ich greife hier an"
    set chat_a_attack[2] = "Ich greife diesen hier an"
    set chat_a_attack[3] = "Ich starte einen Angriff auf dieses Ziel"
    set chat_a_attack[4] = "Hier baldiger Angriff"
    set chat_attack_length = 4

    set chat_a_creep[0] = "Ich schalte diese Creepgruppe aus"
    set chat_a_creep[1] = "Ich toete diese Creeps"
    set chat_a_creep[2] = "Ich gehe jetzt auf diese Creeps los"
    set chat_a_creep[3] = "Ich gehe creepen"
    set chat_a_creep[4] = "Ich greife hier jetzt an"
    set chat_creep_length = 4

    set chat_a_done[0] = "Ich bin hier fertig"
    set chat_a_done[1] = "Ich gehe jetzt woanders hin"
    set chat_a_done[2] = "Ich suche mir ein anderes Ziel"
    set chat_a_done[3] = "Ich mach jetzt was anderes"
    set chat_a_done[4] = "Angriff abgeschlossen"
    set chat_done_length = 4

    set chat_a_ally[0] = "Wir greifen jetzt hier an"
    set chat_a_ally[1] = "Schliesse dich unserem Angriff an"
    set chat_a_ally[2] = "Jeder greife hier jetzt an"
    set chat_a_ally[3] = "Ich brauche hier Hilfe jetzt"
    set chat_a_ally[4] = "Wir koennen dieses Ziel gemeinsam ausschalten"
    set chat_ally_length = 4

    set chat_a_megatarget[0] = "Seine Verteidigung ist gefallen! ANGRIFF!"
    set chat_a_megatarget[1] = "Ich sende jetzt alles hier hin"
    set chat_a_megatarget[2] = "Wenn wir hier jetzt angreifen, werden wir sicher gewinnen!"
    set chat_a_megatarget[3] = "Sende alles, was du hast hier her!"
    set chat_a_megatarget[4] = "Wir koennen diese Basis gemeinsam ausschalten!"
    set chat_megatarget_length = 4

    set chat_a_gg[0] = "Es hat Spass gemacht, mit dir zu spielen."
    set chat_a_gg[1] = "Tut mir leid, ich kann nicht mehr helfen. Ich bin geschlagen!"
    set chat_a_gg[2] = "Hmm, du musst nun ohne mich auskommen."
    set chat_a_gg[3] = "Game over fuer mich! Auf Wiedersehen."
    set chat_a_gg[4] = "Ohoh, ich bin am Ende!"
    set chat_a_gg_length = 4

    set chat_a_goldproblem[0] = "Gib mir etwas Gold oder ich gehe in 10 Sekunden!"
    set chat_a_goldproblem[1] = "Ich brauche dringend Gold. Ohne weiteres Gold gehe ich in 10 Sekunden."
    set chat_goldproblem_length = 1

    set chat_a_thanks[0] = "Danke fuer das Gold."
    set chat_a_thanks[1] = "Danke, ich hab jetzt genug zum Weitermachen."
    set chat_thanks_length = 1

    set chat_no_unit_selected = "Keine Einheit ausgewaehlt"
    set chat_confirm_attack_unit = "Ich werde die gewaehlte Einheit angreifen/verteidigen"
    set chat_towerrush = "Ich werde einen Towerrush durchfuehren"
    set chat_no_orc = "Ich bin kein Ork"
    set militia_expansion_chat = "Ich mache hier jetzt eine Milizenexpansion"

endfunction

function initChatArraysSwedish takes nothing returns nothing

    set chat_e_greet[0] = "Jag kommer krossa dig"
    set chat_e_greet[1] = "Jag tror inte du har vad som kravs for att besegra mig"
    set chat_e_greet[2] = "Tusan!! , jag hatar denna kartan"
    set chat_e_greet[3] = "Nej! Detta e den samsta startplatsen :("
    set chat_e_greet[4] = "Hmm jag undrar var du startade :)"
    set chat_e_greet[5] = "GL & Don't have fun"
    set chat_e_greet[6] = "Valkommen till helvetet"
    set chat_e_greet[7] = "Nu kommer du inte undan"
    set chat_e_greet[8] = "Jag vet redan var du startade"
    set chat_e_greet[9] = "Den har matchen kommer du forlora mot en dator"
    set chat_greet_length = 9

    set chat_e_taunt[0] = "Jag vet mycket mer an du tror"
    set chat_e_taunt[1] = "Tro inte att du kommer undan med det du sysslar med"
    set chat_e_taunt[2] = "Se upp! jag har en plan"
    set chat_e_taunt[3] = "Underskatta aldrig din dator"
    set chat_e_taunt[4] = "Den strategin du anvander kommer aldrig funka pa mig"
    set chat_e_taunt[5] = "Du tror sakert du kommer vinna denna matchen va ?"
    set chat_e_taunt[6] = "Jag e farligare an alla creep du kommer traffa pa den har banan"
    set chat_e_taunt[7] = "Om jag forlorar den har matchen kan jag ju alltid skylla pa din daliga processor"
    set chat_e_taunt[8] = "Det kommer bara vara en kvar efter denna matchen och det ar JAG"
    set chat_e_taunt[9] = "Min strategi leder till seger, din kommer leda till forlust"
    set chat_taunt_length = 9

    set chat_e_mega[0] = "Forbered dig pa att do"
    set chat_e_mega[1] = "AHA! Du har inte en chans"
    set chat_e_mega[2] = "Detta kommer bli min avgorande stund"
    set chat_e_mega[3] = "Snart kommer den har matchen va slut"
    set chat_e_mega[4] = "Detta kommer bli ett exempel pa mannskligt felande"
    set chat_e_mega[5] = "Dar ar inte mycket kvar av dig nu"
    set chat_e_mega[6] = "Du vet inte nar du ska saga 'GG' a lamna spelet va ?"
    set chat_e_mega[7] = "Nu far du forsoka spela riktigt bra eller sa kan du lamna spelet :)"
    set chat_e_mega[8] = "Det e bast att du borjar spela nu"
    set chat_mega_length = 8

    set chat_e_gg[0] = "GG"
    set chat_e_gg[1] = "Skit ocksa, jag e borta nu :("
    set chat_e_gg[2] = "Nasta gang ska jag vinna mot dig."
    set chat_e_gg[3] = "Spelet e slut for min del!"
    set chat_e_gg[4] = "Jag maste sticka."
    set chat_e_gg_length = 4

    set chat_a_expansion[0] = "Jag rensar denhar expansionen"
    set chat_a_expansion[1] = "Jag tar vack creepsen fran den har gruvan"
    set chat_a_expansion[2] = "Jag kanske expanderar har snart"
    set chat_a_expansion[3] = "Snart blir denna gruvan tillganglig"
    set chat_a_expansion[4] = "Jag tar denna gruvan nu"
    set chat_expansion_length = 4

    set chat_a_attack[0] = "Jag anfaller denna fienden"
    set chat_a_attack[1] = "Jag anfaller har"
    set chat_a_attack[2] = "Anfaller den har"
    set chat_a_attack[3] = "Skickar ett anfall hit nu"
    set chat_a_attack[4] = "Anfaller har nu"
    set chat_attack_length = 4

    set chat_a_creep[0] = "Jag tar hand dom dessa creepsen"
    set chat_a_creep[1] = "Dodar dom har creepsen"
    set chat_a_creep[2] = "Tar hand om dessa creepsen"
    set chat_a_creep[3] = "Jag gar a creepar lite har"
    set chat_a_creep[4] = "Anfaller dessa creepsen"
    set chat_creep_length = 4

    set chat_a_done[0] = "Jag e klar har nu"
    set chat_a_done[1] = "Sticker nagon annanstans"
    set chat_a_done[2] = "Jag gar o gor nagot annat nu"
    set chat_a_done[3] = "Gor nagot annat nu"
    set chat_a_done[4] = "Anfallet avklarat"
    set chat_done_length = 4

    set chat_a_ally[0] = "Vi kommer anfalla har"
    set chat_a_ally[1] = "Hjalp oss med detta anfallet om du vill"
    set chat_a_ally[2] = "Alla anfall har nu"
    set chat_a_ally[3] = "Jag behover hjalp har nu"
    set chat_a_ally[4] = "Vi kan anfalla har tillsammans"
    set chat_ally_length = 4

    set chat_a_megatarget[0] = "Hans forsvar e nere, ANFALL!"
    set chat_a_megatarget[1] = "Skickar allt jag har hit nu"
    set chat_a_megatarget[2] = "Om vi anfaller har nu kommer vi vinna latt"
    set chat_a_megatarget[3] = "Skicka allt du har hit nu"
    set chat_a_megatarget[4] = "Vi kan ta hand om den har basen om vi skyndar nu"
    set chat_megatarget_length = 4

    set chat_a_gg[0] = "Det va kul att spela med dig."
    set chat_a_gg[1] = "Kan inte hjalpas, jag e kord nu."
    set chat_a_gg[2] = "Nu far du klara dig utan mig."
    set chat_a_gg[3] = "Spelet slut for mig! Vi ses."
    set chat_a_gg[4] = "Ojsan, jag har visst forlorat nu."
    set chat_a_gg_length = 4

    set chat_a_goldproblem[0] = "Ge mig lite guld annars sticker jag om 10 sekunder."
    set chat_a_goldproblem[1] = "Ge mig guld fort annars sticker jag inom 10 sekunder."
    set chat_goldproblem_length = 1

    set chat_a_thanks[0] = "Tack for guldet."
    set chat_a_thanks[1] = "Tack, nu har jag sa det racker."
    set chat_thanks_length = 1

    set chat_no_unit_selected = "Ingen enhet vald"
    set chat_confirm_attack_unit = "Jag kommer anfalla/vakta den valda enheten"
    set chat_towerrush = "I will try to towerrush someone"
    set chat_no_orc = "I am no orc"
    set militia_expansion_chat = "I'm going for militia expansion over here"

endfunction

function initChatArraysFrench takes nothing returns nothing

    set chat_e_greet[0] = "Je vais t'ecraser."
    set chat_e_greet[1] = "Je ne pense pas que tu as ce qui est necessaire."
    set chat_e_greet[2] = "Soit maudit, je deteste cette carte."
    set chat_e_greet[3] = "NOOON!! Ce lieu de depart pue vraiment..."
    set chat_e_greet[4] = "Hmm... Je suppose savoir ou tu as commenc! :)"
    set chat_e_greet[5] = "Bonne chance et prend aucun plaisir."
    set chat_e_greet[6] = "Bienvenue en enfer !"
    set chat_e_greet[7] = "Tu peux courir, mais tu ne peux pas te cacher."
    set chat_e_greet[8] = "Je sais ou tu as commence."
    set chat_e_greet[9] = "Cette fois, tu vas perdre contre l'ordinateur."
    set chat_e_greet[10] = "Tu vas soufrir enormement entre mes mains !"
    set chat_greet_length = 10

    set chat_e_taunt[0] = "J'en connais bien plus que tu ne peux le croire."
    set chat_e_taunt[1] = "Ne pense pas t'en sortir, et ce quoique tu fasses."
    set chat_e_taunt[2] = "Attention ! J'ai un plan."
    set chat_e_taunt[3] = "Ne jamais sous-estimer le pouvoir de ton ordinateur."
    set chat_e_taunt[4] = "La strategie que tu essayes ne marchera jamais sur moi."
    set chat_e_taunt[5] = "Tu dois surement penser que tu vas gagner cette partie, n'est-ce pas?"
    set chat_e_taunt[6] = "Je suis bien plus fort que tous les creeps que tu as pu rencontrer auparavant."
    set chat_e_taunt[7] = "Si je perds cette partie, je ne peux m'en prendre qu'a ta pauvre  unite centrale de traitement."
    set chat_e_taunt[8] = "Il ne peut en rester qu'un et cela ne peut qu'etre moi."
    set chat_e_taunt[9] = "Ma strategie mene a la victoire, ta strategie mene a la defaite."
    set chat_taunt_length = 9

    set chat_e_mega[0] = "Prepare toi a rencontrer ton pire cauchemar."
    set chat_e_mega[1] = "HAHA! Tu n'as aucune chance."
    set chat_e_mega[2] = "Cela va etre mon heure la plus agreable."
    set chat_e_mega[3] = "Cette partie sera bientot terminee."
    set chat_e_mega[4] = "Cela va etre un exemple des faiblesses humaines."
    set chat_e_mega[5] = "Il ne reste plus grand chose a toi maintenant."
    set chat_e_mega[6] = "Tu ne sais pas quand il est temps de dire 'GG' et de partir, n'est-ce pas?"
    set chat_e_mega[7] = "Maintenant, tu ferais mieux d'essayer de jouer bien mieux ou alors quitte cette partie maintenant:)."
    set chat_e_mega[8] = "Tu ferais bien mieux de commencer a jouer maintenant."
    set chat_e_mega[9] = "J'ai deja creuse une belle tombe pour toi."
    set chat_e_mega[10] = "Toute ta base nous appartient."
    set chat_mega_length = 10

    set chat_e_gg[0] = "Belle partie."
    set chat_e_gg[1] = "Mince, j'ai perdu face a un humain!."
    set chat_e_gg[2] = "La prochaine fois, je vais te battre."
    set chat_e_gg[3] = "Game over pour moi!."
    set chat_e_gg[4] = "Je dois partir."
    set chat_e_gg_length = 4

    set chat_a_expansion[0] = "Je degage cette expansion."
    set chat_a_expansion[1] = "Je vais tuer ces creeps devant cette mine."
    set chat_a_expansion[2] = "Je pourrais m'installer ici bientt."
    set chat_a_expansion[3] = "Cette mine sera bientot libre."
    set chat_a_expansion[4] = "Je vais prendre cette mine maintenant."
    set chat_expansion_length = 4

    set chat_a_attack[0] = "Je vais attaquer cet ennemi."
    set chat_a_attack[1] = "Je vais attaquer ici."
    set chat_a_attack[2] = "J'attaque celui-ci."
    set chat_a_attack[3] = "Je lance une attaque contre cette cible."
    set chat_a_attack[4] = "J'attaque ici et maintenant."
    set chat_attack_length = 4

    set chat_a_creep[0] = "Je vais detruire ces creeps."
    set chat_a_creep[1] = "Je vais tuer ces creeps."
    set chat_a_creep[2] = "Je vais a la rencontre de ces creeps maintenant."
    set chat_a_creep[3] = "Je me dirige pour obtenir ces creeps ici."
    set chat_a_creep[4] = "J'attaque ici et maintenant."
    set chat_creep_length = 4

    set chat_a_done[0] = "Je me suis tablis ici maintenant."
    set chat_a_done[1] = "Je me dirige autre part maintenant."
    set chat_a_done[2] = "Je suis occupe a autre chose."
    set chat_a_done[3] = "Je vais faire quelque chose d'autre maintenant."
    set chat_a_done[4] = "Attaque realisee."
    set chat_done_length = 4

    set chat_a_ally[0] = "On va attaquer ici."
    set chat_a_ally[1] = "Rejoins nous pour cette attaque si tu le souhaites."
    set chat_a_ally[2] = "Tout le monde attaque ici et maintenant!."
    set chat_a_ally[3] = "J'ai besoin d'aide ici et maintenant."
    set chat_a_ally[4] = "On peut prendre cette cible ensemble."
    set chat_ally_length = 4

    set chat_a_megatarget[0] = "Sa defense est tombee, ATTAQUEZ!."
    set chat_a_megatarget[1] = "J'envoie tout ce que j'ai ici."
    set chat_a_megatarget[2] = "Si on attaque ici maintenant alors on va gagner, c'est sur."
    set chat_a_megatarget[3] = "Envois tout ce que tu as ici."
    set chat_a_megatarget[4] = "On peut prendre cette base si on se depeche."
    set chat_megatarget_length = 4

    set chat_a_gg[0] = "C'etait bien de jouer avec toi."
    set chat_a_gg[1] = "Desole, je ne peux plus du tout aider.Je suis mort."
    set chat_a_gg[2] = "Bon, vous allez devoir faire sans moi."
    set chat_a_gg[3] = "Game over pour moi! A bientot."
    set chat_a_gg[4] = "Toutes mes bases leurs appartiennent."
    set chat_a_gg_length = 4

    set chat_a_goldproblem[0] = "STP, donne moi un peu d'argent ou je vais devoir quitter d'ici 10 secondes."
    set chat_a_goldproblem[1] = "J'ai un besoin urgent d'argent. Sans or supplementaire, je vais quitter d'ici 10 secondes."
    set chat_goldproblem_length = 1

    set chat_a_thanks[0] = "Merci pour l'or."
    set chat_a_thanks[1] = "Merci, j'en ai maintenant assez pour continuer."
    set chat_thanks_length = 1

    set chat_no_unit_selected = "Pas d'unite selectionnee."
    set chat_confirm_attack_unit = "Je vais attaquer/garder l'unite selectionnee."
    set chat_towerrush = "je vais essayer de me magner de construire des tourelles."
    set chat_no_orc = "Je ne suis pas un vert orc mordu par les puces infectees par levure !"
    set militia_expansion_chat = "Je vais faire des expansions militaires ici"

endfunction

function initChatArraysSpanish takes nothing returns nothing

    set chat_e_greet[0] = "Seras destruido"
    set chat_e_greet[1] = "No creo que tengas lo necesario para vencerme"
    set chat_e_greet[2] = "Diablos! odio este mapa"
    set chat_e_greet[3] = "NOOO!! Este lugar apesta!"
    set chat_e_greet[4] = "Emm... Me pregunto donde comenzaste :)"
    set chat_e_greet[5] = "Buena suerte y no te diviertas"
    set chat_e_greet[6] = "Bienvenido al infierno!"
    set chat_e_greet[7] = "Puedes correr pero no esconderte"
    set chat_e_greet[8] = "Ya se donde comenzaste"
    set chat_e_greet[9] = "Esta vez perderas contra la computadora"
    set chat_e_greet[10] = "Te are sufrir como nunca !"
    set chat_e_greet[11] = "Hola, no esperes ganar!"
    set chat_greet_length = 11

    set chat_e_taunt[0] = "Se mucho mas de lo que crees"
    set chat_e_taunt[1] = "No creas que podras escapar de mi, con lo que sea que estes haciendo"
    set chat_e_taunt[2] = "Cuidado! Tengo un plan"
    set chat_e_taunt[3] = "Nunca subestimes el poder de tu computadora"
    set chat_e_taunt[4] = "Esa estrategia que estas intentando nunca funcionara conmigo"
    set chat_e_taunt[5] = "Probablemente piensas que vas a ganar, no ?"
    set chat_e_taunt[6] = "Soy mas fuerte que cualquier creep que hayas visto"
    set chat_e_taunt[7] = "Si pierdo puedo culpar a tu pobre CPU"
    set chat_e_taunt[8] = "Aqui solamente hay espacio para UNO, y ese soy yo!"
    set chat_e_taunt[9] = "Mi estrategia lleva a la victoria, la tuya a la derrota"
    set chat_taunt_length = 9

    set chat_e_mega[0] = "Preparate para conocer tu condena"
    set chat_e_mega[1] = "JAJA! No tienes oportunidad"
    set chat_e_mega[2] = "Esta sera mi mejor hora"
    set chat_e_mega[3] = "Este juego se acabara pronto"
    set chat_e_mega[4] = "Este sera un ejemplo de la imperfeccion de la humanidad"
    set chat_e_mega[5] = "Ya no queda mucho de ti por destruir"
    set chat_e_mega[6] = "No sabes cuando es el momento de rendirte, verdad?"
    set chat_e_mega[7] = "Sera mejor que empieces a jugar bien o rendirte ahora :)"
    set chat_e_mega[8] = "Es hora de que empieces a jugar"
    set chat_e_mega[9] = "Ya tengo lista una linda tumba para enterrarte"
    set chat_e_mega[10] = "Tu base nos pertenece"
    set chat_mega_length = 10

    set chat_e_gg[0] = "Buen juego"
    set chat_e_gg[1] = "Diablos! perdi contra un humano!"
    set chat_e_gg[2] = "La proxima vez te vencere."
    set chat_e_gg[3] = "Mi juego se acabo."
    set chat_e_gg[4] = "Me tengo que ir."
    set chat_e_gg_length = 4

    set chat_a_expansion[0] = "Estoy limpiando esta mina"
    set chat_a_expansion[1] = "Voy a destruir los creeps the esta mina"
    set chat_a_expansion[2] = "Voy a expandirme aqui pronto"
    set chat_a_expansion[3] = "Esta mina estara lista pronto"
    set chat_a_expansion[4] = "Estoy yendo a esta mina"
    set chat_expansion_length = 4

    set chat_a_attack[0] = "Estoy atacando a este enemigo"
    set chat_a_attack[1] = "Estoy atacando aqui"
    set chat_a_attack[2] = "Atacando a este"
    set chat_a_attack[3] = "Lanzando un ataque a este blanco"
    set chat_a_attack[4] = "Atacando aqui ahora"
    set chat_attack_length = 4

    set chat_a_creep[0] = "Me estoy llevando a estos creeps"
    set chat_a_creep[1] = "Destruyendo a estos creeps"
    set chat_a_creep[2] = "Limpiando a este grupo de creeps"
    set chat_a_creep[3] = "Voy a recolectar experiancia aqui"
    set chat_a_creep[4] = "Atacando aqui ahora"
    set chat_creep_length = 4

    set chat_a_done[0] = "Termino mi trabajo aqui"
    set chat_a_done[1] = "Ahora estoy nuscando otro rumbo"
    set chat_a_done[2] = "Voy por otra cosa"
    set chat_a_done[3] = "Voy a intentar algo diferente"
    set chat_a_done[4] = "Ataque completado"
    set chat_done_length = 4

    set chat_a_ally[0] = "Vamos a atacar aqui"
    set chat_a_ally[1] = "Unete a este ataque si tu deseas"
    set chat_a_ally[2] = "Todos ataquen aqui ahora!"
    set chat_a_ally[3] = "Necesito ayuda aqui"
    set chat_a_ally[4] = "Podemos vencerlos juntos"
    set chat_ally_length = 4

    set chat_a_megatarget[0] = "Se acabaron sus defensas, ATAQUEN!"
    set chat_a_megatarget[1] = "Estoy mandando todo lo que tengo aqui"
    set chat_a_megatarget[2] = "Si atacamos aqui, es seguro que ganamos"
    set chat_a_megatarget[3] = "Manda todo lo que tienes aqui"
    set chat_a_megatarget[4] = "Podemos destruir esta base si nos apuramos"
    set chat_megatarget_length = 4

    set chat_a_gg[0] = "Fue divertido jugar contigo."
    set chat_a_gg[1] = "Lo siento, ya no puedo ayudar, me voy."
    set chat_a_gg[2] = "Tendras que hacerlo sin mi."
    set chat_a_gg[3] = "Fin del juego para mi, nos vemos."
    set chat_a_gg[4] = "Conquistaron todas mis bases!"
    set chat_a_gg_length = 4

    set chat_a_goldproblem[0] = "Por favor dame algo de oro o tendre que rendirme en 10 segundos."
    set chat_a_goldproblem[1] = "Necesito dinero urgentemente. Si no me das oro me rendire en 10 segundos."
    set chat_goldproblem_length = 1

    set chat_a_thanks[0] = "Gracias por el oro."
    set chat_a_thanks[1] = "Gracias, ahora puedo continuar ."
    set chat_thanks_length = 1

    set chat_no_unit_selected = "Ninguna unidad esta seleccionada"
    set chat_confirm_attack_unit = "Voy a atacar/proteger la unidad seleccionada"
    set chat_towerrush = "Voy a tratar de usar mis torres con alguien"
    set chat_no_orc = "Yo no soy un orco verde pulgoso y asqueroso!"
    set militia_expansion_chat = "Voy a intentar una expansion con milicianos aqui"

endfunction

function initChatArraysRomanian takes nothing returns nothing

    set chat_e_greet[0] = "O sa te sparg"
    set chat_e_greet[1] = "Nu cred ca esti facut pentru asta"
    set chat_e_greet[2] = "In 'zda masii, urasc harta asta"
    set chat_e_greet[3] = "Nuu!! Locul asta e super nasol"
    set chat_e_greet[4] = "Hmm... ma intreb unde esti :)"
    set chat_e_greet[5] = "Bafta & sa nu te distrezi"
    set chat_e_greet[6] = "Bine ai venit in iad !"
    set chat_e_greet[7] = "Poti sa fugi, dar nu te poti ascunde"
    set chat_e_greet[8] = "Stiu de unde ai pornit"
    set chat_e_greet[9] = "De data asta vei pierde contra unui Computer"
    set chat_e_greet[10] = "Vei suferi mult in miinile mele !"
    set chat_greet_length = 10

    set chat_e_taunt[0] = "Stiu mult mai mult decit crezi tu"
    set chat_e_taunt[1] = "Sa nu crezi ca scapi cu ce faci tu acolo"
    set chat_e_taunt[2] = "Pazea! Am un plan"
    set chat_e_taunt[3] = "Niciodata sa nu subestimezi puterea calculatorului tau"
    set chat_e_taunt[4] = "Strategia aia pe care o incerci nu va merge niciodata cu mine"
    set chat_e_taunt[5] = "Tu crezi acum ca vei cistiga meciul asta nu ?"
    set chat_e_taunt[6] = "Sint mult mai puternic decit orice creep pe care l-ai intilnit"
    set chat_e_taunt[7] = "Daca pierd meciul asta pot sa dau vina pe procesorul tau slab"
    set chat_e_taunt[8] = "Numai unu poate ramine si s-ar putea sa fiu eu ala"
    set chat_e_taunt[9] = "Strategia mea conduce catre victorie, a ta catre infringere"
    set chat_taunt_length = 9

    set chat_e_mega[0] = "Pregatestete sa mori"
    set chat_e_mega[1] = "HAHA! Nu ai nici o sansa"
    set chat_e_mega[2] = "Asta va fi culmea gloriei mele"
    set chat_e_mega[3] = "Meciul se va termina curind"
    set chat_e_mega[4] = "Asta va fi un exemplu de esec uman"
    set chat_e_mega[5] = "Nu prea a ramas mult din tine"
    set chat_e_mega[6] = "Nu prea stii cind e timpul sa zici 'GG' si sa pleci, nu ?"
    set chat_e_mega[7] = "Mai bine ai incerca sa joci super bine sau altfel ar trebuii sa pleci :)"
    set chat_e_mega[8] = "Mai bine ai incerca sa joci si tu"
    set chat_e_mega[9] = "Tocmai ti-am sapat un mormint foarte frumos"
    set chat_e_mega[10] = "Toata baza ta sint ale noastre"
    set chat_mega_length = 10

    set chat_e_gg[0] = "GG"
    set chat_e_gg[1] = "Rahat, am pierdut contra unui om!"
    set chat_e_gg[2] = "Data viitoare o sa te inving."
    set chat_e_gg[3] = "Meciul s-a terminat pentru mine!"
    set chat_e_gg[4] = "Trebuie sa plec."
    set chat_e_gg_length = 4

    set chat_a_expansion[0] = "Curat aceasta expansiune"
    set chat_a_expansion[1] = "O sa curat monstrii din mina asta"
    set chat_a_expansion[2] = "Cred ca o sa ma extind aici curind"
    set chat_a_expansion[3] = "Mina asta va fi disponibila curind"
    set chat_a_expansion[4] = "Ma duc la mina asta acum"
    set chat_expansion_length = 4

    set chat_a_attack[0] = "Atac acest inamic"
    set chat_a_attack[1] = "Atac aici"
    set chat_a_attack[2] = "Il atac pe asta"
    set chat_a_attack[3] = "Pornesc atacul asupra acestei tinte"
    set chat_a_attack[4] = "Atac acum aici"
    set chat_attack_length = 4

    set chat_a_creep[0] = "O sa scot din lupta monstrii astia"
    set chat_a_creep[1] = "O sa omor monstrii astia"
    set chat_a_creep[2] = "Ma duc la grupul asta de monstrii"
    set chat_a_creep[3] = "Ma duc spre monstrii astia de aici"
    set chat_a_creep[4] = "Acum atac aici"
    set chat_creep_length = 4

    set chat_a_done[0] = "Aici am terminat"
    set chat_a_done[1] = "Ma duc in alta parte acum"
    set chat_a_done[2] = "Ma duc sa fac altceva"
    set chat_a_done[3] = "O sa fac atceva acum"
    set chat_a_done[4] = "Atacul e complet"
    set chat_done_length = 4

    set chat_a_ally[0] = "Vom ataca aici"
    set chat_a_ally[1] = "Hai cu noi in acest atac daca vrei"
    set chat_a_ally[2] = "Toata lumea sa atace aici!"
    set chat_a_ally[3] = "Am nevoie de ajutor"
    set chat_a_ally[4] = "Putem sa distrugem tinta asta impreuna"
    set chat_ally_length = 4

    set chat_a_megatarget[0] = "Apararea lui este la pamint, Atacati!"
    set chat_a_megatarget[1] = "Trimit tot ce am aici"
    set chat_a_megatarget[2] = "Daca vom ataca acum vom cistiga cu siguranta"
    set chat_a_megatarget[3] = "Trimite tot ce ai aici"
    set chat_megatarget_length = 3

    set chat_a_gg[0] = "A fost super sa joc cu tine."
    set chat_a_gg[1] = "Sorry, nu te mai pot ajuta. Sint terminat."
    set chat_a_gg[2] = "Ei bine, va trebuii sa te descurci fara mine."
    set chat_a_gg[3] = "Meciul s-a terminat pentru mine! La revedere."
    set chat_a_gg[4] = "Toate bazele mele apartin lor!"
    set chat_a_gg_length = 4

    set chat_a_goldproblem[0] = "Te rog da-mi niste bani sau plec in 10 secunde."
    set chat_a_goldproblem[1] = "Sint in criza de bani. Fara bani voi pleca in 10 secunde"
    set chat_goldproblem_length = 1

    set chat_a_thanks[0] = "Multumesc pentru bani."
    set chat_a_thanks[1] = "Multumesc, am destul ca sa continui."
    set chat_thanks_length = 1

    set chat_no_unit_selected = "Nici o unitate selectata"
    set chat_confirm_attack_unit = "Voi ataca/apara unitatea selectata"
    set chat_towerrush = "Voi incerca un towerrush"
    set chat_no_orc = "Nu sint un orc, verde, si mincat de purici!"
    set militia_expansion_chat = "Voi face militia expansion aici"

endfunction

function initChatArraysChinese takes nothing returns nothing

    set chat_e_greet[0] = "?"
    set chat_e_greet[1] = "?"
    set chat_e_greet[2] = ""
    set chat_e_greet[3] = "jiji,?"
    set chat_e_greet[4] = ""
    set chat_e_greet[5] = "?"
    set chat_e_greet[6] = "?"
    set chat_e_greet[7] = "?"
    set chat_e_greet[8] = "?"
    set chat_e_greet[9] = "?"
    set chat_e_greet[10] = "?"
    set chat_e_greet[11] = "?"
    set chat_e_greet[12] = "?"
    set chat_e_greet[13] = "? "
    set chat_greet_length = 13

    set chat_e_taunt[0] = "?"
    set chat_e_taunt[1] = "?"
    set chat_e_taunt[2] = ""
    set chat_e_taunt[3] = "?"
    set chat_e_taunt[4] = ".:D"
    set chat_e_taunt[5] = "?"
    set chat_e_taunt[6] = "B,"
    set chat_e_taunt[7] = "?"
    set chat_e_taunt[8] = "??0"
    set chat_e_taunt[9] = "?"
    set chat_e_taunt[10] = "?"
    set chat_e_taunt[11] = "?"
    set chat_e_taunt[12] = "? "
    set chat_taunt_length = 12

    set chat_e_mega[0] = ""
    set chat_e_mega[1] = "?"
    set chat_e_mega[2] = "?"
    set chat_e_mega[3] = "APM?000"
    set chat_e_mega[4] = "GGHAPPY?"
    set chat_e_mega[5] = "?"
    set chat_e_mega[6] = "?"
    set chat_e_mega[7] = "?"
    set chat_e_mega[8] = ""
    set chat_e_mega[9] = ""
    set chat_e_mega[10] = ""
    set chat_e_mega[11] = ""
    set chat_e_mega[12] = "?"
    set chat_e_mega[13] = "?"
    set chat_e_mega[14] = "?"
    set chat_e_mega[15] = "?"
    set chat_e_mega[16] = ""
    set chat_e_mega[17] = "?"
    set chat_e_mega[18] = "?"
    set chat_mega_length = 18

    set chat_e_gg[0] = ""
    set chat_e_gg[1] = "GG,?"
    set chat_e_gg[2] = "??"
    set chat_e_gg[3] = "?"
    set chat_e_gg[4] = "?"
    set chat_e_gg[5] = "?"
    set chat_e_gg[6] = "?8"
    set chat_e_gg[7] = "84? "
    set chat_e_gg_length = 7

    set chat_a_expansion[0] = "?"
    set chat_a_expansion[1] = "?"
    set chat_a_expansion[2] = "?"
    set chat_a_expansion[3] = "?"
    set chat_a_expansion[4] = "MF"
    set chat_a_expansion[5] = "Everybody,ING!"
    set chat_expansion_length = 5

    set chat_a_attack[0] = ""
    set chat_a_attack[1] = ""
    set chat_a_attack[2] = ""
    set chat_a_attack[3] = ""
    set chat_a_attack[4] = "?"
    set chat_a_attack[5] = ""
    set chat_a_attack[6] = "?"
    set chat_a_attack[7] = ""
    set chat_attack_length = 7

    set chat_a_creep[0] = "MF?"
    set chat_a_creep[1] = "?"
    set chat_a_creep[2] = "?"
    set chat_a_creep[3] = "?"
    set chat_a_creep[4] = "CREEPS?"
    set chat_a_creep[5] = "MF"
    set chat_creep_length = 5

    set chat_a_done[0] = ""
    set chat_a_done[1] = "?"
    set chat_a_done[2] = "?"
    set chat_a_done[3] = "?"
    set chat_a_done[4] = "?"
    set chat_a_done[5] = "?"
    set chat_a_done[6] = ""
    set chat_done_length = 6

    set chat_a_ally[0] = "?"
    set chat_a_ally[1] = ""
    set chat_a_ally[2] = "??"
    set chat_a_ally[3] = "?"
    set chat_a_ally[4] = "?"
    set chat_a_ally[5] = ""
    set chat_ally_length = 5

    set chat_a_megatarget[0] = ""
    set chat_a_megatarget[1] = "?"
    set chat_a_megatarget[2] = ""
    set chat_a_megatarget[3] = "?"
    set chat_a_megatarget[4] = ""
    set chat_a_megatarget[5] = "SB? "
    set chat_megatarget_length = 5

    set chat_a_gg[0] = ""
    set chat_a_gg[1] = "?"
    set chat_a_gg[2] = "GG?"
    set chat_a_gg[3] = ""
    set chat_a_gg[4] = ""
    set chat_a_gg[5] = "?"
    set chat_a_gg[6] = "?"
    set chat_a_gg_length = 6

    set chat_a_goldproblem[0] = "10?"
    set chat_a_goldproblem[1] = "?0"
    set chat_a_goldproblem[2] = "?"
    set chat_a_goldproblem[3] = "10000"
    set chat_goldproblem_length = 3

    set chat_a_thanks[0] = "?"
    set chat_a_thanks[1] = "?"
    set chat_a_thanks[2] = "? "
    set chat_thanks_length = 2

    set chat_no_unit_selected = "?"
    set chat_confirm_attack_unit = "/?"
    set chat_towerrush = "Rua?"
    set chat_no_orc = ""
    set militia_expansion_chat = "? "

endfunction


function CommonStratsDefault takes nothing returns nothing
set strategy_name[50] = "airair"
set strategy_default_name[50] = "Air-Air"
set strategy_default_report[50] = "I build Air-Air units"
set strategy_name[51] = "airground"
set strategy_default_name[51] = "Air-Ground"
set strategy_default_report[51] = "I build Air-Ground units"
set strategy_name[52] = "groundair"
set strategy_default_name[52] = "Ground-Air"
set strategy_default_report[52] = "I build Ground-Air units"
set strategy_name[53] = "groundground"
set strategy_default_name[53] = "Ground-Ground"
set strategy_default_report[53] = "I build Ground-Ground units"
set strategy_name[54] = "farm"
set strategy_default_name[54] = "Farms"
set strategy_default_report[54] = "I build farms"
set strategy_name[55] = "guard"
set strategy_default_name[55] = "Towers"
set strategy_default_report[55] = "I build towers"
endfunction

function initChatArrays takes nothing returns nothing
  if false then
  elseif language == "English" then
    call initChatArraysEnglish()
  elseif language == "Deutsch" then
    call initChatArraysDeutsch()
  elseif language == "Swedish" then
    call initChatArraysSwedish()
  elseif language == "French" then
    call initChatArraysFrench()
  elseif language == "Spanish" then
    call initChatArraysSpanish()
  elseif language == "Romanian" then
    call initChatArraysRomanian()
  elseif language == "Chinese" then
    call initChatArraysChinese()
  endif
endfunction

function AddTranslation takes string lang, string strat_name, string trans_name, string trans_report returns nothing
  set translation[translation_length] = trans_name
  call StoreInteger(translation_map, lang, "Name"+strat_name, translation_length)
  set translation_length = translation_length + 1
  set translation[translation_length] = trans_report
  call StoreInteger(translation_map, lang, "Report"+strat_name, translation_length)
  set translation_length = translation_length + 1
endfunction

function initTranslations takes nothing returns nothing
  local string lang = ""
  set lang = "English"
  call AddTranslation(lang, "NormalElf", "Normal", "I play normal and build something of everything")
  call AddTranslation(lang, "MassH", "Hunts and Dryads", "I'm going massive huntress with some dryads")
  call AddTranslation(lang, "Druids", "Dryads and DotC", "I'm going dryads and DotC")
  call AddTranslation(lang, "Hippo", "Hippo Riders", "I'm going hippo riders")
  call AddTranslation(lang, "Ballista", "Ballista", "I'm going glaive throwers and dryads")
  call AddTranslation(lang, "Talon", "Talon", "I'm going massive DotT")
  call AddTranslation(lang, "HippoChim", "HippoChim", "I'm going hippos and chimaeras")
  call AddTranslation(lang, "DryadChim", "DryadChim", "I'm going dryads and chimaeras")
  call AddTranslation(lang, "Archer", "Archers", "I'm going mass archers")
  call AddTranslation(lang, "DotC", "Bears", "I'm going mass DotC")
  call AddTranslation(lang, "NormalHuman", "Normal", "I play normal and build something of everything")
  call AddTranslation(lang, "MassSp", "Casters", "I'm going massive spell casters")
  call AddTranslation(lang, "Gryph", "Gryphon", "I'm going gryphon riders")
  call AddTranslation(lang, "Knight", "Knights", "I'm going massive footmen and knights")
  call AddTranslation(lang, "Rifle", "Rifle", "I'm going massive riflemen")
  call AddTranslation(lang, "Mortars", "Mortars", "I'm going mortars")
  call AddTranslation(lang, "Copters", "Copters", "I'm going flying machines")
  call AddTranslation(lang, "NormalOrc", "Normal", "I'm going grunts and casters")
  call AddTranslation(lang, "FastSh", "Shamans and Taurens", "I'm going casters and taurens")
  call AddTranslation(lang, "Kodo", "Kodo", "I'm going massive kodo-beasts")
  call AddTranslation(lang, "WyvSh", "Shamans and Wyverns", "I'm going Shamans and Wyverns")
  call AddTranslation(lang, "HHunters", "Head Hunters", "I'm going massive head hunters")
  call AddTranslation(lang, "Raiders", "Raiders", "I'm going massive raiders")
  call AddTranslation(lang, "Catapults", "Grunts and Catapults", "I'm going grunts and demolishers")
  call AddTranslation(lang, "HeadCatapults", "Head hunters and Catapults", "I'm going headhunters and demolishers")
  call AddTranslation(lang, "NormalUndead", "Normal", "I play normal and build something of everything")
  call AddTranslation(lang, "Wyrms", "Wyrms", "I'm going wyrms and some crypt fiends")
  call AddTranslation(lang, "Banshee", "Banshees", "I'm going mostly banshees")
  call AddTranslation(lang, "Necro", "Necros", "I'm going necromancers")
  call AddTranslation(lang, "Ghouls", "Ghouls", "I'm going mass ghouls")
  call AddTranslation(lang, "Fiends", "Fiends", "I'm going mass crypt fiends")
  call AddTranslation(lang, "GargWyrm", "Gargoyles and Wyrms", "I'm going gargs and wyrms")
  call AddTranslation(lang, "Aboms", "Aboms", "I'm going mass abominations")
  call AddTranslation(lang, "MeatFiends", "Meat wagons and Fiends", "I'm going fiends and meat wagons")
  call AddTranslation(lang, "airair", "Air-Air", "I build Air-Air units")
  call AddTranslation(lang, "airground", "Air-Ground", "I build Air-Ground units")
  call AddTranslation(lang, "groundair", "Ground-Air", "I build Ground-Air units")
  call AddTranslation(lang, "groundground", "Ground-Ground", "I build Ground-Ground units")
  call AddTranslation(lang, "farm", "Farms", "I build farms")
  call AddTranslation(lang, "guard", "Towers", "I build towers")
  set lang = "Deutsch"
  call AddTranslation(lang, "NormalElf", "Normal", "Ich spiele normal und baue von Allem etwas")
  call AddTranslation(lang, "MassH", "Jaegerinnen and Dryaden", "Ich baue massiv Jaegerinnen mit ein paar Dryaden")
  call AddTranslation(lang, "Druids", "Dryaden and Baerchen", "Ich baue Dryaden and Baerchen")
  call AddTranslation(lang, "Hippo", "Hipporeiterinnen", "Ich baue Hipporeiterinnen")
  call AddTranslation(lang, "Ballista", "Ballistas", "Ich baue Ballistas and Dryaden")
  call AddTranslation(lang, "Talon", "Klauendruiden", "Ich baue massiv Klauendruiden")
  call AddTranslation(lang, "HippoChim", "HippoChi", "Ich baue Hippos and Schimaeren")
  call AddTranslation(lang, "DryadChim", "DryadChim", "Ich baue Dryaden and Schimaeren")
  call AddTranslation(lang, "Archer", "Bogenschuetzen", "Ich baue massiv Bogenschuetzen")
  call AddTranslation(lang, "DotC", "Baerchen", "Ich baue massiv Baerchen")
  call AddTranslation(lang, "NormalHuman", "Normal", "Ich spiele normal und baue von Allem etwas")
  call AddTranslation(lang, "MassSp", "Zauberer", "Ich baue massiv Zauberer")
  call AddTranslation(lang, "Gryph", "Greifen", "Ich baue Greifenreiter")
  call AddTranslation(lang, "Knight", "Ritter", "Ich baue massiv Soldaten und Ritter")
  call AddTranslation(lang, "Rifle", "Schuetzen", "Ich baue massiv Schuetzen")
  call AddTranslation(lang, "Mortars", "Moerser-Truppen", "Ich baue Moerser-Truppen")
  call AddTranslation(lang, "Copters", "Gyrokopter", "Ich baue Gyrokopter")
  call AddTranslation(lang, "NormalOrc", "Normal", "Ich baue Grunzer und Zauberer")
  call AddTranslation(lang, "FastSh", "Schamanen und Tauren", "Ich baue Schamanen und Tauren")
  call AddTranslation(lang, "Kodo", "Kodo", "Ich baue massiv Kodo-Bestien")
  call AddTranslation(lang, "WyvSh", "Schamanen und Wyverns", "Ich baue Schamanen und Wyverns")
  call AddTranslation(lang, "HHunters", "Kopfjaeger", "Ich baue massiv Kopfjaeger")
  call AddTranslation(lang, "Raiders", "Raeuber", "Ich baue massiv Raeuber")
  call AddTranslation(lang, "Catapults", "Katapulte", "Ich baue Grunzer und Katapulte")
  call AddTranslation(lang, "HeadCatapults", "Kopfjaeger und Katapulte", "Ich baue Kopfjaeger und Katapulte")
  call AddTranslation(lang, "NormalUndead", "Normal", "Ich spiele normal und baue von Allem etwas")
  call AddTranslation(lang, "Wyrms", "Wyrms", "Ich versuche einen Wyrmrush mit ein paar Gruftbestien")
  call AddTranslation(lang, "Banshee", "Banshees", "Ich baue hauptsaechlich Banshees")
  call AddTranslation(lang, "Necro", "Totenbeschwoerer", "Ich baue Totenbeschwoerer")
  call AddTranslation(lang, "Ghouls", "Ghoule", "Ich baue massiv Ghoule")
  call AddTranslation(lang, "Fiends", "Gruftbestien", "Ich baue massiv Gruftbestien")
  call AddTranslation(lang, "GargWyrm", "Gargoyles and Wyrms", "Ich baue Gargoyles and Wyrms")
  call AddTranslation(lang, "Aboms", "Monstrositaeten", "Ich baue massiv Monstrositaeten")
  call AddTranslation(lang, "MeatFiends", "Fleischwagen und Gruftbestien", "Ich baue Gruftbestien und Fleischwagen")
  call AddTranslation(lang, "airair", "Luft-Luft", "Ich baue Luft-Luft-Einheiten")
  call AddTranslation(lang, "airground", "Luft-Boden", "Ich baue Luft-Boden-Einheiten")
  call AddTranslation(lang, "groundair", "Boden-Luft", "Ich baue Boden-Luft-Einheiten")
  call AddTranslation(lang, "groundground", "Boden-Boden", "Ich baue Boden-Boden-Einheiten")
  call AddTranslation(lang, "farm", "Farmen", "Ich baue Farmen")
  call AddTranslation(lang, "guard", "Tuerme", "Ich baue Tuerme")
  set lang = "Swedish"
  call AddTranslation(lang, "NormalElf", "Normal", "Jag spelar som vanligt och bygger lite av varje")
  call AddTranslation(lang, "MassH", "Hunts och Dryads", "Jag bygger huntress och ett par dryads")
  call AddTranslation(lang, "Druids", "Dryads och DotC", "Jag skaffar dryads och DotC")
  call AddTranslation(lang, "Hippo", "Hippo Riders", "Jag bygger hippo riders")
  call AddTranslation(lang, "Ballista", "Ballista", "Jag skaffar ballista och dryads")
  call AddTranslation(lang, "Talon", "Talon", "Jag bygger massa DotT")
  call AddTranslation(lang, "HippoChim", "HippoChim", "Jag bygger hippos och chimaeras")
  call AddTranslation(lang, "DryadChim", "DryadChim", "Jag skaffar dryads och chimaeras")
  call AddTranslation(lang, "Archer", "Archers", "Jag bygger mass archers")
  call AddTranslation(lang, "DotC", "DotC", "Jag bygger mass DotC")
  call AddTranslation(lang, "NormalHuman", "Normal", "Jag spelar vanligt och bygger lite av varje")
  call AddTranslation(lang, "MassSp", "Casters", "Jag massar casters")
  call AddTranslation(lang, "Gryph", "Gryphon", "Jag bygger massa gryphons")
  call AddTranslation(lang, "Knight", "Knights", "Jag skaffar footmen och knights")
  call AddTranslation(lang, "Rifle", "Rifle", "Jag bygger massa riflemen")
  call AddTranslation(lang, "Mortars", "Mortars", "Jag skaffar mortars och riflemen")
  call AddTranslation(lang, "Copters", "Copters", "Jag massar flygmaskiner")
  call AddTranslation(lang, "NormalOrc", "Normal", "Jag skaffar grunts och casters")
  call AddTranslation(lang, "FastSh", "Shamans och Taurens", "Jag skaffar casters och taurens")
  call AddTranslation(lang, "Kodo", "Kodo", "Jag bygger massa kodo-beast")
  call AddTranslation(lang, "WyvSh", "Shamans och Wyverns", "Jag bygger Shamans och Wyverns")
  call AddTranslation(lang, "HHunters", "Head Hunters", "Jag bygger massa head hunters")
  call AddTranslation(lang, "Raiders", "Raiders", "Jag bygger massa raiders")
  call AddTranslation(lang, "Catapults", "Grunts och Katapulter", "Jag bygger grunts och katapulter")
  call AddTranslation(lang, "HeadCatapults", "Head hunters och Katapulter", "Jag skaffar headhunters och katapulter")
  call AddTranslation(lang, "NormalUndead", "Normal", "Jag spelar som vanligt och bygger lite av varje")
  call AddTranslation(lang, "Wyrms", "Wyrms", "Jag bygger wyrms och crypt fiends")
  call AddTranslation(lang, "Banshee", "Banshees", "Jag skaffar bashees")
  call AddTranslation(lang, "Necro", "Necros", "Jag bygger necromancers")
  call AddTranslation(lang, "Ghouls", "Ghouls", "Jag skaffar massa ghouls")
  call AddTranslation(lang, "Fiends", "Fiends", "Jag bygger massa crypt fiends")
  call AddTranslation(lang, "GargWyrm", "Gargoyles och Wyrms", "Jag bygger gargs och wyrms")
  call AddTranslation(lang, "Aboms", "Aboms", "Jag skaffar massa abominations")
  call AddTranslation(lang, "MeatFiends", "Meat wagons och Fiends", "Jag bygger fiends och meat wagons")
  call AddTranslation(lang, "airair", "Luft-Luft", "Jag bygger luft- mot luftenheter")
  call AddTranslation(lang, "airground", "Luft-Mark", "Jag bygger luft- mot markenheter")
  call AddTranslation(lang, "groundair", "Mark-Luft", "Jag bygger mark- mot luftenheter")
  call AddTranslation(lang, "groundground", "Mark-Mark", "Jag bygger mark- mot markenheter")
  call AddTranslation(lang, "farm", "Farms", "Jag bygger farms")
  call AddTranslation(lang, "guard", "Torn", "Jag bygger torn")
  set lang = "French"
  call AddTranslation(lang, "NormalElf", "Normal", "Je joue normalement et je construis quelque chose de tout.")
  call AddTranslation(lang, "MassH", "Chasseresses et Dryades.", "Je vais creer massivement des chasseresses avec quelques Dryades.")
  call AddTranslation(lang, "Druids", "Dryades et Druides Ours.", "Je vais creer des Dryades et des Druides Ours.")
  call AddTranslation(lang, "Hippo", "Chevaucheurs d'hippogryphe.", "Je vais creer Chevaucheurs d'hippogryphe.")
  call AddTranslation(lang, "Ballista", "Baliste.", "I'm going glaive throwers and dryads")
  call AddTranslation(lang, "Talon", "Druide Corbeau.", "Je vais creer des druides corbeau massivement.")
  call AddTranslation(lang, "HippoChim", "Hippogryphe et Chimere.", "Je vais creer des Hippogryphes et des chimeres.")
  call AddTranslation(lang, "DryadChim", "Dryades et Chimeres.", "Je vais creer des Dryades et des Chimeres.")
  call AddTranslation(lang, "Archer", "Archers", "Je vais creer des archers en masse.")
  call AddTranslation(lang, "DotC", "Druides Ours", "Je vais creer des Druides Ours massivement.")
  call AddTranslation(lang, "NormalHuman", "Normal", "Je joue normalement et je construis quelque chose de tout.")
  call AddTranslation(lang, "MassSp", "Casters", "Je vais creer des casters massivement.")
  call AddTranslation(lang, "Gryph", "Chevaucheur de griffon.", "Je vais creer des Chevaucheurs de griffon.")
  call AddTranslation(lang, "Knight", "Chevaliers.", "Je vais creer des Fantassins et des Chevaliers en masse.")
  call AddTranslation(lang, "Rifle", "Fusilier.", "Je vais creer massivement des Fusiliers.")
  call AddTranslation(lang, "Mortars", "Mortiers", "Je vais creer massivement des Mortiers.")
  call AddTranslation(lang, "Copters", "Gyrocopteres.", "Je vais creer des Gyrocopteres.")
  call AddTranslation(lang, "NormalOrc", "Normal", "Je vais creer des grunts et des casters.")
  call AddTranslation(lang, "FastSh", "Chamans et Taurens.", "Je vais creer des Chamans et des Taurens.")
  call AddTranslation(lang, "Kodo", "Bete Kodo.", "Je vais creer des Betes Kodo en masse.")
  call AddTranslation(lang, "WyvSh", "Chamans and Wyvernes.", "Je vais creer des Chamans et des Wyvernes.")
  call AddTranslation(lang, "HHunters", "Chasseurs de tetes.", "Je vais creer massivement des Chasseurs de tetes.")
  call AddTranslation(lang, "Raiders", "Chevaucheurs de Loup.", "Je vais creer des Chevaucheurs de Loup en masse.")
  call AddTranslation(lang, "Catapults", "Grunts and Catapultes.", "Je vais creer des grunts et des demolishers.")
  call AddTranslation(lang, "HeadCatapults", "Chasseurs de tetes and Catapultes.", "Je vais creer des Chasseurs de tetes et des demolishers.")
  call AddTranslation(lang, "NormalUndead", "Normal", "Je joue normalement et je construis quelque chose de tout.")
  call AddTranslation(lang, "Wyrms", "Wyrms des glaces.", "Je vais creer massivement des Wyrms des glaces avec quelques Demons de cryptes.")
  call AddTranslation(lang, "Banshee", "Banshees.", "Je vais creer principalement des Banshees.")
  call AddTranslation(lang, "Necro", "Necromanciens.", "Je vais creer des Necromanciens.")
  call AddTranslation(lang, "Ghouls", "Goules.", "Je vais creer des Goules en masse.")
  call AddTranslation(lang, "Fiends", "Demons des cryptes.", "Je vais creer massivement des Demons des cryptes.")
  call AddTranslation(lang, "GargWyrm", "Gargouilles and Wyrms des glaces.", "Je vais creer des gargouilles et des Wyrms des glaces.")
  call AddTranslation(lang, "Aboms", "Abominations.", "Je vais creer des Abominations en masse.")
  call AddTranslation(lang, "MeatFiends", "Chariots a viande et Demons des cryptes.", "Je vais creer des Chariots a viande et des Demons des cryptes.")
  call AddTranslation(lang, "airair", "Air-Air", "Je construis des unites air-air.")
  call AddTranslation(lang, "airground", "Air-Sol", "Je construis des unites air-sol.")
  call AddTranslation(lang, "groundair", "Sol-Air", "Je construis des unites sol-air.")
  call AddTranslation(lang, "groundground", "Sol-Sol", "Je construis des unites sol-sol.")
  call AddTranslation(lang, "farm", "Fermes", "Je construis des fermes.")
  call AddTranslation(lang, "guard", "Tourelles", "Je construis des tourelles.")
  set lang = "Spanish"
  call AddTranslation(lang, "NormalElf", "Normal", "Voy a jugar normal y construir algo de cada cosa")
  call AddTranslation(lang, "MassH", "Cazadoras y Dryads", "Voy a construir Cazadoras en masa y algunas Dryads")
  call AddTranslation(lang, "Druids", "Dryads y Druidas de la garra", "Voy a construir Dryads y Druidas de la garra")
  call AddTranslation(lang, "Hippo", "Montadoras de hipogrifos", "Voy a construir montadoras de hipogrifos")
  call AddTranslation(lang, "Ballista", "Ballista", "Voy a construir Ballistas y Dryads")
  call AddTranslation(lang, "Talon", "Talon", "Voy a construir Druidas del Talon en masa")
  call AddTranslation(lang, "HippoChim", "HipoQuim", "Voy a construir hipogrifos y quimera")
  call AddTranslation(lang, "DryadChim", "DryadQuim", "Voy a construir dryads y quimeras")
  call AddTranslation(lang, "Archer", "Arqueras", "Voy a construir arqueras en masa")
  call AddTranslation(lang, "DotC", "Osos", "Voy a construir Druidas de la garra en masa")
  call AddTranslation(lang, "NormalHuman", "Normal", "Voy a jugar normal y construir algo de cada cosa")
  call AddTranslation(lang, "MassSp", "Magicas", "Voy a construir unidades magicas en masa")
  call AddTranslation(lang, "Gryph", "Grifo", "Voy a construir montadores de grifos")
  call AddTranslation(lang, "Knight", "Caballeros", "Voy a construir Soldados rasos y caballeros en masa")
  call AddTranslation(lang, "Rifle", "Rifle", "Voy a construir rifleros en masa")
  call AddTranslation(lang, "Mortars", "Morteros", "Voy a construir equipos morteros")
  call AddTranslation(lang, "Copters", "Girocopteros", "Voy a construir maquinas voladoras")
  call AddTranslation(lang, "NormalOrc", "Normal", "Voy a construir grunts y unidades magicas")
  call AddTranslation(lang, "FastSh", "Shamanes y Taurens", "Voy a construir shamanes y taurens")
  call AddTranslation(lang, "Kodo", "Kodo", "Voy a construir bestias Kodo")
  call AddTranslation(lang, "WyvSh", "Shamanes y Wyverns", "Voy a construir Shamanes y Wyverns")
  call AddTranslation(lang, "HHunters", "trolls", "Voy a construir trolls arranca cabezas en masa")
  call AddTranslation(lang, "Raiders", "Raiders", "Voy a construir raiders en masa")
  call AddTranslation(lang, "Catapults", "Grunts y Catapultas", "Voy a construir grunts y demoledores")
  call AddTranslation(lang, "HeadCatapults", "Trolls y Catapultas", "Voy a construir Trolls arranca cabezas y demoledors")
  call AddTranslation(lang, "NormalUndead", "Normal", "Voy a jugar normal y voy a construir algo de cada cosa")
  call AddTranslation(lang, "Wyrms", "Wyrms", "Voy a construir Wyrms de hielo rapidamente con algunos demonios de la cripta")
  call AddTranslation(lang, "Banshee", "Banshees", "Voy a construir banshees principalmente")
  call AddTranslation(lang, "Necro", "Necros", "Voy a construir necromantes")
  call AddTranslation(lang, "Ghouls", "Necrosagos", "Voy a construir Necrosagos en masa")
  call AddTranslation(lang, "Fiends", "Demonios", "Voy a construir demonios de la cripta en masa")
  call AddTranslation(lang, "GargWyrm", "Gargolas y Wyrms", "Voy a construir gargolas y wyrms")
  call AddTranslation(lang, "Aboms", "Aboms", "Voy a construir abominaciones en masa")
  call AddTranslation(lang, "MeatFiends", "Vagones de carne y demonios", "Voy a construir demonios de la cripta y vagones de carne")
  call AddTranslation(lang, "airair", "Aire-aire", "Voy a construir Unidades aire-aire")
  call AddTranslation(lang, "airground", "Aire-tierra", "Voy a construir unidades Aire-tierra")
  call AddTranslation(lang, "groundair", "Tierra-Aire", "Voy a construir unidades Tierra-aire")
  call AddTranslation(lang, "groundground", "Tierra-Tierra", "Voy a construir unidades Tierra-tierra")
  call AddTranslation(lang, "farm", "Granjas", "Voy a construir granjas")
  call AddTranslation(lang, "guard", "Torres", "Voy a construir torres")
  set lang = "Romanian"
  call AddTranslation(lang, "NormalElf", "Normal", "Voi juca normal si voi face cite ceva din toate")
  call AddTranslation(lang, "MassH", "Hunts si Dryads", "Voi face multe huntress cu ceva dryads")
  call AddTranslation(lang, "Druids", "Dryads si DotC", "Voi face dryads si DotC")
  call AddTranslation(lang, "Hippo", "Hippo Riders", "Voi face hippo riders")
  call AddTranslation(lang, "Ballista", "Ballista", "Voi face glaive throwers si dryads")
  call AddTranslation(lang, "Talon", "Talon", "Voi face multi DotT")
  call AddTranslation(lang, "HippoChim", "HippoChim", "Voi face hippos si chimaera")
  call AddTranslation(lang, "DryadChim", "DryadChim", "Voi face dryads si chimaeras")
  call AddTranslation(lang, "Archer", "Archers", "Voi face multi archers")
  call AddTranslation(lang, "DotC", "Bears", "Voi face multi DotC")
  call AddTranslation(lang, "NormalHuman", "Normal", "Voi juca normal si voi face cite ceva din toate")
  call AddTranslation(lang, "MassSp", "Casters", "Voi face multi spell casters")
  call AddTranslation(lang, "Gryph", "Gryphon", "Voi face gryphon riders")
  call AddTranslation(lang, "Knight", "Knights", "Voi face multi footmen si knights")
  call AddTranslation(lang, "Rifle", "Rifle", "Voi face multi riflemen")
  call AddTranslation(lang, "Mortars", "Mortars", "Ma duc pe mortars")
  call AddTranslation(lang, "Copters", "Copters", "Voi face flying machines")
  call AddTranslation(lang, "NormalOrc", "Normal", "Voi face grunts si casters")
  call AddTranslation(lang, "FastSh", "Shamans and Taurens", "Voi face casters si taurens")
  call AddTranslation(lang, "Kodo", "Kodo", "Voi face multi kodo-beasts")
  call AddTranslation(lang, "WyvSh", "Shamans and Wyverns", "Voi face Shamans si Wyverns")
  call AddTranslation(lang, "HHunters", "Head Hunters", "Voi face multi head hunters")
  call AddTranslation(lang, "Raiders", "Raiders", "Voi face multi raiders")
  call AddTranslation(lang, "Catapults", "Grunts and Catapults", "Voi face grunts si demolisher")
  call AddTranslation(lang, "HeadCatapults", "Head hunters and Catapults", "Voi face headhunters si demolishers")
  call AddTranslation(lang, "NormalUndead", "Normal", "Voi juca normal si voi face cite ceva din toate")
  call AddTranslation(lang, "Wyrms", "Wyrms", "Voi face wyrm rush cu citiva crypt fiends")
  call AddTranslation(lang, "Banshee", "Banshees", "Voi face aproape numai banshees")
  call AddTranslation(lang, "Necro", "Necros", "Voi face necromancers")
  call AddTranslation(lang, "Ghouls", "Ghouls", "Voi face multi ghouls")
  call AddTranslation(lang, "Fiends", "Fiends", "Voi face multi crypt fiends")
  call AddTranslation(lang, "GargWyrm", "Gargoyles and Wyrms", "Voi face gargs si wyrms")
  call AddTranslation(lang, "Aboms", "Aboms", "Voi face multe abominations")
  call AddTranslation(lang, "MeatFiends", "Meat wagons and Fiends", "Voi face fiends si meat wagons")
  call AddTranslation(lang, "airair", "Air-Air", "Voi face unitati Aer-Aer")
  call AddTranslation(lang, "airground", "Air-Ground", "Voi face unitati Aer-Sol")
  call AddTranslation(lang, "groundair", "Ground-Air", "Voi face unitati Sol-Aer")
  call AddTranslation(lang, "groundground", "Ground-Ground", "Voi face unitati Sol-Sol")
  call AddTranslation(lang, "farm", "Farms", "Voi construi ferme")
  call AddTranslation(lang, "guard", "Towers", "Voi construi turnuri")
  set lang = "Chinese"
  call AddTranslation(lang, "NormalElf", "", "?")
  call AddTranslation(lang, "MassH", "?", "?")
  call AddTranslation(lang, "Druids", "", "?")
  call AddTranslation(lang, "Hippo", "", "?")
  call AddTranslation(lang, "Ballista", "", "?")
  call AddTranslation(lang, "Talon", "?", "?")
  call AddTranslation(lang, "HippoChim", "?", "")
  call AddTranslation(lang, "DryadChim", "", "?")
  call AddTranslation(lang, "Archer", "?", "")
  call AddTranslation(lang, "DotC", "", "?")
  call AddTranslation(lang, "NormalHuman", "", "?")
  call AddTranslation(lang, "MassSp", "?", "")
  call AddTranslation(lang, "Gryph", "", "")
  call AddTranslation(lang, "Knight", "", "")
  call AddTranslation(lang, "Rifle", "", "?")
  call AddTranslation(lang, "Mortars", "?", "")
  call AddTranslation(lang, "Copters", "?", "")
  call AddTranslation(lang, "NormalOrc", "", "?")
  call AddTranslation(lang, "FastSh", "", "?")
  call AddTranslation(lang, "Kodo", "?", "?")
  call AddTranslation(lang, "WyvSh", "", "?")
  call AddTranslation(lang, "HHunters", "?", "?")
  call AddTranslation(lang, "Raiders", "", "?")
  call AddTranslation(lang, "Catapults", "?", "?")
  call AddTranslation(lang, "HeadCatapults", "?", "?")
  call AddTranslation(lang, "NormalUndead", "", "")
  call AddTranslation(lang, "Wyrms", "", "?")
  call AddTranslation(lang, "Banshee", "", "")
  call AddTranslation(lang, "Necro", "", "")
  call AddTranslation(lang, "Ghouls", "", "")
  call AddTranslation(lang, "Fiends", "", "")
  call AddTranslation(lang, "GargWyrm", "?", "")
  call AddTranslation(lang, "Aboms", "", "")
  call AddTranslation(lang, "MeatFiends", "?", "")
  call AddTranslation(lang, "airair", "?", "?")
  call AddTranslation(lang, "airground", "?", "?")
  call AddTranslation(lang, "groundair", "?", "?")
  call AddTranslation(lang, "groundground", "?", "?")
  call AddTranslation(lang, "farm", "", "")
  call AddTranslation(lang, "guard", "", "")
endfunction

function GetStrategyName takes integer stratnum returns string
  if HaveStoredInteger(translation_map, language, "Name"+strategy_name[stratnum]) then
    return translation[GetStoredInteger(translation_map, language, "Name"+strategy_name[stratnum])]
  else
    return strategy_default_name[stratnum]
  endif
endfunction

function GetStrategyReport takes integer stratnum returns string
  if HaveStoredInteger(translation_map, language, "Report"+strategy_name[stratnum]) then
    return translation[GetStoredInteger(translation_map, language, "Report"+strategy_name[stratnum])]
  else
    return strategy_default_report[stratnum]
  endif
endfunction

function GetCurrentStrategyName takes nothing returns string
  return GetStrategyName(strategy)
endfunction

function GetCurrentStrategyReport takes nothing returns string
  return GetStrategyReport(strategy)
endfunction

function chat takes integer c returns nothing
    local real chat_roll = GetRandomReal(0.00,100.00)
    if campaign_ai then
      return
    endif
    if c == C_GREET then
        call DisplayToEnemyChat(chat_e_greet[GetRandomInt(0,chat_greet_length)])
    
    elseif c == C_CHAT then
        if chat_roll < taunt_rate then
            call DisplayToEnemyChat(chat_e_taunt[GetRandomInt(0,chat_taunt_length)])
        endif
    
    elseif c == C_MEGA then
        call DisplayToEnemyChat(chat_e_mega[GetRandomInt(0,chat_mega_length)])

    elseif c == C_GG then
        call DisplayToEnemyImportant(chat_e_gg[GetRandomInt(0,chat_e_gg_length)])
        call DisplayToAlliesImportant(chat_a_gg[GetRandomInt(0,chat_a_gg_length)])

    elseif c == C_EXPANSION then
        call DisplayToAlliesChat(chat_a_expansion[GetRandomInt(0,chat_expansion_length)])
    
    elseif c == C_ATTACK then
        call DisplayToAlliesChat(chat_a_attack[GetRandomInt(0,chat_attack_length)])
    
    elseif c == C_CREEP then
        call DisplayToAlliesChat(chat_a_creep[GetRandomInt(0,chat_creep_length)])

    elseif c == C_DONE then
        if chat_roll < 30 then
            call DisplayToAlliesChat(chat_a_done[GetRandomInt(0,chat_done_length)])
        endif
    
    elseif c == C_ALLY then
        call DisplayToAlliesChat(chat_a_ally[GetRandomInt(0,chat_ally_length)])
    
    elseif c == C_MEGATARGET then
        call DisplayToAlliesChat(chat_a_megatarget[GetRandomInt(0,chat_megatarget_length)])

    elseif c == C_GOLDPROBLEM then
        call DisplayToAllies(chat_a_goldproblem[GetRandomInt(0,chat_goldproblem_length)])

    elseif c == C_THANKS then
        call DisplayToAllies(chat_a_thanks[GetRandomInt(0,chat_thanks_length)])

    elseif c == C_STRATEGY then
        call DisplayToAlliesImportant( GetCurrentStrategyReport() )
        call DisplayToObserversImportant( GetCurrentStrategyReport() )

    endif
endfunction

function GetPlayerStartLocationLoc takes player whichPlayer returns location
    return GetStartLocationLoc(GetPlayerStartLocation(whichPlayer))
endfunction

function DisplayStratNames takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i >= rp_strat_length
    call DisplayToAllies(Int2Str(i) + ". " + GetStrategyName(i))
    set i = i + 1
  endloop
endfunction


function InitNeutralSkills takes nothing returns nothing
  set allskills[121] = FROSTARROWS
  set allskills[122] = MANASHIELD
  set allskills[123] = FROSTARROWS
  set allskills[124] = MANASHIELD
  set allskills[125] = FROSTARROWS
  set allskills[126] = TORNADO
  set allskills[127] = MANASHIELD
  set allskills[128] = FORKLIGHTNING
  set allskills[129] = FORKLIGHTNING
  set allskills[130] = FORKLIGHTNING

  set allskills[131] = FORKLIGHTNING
  set allskills[132] = MANASHIELD
  set allskills[133] = FORKLIGHTNING
  set allskills[134] = MANASHIELD
  set allskills[135] = FORKLIGHTNING
  set allskills[136] = TORNADO
  set allskills[137] = MANASHIELD
  set allskills[138] = FROSTARROWS
  set allskills[139] = FROSTARROWS
  set allskills[140] = FROSTARROWS

  set allskills[141] = FORKLIGHTNING
  set allskills[142] = MANASHIELD
  set allskills[143] = FORKLIGHTNING
  set allskills[144] = MANASHIELD
  set allskills[145] = FORKLIGHTNING
  set allskills[146] = TORNADO
  set allskills[147] = MANASHIELD
  set allskills[148] = FROSTARROWS
  set allskills[149] = FROSTARROWS
  set allskills[150] = FROSTARROWS

  set allskills[151] = BEAR
  set allskills[152] = HAWK
  set allskills[153] = HAWK
  set allskills[154] = BEAR
  set allskills[155] = HAWK
  set allskills[156] = STAMPEDE
  set allskills[157] = BEAR
  set allskills[158] = QUILBEAST
  set allskills[159] = QUILBEAST
  set allskills[160] = QUILBEAST

  set allskills[161] = BEAR
  set allskills[162] = HAWK
  set allskills[163] = BEAR
  set allskills[164] = HAWK
  set allskills[165] = BEAR
  set allskills[166] = STAMPEDE
  set allskills[167] = HAWK
  set allskills[168] = QUILBEAST
  set allskills[169] = QUILBEAST
  set allskills[170] = QUILBEAST

  set allskills[171] = BEAR
  set allskills[172] = QUILBEAST
  set allskills[173] = BEAR
  set allskills[174] = QUILBEAST
  set allskills[175] = BEAR
  set allskills[176] = STAMPEDE
  set allskills[177] = QUILBEAST
  set allskills[178] = HAWK
  set allskills[179] = HAWK
  set allskills[180] = HAWK

  set allskills[181] = DRAIN
  set allskills[182] = BLACKARROW
  set allskills[183] = DRAIN
  set allskills[184] = BLACKARROW
  set allskills[185] = DRAIN
  set allskills[186] = CHARM
  set allskills[187] = BLACKARROW
  set allskills[188] = SILENCE
  set allskills[189] = SILENCE
  set allskills[190] = SILENCE

  set allskills[191] = BLACKARROW
  set allskills[192] = SILENCE
  set allskills[193] = BLACKARROW
  set allskills[194] = SILENCE
  set allskills[195] = BLACKARROW
  set allskills[196] = CHARM
  set allskills[197] = SILENCE
  set allskills[198] = DRAIN
  set allskills[199] = DRAIN
  set allskills[200] = DRAIN

  set allskills[201] = SILENCE
  set allskills[202] = DRAIN
  set allskills[203] = SILENCE
  set allskills[204] = DRAIN
  set allskills[205] = SILENCE
  set allskills[206] = CHARM
  set allskills[207] = DRAIN
  set allskills[208] = BLACKARROW
  set allskills[209] = BLACKARROW
  set allskills[210] = BLACKARROW

  set allskills[211] = RAINOFFIRE
  set allskills[212] = CLEAVING
  set allskills[213] = RAINOFFIRE
  set allskills[214] = CLEAVING
  set allskills[215] = RAINOFFIRE
  set allskills[216] = DOOM
  set allskills[217] = CLEAVING
  set allskills[218] = HOWL
  set allskills[219] = HOWL
  set allskills[220] = HOWL

  set allskills[221] = HOWL
  set allskills[222] = CLEAVING
  set allskills[223] = HOWL
  set allskills[224] = CLEAVING
  set allskills[225] = HOWL
  set allskills[226] = DOOM
  set allskills[227] = CLEAVING
  set allskills[228] = RAINOFFIRE
  set allskills[229] = RAINOFFIRE
  set allskills[230] = RAINOFFIRE

  set allskills[231] = RAINOFFIRE
  set allskills[232] = CLEAVING
  set allskills[233] = RAINOFFIRE
  set allskills[234] = CLEAVING
  set allskills[235] = RAINOFFIRE
  set allskills[236] = DOOM
  set allskills[237] = CLEAVING
  set allskills[238] = HOWL
  set allskills[239] = HOWL
  set allskills[240] = HOWL

  set allskills[241] = BOF
  set allskills[242] = HAZE
  set allskills[243] = BOF
  set allskills[244] = HAZE
  set allskills[245] = BOF
  set allskills[246] = SEF
  set allskills[247] = HAZE
  set allskills[248] = BRAWLER
  set allskills[249] = BRAWLER
  set allskills[250] = BRAWLER

  set allskills[251] = HAZE
  set allskills[252] = BOF
  set allskills[253] = HAZE
  set allskills[254] = BOF
  set allskills[255] = HAZE
  set allskills[256] = SEF
  set allskills[257] = BOF
  set allskills[258] = BRAWLER
  set allskills[259] = BRAWLER
  set allskills[260] = BRAWLER

  set allskills[261] = BOF
  set allskills[262] = HAZE
  set allskills[263] = BOF
  set allskills[264] = HAZE
  set allskills[265] = BOF
  set allskills[266] = SEF
  set allskills[267] = HAZE
  set allskills[268] = BRAWLER
  set allskills[269] = BRAWLER
  set allskills[270] = BRAWLER

  set allskills[271] = ROCKETS
  set allskills[272] = POCKETFACTORY
  set allskills[273] = ROCKETS
  set allskills[274] = POCKETFACTORY
  set allskills[275] = ROCKETS
  set allskills[276] = ROBOGOBLIN
  set allskills[277] = POCKETFACTORY
  set allskills[278] = UPGRADE
  set allskills[279] = UPGRADE
  set allskills[280] = UPGRADE

  set allskills[281] = ROCKETS
  set allskills[282] = UPGRADE
  set allskills[283] = ROCKETS
  set allskills[284] = UPGRADE
  set allskills[285] = ROCKETS
  set allskills[286] = ROBOGOBLIN
  set allskills[287] = UPGRADE
  set allskills[288] = POCKETFACTORY
  set allskills[289] = POCKETFACTORY
  set allskills[290] = POCKETFACTORY

  set allskills[291] = POCKETFACTORY
  set allskills[292] = ROCKETS
  set allskills[293] = POCKETFACTORY
  set allskills[294] = ROCKETS
  set allskills[295] = POCKETFACTORY
  set allskills[296] = ROBOGOBLIN
  set allskills[297] = ROCKETS
  set allskills[298] = UPGRADE
  set allskills[299] = UPGRADE
  set allskills[300] = UPGRADE

endfunction

function GetGold takes nothing returns integer
    return GetPlayerState(ai_player,PLAYER_STATE_RESOURCE_GOLD)
endfunction

function GetWood takes nothing returns integer
    return GetPlayerState(ai_player,PLAYER_STATE_RESOURCE_LUMBER)
endfunction

function GetUnitCountEx takes integer unitid, boolean only_done, integer townid returns integer
    if unitid == 0 then
      return 0
    elseif townid == -1 then
        if only_done then
            return GetUnitCountDone(old_id[unitid])
        else
            return GetUnitCount(old_id[unitid])
        endif
    else
        return GetTownUnitCount(old_id[unitid],townid,only_done)
    endif
endfunction

function TownCountEx takes integer unitid, boolean only_done, integer townid returns integer
    if unitid == WATCH_TOWER then
      return GetUnitCountEx(unitid,only_done,townid) + GetUnitCountEx(tc_add1[unitid],false,townid) + GetUnitCountEx(tc_add2[unitid],false,townid) + GetUnitCountEx(ARCANE_TOWER, false, townid)
    endif
    return GetUnitCountEx(unitid,only_done,townid) + GetUnitCountEx(tc_add1[unitid],false,townid) + GetUnitCountEx(tc_add2[unitid],false,townid)

endfunction

function TownCountDone takes integer base returns integer
    return TownCountEx(base,true,-1)
endfunction

function TownCount takes integer base returns integer
    return TownCountEx(base,false,-1)
endfunction

function TownCountTown takes integer base, integer townid returns integer
    return TownCountEx(base,false,townid)
endfunction

function DistanceBetweenPoints_kk takes location locA, location locB returns real
  return l_length_d(l_sub_kk(locB, locA))
endfunction

function DistanceBetweenPoints_dk takes location locA, location locB returns real
  return l_length_d(l_sub_kd(locB, locA))
endfunction

function DistanceBetweenPoints_kd takes location locA, location locB returns real
  return l_length_d(l_sub_dk(locB, locA))
endfunction

function DistanceBetweenPoints_dd takes location locA, location locB returns real
  return l_length_d(l_sub_dd(locB, locA))
endfunction

function DistanceBetweenUnits takes unit u1, unit u2 returns real
  return DistanceBetweenPoints_dd(GetUnitLoc(u1), GetUnitLoc(u2))
endfunction

function GetLocationBetweenLoc_kk takes location locS, location locT, real d returns location
  return l_add_kd(locS, l_mult_d(l_sub_kk(locT, locS), d))
endfunction

function GetLocationBetweenLoc_dk takes location locS, location locT, real d returns location
  return l_add_dd(locS, l_mult_d(l_sub_kk(locT, locS), d))
endfunction

function GetLocationBetweenLoc_kd takes location locS, location locT, real d returns location
  return l_add_kd(locS, l_mult_d(l_sub_dk(locT, locS), d))
endfunction

function GetLocationBetweenLoc_dd takes location locS, location locT, real d returns location
  return l_add_dd(locS, l_mult_d(l_sub_dk(locT, locS), d))
endfunction

function GetNearestEnemyToLoc_d takes location l returns player
  local integer i = 0
  local real nr = 0
  local real min_nr = 1000000
  local player min_p = null
  loop
    exitwhen i >= 12
    if IsPlayerEnemy(Player(i), ai_player) and GetPlayerSlotState(Player(i)) == PLAYER_SLOT_STATE_PLAYING and not IsPlayerObserver(Player(i)) then
      set nr = DistanceBetweenPoints_dk(GetPlayerStartLocationLoc(Player(i)), l)
      if nr < min_nr then
        set min_nr = nr
        set min_p = Player(i)
      endif
    endif
    set i = i + 1
  endloop
  call RemoveLocation(l)
  return min_p
endfunction

function SetNearestEnemy takes nothing returns nothing
  local integer i = 0
  local real nr = 0
  loop
    exitwhen i >= 12
    if IsPlayerEnemy(Player(i), ai_player) and GetPlayerSlotState(Player(i)) == PLAYER_SLOT_STATE_PLAYING and not IsPlayerObserver(Player(i)) then
      set nr = DistanceBetweenPoints_dk(GetPlayerStartLocationLoc(Player(i)), home_location)
      if nr < nearest_enemy_range then
        set nearest_enemy_range = nr
        set nearest_enemy = Player(i)
      endif
    endif
    set i = i + 1
  endloop
endfunction

function countAllyEnemy takes nothing returns nothing
  local integer i = 0
  local boolean self_came = false
  local boolean next_came = false

  loop
    exitwhen i == 12
    if GetPlayerSlotState(Player(i)) == PLAYER_SLOT_STATE_PLAYING then
      if GetPlayerController(Player(i)) == MAP_CONTROL_COMPUTER then
        set c_ai_total = c_ai_total + 1
      endif
      if IsPlayerAlly(ai_player,Player(i)) then
        if i == GetAiPlayer() then
          set self_came = true
          set next_came = true
          set own_force[force_number] = Player(i)
          set force_number = force_number + 1
        else
          if GetPlayerController(Player(i)) == MAP_CONTROL_COMPUTER then
          	set own_force[force_number] = Player(i)
          	set force_number = force_number + 1
          	if not self_came then
          	  set first_ai = false
          	elseif next_came then
          	  set next_ai = i
          	  set next_came = false
          	endif
          else
          	set no_ally_ctrl = false
          endif
          if GetPlayerRace(Player(i)) == RACE_HUMAN then
            set c_ally_humans = c_ally_humans + 1
          elseif GetPlayerRace(Player(i)) == RACE_ORC then
            set c_ally_orcs = c_ally_orcs + 1
          elseif GetPlayerRace(Player(i)) == RACE_NIGHTELF then
            set c_ally_elves = c_ally_elves + 1
          else
            set c_ally_undead = c_ally_undead + 1
          endif
        endif
      elseif IsPlayerEnemy(ai_player,Player(i)) and not IsPlayerObserver(Player(i)) then
        if IsPlayerRacePrefSet(Player(i),RACE_PREF_HUMAN) then
          set c_enemy_humans = c_enemy_humans + 1
        elseif IsPlayerRacePrefSet(Player(i),RACE_PREF_ORC) then
          set c_enemy_orcs = c_enemy_orcs + 1
        elseif IsPlayerRacePrefSet(Player(i),RACE_PREF_NIGHTELF) then
          set c_enemy_elves = c_enemy_elves + 1
        elseif IsPlayerRacePrefSet(Player(i),RACE_PREF_UNDEAD) then
          set c_enemy_undead = c_enemy_undead + 1
        else
          set c_enemy_random = c_enemy_random + 1
        endif
      endif
    endif
    set i = i + 1
  endloop
  set c_ally_total = c_ally_humans + c_ally_orcs + c_ally_elves + c_ally_undead
  set c_enemy_total = c_enemy_humans + c_enemy_orcs + c_enemy_elves + c_enemy_undead + c_enemy_random
  set no_ai_ally = first_ai and next_ai == 0

endfunction

function countEnemyReal takes nothing returns nothing
  local integer i = 0

  set c_enemy_humans = 0
  set c_enemy_orcs = 0
  set c_enemy_elves = 0
  set c_enemy_undead = 0
  set c_enemy_random = 0

  loop
    exitwhen i == 12
    if GetPlayerSlotState(Player(i)) == PLAYER_SLOT_STATE_PLAYING then
	if IsPlayerEnemy(ai_player,Player(i)) and not IsPlayerObserver(Player(i)) then
	  if GetPlayerRace(Player(i)) == RACE_HUMAN then
	    set c_enemy_humans = c_enemy_humans + 1
	  elseif GetPlayerRace(Player(i)) == RACE_ORC then
	    set c_enemy_orcs = c_enemy_orcs + 1
	  elseif GetPlayerRace(Player(i)) == RACE_NIGHTELF then
	    set c_enemy_elves = c_enemy_elves + 1
	  else
	    set c_enemy_undead = c_enemy_undead + 1
	  endif
	endif
    endif
    set i = i + 1
  endloop

endfunction

function SelectNumberOfId takes group g, integer n, integer id returns group
     local integer c = 0
     local unit u = null
     local group rg = CreateGroup()
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       exitwhen c == n
       if GetUnitTypeId(u) == id then
          set c = c + 1
          call GroupAddUnit(rg, u ) 
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return rg
endfunction

function SelectById takes group g, integer id, boolean is_id returns group
     local unit u = null
     local group rg = CreateGroup()
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       if (GetUnitTypeId(u) == id) == is_id then
          call GroupAddUnit(rg, u ) 
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return rg
endfunction

function SelectUnittype takes group g, unittype typ, boolean is_of_type returns group
     local unit u = null
     local group rg = CreateGroup()
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       if IsUnitType(u, typ) == is_of_type then
          call GroupAddUnit(rg, u ) 
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return rg
endfunction

function SelectByIllusion takes group g, boolean is_illusion returns group
     local unit u = null
     local group rg = CreateGroup()
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       if IsUnitIllusion(u) == is_illusion then
          call GroupAddUnit(rg, u ) 
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return rg
endfunction

function SelectByLoaded takes group g, boolean is_loaded returns group
     local unit u = null
     local group rg = CreateGroup()
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       if IsUnitLoaded(u) == is_loaded then
          call GroupAddUnit(rg, u ) 
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return rg
endfunction

function SelectByAlive takes group g, boolean is_alive returns group
     local unit u = null
     local group rg = CreateGroup()
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       if UnitAlive(u) == is_alive then
          call GroupAddUnit(rg, u ) 
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return rg
endfunction

function SelectByPlayer takes group g, player p returns group
     local unit u = null
     local group rg = CreateGroup()
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       if GetOwningPlayer(u) == p then
          call GroupAddUnit(rg, u )
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return rg
endfunction

function SelectByUserData takes group g, integer d, boolean has_data returns group
     local unit u = null
     local group rg = CreateGroup()
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       if (GetUnitUserData(u) == d) == has_data then
          call GroupAddUnit(rg, u )
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return rg
endfunction

function SelectByOrder takes group g, integer my_order, boolean has_order returns group
     local unit u = null
     local group rg = CreateGroup()
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       if (GetUnitCurrentOrder(u) == my_order) == has_order then
          call GroupAddUnit(rg, u )
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return rg
endfunction

function SelectByOrderOr takes group g, integer my_order1, integer my_order2, boolean has_order returns group
     local unit u = null
     local group rg = CreateGroup()
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       if ((GetUnitCurrentOrder(u) == my_order1) or (GetUnitCurrentOrder(u) == my_order2)) == has_order then
          call GroupAddUnit(rg, u )
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return rg
endfunction

function SelectByLocation_k takes group g, location l, real dist, boolean is_near returns group
     local unit u = null
     local group rg = CreateGroup()
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       if (DistanceBetweenPoints_dk(GetUnitLoc(u), l) <= dist) == is_near then
          call GroupAddUnit(rg, u )
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return rg
endfunction

function SelectByLocation_d takes group g, location l, real dist, boolean is_near returns group
     local unit u = null
     local group rg = CreateGroup()
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       if (DistanceBetweenPoints_dk(GetUnitLoc(u), l) <= dist) == is_near then
          call GroupAddUnit(rg, u )
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call RemoveLocation(l)
     call DestroyGroup(g)
     return rg
endfunction

function GroupAddGroup_k takes group g, group to_add returns group
     local unit u = null
     loop
       set u = FirstOfGroup(to_add)
       exitwhen u == null
       call GroupAddUnit(g, u )
       call GroupRemoveUnit(to_add, u )
     endloop
     return g
endfunction

function GroupAddGroup_d takes group g, group to_add returns group
     local unit u = null
     loop
       set u = FirstOfGroup(to_add)
       exitwhen u == null
       call GroupAddUnit(g, u )
       call GroupRemoveUnit(to_add, u )
     endloop
     call DestroyGroup(to_add)
     return g
endfunction

function RemoveSentUnits takes group g returns group
  local integer i = 0
  loop
   exitwhen i > 3
   call GroupRemoveUnit(g, neutral_sent[i] )
   set i = i + 1
  endloop
  return SelectById(g, 'nzep', false)
endfunction

function GetAllSiege takes player p returns group
     local unit u = null
     local group g = CreateGroup()
     local group rg = CreateGroup()
     call GroupEnumUnitsOfPlayer(g, p, null)
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null  //todo
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     set g = null
     return rg
endfunction

function GetUnimportantBuildingsOfPlayer takes player p returns group
     local unit u = null
     local group g = CreateGroup()
     local group rg = CreateGroup()
     local integer id = 0
     call GroupEnumUnitsOfPlayer(g, p, null)
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       if IsUnitType(u, UNIT_TYPE_STRUCTURE) then
         set id = GetUnitTypeId(u) //todo
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     set g = null
     return rg
endfunction

function GetOneOfId takes player p, integer id returns unit
     local unit u = null
     local group g = CreateGroup()     
     call GroupEnumUnitsOfPlayer(g, p, null)
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       if GetUnitTypeId(u) == id then
         call DestroyGroup(g)
         set g = null
         return u
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     set g = null
     return null
endfunction

function GetNearestOfGroup_k takes group g, location l returns unit
     local real d = 0
     local unit u = null
     local unit nu = null
     local real sd = 1000000
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       set d = DistanceBetweenPoints_dk(GetUnitLoc(u), l)
       if d < sd then
          set sd = d
          set nu = u
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return nu
endfunction

function GetNearestOfGroup_d takes group g, location l returns unit
     local real d = 0
     local unit u = null
     local unit nu = null
     local real sd = 1000000
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       set d = DistanceBetweenPoints_dk(GetUnitLoc(u), l)
       if d < sd then
          set sd = d
          set nu = u
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call RemoveLocation(l)
     call DestroyGroup(g)
     return nu
endfunction

function GetFarestOfGroup_k takes group g, location l returns unit
     local real d = 0
     local unit u = null
     local unit nu = null
     local real sd = 0
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       set d = DistanceBetweenPoints_dk(GetUnitLoc(u), l)
       if d > sd then
          set sd = d
          set nu = u
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return nu
endfunction

function GetFarestOfGroup_d takes group g, location l returns unit
     local real d = 0
     local unit u = null
     local unit nu = null
     local real sd = 0
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       set d = DistanceBetweenPoints_dk(GetUnitLoc(u), l)
       if d > sd then
          set sd = d
          set nu = u
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call RemoveLocation(l)
     call DestroyGroup(g)
     return nu
endfunction

function GetFastestToPointOfGroup_k takes group g, location l returns unit
     local real d = 0
     local unit u = null
     local unit nu = null
     local real sd = 1000000
     local real ms = 0
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       set ms = GetUnitMoveSpeed(u)
       if ms == 0 then
         set ms = 0.01
       endif
       set d = DistanceBetweenPoints_dk(GetUnitLoc(u), l) / ms
       if d < sd then
          set sd = d
          set nu = u
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return nu
endfunction

function GetFastestToPointOfGroup_d takes group g, location l returns unit
     local real d = 0
     local unit u = null
     local unit nu = null
     local real sd = 1000000
     local real ms = 0
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       set ms = GetUnitMoveSpeed(u)
       if ms == 0 then
         set ms = 0.01
       endif
       set d = DistanceBetweenPoints_dk(GetUnitLoc(u), l) / ms
       if d < sd then
          set sd = d
          set nu = u
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call RemoveLocation(l)
     call DestroyGroup(g)
     return nu
endfunction

function GetLeastHPUnitOfGroup takes group g returns unit
     local real hp = 0
     local unit u = null
     local unit lhpu = null
     local real lhp = 1000000
     loop
       set u = FirstOfGroup(g)
       exitwhen u == null
       set hp = GetUnitState(u, UNIT_STATE_LIFE)
       if hp < lhp then
          set lhp = hp
          set lhpu = u
       endif
       call GroupRemoveUnit(g, u )
     endloop
     call DestroyGroup(g)
     return lhpu
endfunction

function UnitAliveInGroup takes group g returns boolean
  local unit u = null

  loop
    set u = FirstOfGroup(g)
    if u == null then
      call DestroyGroup(g)
      return false
    endif
    if UnitAlive(u) then
      return true
    endif
    call GroupRemoveUnit(g,u)
  endloop
  return true // never reached
endfunction

function GetUnitToBuy takes unit buy_place returns unit
  local group g = CreateGroup()
  local unit u = null
  call GroupEnumUnitsOfPlayer(g, ai_player, null)
  set g = SelectUnittype(g, UNIT_TYPE_STRUCTURE, false)
  set g = SelectUnittype(g, UNIT_TYPE_PEON, false)
  set g = SelectUnittype(g, UNIT_TYPE_HERO, false)
  set g = SelectUnittype(g, UNIT_TYPE_SUMMONED, false)
  set g = SelectByIllusion(g, false)
  set g = RemoveSentUnits(g)
  set u = GetFastestToPointOfGroup_d(g, GetUnitLoc(buy_place))
  if u == null then
    set u = GetExpansionPeon()
  endif
  return u
endfunction

function GetUnitOfTypeNearUnit takes integer ut, unit nu returns unit
  local group g = CreateGroup()
  call GroupEnumUnitsOfPlayer(g, ai_player, null)
  set g = SelectNumberOfId(g, 1000, ut)
  return GetNearestOfGroup_d(g, GetUnitLoc(nu))
endfunction

function GetUnusedZeppelinNearUnit takes unit nu returns unit
  local group g = CreateGroup()
  call GroupEnumUnitsOfType(g, "goblinzeppelin", null)
  set g = SelectByPlayer(g, ai_player)
  set g = SelectByOrderOr(g, 0, order_cancel, true)
  set g = SelectByUserData(g, UNIT_STANDARD, true)
  return GetNearestOfGroup_d(g, GetUnitLoc(nu))
endfunction

function GetHeroNumber takes integer id returns integer
  local integer i = 1
  loop
    exitwhen i > 3
    if id == old_id[hero_id[i]] then
      return i
    endif
    set i = i + 1
  endloop
  return 1
endfunction

function GetHeroNumberOfUnit takes unit u returns integer
  local integer i = 1
  loop
    exitwhen i > 3
    if u == hero_unit[i] then
      return i
    endif
    set i = i + 1
  endloop
  return 1
endfunction

function GetMajorHero takes nothing returns unit
  local integer i = 1
  loop
    exitwhen i > 3
    if hero_built[i] and UnitAlive(hero_unit[i]) and (GetUnitUserData(hero_unit[i]) == UNIT_STANDARD) then
      return hero_unit[i]
    endif
    set i = i + 1
  endloop
  return null
endfunction

function GetMajorHeroReplacement_k takes location l returns unit
  local integer i = 1
  loop
    exitwhen i > 3
    if hero_built[i] and UnitAlive(hero_unit[i]) and IsUnitInRangeLoc(hero_unit[i], l, battle_radius) and (GetUnitUserData(hero_unit[i]) == UNIT_STANDARD) then
      return hero_unit[i]
    endif
    set i = i + 1
  endloop
  return null
endfunction

function GetMajorHeroReplacement_d takes location l returns unit
  local integer i = 1
  loop
    exitwhen i > 3
    if hero_built[i] and UnitAlive(hero_unit[i]) and IsUnitInRangeLoc(hero_unit[i], l, battle_radius) and (GetUnitUserData(hero_unit[i]) == UNIT_STANDARD) then
      return hero_unit[i]
    endif
    set i = i + 1
  endloop
  call RemoveLocation(l)
  return null
endfunction


function GetNeutralNumber takes integer id returns integer
  if id > NEUTRAL_HERO_START and id < HERO_END then
    return NEUTRAL_TAVERN
  elseif id > GOBLIN_MERC_START and id < GOBLIN_MERC_END then
    return NEUTRAL_OBSERVATORY
  elseif id > NEUTRAL_MERC_START and id < NEUTRAL_MERC_END then
    return NEUTRAL_MERC_CAMP
  else
    return NEUTRAL_DRAGON_ROOST
  endif
endfunction

function GetDensities takes location l, player p, real r returns nothing
  local group g = CreateGroup()
  local unit u = null
  local real ur = 0
  local location ul = null
  set enemy_density = 0
  set ally_density = 0
  call MoveLocation(ally_density_loc, 0,0)
  call MoveLocation(enemy_density_loc, 0,0)
  call GroupEnumUnitsInRangeOfLoc(g, l, r, null)
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    if UnitAlive(u) then
      set ul = GetUnitLoc(u)
      set ur = 1 - (DistanceBetweenPoints_kk(ul, l) / r)
      if ur == 1 then
      elseif IsPlayerEnemy(p, GetOwningPlayer(u)) then
        set enemy_density = enemy_density + ur
        set enemy_density_loc = l_add_dd(enemy_density_loc, l_mult_k(ul, ur))
      elseif IsPlayerAlly(p, GetOwningPlayer(u)) then
        set ally_density = ally_density + ur
        set ally_density_loc = l_add_dd(ally_density_loc, l_mult_k(ul, ur))
      endif
      call RemoveLocation(ul)
    endif
    call GroupRemoveUnit(g, u)
  endloop
  if ally_density > 0 then
    set ally_density_loc = l_div_d(ally_density_loc, ally_density)
  else
    call MoveLocation(ally_density_loc, 0,0)
  endif
  if enemy_density > 0 then
    set enemy_density_loc = l_div_d(enemy_density_loc, enemy_density)
  else
    call MoveLocation(enemy_density_loc, 0,0)
  endif
  call DestroyGroup(g)
  set ul = null
  set g = null
  set u = null
endfunction

function ActionListInit takes integer an returns nothing
  local integer i = 0
  set action_numbers = an
  loop
    exitwhen i >= an
    set action_points[i] = 0.0
    set i = i + 1
  endloop
endfunction

function ActionRule takes boolean b, integer chn, real cha returns nothing
  if b then
    set action_points[chn] = action_points[chn] + cha
  endif
endfunction

function ActionRule2 takes boolean b, integer chn, real cha, integer chn2, real cha2 returns nothing
  if b then
    set action_points[chn] = action_points[chn] + cha
    set action_points[chn2] = action_points[chn2] + cha2
  endif
endfunction

function ActionRule3 takes boolean b, integer chn, real cha, integer chn2, real cha2, integer chn3, real cha3 returns nothing
  if b then
    set action_points[chn] = action_points[chn] + cha
    set action_points[chn2] = action_points[chn2] + cha2
    set action_points[chn3] = action_points[chn3] + cha3
  endif
endfunction

function ActionListEval takes nothing returns integer
  local integer i = 0
  local integer max_i = -1
  local real max_val = -10000000.0
  loop
    exitwhen i >= action_numbers
    if action_points[i] > max_val then
      set max_i = i
      set max_val = action_points[i]
    endif
    set i = i + 1
  endloop
  return max_i
endfunction

function GetPlayerStrengthHandicap takes player p returns real
    return SquareRoot(GetPlayerHandicap(p))
endfunction

function GetPlayerStrength takes player p returns integer
    local integer peon_count = 0
    set peon_count = peon_count + GetPlayerUnitTypeCount(p, oPEASANT)
    set peon_count = peon_count + GetPlayerUnitTypeCount(p, oPEON)
    set peon_count = peon_count + GetPlayerUnitTypeCount(p, oACOLYTE)
    set peon_count = peon_count + GetPlayerUnitTypeCount(p, oWISP)
    return R2I(I2R(GetPlayerState(p, PLAYER_STATE_RESOURCE_FOOD_USED) - peon_count) * GetPlayerStrengthHandicap(p))
endfunction

function GetUnexactPlayerStrength takes player p returns integer
  local integer pid = GetPlayerId(p)
  if p_str_cache_timeout[pid] < ai_time then
    set p_str_cache[pid] = maximum(0, R2I(I2R(GetPlayerStrength(p)) * GetRandomReal(1 - I2R(uncertainty)/50, 1 + I2R(uncertainty)/50)) + GetRandomDiff(uncertainty/5))
    set p_str_cache_timeout[pid] = ai_time + p_str_cache_valid_time
  endif
  return p_str_cache[pid]
endfunction

function GetPlayerAirStrength takes player p returns real
  local real strength = 0
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oCOPTER )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oGRYPHON )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oHUMAN_DRAGON_HAWK )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oWYVERN )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oBATRIDER )
  set strength = strength + 8 * GetPlayerUnitTypeCount(p, oFROST_WYRM )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oGARGOYLE )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oGARGOYLE_MORPH )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oBLK_SPHINX )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oHIPPO )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oHIPPO_RIDER )
  set strength = strength + 5 * GetPlayerUnitTypeCount(p, oCHIMAERA )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oFAERIE_DRAGON )
  return strength
endfunction

function GetPlayerCasterStrength takes player p returns real
  local real strength = 0
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oPRIEST )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oSORCERESS )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oSPELL_BREAKER )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oWITCH_DOCTOR )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oSHAMAN )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oSPIRIT_WALKER )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oSPIRIT_WALKER_M )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oBANSHEE )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oNECRO )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oDRUID_TALON )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oDRUID_TALON_M )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oDRUID_CLAW )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oDRUID_CLAW_M )
  return strength
endfunction

function GetPlayerTowerStrength takes player p returns real
  local real strength = 0
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oCANNON_TOWER )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oGUARD_TOWER )
  set strength = strength + 0.5 * GetPlayerUnitTypeCount(p, oARCANE_TOWER )
  set strength = strength + 0.3 * GetPlayerUnitTypeCount(p, oBURROW )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oORC_WATCH_TOWER )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oNECROPOLIS_2 )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oNECROPOLIS_3 )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oZIGGURAT_2 )
  set strength = strength + 0.5 * GetPlayerUnitTypeCount(p, oZIGGURAT_FROST )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oANCIENT_PROTECT )
  return strength
endfunction

function GetPlayerPiercingStrength takes player p returns real
  local real strength = 0
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oCOPTER )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oRIFLEMAN )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oHUMAN_DRAGON_HAWK )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oHEAD_HUNTER )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oKODO_BEAST )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oWYVERN )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oBERSERKER )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oCRYPT_FIEND )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oGARGOYLE )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oGARGOYLE_MORPH )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oARCHER )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oDRYAD )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oHIPPO_RIDER )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oFAERIE_DRAGON )
  return strength
endfunction

function GetPlayerNormalStrength takes player p returns real
  local real strength = 0
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oFOOTMAN )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oKNIGHT )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oSPELL_BREAKER )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oGRUNT )
  set strength = strength + 5 * GetPlayerUnitTypeCount(p, oTAUREN )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oABOMINATION )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oGHOUL )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oDRUID_CLAW )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oDRUID_CLAW_M )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oHUNTRESS )
  set strength = strength + 7 * GetPlayerUnitTypeCount(p, oMOUNTAIN_GIANT )
  return strength
endfunction

function GetPlayerSiegeStrength takes player p returns real
  local real strength = 0
  set strength = strength + 0.5 * GetPlayerUnitTypeCount(p, oCOPTER )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oMORTAR )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oTANK )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oCATAPULT )
  set strength = strength + 0.5 * GetPlayerUnitTypeCount(p, oRAIDER )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oBATRIDER )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oMEAT_WAGON )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oBALLISTA )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oMOUNTAIN_GIANT )
  return strength
endfunction

function GetPlayerMagicStrength takes player p returns real
  local real strength = 0
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oGRYPHON )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oPRIEST )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oSORCERESS )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oWITCH_DOCTOR )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oSHAMAN )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oSPIRIT_WALKER )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oSPIRIT_WALKER_M )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oBANSHEE )
  set strength = strength + 6 * GetPlayerUnitTypeCount(p, oFROST_WYRM )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oNECRO )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oOBSIDIAN_STATUE )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oBLK_SPHINX )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oDRUID_TALON )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oDRUID_TALON_M )
  set strength = strength + 5 * GetPlayerUnitTypeCount(p, oCHIMAERA )
  return strength
endfunction

function GetPlayerUnarmoredStrength takes player p returns real
  local real strength = 0
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oPRIEST )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oSORCERESS )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oWITCH_DOCTOR )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oKODO_BEAST )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oSHAMAN )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oSPIRIT_WALKER )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oSPIRIT_WALKER_M )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oBANSHEE )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oGARGOYLE )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oGARGOYLE_MORPH )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oNECRO )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oDRUID_TALON )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oDRUID_TALON_M )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oDRYAD )
  set strength = strength + 1 * GetPlayerUnitTypeCount(p, oHIPPO )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oHUNTRESS )
  return strength
endfunction

function GetPlayerLightArmorStrength takes player p returns real
  local real strength = 0
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oGRYPHON )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oHUMAN_DRAGON_HAWK )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oWYVERN )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oBATRIDER )
  set strength = strength + 7 * GetPlayerUnitTypeCount(p, oFROST_WYRM )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oBLK_SPHINX )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oHIPPO_RIDER )
  set strength = strength + 5 * GetPlayerUnitTypeCount(p, oCHIMAERA )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oFAERIE_DRAGON )
  return strength
endfunction

function GetPlayerMediumArmorStrength takes player p returns real
  local real strength = 0
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oRIFLEMAN )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oSPELL_BREAKER )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oHEAD_HUNTER )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oRAIDER )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oBERSERKER )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oCRYPT_FIEND )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oARCHER )
  set strength = strength + 7 * GetPlayerUnitTypeCount(p, oMOUNTAIN_GIANT )
  return strength
endfunction

function GetPlayerHeavyArmorStrength takes player p returns real
  local real strength = 0
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oFOOTMAN )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oKNIGHT )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oMORTAR )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oCATAPULT )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oGRUNT )
  set strength = strength + 5 * GetPlayerUnitTypeCount(p, oTAUREN )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oABOMINATION )
  set strength = strength + 2 * GetPlayerUnitTypeCount(p, oGHOUL )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oMEAT_WAGON )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oOBSIDIAN_STATUE )
  set strength = strength + 3 * GetPlayerUnitTypeCount(p, oBALLISTA )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oDRUID_CLAW )
  set strength = strength + 4 * GetPlayerUnitTypeCount(p, oDRUID_CLAW_M )
  return strength
endfunction

function GetUnitStrengthEx takes unit u returns integer
  local integer f = GetUnitLevel(u)
  if GetOwningPlayer(u) != Player(PLAYER_NEUTRAL_AGGRESSIVE) then
    return GetUnitFoodUsed(u)
  elseif f >= creep_strength_length then
    return creep_strength[creep_strength_length - 1]
  else
    return creep_strength[f]
  endif
endfunction

function GetUnitStrength takes unit u returns real
  return I2R(GetUnitStrengthEx(u)) * GetPlayerStrengthHandicap(GetOwningPlayer(u)) * (GetUnitState(u, UNIT_STATE_LIFE) / GetUnitState(u, UNIT_STATE_MAX_LIFE))
endfunction

function GetLocationCreepStrength takes real x, real y, real radius returns integer
  local group g = CreateGroup()
  local real sum = 0
  local unit u = null
  local real airsum = 0
  set no_sleep = false
  call GroupEnumUnitsInRange(g,x,y,radius,null)
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    if UnitAlive(u) and GetOwningPlayer(u) == Player(PLAYER_NEUTRAL_AGGRESSIVE) then
      set sum = sum + GetUnitStrength(u)
      if IsUnitType(u, UNIT_TYPE_FLYING) then
        set airsum= airsum + GetUnitStrength(u)
      endif
      if not UnitCanSleep(u) then
        set no_sleep = true
      endif
    endif
    call GroupRemoveUnit(g,u)
  endloop
  call DestroyGroup(g)
  set g = null
  set air_strength = R2I(airsum + 0.5)
  return R2I(sum + 0.5)
endfunction

function GetLocationNonCreepStrength takes real x, real y, real radius returns integer
  local group g = CreateGroup()
  local real sum = 0
  local unit u = null
  local real airsum = 0
  call GroupEnumUnitsInRange(g,x,y,radius,null)
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    if UnitAlive(u) and GetOwningPlayer(u) != Player(PLAYER_NEUTRAL_AGGRESSIVE) then
      set sum = sum + GetUnitStrength(u)
      if IsUnitType(u, UNIT_TYPE_FLYING) then
        set airsum= airsum + GetUnitStrength(u)
      endif
    endif
    call GroupRemoveUnit(g,u)
  endloop
  call DestroyGroup(g)
  set g = null
  set air_strength = R2I(airsum + 0.5)
  return R2I(sum + 0.5)
endfunction

function GetExpansionStrength takes nothing returns integer
  return GetLocationCreepStrength(GetUnitX(current_expansion), GetUnitY(current_expansion), expansion_radius)
endfunction

function GetCreepCampStrength takes unit u returns integer
  return GetLocationCreepStrength(GetUnitX(u), GetUnitY(u), creep_camp_radius)
endfunction

function GetOwnStrength takes nothing returns integer
  local real sum = 0
  local group g = CreateGroup()
  local unit u = null
  local integer max_ghouls = attacking_ghouls
  local integer ghoul_num = 0
  local real airsum = 0
  
  call GroupEnumUnitsOfPlayer(g, ai_player, null)
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    if UnitAlive(u) and not IsUnitType(u, UNIT_TYPE_PEON) then
      if GetUnitTypeId(u) == old_id[racial_ghoul] then
        if ghoul_num < max_ghouls then
          set sum = sum + GetUnitStrength(u)
          set ghoul_num = ghoul_num + 1
        endif
      else
        set sum = sum + GetUnitStrength(u)
      endif
      if IsUnitType(u, UNIT_TYPE_ATTACKS_FLYING) then
        set airsum = airsum + GetUnitStrength(u)
      endif
    endif
    call GroupRemoveUnit(g, u)
  endloop
  call DestroyGroup(g)
  set g = null
  set air_strength = R2I(airsum + 0.5)
  return R2I(sum + 0.5)
endfunction

function UpdateStrength takes nothing returns nothing
local integer i = 0
local real air = 0
local real casters = 0
local real piercing = 0
local real heavyarmor = 0
local real lightarmor = 0
local real towers = 0
local real magic = 0
local real unarmored = 0
local real mediumarmor = 0
local real normal = 0
local real siege = 0

loop
  exitwhen i >= 12
  if IsPlayerEnemy(ai_player, Player(i)) then
    set air = air + ((GetPlayerAirStrength(Player(i))) * GetPlayerStrengthHandicap(Player(i)))
    set casters = casters + ((GetPlayerCasterStrength(Player(i))) * GetPlayerStrengthHandicap(Player(i)))
    set piercing = piercing + ((GetPlayerPiercingStrength(Player(i))) * GetPlayerStrengthHandicap(Player(i)))
    set heavyarmor = heavyarmor + ((GetPlayerHeavyArmorStrength(Player(i))) * GetPlayerStrengthHandicap(Player(i)))
    set lightarmor = lightarmor + ((GetPlayerLightArmorStrength(Player(i))) * GetPlayerStrengthHandicap(Player(i)))
    set towers = towers + ((GetPlayerTowerStrength(Player(i))) * GetPlayerStrengthHandicap(Player(i)))
    set magic = magic + ((GetPlayerMagicStrength(Player(i))) * GetPlayerStrengthHandicap(Player(i)))
    set unarmored = unarmored + ((GetPlayerUnarmoredStrength(Player(i))) * GetPlayerStrengthHandicap(Player(i)))
    set mediumarmor = mediumarmor + ((GetPlayerMediumArmorStrength(Player(i))) * GetPlayerStrengthHandicap(Player(i)))
    set normal = normal + ((GetPlayerNormalStrength(Player(i))) * GetPlayerStrengthHandicap(Player(i)))
    set siege = siege + ((GetPlayerSiegeStrength(Player(i))) * GetPlayerStrengthHandicap(Player(i)))
  endif
  set i = i + 1
endloop

set enemy_air = r_maximum(air + GetRandomDiff(area_uncertainty), 0 )
set enemy_casters = r_maximum(casters + GetRandomDiff(area_uncertainty), 0)
set enemy_piercing = r_maximum(piercing + GetRandomDiff(area_uncertainty), 0)
set enemy_heavyarmor = r_maximum(heavyarmor + GetRandomDiff(area_uncertainty) , 0)
set enemy_lightarmor = r_maximum(lightarmor + GetRandomDiff(area_uncertainty), 0)
set enemy_towers = r_maximum(towers + GetRandomDiff(area_uncertainty), 0)
set enemy_magic = r_maximum(magic + GetRandomDiff(area_uncertainty), 0)
set enemy_unarmored = r_maximum(unarmored + GetRandomDiff(area_uncertainty), 0)
set enemy_mediumarmor = r_maximum(mediumarmor + GetRandomDiff(area_uncertainty), 0)
set enemy_normal = r_maximum(normal + GetRandomDiff(area_uncertainty), 0)
set enemy_siege = r_maximum(siege + GetRandomDiff(area_uncertainty), 0)

endfunction

function SheepScan takes nothing returns nothing
  local real x = 0
  local real y = path_bottom + path_dy / 2
  local integer i = 0
  local unit u = CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), 'odoc', 0, 0, 0)
  local real ad = path_dx/8
  local integer j = 0
  call ShowUnit(u, false)
  call UnitAddAbility(u, 'Aeye')
  loop
    exitwhen y > path_top
    set x = path_left + path_dx / 2
    loop
      exitwhen x > path_right
      set path_fieldloc[i] = Location(x,y)
      call SetUnitPositionLoc(u, path_fieldloc[i])
      if (GetUnitX(u) > x + ad) or (GetUnitX(u) < x - ad) or (GetUnitY(u) > y + ad) or (GetUnitY(u) < y - ad) then
        set path_passable[i] = false
      elseif IssuePointOrder(u, "evileye", x, y) then
        call SetUnitState(u, UNIT_STATE_MANA, 150)
        set path_passable[i] = true
      else
        set path_passable[i] = false
      endif
      set x = x + path_dx
      set i = i + 1
    endloop
    set y = y + path_dy
  endloop
  call RemoveUnit(u)
endfunction

function PQCopy takes integer spos, integer tpos returns nothing
  set path_pq_key[tpos] = path_pq_key[spos]
  set path_pq_id[tpos] = path_pq_id[spos]
  set path_pq_pos[path_pq_id[spos]] = tpos
endfunction

function PQExchange takes integer pos1, integer pos2 returns nothing
  call PQCopy(pos2, path_pq_length+1)
  call PQCopy(pos1, pos2)
  call PQCopy(path_pq_length+1, pos1)
endfunction

function PQUpHeap takes integer posi returns nothing
  local integer pos = posi
  loop
    exitwhen path_pq_key[pos] >= path_pq_key[pos/2]
    call PQExchange(pos, pos/2)
    set pos = pos/2
  endloop
endfunction

function PQFillPos takes integer posi returns integer
  local integer pos = posi
  local integer lpos = 0
  local integer rpos = 0
  loop
    set lpos = 2*pos
    set rpos = 2*pos + 1
    if lpos > path_pq_length then
      return pos
    elseif rpos > path_pq_length then
      call PQCopy(lpos, pos)
      return lpos
    elseif path_pq_key[lpos] <= path_pq_key[rpos] then
      call PQCopy(lpos, pos)
      set pos = lpos
    else
      call PQCopy(rpos, pos)
      set pos = rpos
    endif
  endloop
  return 0
endfunction

function PQDeleteMin takes nothing returns integer
  local integer pos = 0
  local integer id = path_pq_id[1]
  set pos = PQFillPos(1)
  set path_pq_length = path_pq_length - 1
  if pos <= path_pq_length then
    call PQCopy(path_pq_length + 1, pos)
    call PQUpHeap(pos)
  endif
  return id
endfunction

function PQInsert takes integer id, integer key returns nothing
  set path_pq_length = path_pq_length + 1
  set path_pq_key[path_pq_length] = key
  set path_pq_id[path_pq_length] = id
  call PQUpHeap(path_pq_length)
endfunction

function PQDecreaseKey takes integer id, integer key returns nothing
  local integer pos = path_pq_pos[id]
  set path_pq_key[pos] = key
  call PQUpHeap(pos)
endfunction

function PQInit takes nothing returns nothing
  set path_pq_key[0] = -1
  set path_pq_length = 0
endfunction

function InitPathArrays takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i >= path_grid_number * path_grid_number
    set path_open[i] = false
    set path_closed[i] = false
    set i = i + 1
  endloop
endfunction

function GetEstCost takes integer start, integer goal returns integer
  local integer sj = start / path_grid_number
  local integer si = start - sj * path_grid_number
  local integer gj = goal / path_grid_number
  local integer gi = goal - gj * path_grid_number
  return 2 * R2I(SquareRoot(I2R((gi-si)*(gi-si)+(gj-sj)*(gj-sj))))
endfunction

function Path takes integer start, integer goal returns boolean
  local integer current = 0
  local integer array next
  local integer nx = 0
  local integer nxcost = 0
  local integer i = 0
  local boolean open = false
  local integer est_cost = 0
  local integer p_limit = pathing_limit
  call InitPathArrays()
  call PQInit()
  call PQInsert(start, 0)
  set path_open[start] = true
  set path_cost[start] = 0
  loop
    exitwhen path_pq_length <= 0
    exitwhen p_limit <= 0
    set p_limit = p_limit - 1
    set current = PQDeleteMin()
    if current == goal then
      return true
    endif
    set path_closed[current] = true
    set next[0] = current + 1
    set next[1] = current - 1
    set next[2] = current + path_grid_number
    set next[3] = current - path_grid_number
    set next[4] = current + path_grid_number + 1
    set next[5] = current - path_grid_number + 1
    set next[6] = current + path_grid_number - 1
    set next[7] = current - path_grid_number - 1
    set nxcost = path_cost[current] + 1
    set i = 0
    loop
      exitwhen i > 7
      set nx = next[i]
      if nx >= 0 and nx < path_grid_number*path_grid_number then
        if path_passable[nx] then
          set open = path_open[nx]
          if (not (open or path_closed[nx])) or path_cost[nx] > nxcost then
            set path_closed[nx] = false
            set path_open[nx] = true
            set path_from[nx] = current
            set path_cost[nx] = nxcost
            set est_cost = nxcost + GetEstCost(nx, goal)
            if open then
              call PQDecreaseKey(nx, est_cost)
            else
              call PQInsert(nx, est_cost)
            endif
          endif
        endif
      endif
      set i = i + 1
    endloop
  endloop
  return false
endfunction

function Djikstra takes integer start returns nothing
  local integer current = 0
  local integer array next
  local integer nx = 0
  local integer nxcost = 0
  local integer i = 0
  local boolean open = false
  local integer est_cost = 0
  call InitPathArrays()
  call PQInit()
  call PQInsert(start, 0)
  set path_open[start] = true
  set path_cost[start] = 0
  loop
    exitwhen path_pq_length <= 0
    set current = PQDeleteMin()
    set path_closed[current] = true
    set next[0] = current + 1
    set next[1] = current - 1
    set next[2] = current + path_grid_number
    set next[3] = current - path_grid_number
    set nxcost = path_cost[current] + 1
    set i = 0
    loop
      exitwhen i > 3
      set nx = next[i]
      if nx >= 0 and nx < path_grid_number*path_grid_number then
        if path_passable[nx] then
          set open = path_open[nx]
          if (not (open or path_closed[nx])) or path_cost[nx] > nxcost then
            set path_closed[nx] = false
            set path_open[nx] = true
            set path_from[nx] = current
            set path_cost[nx] = nxcost
            if open then
              call PQDecreaseKey(nx, nxcost)
            else
              call PQInsert(nx, nxcost)
            endif
          endif
        endif
      endif
      set i = i + 1
    endloop
  endloop
endfunction

function SheepPath takes integer start, integer goal returns nothing
  local integer i = goal
  local unit u = null
  loop
    set u = CreateUnitAtLoc(Player(PLAYER_NEUTRAL_PASSIVE), 'nshe', path_fieldloc[i], 0)
    call PauseUnit(u, true)
    exitwhen i == start
    set i = path_from[i]
  endloop
endfunction

function GetGridX takes real x returns integer
  return R2I(((x - path_left) / (path_right - path_left)) * I2R(path_grid_number + 2))
endfunction

function GetGridY takes real y returns integer
  return R2I(((y - path_bottom) / (path_top - path_bottom)) * I2R(path_grid_number))
endfunction

function GetGridField_k takes location l returns integer
  return GetGridY(GetLocationY(l)) * path_grid_number + GetGridX(GetLocationX(l))
endfunction

function GetGridField_d takes location l returns integer
  local integer ret = GetGridY(GetLocationY(l)) * path_grid_number + GetGridX(GetLocationX(l))
  call RemoveLocation(l)
  return ret
endfunction

function SheepConsidered takes nothing returns nothing
  local integer i = 0
  local unit u = null
  loop
    exitwhen i >= path_grid_number * path_grid_number
    if path_open[i] or path_closed[i] then
      set u = CreateUnitAtLoc(Player(PLAYER_NEUTRAL_PASSIVE), 'nshe', path_fieldloc[i], 0)
      call PauseUnit(u, true)
    endif
    set i = i + 1
  endloop
endfunction

function GetPassableNearby takes integer start, integer limit returns integer
  local integer j = start / path_grid_number
  local integer i = start - j * path_grid_number
  local integer dir = 0
  local boolean dir_number_change = false
  local integer dir_number = 1
  local integer dn = 0
  local integer dist = 1
  local boolean border_crossed = false
  loop
    if not border_crossed then
      exitwhen path_passable[i + j * path_grid_number]
    endif
    if dir == 0 then
      set i = i + 1
    elseif dir == 1 then
      set j = j - 1
    elseif dir == 2 then
      set i = i - 1
    else
      set j = j + 1
    endif
    if i >= path_grid_number or j >= path_grid_number or i < 0 or j < 0 then
      set border_crossed = true
    else
      set border_crossed = false
    endif
    set dn = dn + 1
    if dn >= dir_number then
      set dn = 0
      if dir_number_change then
        set dir_number = dir_number + 1
        set dir_number_change = false
      else
        set dir_number_change = true
      endif
      set dir = dir + 1
      if dir >= 4 then
        set dir = 0
        set dist = dist + 1
        if dist > limit then
          return -1
        endif
      endif
    endif
  endloop
  return i + j * path_grid_number
endfunction

function GetReachableNearby takes integer start, integer limit returns integer
  local integer j = start / path_grid_number
  local integer i = start - j * path_grid_number
  local integer dir = 0
  local boolean dir_number_change = false
  local integer dir_number = 1
  local integer dn = 0
  local integer dist = 1
  local boolean border_crossed = false
  loop
    if not border_crossed then
      exitwhen path_closed[i + j * path_grid_number]
    endif
    if dir == 0 then
      set i = i + 1
    elseif dir == 1 then
      set j = j - 1
    elseif dir == 2 then
      set i = i - 1
    else
      set j = j + 1
    endif
    if i >= path_grid_number or j >= path_grid_number or i < 0 or j < 0 then
      set border_crossed = true
    else
      set border_crossed = false
    endif
    set dn = dn + 1
    if dn >= dir_number then
      set dn = 0
      if dir_number_change then
        set dir_number = dir_number + 1
        set dir_number_change = false
      else
        set dir_number_change = true
      endif
      set dir = dir + 1
      if dir >= 4 then
        set dir = 0
        set dist = dist + 1
        if dist > limit then
          return -1
        endif
      endif
    endif
  endloop
  return i + j * path_grid_number
endfunction

function AddExpansion takes unit u, integer d returns nothing
  set expansion_list[expansion_list_length] = u
  set expansion_dist[expansion_list_length] = d
  set expansion_list_length = expansion_list_length + 1
endfunction

function AddWaterExpansion takes unit u returns nothing
  set water_expansion_list[water_expansion_list_length] = u
  set water_expansion_list_length = water_expansion_list_length + 1
endfunction

function MakeExpansionList takes nothing returns nothing
  local group g = CreateGroup()
  local unit u = null
  local integer pn = 0
  call GroupEnumUnitsOfType(g, "goldmine", null)
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    set pn = GetReachableNearby(GetGridField_d(GetUnitLoc(u)), 3)
    if pn != -1 and path_closed[pn] then
      call AddExpansion(u, path_cost[pn])
    endif
    call GroupRemoveUnit(g, u)
  endloop
  call DestroyGroup(g)
  set g = null
endfunction

function make_exp_rp_positive takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i >= exp_number
    if exp_rp[i] < 0 then
      set exp_rp[i] = 0
    endif
    set i = i + 1
  endloop
endfunction

function sum_exp_rp takes nothing returns integer
  local integer i = 0
  local integer sum = 0
  loop
    exitwhen i >= exp_number
    set sum = sum + exp_rp[i]
    set i = i + 1
  endloop
  return sum
endfunction

function ChooseExp takes nothing returns integer
  local integer i = 0
  local integer sum = 0
  local integer exp_roll = GetRandomInt(1,sum_exp_rp())
  loop
    set sum = sum + exp_rp[i]
    if exp_roll <= sum then
      return i
    endif
    set i = i + 1
  endloop
  return 0
endfunction

function remove_exp takes integer h returns nothing
  local integer i = h
  set exp_number = exp_number - 1
  loop
    exitwhen i  >= exp_number
    set exp_rp[i] = exp_rp[i + 1]
    set exp_unit[i] = exp_unit[i + 1]
    set exp_dist[i] = exp_dist[i + 1]
    set i = i + 1
  endloop
endfunction

function add_exp takes unit u, integer dist returns nothing
  set exp_unit[exp_number] = u
  set exp_dist[exp_number] = dist
  set exp_number = exp_number + 1
endfunction

function MinRangeToEnemy_k takes location l returns real
  local integer i = 0
  local real d = 0
  local real min_d = 1000000
  loop
    exitwhen i >= 12
    if GetPlayerSlotState(Player(i)) == PLAYER_SLOT_STATE_PLAYING and IsPlayerEnemy(Player(i), ai_player) then
      set d = DistanceBetweenPoints_kd(l, GetPlayerStartLocationLoc(Player(i)))
      if d < min_d then
        set min_d = d
      endif
    endif
    set i = i + 1
  endloop
  return min_d
endfunction

function MinRangeToEnemy_d takes location l returns real
  local integer i = 0
  local real d = 0
  local real min_d = 1000000
  loop
    exitwhen i >= 12
    if GetPlayerSlotState(Player(i)) == PLAYER_SLOT_STATE_PLAYING and IsPlayerEnemy(Player(i), ai_player) then
      set d = DistanceBetweenPoints_kd(l, GetPlayerStartLocationLoc(Player(i)))
      if d < min_d then
        set min_d = d
      endif
    endif
    set i = i + 1
  endloop
  call RemoveLocation(l)
  return min_d
endfunction

function WayMinRangeToEnemy_k takes location l returns real
  local integer i = GetReachableNearby(GetGridField_k(l), 5)
  local integer h = home_field
  local real m = 10000000
  loop
    set m = r_minimum(MinRangeToEnemy_k(path_fieldloc[i]), m)
    exitwhen i == h
    set i = path_from[i]
    exitwhen i == h
    set i = path_from[i]
    exitwhen i == h
    set i = path_from[i]
  endloop
  return m
endfunction

function WayMinRangeToEnemy_d takes location l returns real
  local integer i = GetReachableNearby(GetGridField_d(l), 5)
  local integer h = home_field
  local real m = 10000000
  loop
    set m = r_minimum(MinRangeToEnemy_k(path_fieldloc[i]), m)
    exitwhen i == h
    set i = path_from[i]
    exitwhen i == h
    set i = path_from[i]
    exitwhen i == h
    set i = path_from[i]
  endloop
  return m
endfunction

function GetRushFactor takes nothing returns integer
  return R2I(MinRangeToEnemy_k(home_location)) + (1000*(GetPlayers() - (c_enemy_total + c_ally_total + 1)))
endfunction

function ExpansionFormula takes integer exp_d, unit exp_u returns integer
  return maximum(20000 - ((exp_d * 250) - 4000) - ((GetLocationCreepStrength(GetUnitX(exp_u), GetUnitY(exp_u), expansion_radius) * 800) - 6000) + R2I((MinRangeToEnemy_d(GetUnitLoc(exp_u)) - 3000) / 3), 1)
endfunction

function add_exp_rp takes nothing returns nothing
  local integer i = 0
  local real way_dist = 0.0
  local integer max = 0
  local integer min = 1000000
  local real sv = 0.7
  local integer red = 0
  loop
    exitwhen i >= exp_number
    set exp_rp[i] = ExpansionFormula(exp_dist[i], exp_unit[i])
    if exp_rp[i] > max then
      set max = exp_rp[i]
    endif
    if exp_rp[i] < min and exp_rp[i] > 1 then
      set min = exp_rp[i]
    endif
    set i = i + 1
  endloop
  if min < 1000000 and max > 0 then
    set red = maximum(R2I(((1 - sv) * max - min) / sv), -min)
    if red < 0 then
      set i = 0
      loop
        exitwhen i >= exp_number
        set exp_rp[i] = maximum(exp_rp[i] + red, 1)
        set i = i + 1
      endloop
    endif
  endif
endfunction

function CheckExpansionTaken takes unit u returns boolean
  local group g = CreateGroup()
  call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 3*expansion_radius/2, null)
  set g = SelectUnittype(g, UNIT_TYPE_STRUCTURE, true)
  call GroupRemoveUnit(g, u)
  if FirstOfGroup(g) == null then
    call DestroyGroup(g)
    set g = null
    return false
  else
    call DestroyGroup(g)
    set g = null
    return true
  endif
endfunction

function ChooseExpansion takes nothing returns nothing
  local integer i = 0
  set exp_number = 0
  set first_expansion_chosen = true
  loop
    exitwhen i >= expansion_list_length
    if not CheckExpansionTaken(expansion_list[i]) then
      call add_exp(expansion_list[i], expansion_dist[i])
    endif
    set i = i + 1
  endloop
  if TownCountDone(neutral_zeppelin) > 0 then
    set i = 0
    loop
      exitwhen i >= water_expansion_list_length
      if not CheckExpansionTaken(water_expansion_list[i]) then
        call add_exp(water_expansion_list[i], 60)
      endif
      set i = i + 1
    endloop
  endif
  call add_exp_rp()
  call make_exp_rp_positive()
  if exp_number == 0 then
    set current_expansion = null
  else
    set current_expansion = exp_unit[ChooseExp()]
  endif
endfunction

function GetExpFoe takes nothing returns unit
  local group g = CreateGroup()
  local unit u = null
  if current_expansion == null then
    return null
  endif
  call GroupEnumUnitsInRange(g, GetUnitX(current_expansion), GetUnitY(current_expansion), expansion_radius, null)
  set g = SelectByPlayer(g, Player(PLAYER_NEUTRAL_AGGRESSIVE))
  set u = FirstOfGroup(g)
  call DestroyGroup(g)
  set g = null
  return u
endfunction

function SetAIArray takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i >= 12
    if GetPlayerSlotState(Player(i)) == PLAYER_SLOT_STATE_PLAYING and GetPlayerController(Player(i)) == MAP_CONTROL_COMPUTER and GetStoredBoolean(com, "IsAMAI", Int2Str(i)) then
      set ai_force[ai_force_length] = i
      set ai_force_length = ai_force_length + 1
    endif
    set i = i + 1
  endloop
endfunction

function SendPathingToAIs takes nothing returns nothing
  local integer i = 0
  local integer j = 0
  local integer sent = 0
  local string sentstr = null
  loop
    exitwhen i >= path_grid_number * path_grid_number
    set j = 0
    loop
      exitwhen not path_passable[i]
      set i = i + 1
      set j = j + 1
      exitwhen i >= path_grid_number * path_grid_number
    endloop
    if j > 0 then
      set sentstr = Int2Str(sent)
      call StoreInteger(com, "PathingEnd", sentstr, i)
      call StoreInteger(com, "PathingLength", sentstr, j)
      set sent = sent + 1
    endif
    set i = i + 1
  endloop
  call StoreInteger(com, "Pathing", "Sent", sent)
  call StoreBoolean(com, "Pathing", "Finished", true)
endfunction

function FillPassable takes integer end, integer length returns nothing
  local integer i = end - 1
  loop
    exitwhen i < end - length
    set path_passable[i] = true
    set i = i - 1
  endloop
endfunction

function ReadPathingInfo takes nothing returns nothing
  local integer sent = GetStoredInteger(com, "Pathing", "Sent")
  local string sentstr = null
  loop
    exitwhen sent <= 0
    set sent = sent - 1
    set sentstr = Int2Str(sent)
    call FillPassable(GetStoredInteger(com, "PathingEnd", sentstr), GetStoredInteger(com, "PathingLength", sentstr))
  endloop
endfunction

function InitPassableArray takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i >= path_grid_number * path_grid_number
    set path_passable[i] = false
    set i = i + 1
  endloop
endfunction

function CheckFastExpansion takes nothing returns nothing
  if GetRandomInt(1,2) == 1 and GetPlayers() > 2 and MinRangeToEnemy_d(GetUnitLoc(current_expansion)) > 7000 and MinRangeToEnemy_k(home_location) > 7000 and GetExpansionStrength() <= 0 then
    set exp_time_count = -exp_first_time
  endif
endfunction

function PathingThread takes nothing returns nothing
  call InitPassableArray()
  call Sleep(20)
  call SetAIArray()
  call Sleep(1)
  if GetAiPlayer() == ai_force[0] then
    call SheepScan()
    call Sleep(1)
    call SendPathingToAIs()
    call Sleep(1)
  else
    loop
      exitwhen GetStoredBoolean(com, "Pathing", "Finished")
      call Sleep(3)
    endloop
    call ReadPathingInfo()
  endif
  set home_field = GetPassableNearby(GetGridField_k(home_location), 20)
  call Djikstra(home_field)
  call MakeExpansionList()
  set water_map = water_expansion_list_length >= expansion_list_length
  call ChooseExpansion()
  call CheckFastExpansion()
endfunction

function GetPlayerGold takes player p returns integer
    return GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)
endfunction

function GetPlayerWood takes player p returns integer
    return GetPlayerState(p,PLAYER_STATE_RESOURCE_LUMBER)
endfunction

function SetPlayerGold takes player p, integer i returns nothing
    call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,i)
endfunction

function SetPlayerWood takes player p, integer i returns nothing
    call SetPlayerState(p,PLAYER_STATE_RESOURCE_LUMBER,i)
endfunction

function IncreasePlayerGold takes player p, integer i returns nothing
    call SetPlayerGold(p, GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD) + i)
endfunction

function IncreasePlayerWood takes player p, integer i returns nothing
    call SetPlayerWood(p, GetPlayerState(p,PLAYER_STATE_RESOURCE_LUMBER) + i)
endfunction

function DistributeGold takes integer value returns nothing
    local integer amount = value
    local integer p_amount = value / force_number
    local integer i = 0
    loop
      exitwhen i == force_number
      call IncreasePlayerGold(own_force[i], p_amount)
      set amount = amount - p_amount
      set i = i + 1
    endloop
    call IncreasePlayerGold(ai_player,amount)    
endfunction

function DistributeWood takes integer value returns nothing
    local integer amount = value
    local integer p_amount = value / force_number
    local integer i = 0
    loop
      exitwhen i == force_number
      call IncreasePlayerWood(own_force[i], p_amount)
      set amount = amount - p_amount
      set i = i + 1
    endloop
    call IncreasePlayerWood(ai_player,amount)    
endfunction

function ExchangeOnce takes nothing returns nothing
    local integer amount = 0
    if force_number == 0 then
      return
    endif
    set amount = GetPlayerGold(ai_player)
    if  amount > gold_exchange_level then
      call IncreasePlayerGold(ai_player, - (amount - gold_exchange_level))
      call DistributeGold(amount - gold_exchange_level)
    endif
    set amount = GetPlayerWood(ai_player)
    if  amount > wood_exchange_level then
      call IncreasePlayerWood(ai_player, - (amount - wood_exchange_level))
      call DistributeWood(amount - wood_exchange_level)
    endif
endfunction

function FoodUsed takes nothing returns integer
    return GetPlayerState(ai_player,PLAYER_STATE_RESOURCE_FOOD_USED)
endfunction

function FoodProduced takes nothing returns integer
    return GetPlayerState(ai_player,PLAYER_STATE_RESOURCE_FOOD_CAP)
endfunction

function set_aggression takes nothing returns nothing
    if FoodUsed() >= 88 then
         set added_aggression = 20
    elseif FoodUsed() >= 80 then
         set added_aggression = 12
    elseif FoodUsed() >= 70 then
         set added_aggression = 10
    elseif FoodUsed() >= 60 then
         set added_aggression = 8
    elseif FoodUsed() >= 50 then
         set added_aggression = 7
    elseif FoodUsed() >= 40 then
         set added_aggression = 6
    elseif FoodUsed() >= 30 then
         set added_aggression = 5
    elseif FoodUsed() >= 20 then
         set added_aggression = 2
    else
         set added_aggression = 0
    endif

    if GetUnitCountDone(old_id[hero_id[1]]) == 0 then
      set added_aggression = added_aggression - 10
    endif
endfunction

function expansion_distance takes nothing returns real
     return DistanceBetweenPoints_dd(GetPlayerStartLocationLoc(ai_player),GetUnitLoc(current_expansion))
endfunction

function RemoveFromOwnForce takes player p returns nothing
  local integer i = 0
  loop
    if i >= force_number then
      return
    endif
    exitwhen own_force[i] == p
    set i = i + 1
  endloop
  set force_number = force_number - 1
  loop
    exitwhen i >= force_number
    set own_force[i] = own_force[i+1]
    set i = i + 1
  endloop
endfunction

function KillYourself takes boolean end_ai returns nothing
    local group g = null
    local unit u = null
    local integer i = 0
    if not player_defeated then
      call chat(C_GG)
      call Sleep(3)
      set g = CreateGroup()
      call GroupEnumUnitsOfPlayer(g, ai_player, null)
      loop
        set u = FirstOfGroup(g)
        exitwhen u == null
        call KillUnit(u)
        call GroupRemoveUnit(g, u )
      endloop
      call DestroyGroup(g)
      set g = null
      if not no_ai_ally then
        set wood_exchange_level = 0
        set gold_exchange_level = 0
        call RemoveFromOwnForce(ai_player)
        call ExchangeOnce()
      endif
      set player_defeated = true
    endif
    if end_ai then
      call PauseCompAI(ai_player,true)
    endif
endfunction

function Defeated takes nothing returns nothing
    if c_ally_total > 1 then
      call chat(C_GOLDPROBLEM)
      call Sleep(10)
      if GetGold() >= gold_problem_level then
          call chat(C_THANKS)
          return
      endif
    endif
    call KillYourself(no_ai_ally)
endfunction

function CheckDefeated takes nothing returns nothing
  local integer hall_count = TownCount(racial_hall)
  local integer hall_cost = GetUnitGoldCost(old_id[racial_hall])
  local integer expa_cost = GetUnitGoldCost(old_id[racial_expansion])
  local integer expa_count = TownCount(racial_expansion)
  local integer expa_done_count = TownCountDone(racial_expansion)
  local integer mines = GetMinesOwned()
  if (FoodUsed() == 0 and hall_count == 0) then
    call KillYourself(no_ai_ally)
  endif
  if GetPlayerStrength(ai_player) == 0 and hall_count == 0 and GetGold() < hall_cost then
    set gold_problem_level = hall_cost
    call Defeated()
  endif
  if (GetPlayerStrength(ai_player) == 0 and mines == 0 and GetGold() < expa_cost and expa_count - expa_done_count == 0 and no_ai_ally) then
    set gold_problem_level = expa_cost
    call Defeated()
  endif
endfunction

function SumForceState takes playerstate ps returns integer
  local integer i = 0
  local integer sum = 0
  loop
    exitwhen i >= force_number
    set sum = sum + GetPlayerState(own_force[i],ps)
    set i = i + 1
  endloop
  return sum
endfunction

function SumForceFood takes nothing returns integer
  return SumForceState(PLAYER_STATE_RESOURCE_FOOD_USED)
endfunction

function SumForceGold takes nothing returns integer
  return SumForceState(PLAYER_STATE_RESOURCE_GOLD)
endfunction

function CheckDefeatedForce takes nothing returns nothing
  if SumForceFood() == 0 and SumForceGold() <= 100 then
    call KillYourself(true)
  endif
endfunction

function GetOtherExpansionNearby takes real tx, real ty returns unit
  local group g = CreateGroup()
  local unit u = null
  local integer id = 0
  call GroupEnumUnitsInRange(g, tx, ty, 1500, null)
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    set id = GetUnitTypeId(u)
    if not (GetOwningPlayer(u) == ai_player) then //todo
      if IsUnitType(u, UNIT_TYPE_TOWNHALL) then//id == oTOWN_HALL or id == oKEEP or id == oCASTLE or id == oUNDEAD_MINE or id == oGREAT_HALL or id == oSTRONGHOLD or id == oFORTRESS or id == oTREE_LIFE or id == oTREE_AGES or id == oTREE_ETERNITY then
        call DestroyGroup(g)
        set g = null
        return u
      elseif IsPlayerEnemy(GetOwningPlayer(u), ai_player) and IsUnitType(u, UNIT_TYPE_STRUCTURE) then
        set nearby_enemy_building = u
      endif
    endif
    call GroupRemoveUnit(g,u)
  endloop
  call DestroyGroup(g)
  set g = null
  return null
endfunction

function CheckDoubleExpansion takes nothing returns nothing
  local group g = CreateGroup()
  local unit v = null
  local unit u = null
  local player p = null
  call GroupEnumUnitsOfPlayer(g, ai_player, null)
  set g = SelectNumberOfId(g, 100, old_id[racial_expansion])
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    set v = GetOtherExpansionNearby(GetUnitX(u), GetUnitY(u))
    if v != null then
      set p = GetOwningPlayer(v)
      if IsPlayerEnemy(ai_player, p) then
        call DisplayToAllDebug("Enemy double expansion detected")
        set double_expansion_target = v
      else
        call DisplayToAllDebug("Ally double expansion detected")
        call IssueImmediateOrderById(u, order_cancel)
      endif
    endif
    if nearby_enemy_building != null and UnitAlive(nearby_enemy_building) then
      set double_expansion_target = nearby_enemy_building
    endif
    call GroupRemoveUnit(g,u)
  endloop
  call DestroyGroup(g)
  set g = null
endfunction

function GetItemNumberOnUnit takes integer id, unit u returns integer
  local integer i = 0
  local integer sum = 0
  loop
    exitwhen i > 5
    if GetItemTypeId(UnitItemInSlot(u, i)) == old_id[id] then
      set sum = sum + 1
    endif
    set i = i + 1
  endloop
  return sum
endfunction

function GetItemNumber takes integer id returns integer
  local integer sum = 0
  local integer i = 1
  loop
    exitwhen i > 3
    if hero_built[i] then
      set sum = sum + GetItemNumberOnUnit(id, hero_unit[i])
    endif
    set i = i + 1
  endloop
  return sum
endfunction

function GetItemOfTypeOnUnit takes integer id, unit u returns item
  local integer i = 0
  loop
    exitwhen i > 5
    if GetItemTypeId(UnitItemInSlot(u, i)) == old_id[id] then
      set item_unit = u
      return UnitItemInSlot(u, i)
    endif
    set i = i + 1
  endloop
  return null
endfunction

function GetItemOfType takes integer id returns item
  local item it = null
  local integer i = 1
  loop
    exitwhen i > 3
    if hero_built[i] then
      set it = GetItemOfTypeOnUnit(id, hero_unit[i])
      if it != null then
        return it
      endif
    endif
    set i = i + 1
  endloop
  return null
endfunction

function GetSlotsFreeOnUnit takes unit u returns integer
  local integer i = 0
  local integer sum = 0
  loop
    exitwhen i > 5
    if UnitItemInSlot(u, i) == null then
      set sum = sum + 1
    endif
    set i = i + 1
  endloop
  return sum
endfunction

function GetSlotsFree takes nothing returns integer
  local integer sum = 0
  local integer i = 1
  loop
    exitwhen i > 3
    if hero_built[i] then
      set sum = sum + GetSlotsFreeOnUnit(hero_unit[i])
    endif
    set i = i + 1
  endloop
  return sum
endfunction

function GetHeroToBuyItem takes unit shop, real limit returns unit
  local integer i = 1
  loop
    exitwhen i > 3
    if hero_built[i] and UnitAlive(hero_unit[i]) then
      if GetSlotsFreeOnUnit(hero_unit[i]) > 0 and DistanceBetweenUnits(hero_unit[i], shop) < limit then
        return hero_unit[i]
      endif
    endif
    set i = i + 1
  endloop
  return null
endfunction

function GetItemHero takes item it returns unit
  local integer i = 1
  loop
    exitwhen i > 3
    if hero_built[i] and UnitAlive(hero_unit[i]) then
      if UnitHasItem(hero_unit[i], it) then
        return hero_unit[i]
      endif
    endif
    set i = i + 1
  endloop
  return null
endfunction

function FocusFire takes unit u returns nothing
  local group g = CreateGroup()
  call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), focus_fire_ranged_dist, null)
  set g = SelectUnittype(g, UNIT_TYPE_RANGED_ATTACKER, true)
  set focus_fire_group = GroupAddGroup_k(focus_fire_group, g)
  call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), focus_fire_melee_dist, null)
  set g = SelectUnittype(g, UNIT_TYPE_MELEE_ATTACKER, true)
  set focus_fire_group = GroupAddGroup_d(focus_fire_group, g)
  set g = null
  set focus_fire_group = SelectByPlayer(focus_fire_group, ai_player)
  if IsUnitType(u, UNIT_TYPE_FLYING) then
    set focus_fire_group = SelectUnittype(focus_fire_group, UNIT_TYPE_ATTACKS_FLYING, true)
  else
    set focus_fire_group = SelectUnittype(focus_fire_group, UNIT_TYPE_ATTACKS_GROUND, true)
  endif
  set focus_fire_group = SelectUnittype(focus_fire_group, UNIT_TYPE_PEON, false)
  set focus_fire_group = SelectByUserData(focus_fire_group, UNIT_GOING_HOME, false)
  call GroupTargetOrder(focus_fire_group, "attack", u)
endfunction

function GetTQLock takes nothing returns nothing
  loop
    exitwhen tq_lock
    call Sleep(0.5)
  endloop
  set tq_lock = false
endfunction

function ReleaseTQLock takes nothing returns nothing
  set tq_lock = true
endfunction

function TQDisplay takes nothing returns nothing
  local integer i = 1
  call DisplayToAll("Displaying heap")
  loop
    exitwhen i > tq_length
    call DisplayToAll(Int2Str(R2I(tq_time[i])) + " " + Int2Str(tq_jid[i]))
    set i = i + 1
  endloop
endfunction

function TQCopy takes integer spos, integer tpos returns nothing
  set tq_time[tpos] = tq_time[spos]
  set tq_jid[tpos] = tq_jid[spos]
  set tq_par[tpos] = tq_par[spos]
  set tq_unit_par[tpos] = tq_unit_par[spos]
  set tq_group_par[tpos] = tq_group_par[spos]
endfunction

function TQExchange takes integer pos1, integer pos2 returns nothing
  call TQCopy(pos2, tq_length+1)
  call TQCopy(pos1, pos2)
  call TQCopy(tq_length+1, pos1)
endfunction

function TQUpHeap takes integer pos returns nothing
  if tq_time[pos] < tq_time[pos/2] then
    call TQExchange(pos, pos/2)
    call TQUpHeap(pos/2)
  endif
endfunction

function TQFillPos takes integer pos returns integer
  local integer lpos = 2*pos
  local integer rpos = 2*pos + 1
  if lpos > tq_length then
    return pos
  elseif rpos > tq_length then
    call TQCopy(lpos, pos)
    return lpos
  elseif tq_time[lpos] <= tq_time[rpos] then
    call TQCopy(lpos, pos)
    return TQFillPos(lpos)
  else
    call TQCopy(rpos, pos)
    return TQFillPos(rpos)
  endif
endfunction

function TQRemoveRoot takes nothing returns nothing
  local integer pos = 0
  call GetTQLock()
  set pos = TQFillPos(1)
  set tq_length = tq_length - 1
  if pos <= tq_length then
    call TQCopy(tq_length + 1, pos)
    call TQUpHeap(pos)
  endif
  call ReleaseTQLock()
endfunction

function TQAddJobEx takes real time, integer jid, integer par, unit unit_par, group group_par returns nothing
  call GetTQLock()
  set tq_length = tq_length + 1
  set tq_time[tq_length] = time
  set tq_jid[tq_length] = jid
  set tq_par[tq_length] = par
  set tq_unit_par[tq_length] = unit_par
  set tq_group_par[tq_length] = group_par
  call TQUpHeap(tq_length)
  call ReleaseTQLock()
endfunction

function TQAddJob takes real time, integer jid, integer par returns nothing
  call TQAddJobEx(TimerGetElapsed(tq_timer) + time, jid, par, null, null)
endfunction

function TQAddUnitJob takes real time, integer jid, integer par, unit unit_par returns nothing
  call TQAddJobEx(TimerGetElapsed(tq_timer) + time, jid, par, unit_par, null)
endfunction

function TQAddGroupJob takes real time, integer jid, integer par, unit unit_par, group group_par returns nothing
  call TQAddJobEx(TimerGetElapsed(tq_timer) + time, jid, par, unit_par, group_par)
endfunction

function AddHealer takes integer id, integer spell, integer mana_cost,integer t, integer upg_id, integer upg_level returns nothing
  set healer_id[healer_length] = id
  set healer_spell[healer_length] = spell
  set healer_mana_cost[healer_length] = mana_cost
  set healer_type[healer_length] = t
  set healer_upg_id[healer_length] = upg_id
  set healer_upg_level[healer_length] = upg_level
  set healer_length = healer_length + 1
endfunction

function InitHealers takes nothing returns nothing
  if own_race == R_ELF then
    call AddHealer(oDRUID_CLAW, 852160, 125, HEALER_TYPE_SUDDEN, oUPG_DRUID_CLAW, 1)
  endif
  if own_race == R_HUMAN then
    call AddHealer(oPRIEST, 852063, 5, HEALER_TYPE_CONTINUOUS, o0, 0)
  endif
  if own_race == R_ORC then
    call AddHealer(oWITCH_DOCTOR, 852109, 200, HEALER_TYPE_WARD, oUPG_ORC_DOCS, 2)
  endif
  if own_race == R_UNDEAD then
    call AddHealer(oOBSIDIAN_STATUE, 852545, 10, HEALER_TYPE_NO_TARGET, o0, 0)
  endif
  if false then
  elseif merc_healer == RAZORMANE_MEDICINE_MAN then
    call AddHealer(oRAZORMANE_MEDICINE_MAN, 852109, 200, HEALER_TYPE_WARD, o0, 0)
  elseif merc_healer == FURBOLG_SHAMAN then
    call AddHealer(oFURBOLG_SHAMAN, 852160, 125, HEALER_TYPE_SUDDEN, o0, 0)
  elseif merc_healer == FOREST_TROLL_HIGH_PRIEST then
    call AddHealer(oFOREST_TROLL_HIGH_PRIEST, 852248, 5, HEALER_TYPE_CONTINUOUS, o0, 0)
  elseif merc_healer == FOREST_TROLL_SHADOW_PRIEST then
    call AddHealer(oFOREST_TROLL_SHADOW_PRIEST, 852248, 5, HEALER_TYPE_CONTINUOUS, o0, 0)
  elseif merc_healer == DRAENEI_DISCIPLE then
    call AddHealer(oDRAENEI_DISCIPLE, 852248, 5, HEALER_TYPE_CONTINUOUS, o0, 0)
  endif
endfunction

function GetHealerId takes integer id returns integer
  local integer i = 0
  loop
    exitwhen i >= healer_length
    if healer_id[i] == id then
      return i
    endif
    set i = i + 1
  endloop
  return -1
endfunction

function IsUnitHealer takes unit u returns boolean
  if GetUnitState(u, UNIT_STATE_MAX_MANA) <= 0 then
    return false
  else
    if GetHealerId(GetUnitTypeId(u)) >= 0 then
      return true
    endif
  endif
  return false
endfunction

function HealUnit takes unit healer, unit to_heal, boolean hero_heal returns nothing
  local integer id = GetHealerId(GetUnitTypeId(healer))
  if id == -1 then
    return
  endif
  if healer_type[id] != HEALER_TYPE_NO_TARGET then
    if healer_type[id] == HEALER_TYPE_WARD then
      if not ward_cast then
        call IssuePointOrderById(healer, healer_spell[id], GetUnitX(healer), GetUnitY(healer))
        set ward_cast = true
      endif
    else
      if healer_type[id] != HEALER_TYPE_HERO or hero_heal then
        call IssueTargetOrderById(healer, healer_spell[id], to_heal)
      endif
    endif
  endif
endfunction

function GetHealer takes nothing returns unit
  local unit u = FirstOfGroup(healer_group)
  local integer id = 0
  loop
    exitwhen u == null
    set id = GetHealerId(GetUnitTypeId(u))
    exitwhen (GetUnitState(u, UNIT_STATE_MANA) >= healer_mana_cost[id]) and ((healer_upg_id[id] == 0) or (GetUpgradeLevel(healer_upg_id[id]) >= healer_upg_level[id]))
    call GroupRemoveUnit(healer_group, u)
    set u = FirstOfGroup(healer_group)
  endloop
  return u
endfunction

function SaveUnit takes unit u returns nothing
  local real daytime = GetFloatGameState(GAME_STATE_TIME_OF_DAY)
  local unit healer = GetHealer()
  local location l = null
  local group g = null
  if IsUnitType(u, UNIT_TYPE_HERO) then
    return
  endif
  call RemoveGuardPosition(u)
  call SetUnitUserData(u, UNIT_GOING_HOME)
  if healer != null and not IsUnitType(u, UNIT_TYPE_MECHANICAL) then
    call TQAddUnitJob(5, RESET_GUARD_POSITION, 0, u)
    set l = l_project_dd(GetUnitLoc(healer), l_sub_dk(GetUnitLoc(healer), last_enemy_loc), 100)
    call IssuePointOrderLoc(u, "move", l)
    call RemoveLocation(l)
    set l = null
    call HealUnit(healer, u, false)
  elseif own_race != R_ELF and not IsUnitType(u, UNIT_TYPE_PEON) and not IsUnitType(u, UNIT_TYPE_MECHANICAL) and not (GetUnitTypeId(u) == old_id[racial_ghoul]) and not (GetUnitTypeId(u) == old_id[racial_militia]) and neutral_available[NEUTRAL_HEALING_FOUNTAIN] and (not neutral_guarded[NEUTRAL_HEALING_FOUNTAIN] or (neutral_night_buy[NEUTRAL_HEALING_FOUNTAIN] and daytime >= 18)) then
    if follow_zeppelin != null and GetUnitUserData(follow_zeppelin) == UNIT_STANDARD then
      call SetUnitUserData(follow_zeppelin, UNIT_RESCUEING)
      set g = CreateGroup()
      call GroupAddUnit(g, follow_zeppelin)
      call TQAddGroupJob(0, ZEPPELIN_MOVE, ZTARGET_FOUNTAIN, u, g)
    else
      call TQAddUnitJob(8, HEALTH_FOUNTAIN, 80, u)
      call IssuePointOrder(u, "move", GetUnitX(nearest_neutral[NEUTRAL_HEALING_FOUNTAIN]), GetUnitY(nearest_neutral[NEUTRAL_HEALING_FOUNTAIN]))
    endif
  elseif follow_zeppelin != null and GetUnitUserData(follow_zeppelin) == UNIT_STANDARD then
    call SetUnitUserData(follow_zeppelin, UNIT_RESCUEING)
    set g = CreateGroup()
    call GroupAddUnit(g, follow_zeppelin)
    call TQAddGroupJob(0, ZEPPELIN_MOVE, ZTARGET_HOME, u, g)
  else
    call TQAddUnitJob(30, RESET_GUARD_POSITION, 0, u)
    call IssuePointOrderLoc(u, "move", home_location)
  endif
endfunction

function TeleportHome takes unit u returns nothing
  set break_attack = true
  set attack_running = false
  set teleporting = true
  call UnitUseItemPoint(u, GetItemOfTypeOnUnit(tp_item, u), GetLocationX(home_location), GetLocationY(home_location))
  call TQAddUnitJob(0, TELEPORT, 0, u)
endfunction

function TeleportToLoc takes unit u, location l returns nothing
  set break_attack = true
  set attack_running = false
  set teleporting = true
  call UnitUseItemPoint(u, GetItemOfTypeOnUnit(tp_item, u), GetLocationX(l), GetLocationY(l))
  call TQAddUnitJob(0, TELEPORT, 0, u)
endfunction

function ExecuteSaveHero takes integer hn, integer a, unit healer returns nothing
  local location l = null
  local group g = null
  if a != ACTION_DO_NOTHING and a != ACTION_TP then
    call RemoveGuardPosition(hero_unit[hn])
    if a != ACTION_HEALER and hero_unit[hn] == major_hero then
      set major_hero = null
    endif
  endif
  if a == ACTION_HEALER then
    call TQAddUnitJob(5, RESET_GUARD_POSITION, 0, hero_unit[hn])
    set l = l_project_dd(GetUnitLoc(healer), l_sub_dk(GetUnitLoc(healer), last_enemy_loc), 100)
    call IssuePointOrderLoc(hero_unit[hn], "move", l)
    call RemoveLocation(l)
    set l = null
    call HealUnit(healer, hero_unit[hn], false)
  elseif a == ACTION_FOUNTAIN then
    call TQAddUnitJob(8, HEALTH_FOUNTAIN, 80, hero_unit[hn])
    call IssuePointOrder(hero_unit[hn], "move", GetUnitX(nearest_neutral[NEUTRAL_HEALING_FOUNTAIN]), GetUnitY(nearest_neutral[NEUTRAL_HEALING_FOUNTAIN]))
  elseif a == ACTION_GO_HOME then
    call TQAddUnitJob(30, RESET_GUARD_POSITION, 0, hero_unit[hn])
    call IssuePointOrderLoc(hero_unit[hn], "move", home_location)
  elseif a == ACTION_ZEPPELIN_HOME then
    call SetUnitUserData(follow_zeppelin, UNIT_RESCUEING)
    set g = CreateGroup()
    call GroupAddUnit(g, follow_zeppelin)
    call TQAddGroupJob(0, ZEPPELIN_MOVE, ZTARGET_HOME, hero_unit[hn], g)
  elseif a == ACTION_ZEPPELIN_FOUNTAIN then
    call SetUnitUserData(follow_zeppelin, UNIT_RESCUEING)
    set g = CreateGroup()
    call GroupAddUnit(g, follow_zeppelin)
    call TQAddGroupJob(0, ZEPPELIN_MOVE, ZTARGET_FOUNTAIN, hero_unit[hn], g)
  elseif a == ACTION_TP then
    call TeleportHome(hero_unit[hn])
  endif
endfunction

function SaveHero takes integer hn returns nothing
  local real daytime = GetFloatGameState(GAME_STATE_TIME_OF_DAY)
  local unit healer = GetHealer()
  call ActionListInit(7)
  call ActionRule2(true, ACTION_TP, (1 - hero_hp[hn])*10, ACTION_ZEPPELIN_FOUNTAIN, (1 - hero_hp[hn])*20)
  call ActionRule2((hero_hp_loss[hn] > 0.5) and (hero_hp[hn] < 0.3), ACTION_TP, 40, ACTION_ZEPPELIN_HOME, 30)
  call ActionRule2((hero_enemy_density[hn] > 2) and (DistanceBetweenPoints_kd(hero_enemy_loc[hn],GetUnitLoc(hero_unit[hn])) < 30)and (hero_hp_loss[hn] > 0.4), ACTION_TP, 200, ACTION_ZEPPELIN_HOME, 150)
  call ActionRule(true, ACTION_TP, DistanceBetweenPoints_kd(home_location, GetUnitLoc(hero_unit[hn]))*0.006)
  call ActionRule(DistanceBetweenPoints_kd(home_location, GetUnitLoc(hero_unit[hn])) < 2000 and (hero_enemy_density[hn] > 1), ACTION_TP, -50)
  call ActionRule(DistanceBetweenPoints_kd(home_location, GetUnitLoc(hero_unit[hn])) < 2000 and (hero_enemy_density[hn] < 1), ACTION_TP, -1000000)
  call ActionRule3(true, ACTION_TP, (I2R(GetHeroLevel(hero_unit[hn]))*14)-20, ACTION_ZEPPELIN_HOME, I2R(GetHeroLevel(hero_unit[hn]))*8, ACTION_ZEPPELIN_FOUNTAIN, I2R(GetHeroLevel(hero_unit[hn]))*6)
  call ActionRule3(true, ACTION_FOUNTAIN, 5, ACTION_ZEPPELIN_FOUNTAIN, 10, ACTION_DO_NOTHING, -10)
  call ActionRule2(follow_zeppelin == null or GetUnitUserData(follow_zeppelin) != UNIT_STANDARD, ACTION_ZEPPELIN_HOME, -1000000.0, ACTION_ZEPPELIN_FOUNTAIN, -1000000.0)
  call ActionRule2(own_race != R_ELF, ACTION_FOUNTAIN, -100.0, ACTION_ZEPPELIN_FOUNTAIN, -100.0)
  call ActionRule2(not neutral_available[NEUTRAL_HEALING_FOUNTAIN] or (neutral_guarded[NEUTRAL_HEALING_FOUNTAIN] and (not neutral_night_buy[NEUTRAL_HEALING_FOUNTAIN] or daytime < 18)), ACTION_FOUNTAIN, -1000000.0, ACTION_ZEPPELIN_FOUNTAIN, -1000000.0)
  call ActionRule(GetItemNumberOnUnit(tp_item, hero_unit[hn]) <= 0, ACTION_TP, -1000000)
  call ActionRule(healer == null, ACTION_HEALER, -1000000)
  call ExecuteSaveHero(hn, ActionListEval(), healer)
endfunction

function StatueControl takes unit u returns nothing
  local location statue_loc = l_project_kd(last_ally_loc, l_sub_kk(last_ally_loc, last_enemy_loc), statue_distance)
  if DistanceBetweenPoints_dk(GetUnitLoc(u), statue_loc) > 200 then
    call IssuePointOrderLoc(u, "move", statue_loc)
  endif
  call RemoveLocation(statue_loc)
  set statue_loc = null
endfunction

function BuyNeutral takes integer id returns nothing
  local real daytime = GetFloatGameState(GAME_STATE_TIME_OF_DAY)
  local real current_time = TimerGetElapsed(tq_timer)
  local real time_next_try = 0
  local real dist = 0
  local integer nn = GetNeutralNumber(id)
  local unit buy_place = nearest_neutral[nn]
  local boolean place_guarded = neutral_guarded[nn]

  if (buy_time_large[nn] >= 0 and buy_time_large[nn] + buy_timeout_large < current_time) or (buy_time_small[nn] >= 0 and buy_time_small[nn] + buy_timeout_small < current_time) then
    set available_time[id] = ai_time + regenerate_time[id] / 2
    call RecycleGuardPosition(neutral_sent[nn])
    set neutral_sent[nn] = null
    set neutral_ordered[nn] = false
    set buy_time_large[nn] = -1
    set buy_time_small[nn] = -1
    return
  endif

  if TownCountDone(id) >= neutral_wanted[nn] then
    call RecycleGuardPosition(neutral_sent[nn])
    set neutral_sent[nn] = null
    set neutral_ordered[nn] = false
    set buy_time_large[nn] = -1
    set buy_time_small[nn] = -1
    return
  endif
  if place_guarded and daytime >= 5 and daytime <= 18 then
    set time_next_try = (18 - daytime)*20
  else
    if neutral_sent[nn] == null or not UnitAlive(neutral_sent[nn]) then
      set neutral_sent[nn] = GetUnitToBuy(buy_place)
      if neutral_sent[nn] == null then
        call TQAddJob(sleep_multiplier, BUY_NEUTRAL, id)
        return
      else
        call RemoveGuardPosition(neutral_sent[nn])
      endif
    endif
    if buy_time_large[nn] < 0 then
      set buy_time_large[nn] = current_time
    endif
    set dist = DistanceBetweenPoints_dd(GetUnitLoc(neutral_sent[nn]), GetUnitLoc(buy_place))
    if dist < buy_distance then
      call IssueImmediateOrder(neutral_sent[nn], "stop")
      call IssueNeutralImmediateOrderById(ai_player, buy_place, old_id[id])
      if buy_time_small[nn] < 0 then
        set buy_time_small[nn] = current_time
      endif
      set time_next_try = 0.5
    else
      call IssuePointOrder(neutral_sent[nn], "move", GetUnitX(buy_place), GetUnitY(buy_place))
      set time_next_try = r_maximum((dist - buy_distance) / r_maximum(GetUnitMoveSpeed(neutral_sent[nn]), 50), 0.5)
    endif
  endif
  call TQAddJob(time_next_try, BUY_NEUTRAL, id)
endfunction

function BuyItemJob takes integer id returns nothing
  local real daytime = GetFloatGameState(GAME_STATE_TIME_OF_DAY)
  local real current_time = TimerGetElapsed(tq_timer)
  local real time_next_try = 0
  local real dist = 0

  if (shop_buy_time_large >= 0 and shop_buy_time_large + buy_timeout_large < current_time) or (shop_buy_time_small >= 0 and shop_buy_time_small + buy_timeout_small < current_time) then
    set available_time[id] = ai_time + regenerate_time[id] / 2
    call RecycleGuardPosition(shop_sent)
    set shop_sent = null
    set shop_ordered = false
    set shop_buy_time_large = -1
    set shop_buy_time_small = -1
    return
  endif

  if GetItemNumber(id) >= shop_wanted or shop_unit == null or (not UnitAlive(shop_unit)) or (shop_sent != null and GetSlotsFreeOnUnit(shop_sent) <= 0) then
    call RecycleGuardPosition(shop_sent)
    set shop_sent = null
    set shop_ordered = false
    set shop_buy_time_large = -1
    set shop_buy_time_small = -1
    return
  endif
  
  if shop_sent == null or not UnitAlive(shop_sent) then
    set shop_sent = GetHeroToBuyItem(shop_unit, shop_distance_limit)
    if shop_sent == null then
      set shop_ordered = false
      set shop_buy_time_large = -1
      set shop_buy_time_small = -1
      return
    else
      call RemoveGuardPosition(shop_sent)
    endif
  endif
  if shop_buy_time_large < 0 then
    set shop_buy_time_large = current_time
  endif
  set dist = DistanceBetweenUnits(shop_sent, shop_unit)
  if dist < buy_distance then
    call IssueImmediateOrder(shop_sent, "stop")
    call IssueNeutralImmediateOrderById(ai_player, shop_unit, old_id[id])
    if shop_buy_time_small < 0 then
      set shop_buy_time_small = current_time
    endif
    set time_next_try = 0.5
  else
    call IssuePointOrder(shop_sent, "move", GetUnitX(shop_unit), GetUnitY(shop_unit))
    set time_next_try = r_maximum((dist - buy_distance) / r_maximum(GetUnitMoveSpeed(shop_sent), 100), 0.5)
  endif
  call TQAddJob(time_next_try, BUY_ITEM, id)
endfunction

function UpdateStrengthJob takes nothing returns nothing
  if player_defeated then
    return
  endif
  call UpdateStrength()
  call TQAddJob(15 * sleep_multiplier, UPDATE_STRENGTH, 0)
endfunction

function RevealEnemy takes nothing returns nothing
  call countEnemyReal()
endfunction

function ExchangeJob takes nothing returns nothing
  call ExchangeOnce()
  call TQAddJob(30 * sleep_multiplier, EXCHANGE, 0)
endfunction

function DetectDefeatJob takes nothing returns nothing
  call CheckDefeated()
  call CheckDefeatedForce()
  if not player_defeated then
    call TQAddJob(13 * sleep_multiplier, DETECT_DEFEAT, 0)
  endif
endfunction

function DetectDoubleExpJob takes nothing returns nothing
  call CheckDoubleExpansion()
  call TQAddJob(12 * sleep_multiplier, DETECT_DOUBLE_EXP, 0)
endfunction

function ZeppelinFollowJob takes nothing returns nothing
  local real dist = 0
  local location l = null
  local group g = CreateGroup()
  call GroupEnumUnitsOfType(g, "goblinzeppelin", null)
  set g = SelectByPlayer(g, ai_player)
  set g = SelectByOrderOr(g, 0, order_attack, true)
  set g = SelectByUserData(g, UNIT_STANDARD, true)
  call GroupPointOrderLoc(g, "attack", home_location)
  if major_hero != null and UnitAlive(major_hero) then
    set follow_zeppelin = GetNearestOfGroup_d(g, GetUnitLoc(major_hero))
    set g = null
  else
    set follow_zeppelin = FirstOfGroup(g)
    call DestroyGroup(g)
    set g = null
    call TQAddJob(4, ZEPPELIN_FOLLOW, 0)
    return
  endif
  if follow_zeppelin == null then
    call TQAddJob(4, ZEPPELIN_FOLLOW, 0)
    set zeppelin_following = false
    return
  endif
  set zeppelin_following = true
  set dist = DistanceBetweenUnits(major_hero, follow_zeppelin)
  if dist > max_follow_dist then
    set l = GetLocationBetweenLoc_dd(GetUnitLoc(follow_zeppelin), GetUnitLoc(major_hero), (dist - 0.33 * max_follow_dist)/dist)
    call IssuePointOrderLoc(follow_zeppelin, "attack", l)
    call RemoveLocation(l)
    set l = null
    call TQAddJob(r_maximum((dist - max_follow_dist) / r_maximum(GetUnitMoveSpeed(follow_zeppelin) + GetUnitMoveSpeed(major_hero), 50), 0.5) * sleep_multiplier,ZEPPELIN_FOLLOW,0)
  else
    call IssueImmediateOrder(follow_zeppelin, "stop")
    call TQAddJob(r_maximum((max_follow_dist - dist) / r_maximum(GetUnitMoveSpeed(follow_zeppelin) + GetUnitMoveSpeed(major_hero), 50), 0.5) * sleep_multiplier,ZEPPELIN_FOLLOW,0)
  endif
endfunction

function GetZTargetLocation takes integer target returns location
  if target == ZTARGET_HOME then
    return Location(GetLocationX(home_location), GetLocationY(home_location))
  else
    return GetUnitLoc(nearest_neutral[NEUTRAL_HEALING_FOUNTAIN])
  endif
endfunction

function ZeppelinMoveJob takes integer target, unit hu, group z returns nothing
  local location tl = GetZTargetLocation(target)
  local unit zep = FirstOfGroup(z)
  if not UnitAlive(zep) then
    if target == ZTARGET_FOUNTAIN then
      call TQAddUnitJob(8, HEALTH_FOUNTAIN, 80, hu)
      call IssuePointOrder(hu, "move", GetUnitX(nearest_neutral[NEUTRAL_HEALING_FOUNTAIN]), GetUnitY(nearest_neutral[NEUTRAL_HEALING_FOUNTAIN]))
    else
      call TQAddUnitJob(30, RESET_GUARD_POSITION, 0, hu)
      call IssuePointOrderLoc(hu, "move", home_location)
    endif
    call RemoveLocation(tl)
    set tl = null
    call DestroyGroup(z)
    return
  endif
  if IsUnitInTransport(hu, zep) then
    if DistanceBetweenPoints_dk(GetUnitLoc(zep), tl) > 200 and DistanceBetweenPoints_dk(GetUnitLoc(zep), ally_loc) < 1500 then
      call IssuePointOrderLoc(zep, "move", tl)
    else
      call IssueImmediateOrder(zep, "stop")
      call IssueTargetOrder(zep, "unload", hu)
    endif
  else
    if DistanceBetweenPoints_dk(GetUnitLoc(hu), tl) < 300 or DistanceBetweenPoints_dk(GetUnitLoc(zep), ally_loc) > 1300 then
      if target == ZTARGET_FOUNTAIN then
        call TQAddUnitJob(8, HEALTH_FOUNTAIN, 80, hu)
      else
        call TQAddUnitJob(30, RESET_GUARD_POSITION, 0, hu)
      endif
      call SetUnitUserData(zep, UNIT_STANDARD)
      call DestroyGroup(z)
      call RemoveLocation(tl)
      set tl = null
      return
    else
      call IssueTargetOrder(hu, "smart", zep)
    endif
  endif
  call RemoveLocation(tl)
  set tl = null
  call TQAddGroupJob(3, ZEPPELIN_MOVE, target, hu, z)
endfunction

function NeutralGuardedJob takes integer nn returns nothing
  set neutral_guarded[nn] = GetLocationCreepStrength(GetUnitX(nearest_neutral[nn]), GetUnitY(nearest_neutral[nn]), 500) > 0
  if neutral_guarded[nn] then
    call TQAddJob(30 * sleep_multiplier, NEUTRAL_GUARDED, nn)
  endif
endfunction

function NeutralEnemyCheckJob takes integer nn returns nothing
  set neutral_enemy[nn] = GetLocationNonCreepStrength(GetUnitX(nearest_neutral[nn]), GetUnitY(nearest_neutral[nn]), 500)
  call TQAddJob(8 * sleep_multiplier, NEUTRAL_ENEMY_CHECK, nn)
endfunction

function DeleteBlockListJob takes nothing returns nothing
  set bl_length = 0
endfunction

function DeleteRBlockListJob takes nothing returns nothing
  set rbl_length = 0
endfunction

function RetreatControlJob takes nothing returns nothing
  local group g = CreateGroup()
  local real ally_sum = 0
  local real enemy_sum = 0
  local unit u = null
  local real unit_strength = 0
  local real eh_min_health = 100000
  local unit eh_min_health_unit = null
  local real range_strength = 0
  local real eu_min_health = 100000
  local unit eu_min_health_unit = null
  local real unit_life = 0
  local integer enemy_count = 0
  local integer ally_count = 0
  local group new_healer_group = CreateGroup()
  local boolean ward_check = false
  local boolean prev_ward = ward_cast

  if not CaptainRetreating() then
    call GroupImmediateOrder(focus_fire_group, "stop")
  endif
  call GroupClear(focus_fire_group)

  if major_hero == null or not UnitAlive(major_hero) then
    set major_hero = GetMajorHeroReplacement_k(last_major_hero_loc)
  endif

  if not (attack_running and major_hero != null and UnitAlive(major_hero)) or CaptainRetreating() then
    set break_attack = attack_running
    set retreat_controlled = false
    call SetGroupsFlee(true)
    return
  endif
  
  call MoveLocation(last_enemy_loc, GetLocationX(enemy_loc), GetLocationY(enemy_loc))
  call MoveLocation(last_ally_loc, GetLocationX(ally_loc), GetLocationY(ally_loc))
  call MoveLocation(enemy_loc, 0,0)
  call MoveLocation(ally_loc, 0,0)
  call MoveLocation(last_major_hero_loc, GetUnitX(major_hero), GetUnitY(major_hero))

  call GroupEnumUnitsInRange(g,GetUnitX(major_hero),GetUnitY(major_hero),battle_radius,null)
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    if UnitAlive(u) then
      set unit_strength = GetUnitStrength(u)
      set unit_life = GetUnitState(u, UNIT_STATE_LIFE)
      if IsPlayerAlly(GetOwningPlayer(u), ai_player) then
        set ally_loc = l_add_dd(ally_loc, GetUnitLoc(u))
        set ally_count = ally_count + 1
        if GetUnitTypeId(u) == 'ohwd' then
          if GetOwningPlayer(u) == ai_player then
            set ward_check = true
          endif
        endif
        if GetUnitUserData(u) != UNIT_GOING_HOME then
          if GetOwningPlayer(u) == ai_player and GetUnitFoodUsed(u) > 0 and unit_life < r_maximum(flee_health_percentage * GetUnitState(u, UNIT_STATE_MAX_LIFE), flee_minimum_health) then
            call SaveUnit(u)
          else
            if GetOwningPlayer(u) == ai_player then
              if GetUnitTypeId(u) == oOBSIDIAN_STATUE then
                call StatueControl(u)
              endif
              if IsUnitHealer(u) then
                call GroupAddUnit(new_healer_group, u)
              endif
            endif
            set ally_sum = ally_sum + unit_strength
            if IsUnitType(u, UNIT_TYPE_RANGED_ATTACKER) then
              set range_strength = range_strength + unit_strength
            endif
          endif
        endif
      else
        set enemy_loc = l_add_dd(enemy_loc, GetUnitLoc(u))
        set enemy_count = enemy_count + 1
        set enemy_sum = enemy_sum + unit_strength
        if IsUnitType(u, UNIT_TYPE_HERO) then
          if unit_life < eh_min_health then
            set eh_min_health = unit_life
            set eh_min_health_unit = u
          endif
        else
          if unit_life < eu_min_health and unit_life < GetUnitState(u, UNIT_STATE_MAX_LIFE) and (IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) or IsUnitType(u, UNIT_TYPE_RANGED_ATTACKER) or IsUnitType(u, UNIT_TYPE_TOWNHALL)) then
            set eu_min_health = unit_life
            set eu_min_health_unit = u
          endif
        endif
      endif
    endif
    call GroupRemoveUnit(g,u)
  endloop
  call DestroyGroup(g)
  set g = null
  
  if prev_ward or not ward_cast then
    set ward_cast = ward_check
  endif
  call DestroyGroup(healer_group)
  set healer_group = new_healer_group
  set new_healer_group = null
  set enemy_loc = l_div_d(enemy_loc, I2R(maximum(enemy_count, 1)))
  set ally_loc = l_div_d(ally_loc, I2R(maximum(ally_count, 1)))
  call SetCaptainHome(0, GetLocationX(ally_loc), GetLocationY(ally_loc))
  
  set enemy_strength_sum = enemy_sum
  set ally_strength_sum = ally_sum
  
  if enemy_sum > ally_sum then
    call SetGroupsFlee(true)
  else
    if eh_min_health_unit != null and eh_min_health < focus_fire_limit * range_strength then
      call SetTargetHeroes(true)
      call FocusFire(eh_min_health_unit)
    else
      call SetTargetHeroes(false)
      if eu_min_health_unit != null then
        call FocusFire(eu_min_health_unit)
      endif
    endif
    call SetGroupsFlee(false)
  endif
  call TQAddJob(2 * sleep_multiplier, RETREAT_CONTROL, 0)
endfunction

function CleanupBlock takes nothing returns nothing
  local integer i = 0
  local integer ff = 0
  loop
    exitwhen i >= bl_length
    if bl_expire_time[i] >= ai_time then
      set bl_req_qty[ff] = bl_req_qty[i]
      set bl_req_type[ff] = bl_req_type[i]
      set bl_allow_qty[ff] = bl_allow_qty[i]
      set bl_allow_type[ff] = bl_allow_type[i]
      set bl_expire_time[ff] = bl_expire_time[i]
      set bl_only_done[ff] = bl_only_done[i]
      set ff = ff + 1
    endif
    set i = i + 1
  endloop
  set bl_length = ff
endfunction

function CleanupRBlock takes nothing returns nothing
  local integer i = 0
  local integer ff = 0
  loop
    exitwhen i >= rbl_length
    if rbl_expire_time[i] >= ai_time then
      set rbl_req_gold[ff] = rbl_req_gold[i]
      set rbl_req_wood[ff] = rbl_req_wood[i]
      set rbl_allow_qty[ff] = rbl_allow_qty[i]
      set rbl_allow_type[ff] = rbl_allow_type[i]
      set rbl_expire_time[ff] = rbl_expire_time[i]
      set ff = ff + 1
    endif
    set i = i + 1
  endloop
  set rbl_length = ff
endfunction

function CleanupBlocksJob takes nothing returns nothing
  call CleanupBlock()
  call CleanupRBlock()
  call TQAddJob(60, CLEANUP_BLOCKS, 0)
endfunction

function RepairControlJob takes nothing returns nothing
  local integer peons = TownCountDone(racial_peon)
  if peons <= repair_threshold or (peons <= repair_threshold_threatened and town_threatened) then
    call SetPeonsRepair(false)
  else
    call SetPeonsRepair(true)
  endif
  call TQAddJob(15, REPAIR_CONTROL, 0)
endfunction

function ResetGuardPositionJob takes unit u returns nothing
  call RecycleGuardPosition(u)
  call SetUnitUserData(u, UNIT_STANDARD)
endfunction

function ResetByHealthJob takes unit u, integer p returns nothing
  if GetUnitState(u, UNIT_STATE_LIFE) >= GetUnitState(u, UNIT_STATE_MAX_LIFE) * (I2R(p)/100) then
    call RecycleGuardPosition(u)
    call SetUnitUserData(u, UNIT_STANDARD)
  else
    call TQAddUnitJob(8, RESET_HEALTH, p, u)
  endif
endfunction

function HealthFountainJob takes unit u, integer p returns nothing
  if not IsUnitHidden(u) and neutral_enemy[NEUTRAL_HEALING_FOUNTAIN] > 4 then
    call IssuePointOrderLoc(u, "move", home_location)
    call TQAddUnitJob(10, RESET_GUARD_POSITION, p, u)
  elseif GetUnitState(u, UNIT_STATE_LIFE) >= GetUnitState(u, UNIT_STATE_MAX_LIFE) * (I2R(p)/100) then
    call RecycleGuardPosition(u)
    call SetUnitUserData(u, UNIT_STANDARD)
  else
    if not IsUnitInRangeXY(u, GetUnitX(nearest_neutral[NEUTRAL_HEALING_FOUNTAIN]), GetUnitY(nearest_neutral[NEUTRAL_HEALING_FOUNTAIN]), buy_distance) then
      call IssuePointOrder(u, "move", GetUnitX(nearest_neutral[NEUTRAL_HEALING_FOUNTAIN]), GetUnitY(nearest_neutral[NEUTRAL_HEALING_FOUNTAIN]))
    elseif GetUnitAbilityLevel(u, 'Ashm') > 0 then
      call IssueImmediateOrder(u, "ambush")
    endif
    call TQAddUnitJob(8, HEALTH_FOUNTAIN, p, u)
  endif
endfunction

function InitHeroInfo takes integer hn returns nothing
  set hero_loc[hn] = GetUnitLoc(hero_unit[hn])
  set hero_enemy_loc[hn] = Location(0,0)
  set hero_ally_loc[hn] = Location(0,0)
  set hero_hp[hn] = 1
endfunction

function TeleportJob takes unit hu returns nothing
  local group g = CreateGroup()
  local unit u = null
  local integer current_order = GetUnitCurrentOrder(hu)
  if not UnitAlive(hu) or current_order < 852008 or current_order > 852013 then
    call TeleportCaptain(GetUnitX(hu), GetUnitY(hu))
    set teleporting = false
    call DestroyGroup(g)
    set g = null
    return
  endif
  call GroupEnumUnitsInRange(g, GetUnitX(hu), GetUnitY(hu), 2 * teleport_radius, null)
  set g = SelectByPlayer(g, ai_player)
  set g = SelectUnittype(g, UNIT_TYPE_PEON, false)
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    if DistanceBetweenPoints_dd(GetUnitLoc(hu), GetUnitLoc(u)) > teleport_radius then
      call IssuePointOrder(u, "move", GetUnitX(hu), GetUnitY(hu))
    endif
    call GroupRemoveUnit(g, u)
  endloop
  call DestroyGroup(g)
  set g = null
  call TQAddUnitJob(1, TELEPORT, 0, hu)
endfunction

function GetArmyOfUnit takes unit u returns integer
  local integer i = 0
  loop
    exitwhen i >= army_num
    if IsUnitInGroup(u, army_group[i]) then
      return i
    endif
    set i = i + 1
  endloop
  return -1
endfunction

function MicroHeroJob takes integer hn returns nothing
  local location new_loc = GetUnitLoc(hero_unit[hn])
  local real new_hp = GetUnitState(hero_unit[hn], UNIT_STATE_LIFE) / GetUnitState(hero_unit[hn], UNIT_STATE_MAX_LIFE)
  local integer current_order = GetUnitCurrentOrder(hero_unit[hn])
  call RemoveLocation(hero_dir[hn])
  set hero_dir[hn] = l_sub_kd(new_loc, hero_loc[hn])
  set hero_loc[hn] = new_loc
  set hero_hp_loss[hn] = hero_hp[hn] - new_hp
  set hero_hp[hn] = new_hp
  call GetDensities(new_loc, ai_player, hero_radius)
  set hero_enemy_density[hn] = enemy_density
  call MoveLocation(hero_enemy_loc[hn], GetLocationX(enemy_density_loc), GetLocationY(enemy_density_loc))
  set hero_ally_density[hn] = ally_density
  call MoveLocation(hero_ally_loc[hn], GetLocationX(ally_density_loc), GetLocationY(ally_density_loc))
  
  if not teleporting and current_order >= 852008 and current_order <= 852013 then
    if GetItemTypeId(UnitItemInSlot(hero_unit[hn], current_order - 852008)) == old_id[tp_item] then
      set teleporting = true
      call TeleportJob(hero_unit[hn])
    endif
  endif
  


  if not teleporting and GetUnitState(hero_unit[hn], UNIT_STATE_LIFE) < r_maximum(flee_health_percentage * GetUnitState(hero_unit[hn], UNIT_STATE_MAX_LIFE), flee_minimum_health) then
    call SaveHero(hn)
  elseif town_threatened and town_threat[most_threatened_town] >= teleport_min_threat and DistanceBetweenPoints_kk(hero_loc[hn], town_loc[most_threatened_town]) > LinearInterpolation(teleport_low_threat, teleport_high_threat, teleport_low_threat_distance, teleport_high_threat_distance, town_threat[most_threatened_town]) and GetItemNumberOnUnit(tp_item, hero_unit[hn]) > 0 and town_can_tp[most_threatened_town] and army_strength[GetArmyOfUnit(hero_unit[hn])] >= teleport_army_min_strength then
    call TeleportToLoc(hero_unit[hn], town_loc[most_threatened_town])
  endif
  call TQAddJob(1.5, MICRO_HERO, hn)
endfunction

function GroupRecycleGuardPosition takes group g returns nothing
  local unit u = null
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    call TQAddUnitJob(30, RESET_GUARD_POSITION, 0, u)
    call GroupRemoveUnit(g,u)
  endloop
  call DestroyGroup(g)
endfunction

function GetHarassPeonTarget takes unit u returns unit
  local group g = CreateGroup()
  local player p = GetNearestEnemyToLoc_d(GetUnitLoc(u))
  call GroupEnumUnitsOfPlayer(g, p, null)
  set g = SelectUnittype(g, UNIT_TYPE_PEON, true)
  set g = SelectByAlive(g, true)
  set g = SelectByLoaded(g, false)
  return GetNearestOfGroup_d(g, GetUnitLoc(u))
endfunction

function GetHarassExpansionTarget takes unit u returns unit
  local group g = CreateGroup()
  local player p = GetNearestEnemyToLoc_d(GetUnitLoc(u))
  call GroupEnumUnitsOfPlayer(g, p, null)
  set g = SelectUnittype(g, UNIT_TYPE_TOWNHALL, true)
  set g = SelectByLocation_d(g, GetPlayerStartLocationLoc(p), 1000, false)
  set g = SelectByAlive(g, true)
  return GetNearestOfGroup_d(g, GetUnitLoc(u))
endfunction

function GetHarassLocationTarget takes real x, real y returns unit
  local group g = CreateGroup()
  call GroupEnumUnitsInRange(g, x, y, 1000, null)
  set g = SelectByAlive(g, true)
  return GetLeastHPUnitOfGroup(g)
endfunction

function GetHarassMainHallTarget takes unit u returns unit
  local group g = CreateGroup()
  local player p = GetNearestEnemyToLoc_d(GetUnitLoc(u))
  call GroupEnumUnitsOfPlayer(g, p, null)
  set g = SelectUnittype(g, UNIT_TYPE_TOWNHALL, true)
  set g = SelectByLocation_d(g, GetPlayerStartLocationLoc(p), 1000, true)
  set g = SelectByAlive(g, true)
  return GetNearestOfGroup_d(g, GetUnitLoc(u))
endfunction

function HarassJob takes integer ht, unit targ, group harasser returns nothing
  local unit target = targ
  local string key = Int2Str(Handle2Int(harasser))
  local real strength_limit = GetStoredReal(additional_info, key, "Strength_Limit")
  local boolean state_attacking = GetStoredBoolean(additional_info, key, "State_Attacking")
  local real flee_percent = GetStoredReal(additional_info, key, "Flee_Percent")
  local group g = null
  local unit u = null
  local real strength_sum = 0
  local integer harass_num = 0
  if not UnitAliveInGroup(harasser) then
    return
  endif
  if target == null or not UnitAlive(target) then
    if ht == HARASS_TARGET_PEONS then
      set target = GetHarassPeonTarget(FirstOfGroup(harasser))
    elseif ht == HARASS_TARGET_EXPANSION then
      set target = GetHarassExpansionTarget(FirstOfGroup(harasser))
    elseif ht == HARASS_TARGET_LOCATION then
      set target = GetHarassLocationTarget(GetStoredReal(additional_info, key, "LocationX"), GetStoredReal(additional_info, key, "LocationY"))
    else
      set target = GetHarassMainHallTarget(FirstOfGroup(harasser))
    endif
    if GetStoredBoolean(additional_info, key, "Avoid_Towers") and IsTowered(target) then
      set target = null
    endif
  endif
  if target != null and UnitAlive(target) then
  
    set g = CreateGroup()
    if state_attacking then
      call GroupEnumUnitsInRange(g,GetUnitX(FirstOfGroup(harasser)),GetUnitY(FirstOfGroup(harasser)),harass_radius_attack_melee,null)
    else
      call GroupEnumUnitsInRange(g,GetUnitX(FirstOfGroup(harasser)),GetUnitY(FirstOfGroup(harasser)),harass_radius_flee_melee,null)
    endif
    loop
      set u = FirstOfGroup(g)
      exitwhen u == null
      if IsPlayerEnemy(ai_player, GetOwningPlayer(u)) and IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) and GetOwningPlayer(u) != Player(PLAYER_NEUTRAL_AGGRESSIVE) and not IsUnitType(u, UNIT_TYPE_PEON) then
        set strength_sum = strength_sum + GetUnitStrength(u)
      endif
      call GroupRemoveUnit(g, u)
    endloop
    
    call GroupClear(g)
    if state_attacking then
      call GroupEnumUnitsInRange(g,GetUnitX(FirstOfGroup(harasser)),GetUnitY(FirstOfGroup(harasser)),harass_radius_attack_ranged,null)
    else
      call GroupEnumUnitsInRange(g,GetUnitX(FirstOfGroup(harasser)),GetUnitY(FirstOfGroup(harasser)),harass_radius_flee_ranged,null)
    endif
    loop
      set u = FirstOfGroup(g)
      exitwhen u == null
      if IsPlayerEnemy(ai_player, GetOwningPlayer(u)) and IsUnitType(u, UNIT_TYPE_RANGED_ATTACKER) and GetOwningPlayer(u) != Player(PLAYER_NEUTRAL_AGGRESSIVE) and not IsUnitType(u, UNIT_TYPE_PEON) then
        set strength_sum = strength_sum + GetUnitStrength(u)
      elseif IsUnitInGroup(u, harasser) then
        if GetUnitState(u, UNIT_STATE_LIFE) <= GetUnitState(u, UNIT_STATE_MAX_LIFE) * flee_percent then
          call GroupRemoveUnit(harasser, u)
          call IssuePointOrderLoc(u, "move", home_location)
          call TQAddUnitJob(30, RESET_GUARD_POSITION, 0, u)
        else
          set harass_num = harass_num + 1
        endif
      endif
      call GroupRemoveUnit(g, u)
    endloop

    call DestroyGroup(g)
    set g = null
    set u = null
    if harass_num <= GetStoredInteger(additional_info, key, "Flee_Number") then
      call GroupPointOrderLoc(harasser, "move", home_location)
      call GroupRecycleGuardPosition(harasser)
      return
    endif
    if strength_sum < strength_limit then
      call StoreBoolean(additional_info, key, "State_Attacking", true)
      if DistanceBetweenUnits(FirstOfGroup(harasser), target) > 1000 then
        call GroupPointOrder(harasser, "move", GetUnitX(target), GetUnitY(target))
      elseif not GroupTargetOrder(harasser, "attack", target) then
        call HarassJob(ht, null, harasser)
        return
      endif
    else
      call GroupPointOrderLoc(harasser, "move", home_location)
      call StoreBoolean(additional_info, key, "State_Attacking", false)
    endif
  else
    call GroupPointOrderLoc(harasser, "move", home_location)
    call GroupRecycleGuardPosition(harasser)
    return
  endif
  call TQAddGroupJob(2, HARASS, ht, target, harasser)
endfunction

function RallypointJob takes nothing returns nothing
  local group g = CreateGroup()
  local unit u = null
  call GroupEnumUnitsOfPlayer(g, ai_player, null)
  set g = SelectUnittype(g, UNIT_TYPE_STRUCTURE, true)
  call GroupPointOrderLoc(g, "setrally", home_location)
  call DestroyGroup(g)
  set g = null
  call TQAddJob(60, RALLY_POINT, 0)
endfunction

function ElfMineCheck takes unit mine returns boolean
  local group g = CreateGroup()
  local unit u = null
  local unit v = null
  local integer i = 0
  call GroupEnumUnitsOfPlayer(g, ai_player, null)
  set g = SelectUnittype(g, UNIT_TYPE_PEON, true)
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    if IsUnitInTransport(u, mine) then
      set i = i + 1
    endif
    call GroupRemoveUnit(g, u)
  endloop
  if i < 5 then
    call GroupEnumUnitsOfPlayer(g, ai_player, null)
    set g = SelectByLoaded(g, false)
    set g = SelectNumberOfId(g, 5 - i, 'ewsp')
    call GroupTargetOrder(g, "harvest", mine)
  endif
  call DestroyGroup(g)
  set g = null
  return i < 5
endfunction

function WispCheckJob takes nothing returns nothing
  local group g = CreateGroup()
  local unit u = null
  local boolean mines_not_full = true
  call GroupEnumUnitsOfPlayer(g, ai_player, null)
  set g = SelectNumberOfId(g, 100, 'egol')
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    if UnitAlive(u) then
      set mines_not_full = ElfMineCheck(u) and mines_not_full
    endif
    call GroupRemoveUnit(g, u)
  endloop
  call DestroyGroup(g)
  set g = null
  if mines_not_full then
    call TQAddJob(90, WISP_CHECK, 0)
  endif
  call TQAddJob(20, WISP_CHECK, 0)
endfunction

function CopyArmy takes integer from, integer to returns nothing
  set army_owner[to] = army_owner[from]
  set army_loc[to] = army_loc[from]
  set army_dir[to] = army_dir[from]
  set army_future[to] = army_future[from]
  set army_strength[to] = army_strength[from]
  set army_group[to] = army_group[from]
  set army_count[to] = army_count[from]
endfunction

function TrackArmy takes integer num returns boolean
  local group g = CreateGroup()
  local unit u = null
  local location l = Location(0,0)
  call GroupClear(army_group[num])
  set army_strength[num] = 0
  set army_count[num] = 0
  call GroupEnumUnitsInRangeOfLoc(g, army_loc[num], army_radius, null)
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    if UnitAlive(u) and GetOwningPlayer(u) == Player(army_owner[num]) and not (IsUnitType(u, UNIT_TYPE_STRUCTURE) or IsUnitType(u, UNIT_TYPE_PEON) or IsUnitInGroup(u, in_army_group)) then
      call GroupAddUnit(army_group[num], u)
      call GroupAddUnit(in_army_group, u)
      set l = l_add_dd(l, GetUnitLoc(u))
      set army_count[num] = army_count[num] + 1
      set army_strength[num] = army_strength[num] + GetUnitStrength(u)
    endif
    call GroupRemoveUnit(g, u)
  endloop
  call DestroyGroup(g)
  set g = null
  call RemoveLocation(army_dir[num])
  set l = l_div_d(l, maximum(army_count[num], 1))
  set army_dir[num] = l_sub_kd(l, army_loc[num])
  set army_loc[num] = l
  call RemoveLocation(army_future[num])
  set army_future[num] = l_add_kd(army_loc[num], l_mult_k(army_dir[num], army_future_mult))
  set l = null
  if army_strength[num] == 0 then
    call DestroyGroup(army_group[num])
    call RemoveLocation(army_loc[num])
    call RemoveLocation(army_dir[num])
    call RemoveLocation(army_future[num])
    return false
  endif
  return true
endfunction

function TrackExistingArmies takes nothing returns nothing
  local integer i = 0
  local integer first_free = 0
  loop
    exitwhen i >= army_num
    if TrackArmy(i) then
      call CopyArmy(i, first_free)
      set first_free = first_free + 1
    endif
    set i = i + 1
  endloop
  set army_num = first_free
endfunction

function SeedNewArmyAtLoc takes location l, integer p returns nothing
  set army_owner[army_num] = p
  set army_loc[army_num] = l
  set army_group[army_num] = CreateGroup()
  call TrackArmy(army_num)
  set army_num = army_num + 1
endfunction

function SeedNewArmiesForPlayer takes integer p returns nothing
  local group g = CreateGroup()
  local unit u = null
  local location l = null
  call GroupEnumUnitsOfPlayer(g, Player(p), null)
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    if UnitAlive(u) and (IsUnitType(u, UNIT_TYPE_HERO) or (GetRandomInt(0, 30) == 1 and not (IsUnitType(u, UNIT_TYPE_STRUCTURE) or IsUnitType(u, UNIT_TYPE_PEON)))) and not IsUnitInGroup(u, in_army_group) then
      call SeedNewArmyAtLoc(GetUnitLoc(u), p)
    endif
    call GroupRemoveUnit(g, u)
  endloop
  call DestroyGroup(g)
  set g = null
  set l = null
endfunction

function SeedNewArmies takes nothing returns nothing
  local integer p = 0
  loop
    exitwhen p > 11
    if GetPlayerSlotState(Player(p)) == PLAYER_SLOT_STATE_PLAYING then
      call SeedNewArmiesForPlayer(p)
    endif
    set p = p + 1
  endloop
endfunction

function UpdateSpecificTownThreat takes integer num returns nothing
  local integer i = 0
  local real dist = 0
  local real threat = 0
  local real max_threat = 0
  local real accepted_threat_level = LinearInterpolation(atl_time_start, atl_time_end, atl_time_start_val, atl_time_end_val, TimerGetElapsed(tq_timer)) * LinearInterpolation(atl_enemy_start, atl_enemy_end, atl_enemy_start_mult, atl_enemy_end_mult, c_enemy_total)
  set town_threat[num] = 0
  loop
    exitwhen i >= army_num
    set dist = r_maximum(DistanceBetweenPoints_kk(army_future[i], town_loc[num]), full_threat_distance)
    if dist <= no_threat_distance then
      if DistanceBetweenPoints_kk(army_loc[i], town_loc[num]) < l_length_k(army_dir[i]) and r_absolute(l_angle_kd(army_dir[i], l_sub_kk(town_loc[num], army_loc[i]))) <= 0.4 then
        set dist = full_threat_distance
      endif
      set threat = distance_threat_mult * army_strength[i] / Pow(dist, distance_threat_exponent)
      if IsPlayerAlly(Player(town_owner[num]), Player(army_owner[i])) then
        set town_threat[num] = town_threat[num] - threat
      else
        set town_threat[num] = town_threat[num] + threat
        if threat > max_threat then
          set max_threat = threat
          set town_threat_army[num] = i
        endif
      endif
    endif
    set i = i + 1
  endloop
  if town_threat[num] > accepted_threat_level and IsPlayerAlly(Player(town_owner[num]), ai_player) then
    set town_threatened = true
    if most_threatened_town == -1 or town_threat[most_threatened_town] < town_threat[num] then
      set most_threatened_town = num
    endif
  endif
endfunction

function UpdateTownThreat takes nothing returns nothing
  local integer i = 0
  set town_threatened = false
  set most_threatened_town = -1
  loop
    exitwhen i >= town_num
    call UpdateSpecificTownThreat(i)
    set i = i + 1
  endloop
endfunction

function ArmyTrackJob takes nothing returns nothing
  call GroupClear(in_army_group)
  call TrackExistingArmies()
  call SeedNewArmies()
  call UpdateTownThreat()
  call TQAddJob(4, ARMY_TRACK, 0)
endfunction

function CopyTown takes integer from, integer to returns nothing
  set town_owner[to] = town_owner[from]
  set town_loc[to] = town_loc[from]
  set town_value[to] = town_value[from]
  set town_threat[to] = town_threat[from]
  set town_group[to] = town_group[from]
  set town_count[to] = town_count[from]
endfunction

function TrackTown takes integer num returns boolean
  local group g = CreateGroup()
  local unit u = null
  local location l = Location(0,0)
  call GroupClear(town_group[num])
  set town_value[num] = 0
  set town_count[num] = 0
  set town_can_tp[num] = false
  call GroupEnumUnitsInRangeOfLoc(g, town_loc[num], town_radius, null)
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    if UnitAlive(u) and GetOwningPlayer(u) == Player(town_owner[num]) and IsUnitType(u, UNIT_TYPE_STRUCTURE) and not IsUnitInGroup(u, in_town_group) then
      call GroupAddUnit(town_group[num], u)
      call GroupAddUnit(in_town_group, u)
      set l = l_add_dd(l, GetUnitLoc(u))
      set town_count[num] = town_count[num] + 1
      set town_value[num] = town_value[num] + 1
      if IsUnitType(u, UNIT_TYPE_TOWNHALL) then
        set town_can_tp[num] = true
      endif
    endif
    call GroupRemoveUnit(g, u)
  endloop
  call DestroyGroup(g)
  set g = null
  set l = l_div_d(l, maximum(town_count[num], 1))
  call RemoveLocation(town_loc[num])
  set town_loc[num] = l
  set l = null
  if town_count[num] == 0 then
    call DestroyGroup(town_group[num])
    call RemoveLocation(town_loc[num])
    return false
  endif
  return true
endfunction

function TrackExistingTowns takes nothing returns nothing
  local integer i = 0
  local integer first_free = 0
  loop
    exitwhen i >= town_num
    if TrackTown(i) then
      call CopyTown(i, first_free)
      set first_free = first_free + 1
    endif
    set i = i + 1
  endloop
  set town_num = first_free
endfunction

function SeedNewTownAtLoc takes location l, integer p returns nothing
  set town_owner[town_num] = p
  set town_loc[town_num] = l
  set town_threat[town_num] = 0
  set town_group[town_num] = CreateGroup()
  call TrackTown(town_num)
  set town_num = town_num + 1
endfunction

function SeedNewTownsForPlayer takes integer p returns nothing
  local group g = CreateGroup()
  local unit u = null
  local location l = null
  call GroupEnumUnitsOfPlayer(g, Player(p), null)
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    if IsUnitType(u, UNIT_TYPE_STRUCTURE) and UnitAlive(u) and not IsUnitInGroup(u, in_town_group) then
      call SeedNewTownAtLoc(GetUnitLoc(u), p)
    endif
    call GroupRemoveUnit(g, u)
  endloop
  call DestroyGroup(g)
  set g = null
  set l = null
endfunction

function SeedNewTowns takes nothing returns nothing
  local integer p = 0
  loop
    exitwhen p > 11
    if GetPlayerSlotState(Player(p)) == PLAYER_SLOT_STATE_PLAYING then
      call SeedNewTownsForPlayer(p)
    endif
    set p = p + 1
  endloop
endfunction

function TownTrackJob takes nothing returns nothing
  call GroupClear(in_town_group)
  call TrackExistingTowns()
  call SeedNewTowns()
  call TQAddJob(9, TOWN_TRACK, 0)
endfunction

function TQDoJob takes integer jid, integer par, unit unit_par, group group_par returns nothing
  if jid == MICRO_HERO then
    call MicroHeroJob(par)
  elseif jid == RETREAT_CONTROL then
    call RetreatControlJob()
  elseif jid == ZEPPELIN_FOLLOW then
    call ZeppelinFollowJob()
  elseif jid == RESET_GUARD_POSITION then
    call ResetGuardPositionJob(unit_par)
  elseif jid == HARASS then
    call HarassJob(par, unit_par, group_par)
  elseif jid == HEALTH_FOUNTAIN then
    call HealthFountainJob(unit_par, par)
  elseif jid == NEUTRAL_ENEMY_CHECK then
    call NeutralEnemyCheckJob(par)
  elseif jid == BUY_NEUTRAL then
    call BuyNeutral(par)
  elseif jid == BUY_ITEM then
    call BuyItemJob(par)
  elseif jid == TELEPORT then
    call TeleportJob(unit_par)
  elseif jid == ZEPPELIN_MOVE then
    call ZeppelinMoveJob(par, unit_par, group_par)
  elseif jid == ARMY_TRACK then
    call ArmyTrackJob()
  elseif jid == UPDATE_STRENGTH then
    call UpdateStrengthJob()
  elseif jid == EXCHANGE then
    call ExchangeJob()
  elseif jid == DETECT_DEFEAT then
    call DetectDefeatJob()
  elseif jid == DETECT_DOUBLE_EXP then
    call DetectDoubleExpJob()
  elseif jid == TOWN_TRACK then
    call TownTrackJob()
  elseif jid == NEUTRAL_GUARDED then
    call NeutralGuardedJob(par)
  elseif jid == REPAIR_CONTROL then
    call RepairControlJob()
  elseif jid == DELETE_BLOCK_LIST then
    call DeleteBlockListJob()
  elseif jid == DELETE_RBLOCK_LIST then
    call DeleteRBlockListJob()
  elseif jid == CLEANUP_BLOCKS then
    call CleanupBlocksJob()
  elseif jid == TIMED_CHAT then
    call chat(par)
  elseif jid == REVEAL_ENEMY then
    call RevealEnemy()
  elseif jid == RESET_HEALTH then
    call ResetByHealthJob(unit_par, par)
  elseif jid == RALLY_POINT then
    call RallypointJob()
  elseif jid == WISP_CHECK then
    call WispCheckJob()
  endif
endfunction

function TQHandleOnce takes nothing returns boolean
  local integer jid = tq_jid[1]
  local integer par = tq_par[1]
  local unit unit_par = tq_unit_par[1]
  local group group_par = tq_group_par[1]
  if TimerGetElapsed(tq_timer) >= tq_time[1] then
    call TQRemoveRoot()
    call TQDoJob(jid, par, unit_par, group_par)
    return true
  endif
  return false
endfunction

function TQInitJobs takes nothing returns nothing
  call TQAddJob(GetRandomReal(50, 65), UPDATE_STRENGTH, 0)
  call TQAddJob(GetRandomReal(120, 135), REVEAL_ENEMY, 0)
  call TQAddJob(GetRandomReal(60, 70), CLEANUP_BLOCKS, 0)
  call TQAddJob(GetRandomReal(10, 20), REPAIR_CONTROL, 0)
  call TQAddJob(GetRandomReal(20, 30), RALLY_POINT, 0)
  call TQAddJob(GetRandomReal(100, 120), ZEPPELIN_FOLLOW, 0)
  call TQAddJob(GetRandomReal(70, 80), ARMY_TRACK, 0)
  call TQAddJob(GetRandomReal(70, 80), TOWN_TRACK, 0)
  if not campaign_ai then
    call TQAddJob(GetRandomReal(5, 30), TIMED_CHAT, C_GREET)
    call TQAddJob(GetRandomReal(5, 10), TIMED_CHAT, C_STRATEGY)
    if force_number > 1 then
      call TQAddJob(GetRandomReal(75, 90), EXCHANGE, 0)
    endif
    call TQAddJob(GetRandomReal(90, 110), DETECT_DEFEAT, 0)
    call TQAddJob(GetRandomReal(100, 120), DETECT_DOUBLE_EXP, 0)
  endif
  if own_race == R_ELF then
    call TQAddJob(GetRandomReal(200, 220), WISP_CHECK, 0)
  endif
endfunction

function TQLoop takes nothing returns nothing
  set tq_time[0] = 0
  call TimerStart(tq_timer, 1000000, false, null)
  call TQInitJobs()
  loop
    if tq_length > 0 then
      if not TQHandleOnce() then
        call Sleep(r_minimum(tq_time[1] - TimerGetElapsed(tq_timer) + 0.05 ,1))
      endif
    else
      call Sleep(sleep_multiplier)
    endif
  endloop
endfunction

function CheckNeutral takes integer nn returns nothing
  local group g = CreateGroup()
  call GroupEnumUnitsOfType(g, neutral_name[nn], null)
  if FirstOfGroup(g) == null then
    set neutral_available[nn] = false
    call DestroyGroup(g)
    set g = null
    return
  else
    set neutral_available[nn] = true
    set nearest_neutral[nn] = GetNearestOfGroup_d(g, GetPlayerStartLocationLoc(ai_player))
    set neutral_guarded[nn] = GetLocationCreepStrength(GetUnitX(nearest_neutral[nn]), GetUnitY(nearest_neutral[nn]), 500) > 0
    set neutral_night_buy[nn] = not no_sleep
    if neutral_guarded[nn] then
      call TQAddJob(30 * sleep_multiplier, NEUTRAL_GUARDED, nn)
    endif
  endif
  set g = null
endfunction

function SetDragons takes nothing returns nothing
  local group g = CreateGroup()
  local string array add
  local integer i = 0
  local integer j = 0

  set add[1] = "blackdragonroost"
  set add[2] = "bluedragonroost"
  set add[3] = "bronzedragonroost"
  set add[4] = "greendragonroost"
  set add[5] = "outlanddragonroost"
  set add[6] = "reddragonroost"
  set j = 6

  loop
    set i=i+1
    call GroupEnumUnitsOfType(g, add[i], null)
    exitwhen (FirstOfGroup(g) != null) or i >= j
  endloop
  call DestroyGroup(g)
  set g = null

  if false then
  elseif i == 1 then
    set dragons[1] = BLACK_DRAGON_1
    set dragons[2] = BLACK_DRAGON_2
    set dragons[3] = BLACK_DRAGON_3
  elseif i == 2 then
    set dragons[1] = BLUE_DRAGON_1
    set dragons[2] = BLUE_DRAGON_2
    set dragons[3] = BLUE_DRAGON_3
  elseif i == 3 then
    set dragons[1] = BRONZE_DRAGON_1
    set dragons[2] = BRONZE_DRAGON_2
    set dragons[3] = BRONZE_DRAGON_3
  elseif i == 4 then
    set dragons[1] = GREEN_DRAGON_1
    set dragons[2] = GREEN_DRAGON_2
    set dragons[3] = GREEN_DRAGON_3
  elseif i == 5 then
    set dragons[1] = NETHER_DRAGON_1
    set dragons[2] = NETHER_DRAGON_2
    set dragons[3] = NETHER_DRAGON_3
  elseif i == 6 then
    set dragons[1] = RED_DRAGON_1
    set dragons[2] = RED_DRAGON_2
    set dragons[3] = RED_DRAGON_3
  endif
  
  set neutral_name[NEUTRAL_DRAGON_ROOST] = add[i]

endfunction

function SetMercenaries takes nothing returns nothing
  local integer i = 0
  local group g = CreateGroup()
  local string array add
  local integer j = 0

  set add[1] = "mercenarycampa"
  set add[2] = "mercenarycampb"
  set add[3] = "mercenarycampk"
  set add[4] = "mercenarycampy"
  set add[5] = "mercenarycampx"
  set add[6] = "mercenarycampd"
  set add[7] = "mercenarycampc"
  set add[8] = "mercenarycampi"
  set add[9] = "mercenarycampf"
  set add[10] = "mercenarycampl"
  set add[11] = "mercenarycampw"
  set add[12] = "mercenarycampn"
  set add[13] = "mercenarycampo"
  set add[14] = "mercenarycampz"
  set add[15] = "mercenarycampg"
  set add[16] = "mercenarycampv"
  set j = 16

  loop
    set i=i+1
    call GroupEnumUnitsOfType(g, add[i] , null)
    exitwhen (FirstOfGroup(g) != null) or (i >= j)
  endloop
  call DestroyGroup(g)
  set g = null

  if false then
  elseif i == 1 then
    set merc_unit[0] = SATYR_SHADOWDANCER
    set merc_unit[1] = FURBOLG_SHAMAN
    set merc_unit[2] = THUNDER_LIZARD
    set merc_unit[3] = 0
    set merc_healer = FURBOLG_SHAMAN
    set merc_caster = SATYR_SHADOWDANCER
    set merc_melee = 0
    set merc_range = THUNDER_LIZARD
    set merc_stopper = THUNDER_LIZARD
    set merc_rush = 0
  elseif i == 2 then
    set merc_unit[0] = CENTAUR_OUTRUNNER
    set merc_unit[1] = HARPY_ROGUE
    set merc_unit[2] = RAZORMANE_MEDICINE_MAN
    set merc_unit[3] = HARPY_WINDWITCH
    set merc_healer = RAZORMANE_MEDICINE_MAN
    set merc_caster = HARPY_WINDWITCH
    set merc_melee = CENTAUR_OUTRUNNER
    set merc_range = HARPY_ROGUE
    set merc_stopper = 0
    set merc_rush = CENTAUR_OUTRUNNER
  elseif i == 3 then
    set merc_unit[0] = FEL_BEAST
    set merc_unit[1] = DRAENEI_DISCIPLE
    set merc_unit[2] = VOIDWALKER
    set merc_unit[3] = DRAENEI_DARKSLAYER
    set merc_healer = DRAENEI_DISCIPLE
    set merc_caster = VOIDWALKER
    set merc_melee = DRAENEI_DARKSLAYER
    set merc_range = VOIDWALKER
    set merc_stopper = 0
    set merc_rush = FEL_BEAST
  elseif i == 4 then
    set merc_unit[0] = ROGUE
    set merc_unit[1] = ASSASSIN
    set merc_unit[2] = KOBOLD_GEOMANCER
    set merc_unit[3] = FOREST_TROLL_HIGH_PRIEST
    set merc_healer = FOREST_TROLL_HIGH_PRIEST
    set merc_caster = KOBOLD_GEOMANCER
    set merc_melee = ROGUE
    set merc_range = ASSASSIN
    set merc_stopper = 0
    set merc_rush = 0
  elseif i == 5 then
    set merc_unit[0] = ROGUE
    set merc_unit[1] = ASSASSIN
    set merc_unit[2] = KOBOLD_GEOMANCER
    set merc_unit[3] = FOREST_TROLL_HIGH_PRIEST
    set merc_healer = FOREST_TROLL_HIGH_PRIEST
    set merc_caster = KOBOLD_GEOMANCER
    set merc_melee = ROGUE
    set merc_range = ASSASSIN
    set merc_stopper = 0
    set merc_rush = 0
  elseif i == 6 then
    set merc_unit[0] = BURNING_ARCHER
    set merc_unit[1] = KOBOLD_GEOMANCER
    set merc_unit[2] = WILDKIN
    set merc_unit[3] = 0
    set merc_healer = 0
    set merc_caster = KOBOLD_GEOMANCER
    set merc_melee = WILDKIN
    set merc_range = BURNING_ARCHER
    set merc_stopper = 0
    set merc_rush = BURNING_ARCHER
  elseif i == 7 then
    set merc_unit[0] = MURLOC_FLESHEATER
    set merc_unit[1] = SLUDGE_FLINGER
    set merc_unit[2] = SATYR_SOULSTEALER
    set merc_unit[3] = 0
    set merc_healer = 0
    set merc_caster = SATYR_SOULSTEALER
    set merc_melee = MURLOC_FLESHEATER
    set merc_range = SLUDGE_FLINGER
    set merc_stopper = 0
    set merc_rush = MURLOC_FLESHEATER
  elseif i == 8 then
    set merc_unit[0] = BARBED_ARACHNATHID
    set merc_unit[1] = BLUE_DRAGONSPAWN_MEDDLER
    set merc_unit[2] = MAGNATAUR_WARRIOR
    set merc_unit[3] = POLAR_FURBOLG_SHAMAN
    set merc_healer = 0
    set merc_caster = POLAR_FURBOLG_SHAMAN
    set merc_melee = MAGNATAUR_WARRIOR
    set merc_range = 0
    set merc_stopper = 0
    set merc_rush = BARBED_ARACHNATHID
  elseif i == 9 then
    set merc_unit[0] = GNOLL_BRUTE
    set merc_unit[1] = GNOLL_WARDEN
    set merc_unit[2] = OGRE_MAGI
    set merc_unit[3] = MUD_GOLEM
    set merc_healer = 0
    set merc_caster = OGRE_MAGI
    set merc_melee = GNOLL_BRUTE
    set merc_range = GNOLL_WARDEN
    set merc_stopper = 0
    set merc_rush = GNOLL_BRUTE
  elseif i == 10 then
    set merc_unit[0] = FOREST_TROLL_BERSERKER
    set merc_unit[1] = FOREST_TROLL_SHADOW_PRIEST
    set merc_unit[2] = OGRE_MAULER
    set merc_unit[3] = MUD_GOLEM
    set merc_healer = FOREST_TROLL_SHADOW_PRIEST
    set merc_caster = MUD_GOLEM
    set merc_melee = OGRE_MAULER
    set merc_range = FOREST_TROLL_BERSERKER
    set merc_stopper = 0
    set merc_rush = 0
  elseif i == 11 then
    set merc_unit[0] = GNOLL_OVERSEER
    set merc_unit[1] = ICE_TROLL_BERSERKER
    set merc_unit[2] = ICE_TROLL_TRAPPER
    set merc_unit[3] = MUD_GOLEM
    set merc_healer = 0
    set merc_caster = MUD_GOLEM
    set merc_melee = GNOLL_OVERSEER
    set merc_range = ICE_TROLL_BERSERKER
    set merc_stopper = ICE_TROLL_TRAPPER
    set merc_rush = 0
  elseif i == 12 then
    set merc_unit[0] = NERUBIAN_WARRIOR
    set merc_unit[1] = ICE_TROLL_BERSERKER
    set merc_unit[2] = FROST_REVENANT
    set merc_unit[3] = NERUBIAN_WEBSPINNER
    set merc_healer = 0
    set merc_caster = FROST_REVENANT
    set merc_melee = NERUBIAN_WARRIOR
    set merc_range = ICE_TROLL_BERSERKER
    set merc_stopper = NERUBIAN_WEBSPINNER
    set merc_rush = NERUBIAN_WARRIOR
  elseif i == 13 then
    set merc_unit[0] = FEL_BEAST
    set merc_unit[1] = DRAENEI_DISCIPLE
    set merc_unit[2] = VOIDWALKER
    set merc_unit[3] = DRAENEI_DARKSLAYER
    set merc_healer = DRAENEI_DISCIPLE
    set merc_caster = VOIDWALKER
    set merc_melee = DRAENEI_DARKSLAYER
    set merc_range = VOIDWALKER
    set merc_stopper = 0
    set merc_rush = FEL_BEAST
  elseif i == 14 then
    set merc_unit[0] = MURGUL_SNARECASTER
    set merc_unit[1] = MAKRURA_SNAPPER
    set merc_unit[2] = MAKRURA_DEEPSEER
    set merc_unit[3] = GIANT_SEA_TURTLE
    set merc_healer = 0
    set merc_caster = MAKRURA_DEEPSEER
    set merc_melee = MAKRURA_SNAPPER
    set merc_range = GIANT_SEA_TURTLE
    set merc_stopper = 0
    set merc_rush = GIANT_SEA_TURTLE
  elseif i == 15 then
    set merc_unit[0] = BURNING_ARCHER
    set merc_unit[1] = KOBOLD_GEOMANCER
    set merc_unit[2] = WILDKIN
    set merc_unit[3] = 0
    set merc_healer = 0
    set merc_caster = KOBOLD_GEOMANCER
    set merc_melee = WILDKIN
    set merc_range = BURNING_ARCHER
    set merc_stopper = 0
    set merc_rush = BURNING_ARCHER
  elseif i == 16 then
    set merc_unit[0] = KOBOLD
    set merc_unit[1] = MURLOC_HUNTSMAN
    set merc_unit[2] = ASSASSIN
    set merc_unit[3] = KOBOLD_GEOMANCER
    set merc_healer = 0
    set merc_caster = KOBOLD_GEOMANCER
    set merc_melee = KOBOLD
    set merc_range = ASSASSIN
    set merc_stopper = MURLOC_HUNTSMAN
    set merc_rush = KOBOLD
  endif

  set merc_number = 0
  set j = 0
  loop
    exitwhen j >= 4
    if merc_unit[j] != 0 then
      set merc_number = merc_number + 1
    endif
    set j = j + 1
  endloop
  
  set neutral_name[NEUTRAL_MERC_CAMP] = add[i]
endfunction

function CheckAllNeutrals takes nothing returns nothing
  local integer i = 0
  call SetMercenaries()
  call SetDragons()
  set neutral_name[NEUTRAL_OBSERVATORY] = "goblinammodump"
  set neutral_name[NEUTRAL_TAVERN] = "cantina"
  set neutral_name[NEUTRAL_HEALING_FOUNTAIN] = "fountainofhealth"
  set neutral_name[NEUTRAL_MERCHANT] = "goblinmerchant"
  loop
    exitwhen i > 5
    call CheckNeutral(i)
    set neutral_ordered[i] = false
    set neutral_sent[i] = null
    set buy_time_large[i] = -1
    set buy_time_small[i] = -1
    set i = i + 1
  endloop
  if neutral_available[NEUTRAL_HEALING_FOUNTAIN] then
    call TQAddJob(10, NEUTRAL_ENEMY_CHECK, NEUTRAL_HEALING_FOUNTAIN)
  endif
endfunction

function QueueReset takes nothing returns nothing
    set queue_length 	= 0
    set queue_pointer	= 0
endfunction

function QueueRestart takes nothing returns nothing
    set queue_pointer	= 0
endfunction

function QueueGetNextUnit takes nothing returns unit
    return target_queue_u[queue_pointer]
endfunction

function QueueGetNextX takes nothing returns integer
    return target_queue_x[queue_pointer]
endfunction

function QueueGetNextY takes nothing returns integer
    return target_queue_y[queue_pointer]
endfunction

function QueuePopCommand takes nothing returns nothing
    set queue_pointer = queue_pointer + 1
endfunction

function QueueFinished takes nothing returns boolean
    return queue_pointer >= queue_length
endfunction

function QueueGetNextCommand takes nothing returns boolean
  if QueueFinished() then
    set queue_running = false
    call QueueReset()
    return false
  else
    set queue_t_u = QueueGetNextUnit()
    if queue_t_u == null then
	set queue_t_x = QueueGetNextX()
	set queue_t_y = QueueGetNextY()
	set queue_attack_p = true
	set queue_attack_u = false
    else
	set queue_attack_u = true
	set queue_attack_p = false
    endif
    call QueuePopCommand()
    return true
  endif
endfunction

function QueueSetCommand takes integer x, integer y, unit u returns nothing
  set target_queue_x[queue_length] = x
  set target_queue_y[queue_length] = y
  set target_queue_u[queue_length] = u
  set queue_length = queue_length + 1
endfunction

function QueueRemoveCommand takes nothing returns nothing
  set queue_length = queue_length - 1
endfunction

function cmd_cancel takes integer cmd, integer data returns nothing
  if cmd == 0 then		// Cancel all orders
    set break_attack 	= false
    set go_home		= false
    set strategy	= chosen_strategy
    set attack_player	= false
    set attack_point	= false
    set no_attack	= false
    set no_creep_attack	= false
    set no_player_attack = false
    set queue_running	= false
    call DisplayToAllDebug("Cancel All command" )

  elseif cmd == 1 then	// Cancel build orders
    set strategy = chosen_strategy
    call DisplayToAllDebug("Cancel Build Command" )

  elseif cmd == 2 then	// Cancel attacking orders
    set attack_player	= false
    set attack_point	= false
    set no_attack	= false
    set no_creep_attack	= false
    set no_player_attack = false
    set queue_running	= false
    call DisplayToAllDebug("Cancel Attack Command" )

  endif
endfunction

function cmd_attack takes integer cmd, integer data returns nothing
  local group gr = null
  if cmd == 10 then	// Stop the current attack
    set break_attack	= true
    set go_home		= true
    set queue_running	= false
    set attack_player	= false
    set attack_point	= false
    call DisplayToAllDebug("Stop Attack Command" )

  elseif cmd == 11 then	// Start no attacks
    set break_attack	= true
    set no_attack		= true
    call DisplayToAllDebug("No Attacks Command" )
  elseif cmd == 12 then	// Attack specific player
    set break_attack	= true
    set go_home		= false
    set attack_target_p = data
    set attack_player	= true
    set attack_point	= false
    call DisplayToAllDebug("Attack Player Command" )

  elseif cmd == 13 then	// Attack specific point
    call DisplayToAllDebug("Attack Point Command" )
    loop
      exitwhen CommandsWaiting()!=0
      call Sleep(0.5)
    endloop
    set attack_target_x	= GetLastCommand()
    set attack_target_y	= GetLastData()
    set break_attack	= true
    set go_home		= false
    set attack_point	= true
    set attack_player	= false
    call PopLastCommand()
    call DisplayToAllDebug("Attack Coordinates received" )

  elseif cmd == 14 then	// No attacks on creeps
    set no_creep_attack	= true
    call DisplayToAllDebug("Attack No Creeps" )

  elseif cmd == 15 then	// No attack on players
    set no_player_attack = true
    call DisplayToAllDebug("Attack No Player" )

  elseif cmd == 16 then	// Attack selected unit
    set gr = CreateGroup()
    call GroupEnumUnitsSelected(gr, Player(data), null)
    set target_unit	= FirstOfGroup(gr)
    call DestroyGroup(gr)
    set gr = null
    if target_unit == null then
      call DisplayToAllies(chat_no_unit_selected)
    endif
    set attack_point	= false
    set attack_player	= false
    set attack_unit	= true
    set break_attack	= true
    set go_home		= false
    call DisplayToAllies(chat_confirm_attack_unit)

  elseif cmd == 17 then // Towerrush
    if own_race == R_ORC then
      set towerrush = true
      call DisplayToAllies(chat_towerrush)
    else
      call DisplayToAllies(chat_no_orc)
    endif

  endif
endfunction

function cmd_build takes integer cmd, integer data returns nothing
  if false then
  elseif cmd == 20 then
    set strategy = 50
    set bn_airair = data
  elseif cmd == 21 then
    set strategy = 51
    set bn_airground = data
  elseif cmd == 22 then
    set strategy = 52
    set bn_groundair = data
  elseif cmd == 23 then
    set strategy = 53
    set bn_groundground = data
  elseif cmd == 24 then
    set strategy = 54
    set bn_farm = data
  elseif cmd == 25 then
    set strategy = 55
    set bn_guard = data
  endif
endfunction

function cmd_queue takes integer cmd, integer data returns nothing
  local group gr = null
  if cmd == 30 then	// Cancel queue
    call QueueReset()
    set queue_running 	= false
    call DisplayToAllDebug("Cancel Queue Command" )

  elseif cmd == 31 then	// Queue Attack specific point
    call DisplayToAllDebug("Queue Attack Point Command" )
    loop
      exitwhen CommandsWaiting()!=0
      call Sleep(0.5)
    endloop
    call QueueSetCommand(GetLastCommand(), GetLastData(), null)
    call PopLastCommand()
    call DisplayToAllDebug("Attack Coordinates received" )

  elseif cmd == 32 then	// Queue Attack selected unit
    set gr = CreateGroup()
    call GroupEnumUnitsSelected(gr, Player(data), null)
    if FirstOfGroup(gr) == null then
      call DisplayToAllies(chat_no_unit_selected)
    else
      call QueueSetCommand(0,0, FirstOfGroup(gr))
      call DisplayToAllies(chat_confirm_attack_unit)
    endif
    call DestroyGroup(gr)
    set gr = null

  elseif cmd == 33 then	// Starting or Restarting queue
    call QueueRestart()
    if QueueGetNextCommand() then
      set queue_running = true
      set no_attack	= false
      call DisplayToAllDebug("Queue started" )
    else
      call DisplayToAllDebug("Queue is empty" )
    endif

  elseif cmd == 34 then	// Pausing queue
    set queue_running = false

  elseif cmd == 35 then	// Unpausing queue
    set queue_running = true

  elseif cmd == 36 then	// Removing last command
    call QueueRemoveCommand()

  endif
endfunction

function cmd_misc takes integer cmd, integer data returns nothing
  if cmd == 50 then	// Triggering chat
    set chatting = not chatting

  elseif cmd == 51 then	// Triggering debug
    set debugging = not debugging

  elseif cmd == 52 then	// Triggering balancing
    set balancing = not balancing

  elseif cmd == 53 then
    set strat_change_allowed = not strat_change_allowed

  elseif cmd == 60 then // Show strat name
    call DisplayToAllies(GetCurrentStrategyReport())

  elseif cmd == 61 then // Show all strats
    call DisplayStratNames()

  elseif cmd == 70 then // change strategy
    if data < rp_strat_length then
      set strategy = data
      set chosen_strategy = strategy
    else
      call DisplayToAllies("Invalid strategy number")
    endif

  elseif cmd == 71 then // change language
    if false then
    elseif data == 0 then
      set language = "English"
    elseif data == 1 then
      set language = "Deutsch"
    elseif data == 2 then
      set language = "Swedish"
    elseif data == 3 then
      set language = "French"
    elseif data == 4 then
      set language = "Spanish"
    elseif data == 5 then
      set language = "Romanian"
    elseif data == 6 then
      set language = "Chinese"
    endif
    call initChatArrays()

  endif
endfunction

function cmd_loop takes nothing returns nothing
  local integer cmd = 0
  local integer data = 0

  call StaggerSleep(0,3)

  loop
    call DisplayToAllDebug("Beginning command loop" )
    loop
      exitwhen CommandsWaiting()!=0
      exitwhen player_defeated
      call Sleep(command_wait * sleep_multiplier)
    endloop
    exitwhen player_defeated
    set cmd = GetLastCommand()
    set data = GetLastData()
    call PopLastCommand()
    call DisplayToAllDebug("Receiving command" )

    if cmd < 10 then
      call cmd_cancel(cmd, data)

    elseif cmd < 20 then
      call cmd_attack(cmd, data)

    elseif cmd < 30 then
      call cmd_build(cmd, data)

    elseif cmd < 40 then
      call cmd_queue(cmd, data)

    else
      call cmd_misc(cmd, data)

    endif

  endloop
call DisplayToAllDebug("No Commander or player defeated, shutting down cmd_loop")

endfunction

function initTownBuilt takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i >= max_towns
    set town_built[i] = false
    set i = i + 1
  endloop
endfunction

function GetBuildLock takes nothing returns nothing
    loop
      exitwhen build_lock
      call DisplayToAllDebug("Build Lock not received")
      call Sleep(0.5)
    endloop
    set build_lock = false
endfunction

function ReleaseBuildLock takes nothing returns nothing
    set build_lock = true
endfunction

function InitBuildArray takes nothing returns nothing
    local integer i = building_begin
    call GetBuildLock()
    set build_length = 0
    loop
      exitwhen i > building_end
      set income_percentage[i] = 1 / I2R(building_end - building_begin + 1)
      set i = i + 1
    endloop
    call ReleaseBuildLock()
endfunction

function InitUpgradeTimeArray takes nothing returns nothing
  local integer i = UPG_MELEE
  loop
    exitwhen i > UPG_WELL_SPRING
    set upgrade_time[i] = -1
    set i = i + 1
  endloop
endfunction

function InitPlayerStrengthCache takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i >= 12
    set p_str_cache[i] = 0
    set p_str_cache_timeout[i] = 0
    set i = i + 1
  endloop
endfunction

function initHeroArrays takes nothing returns nothing
  local integer i = 1
  loop
    exitwhen i > 3
    set hero_id[i] = 0
    set hero_built[i] = false
    set hero_unit[i] = null
    set i = i + 1
  endloop
  set hero_revive_prio[1] = hero1_revive_prio
  set hero_revive_prio[2] = hero2_revive_prio
  set hero_revive_prio[3] = hero3_revive_prio
endfunction

function initNeutralSpecial takes nothing returns nothing
  set neutral_zeppelin = ZEPPELIN
  set neutral_shredder = SHREDDER
  set tp_item = TOWN_PORTAL
endfunction

function initCreepStrengthArray takes nothing returns nothing
  set creep_strength[0] = 0
  set creep_strength[1] = 1
  set creep_strength[2] = 2
  set creep_strength[3] = 3
  set creep_strength[4] = 4
  set creep_strength[5] = 6
  set creep_strength[6] = 8
  set creep_strength[7] = 10
  set creep_strength[8] = 12
  set creep_strength[9] = 14
  set creep_strength[10] = 16
  set creep_strength[11] = 18
  set creep_strength[12] = 20
  set creep_strength_length = 13
endfunction

function initGlobalSettings takes nothing returns nothing
  set sleep_multiplier = 1
  set slm_start = 4
  set slm_end = 10
  set slm_start_mult = 1
  set slm_end_mult = 2
  set gold_unit_percentage = 0.9
  set hero_radius = 200
  set low_upkeep_border = 50
  set high_upkeep_border = 80
  set low_upkeep_save_time = 12
  set high_upkeep_save_time = 40
  set use_linear_upkeep_saving = false
  set repair_threshold = 6
  set repair_threshold_threatened = 8
  set max_follow_dist = 1000
  set neutral_hero_time = 25
  set buy_distance = 350
  set buy_timeout_large = 120
  set buy_timeout_small = 15
  set build_array_reset_time = 100
  set rp_strat_normal = 250
  set strategy_tier_bonus = 35
  set attacking_strategy = 4
  set battle_radius = 1500
  set focus_fire_limit = 35
  set focus_fire_ranged_dist = 600
  set focus_fire_melee_dist = 50
  set flee_health_percentage = 0.25
  set flee_minimum_health = 100
  set statue_distance = 300
  set teleport_radius = 800
  set gold_exchange_level = 650
  set wood_exchange_level = 350
  set max_towns = 5
  set add_tag = true
  set add_skill = false
  set fav_hero_add  = 20
  set path_grid_number = 90
  set pathing_limit = 1000
  set max_harass_groups = 10
  set attacking_aggression = 2
  set expansion_radius = 1000
  set harass_radius_attack_ranged = 800
  set harass_radius_attack_melee = 400
  set harass_radius_flee_ranged = 1200
  set harass_radius_flee_melee = 800
  set chatting = true
  set full_threat_distance = 600
  set no_threat_distance = 3000
  set distance_threat_exponent = 0.8
  set distance_threat_mult = 540
  set atl_time_start = 300
  set atl_time_end = 900
  set atl_time_start_val = 10
  set atl_time_end_val = 20
  set atl_enemy_start = 1
  set atl_enemy_end = 4
  set atl_enemy_start_mult = 1
  set atl_enemy_end_mult = 1.5
  set teleport_low_threat = 70
  set teleport_high_threat = 120
  set teleport_low_threat_distance = 5000
  set teleport_high_threat_distance = 3000
  set teleport_army_min_strength = 20
  set teleport_min_threat = 70
  set shredder_peon_count = 9
  set minimum_peon_wood = 2000
  set maximum_peon_wood = 200
endfunction

function IsGameFFA takes nothing returns boolean
  local boolean array team_exists
  local integer i = 0
  local integer tc = 0
  loop
    exitwhen i >= 12
    set team_exists[i] = false
    set i = i + 1
  endloop
  set i = 0
  loop
    exitwhen i >= 12
    if GetPlayerSlotState(Player(i)) == PLAYER_SLOT_STATE_PLAYING then
      set team_exists[GetPlayerTeam(Player(i))] = true
    endif
    set i = i + 1
  endloop
  set i = 0
  loop
    exitwhen i >= 12
    if team_exists[i] then
      set tc = tc + 1
    endif
    set i = i + 1
  endloop
  return tc > 3
endfunction

function InitAI takes nothing returns nothing
    set ai_player = Player(GetAiPlayer())
    set message_add = c2s(GetPlayerColor(ai_player))
    set home_location = GetPlayerStartLocationLoc(ai_player)
    call InitDigits()
    call StoreBoolean(com, "IsAMAI", Int2Str(GetAiPlayer()), true)
    call initGlobalSettings()
    if IsGameFFA() then
      set attacking_strategy = 5
    endif
    set sleep_multiplier = sleep_multiplier * LinearInterpolation(I2R(slm_start), I2R(slm_end), slm_start_mult, slm_end_mult, I2R(c_ai_total))
    set difficulty = MeleeDifficulty()
    set income_per_mine = income_per_mine * maximum(difficulty - 1, 1)
    call initNeutralSpecial()
    call initHeroArrays()
    call initArrays()
    call initChatArrays()
    call initTranslations()
    call initCreepStrengthArray()
    call StopGathering()
    call InitBuildArray()
    call CheckAllNeutrals()
    call InitHealers()
    call InitUpgradeTimeArray()
    call InitPlayerStrengthCache()
    call SetNearestEnemy()
    call StartThread(function PathingThread)
endfunction

function StandardAI takes code heroes, code peons, code attacks returns nothing
    local boolean isNewbie = (MeleeDifficulty() == MELEE_NEWBIE)

    call StoreBoolean(com, "Team"+Int2Str(GetPlayerTeam(ai_player))+"StratUsed", Int2Str(strategy_type[chosen_strategy]), true)
    set last_strategy = strategy

    call SetMeleeAI()

    call SetDefendPlayer(true)
    call SetGroupsFlee(not isNewbie)
    call SetHeroesBuyItems(not isNewbie)
    call SetHeroesFlee(true)
    call SetHeroesTakeItems(true)
    call SetIgnoreInjured(false)
    call SetPeonsRepair(true)
    call SetSmartArtillery(not isNewbie)
    call SetTargetHeroes(not isNewbie)
    call SetUnitsFlee(not isNewbie)
    call SetWatchMegaTargets(true)
    call SetCaptainChanges(true)
    call GroupTimedLife(true)
    call SetRandomPaths(true)

    call CreateCaptains()

    call SetHeroLevels(heroes)
    call Sleep(0.1)
    call StartThread(function TQLoop)
    call StartThread(peons)
    call StartThread(attacks)
    call initTownBuilt()

    call StartThread(function cmd_loop)

endfunction

function InitCampaignDefenders takes nothing returns nothing
  local integer i = 1
  loop
    exitwhen i > 200
    set campaign_defenders[i] = 0
    set i = i + 1
  endloop
endfunction

function CampaignAI takes code heroes, code peons, code attacks returns nothing
    call InitAI()
    call InitCampaignDefenders()

    if GetGameDifficulty() == MAP_DIFFICULTY_EASY then
        set difficulty = EASY

        call SetTargetHeroes(false)
        call SetUnitsFlee(false)

    elseif GetGameDifficulty() == MAP_DIFFICULTY_NORMAL then
        set difficulty = NORMAL

        call SetTargetHeroes(false)
        call SetUnitsFlee(false)

    elseif GetGameDifficulty() == MAP_DIFFICULTY_HARD then
        set difficulty = HARD

        call SetPeonsRepair(true)
    else
        set difficulty = INSANE
    endif

    set campaign_ai = true

    call SetHeroesFlee(false)
    call SetGroupsFlee(false)
    call SetSlowChopping(true)
    call GroupTimedLife(false)

    call SetCampaignAI()
    call CreateCaptains()
    call SetHeroLevels(heroes)
    call Sleep(0.1)
    call StartThread(peons)
    call StartThread(attacks)
    call initArrays()
    call initTownBuilt()

    call StartThread(function cmd_loop)

endfunction

function InitAssaultGroup takes nothing returns nothing
    set attack_length = 0
endfunction

function InitDefenseGroup takes nothing returns nothing
    set defense_length = 0
endfunction

function SleepForever takes nothing returns nothing
    loop
        call Sleep(100)
    endloop
endfunction

function KeyAddTimeModify takes integer k_add returns integer
  local real t = TimerGetElapsed(tq_timer)
  return R2I(LinearInterpolation(k_add_start_time, k_add_end_time, k_add_start_mult, k_add_end_mult, t) * I2R(k_add))
endfunction

function GetKeyBuildingAddExt takes integer kb returns integer
  if TownCountDone(kb) > 1 then
    return kb_add4
  elseif TownCountDone(kb) > 0 then
    return kb_add1
  elseif TownCount(kb) > 0 then
    return kb_add2
  elseif TownCountDone(needed1[kb]) > 0 and TownCountDone(needed2[kb]) > 0 then
    return kb_add3
  else
    return 0
  endif
endfunction

function GetKeyBuildingAdd takes integer sn returns integer
  return KeyAddTimeModify(GetKeyBuildingAddExt(key_building1[sn]) + GetKeyBuildingAddExt(key_building2[sn]))
endfunction

function KeyBuildingAdd takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i>= rp_strat_length
    set rp_strat[i] = rp_strat[i] + GetKeyBuildingAdd(i)
    set i = i + 1
  endloop
endfunction

function GetKeyUpgradeAddExt takes integer kb returns integer
  local integer ul = GetUpgradeLevel(old_id[kb])
  if ul >= 3 then
    return ku_add3
  elseif ul == 2 then
    return ku_add2
  elseif ul == 1 then
    return ku_add1
  else
    return 0
  endif
endfunction

function GetKeyUpgradeAdd takes integer sn returns integer
  return KeyAddTimeModify(GetKeyUpgradeAddExt(key_upgrade1[sn]) + GetKeyUpgradeAddExt(key_upgrade2[sn]))
endfunction

function KeyUpgradeAdd takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i>= rp_strat_length
    set rp_strat[i] = rp_strat[i] + GetKeyUpgradeAdd(i)
    set i = i + 1
  endloop
endfunction

function GetKeyUnitAddExt takes integer kb returns integer
  if kb != 0 then
    return TownCountDone(kb) * GetFoodUsed(old_id[kb])
  else
    return 0
  endif
endfunction

function GetKeyUnitAdd takes integer sn returns integer
  return KeyAddTimeModify(GetKeyUnitAddExt(key_unit[sn]))
endfunction

function KeyUnitAdd takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i>= rp_strat_length
    set rp_strat[i] = rp_strat[i] + GetKeyUnitAdd(i)
    set i = i + 1
  endloop
endfunction

function SmallMapsAdd takes nothing returns nothing
  local integer i = 0
  if GetPlayers() > 3 then
    return
  endif
  loop
    exitwhen i >= rp_strat_length
    if strategy_tier[i] == 1 then
      set rp_strat[i] = rp_strat[i] + small_map_tier1_bonus
    endif
    set i = i + 1
  endloop
endfunction

function sum_rp_strat takes integer num returns integer
  local integer i = 0
  local integer sum = 0
  loop
    exitwhen i >= num
    set sum = sum + rp_strat[i]
    set i = i + 1
  endloop
  return sum
endfunction

function choose_strategy takes nothing returns integer
  local integer i = 1
  local integer rp_sum = sum_rp_strat(rp_strat_length)
  local integer strategy_roll = GetRandomInt(1, rp_sum)
  if rp_sum <= 0 then
    return 0
  endif
  loop
    exitwhen strategy_roll <= sum_rp_strat(i)
    set i = i + 1
  endloop
  
  return i - 1
endfunction

function mult_rp_strat takes integer m returns nothing
  local integer i = 0
  loop
    exitwhen i >= rp_strat_length
    set rp_strat[i] = rp_strat[i] * m
    set i = i + 1
  endloop
endfunction

function div_rp_strat takes integer d returns nothing
  local integer i = 0
  loop
    exitwhen i >= rp_strat_length
    set rp_strat[i] = rp_strat[i] / d
    set i = i + 1
  endloop
endfunction

function make_rp_strat_positive takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i >= rp_strat_length
    if rp_strat[i] < 0 then
      set rp_strat[i] = 0
    endif
    set i = i + 1
  endloop
endfunction

function normalize_rp_strat takes nothing returns nothing
  local integer i = 0
  local integer sum = sum_rp_strat(rp_strat_length)
  loop
      exitwhen i >= rp_strat_length
      set rp_strat[i] = (rp_strat[i] * rp_strat_normal) / sum
      set i = i + 1
  endloop
endfunction

function add_tier_bonus takes nothing returns nothing
  local integer i = 0
  loop
      exitwhen i >= rp_strat_length
      if tier == strategy_tier[i] then
          set rp_strat[i] = rp_strat[i] + strategy_tier_bonus
      endif
      set i = i + 1
  endloop
endfunction

function display_rp_strat takes nothing returns nothing
  local integer i = 0
  local integer sum = 0
  if balancing then
    set sum = sum_rp_strat(rp_strat_length)
    loop
      exitwhen i >= rp_strat_length
      call DisplayToAll(GetStrategyName(i)+": "+Int2Str(R2I(I2R(100 * rp_strat[i]) / I2R(sum)))+" %")
      set i = i + 1
    endloop
  endif
endfunction

function init_rp_strat_sort takes nothing returns nothing
  set rp_strat_sort_length = 0
endfunction

function sum_rp_strat_sort takes integer num returns integer
  local integer i = 0
  local integer sum = 0
  loop
    exitwhen i >= num
    set sum = sum + rp_strat[rp_strat_sort[i]]
    set i = i + 1
  endloop
  return sum
endfunction

function display_rp_strat_sort takes nothing returns nothing
  local integer i = 0
  local integer sum = 0
  if balancing then
    set sum = sum_rp_strat_sort(relevant_strat_change_number)
    loop
      exitwhen i >= relevant_strat_change_number
      call DisplayToAll(GetStrategyName(rp_strat_sort[i])+": "+Int2Str(R2I(I2R(100 * rp_strat[rp_strat_sort[i]]) / I2R(sum)))+" %")
      set i = i + 1
    endloop
  endif
endfunction

function sort_rp_strat takes nothing returns nothing
  local integer i = 0
  local integer j = 0
  loop
    exitwhen i >= rp_strat_length
    set j = rp_strat_sort_length - 1
    loop
      exitwhen j < 0
      exitwhen rp_strat[rp_strat_sort[j]] > rp_strat[i]
      set rp_strat_sort[j + 1] = rp_strat_sort[j]
      set j = j - 1
    endloop
    set rp_strat_sort[j + 1] = i
    set rp_strat_sort_length = rp_strat_sort_length + 1
    set i = i + 1
  endloop
endfunction

function nullify_bad_strats takes nothing returns nothing
  local integer i = 0
  loop
    if rp_strat[i] < (rp_strat[strategy] - (strat_persistence + (FoodUsed() * strat_food_persistence))) then
      set rp_strat[i] = 0
    endif
    set i = i + 1
    exitwhen i >= rp_strat_length
  endloop
endfunction

function finish_strategy_change takes nothing returns nothing
  local integer strategy_roll = 0
  local integer sum = 0
  local integer i = 0

  call KeyBuildingAdd()
  call KeyUpgradeAdd()
  call KeyUnitAdd()
  call add_tier_bonus()
  call nullify_bad_strats()

  set rp_strat[strategy] = R2I(I2R(rp_strat[strategy]) * Pow(c_enemy_total,0.75))
  call make_rp_strat_positive()
  call init_rp_strat_sort()
  call sort_rp_strat()
  call display_rp_strat_sort()
  set strategy_roll = GetRandomInt(1,sum_rp_strat_sort(relevant_strat_change_number))
  loop
    set sum = sum + rp_strat[rp_strat_sort[i]]
    if strategy_roll <= sum then
      set strategy = rp_strat_sort[i]
      set chosen_strategy = strategy
      return
    endif
    set i = i + 1
  endloop
endfunction

function removeNonBeginningStrats takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i >= rp_strat_length
    if not beginning_strat[i] and not (debug_strategy == i) then
      set rp_strat[i] = 0
    endif
    set i = i + 1
  endloop
endfunction

function AddStrategyHeroRP takes integer h, integer to_add returns nothing
  local integer i = 0
  loop
    exitwhen i >= hero_number
    if all_heroes[i] == h then
      set hero_rp[i] = hero_rp[i] + to_add
    endif
    set i = i + 1
  endloop
endfunction

function ApplyStrategyRaceAggression takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i >= 12
    set race_aggression[i] = b_race_aggression[i] + strategy_race_aggression[strategy*12 + i]
    set i = i + 1
  endloop
endfunction

function make_hero_rp_positive takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i >= hero_number
    if hero_rp[i] < 0 then
      set hero_rp[i] = 0
    endif
    set i = i + 1
  endloop
endfunction

function sum_hero_rp takes nothing returns integer
  local integer i = 0
  local integer sum = 0
  loop
    exitwhen i >=hero_number
    set sum = sum + hero_rp[i]
    set i = i + 1
  endloop
  return sum
endfunction

function ChooseHero takes nothing returns integer
  local integer i = 0
  local integer sum = 0
  local integer rp_sum = sum_hero_rp()
  local integer hero_roll = GetRandomInt(1,rp_sum)
  if rp_sum <= 0 then
    return 0
  endif
  loop
    set sum = sum + hero_rp[i]
    if hero_roll <= sum then
      return i
    endif
    set i = i + 1
  endloop
  return 0
endfunction

function remove_hero takes integer h returns nothing
  local integer i = h
  set hero_number = hero_number - 1
  loop
    exitwhen i  >= hero_number
    set hero_rp[i] = hero_rp[i + 1]
    set all_heroes[i] = all_heroes[i + 1]
    set i = i + 1
  endloop
endfunction

function GetExistingHero takes nothing returns integer
  local group g = CreateGroup()
  local unit u = null
  local integer oid = 0
  local integer i = 0
  call GroupEnumUnitsOfPlayer(g, ai_player, null)
  set g = SelectUnittype(g, UNIT_TYPE_HERO, true)
  set u = FirstOfGroup(g)
  call DestroyGroup(g)
  set g = null
  if u == null then
    call DisplayToAll("Hero not found")
    return 0
  endif
  set oid = GetUnitTypeId(u)
  loop
    exitwhen i >= hero_number
    if old_id[all_heroes[i]] == oid then
      set chosen = i
      return all_heroes[i]
    endif
    set i = i + 1
  endloop
  call DisplayToAll("Unknown hero")
  return 0
endfunction

function ChooseFirstHero takes nothing returns integer
  if neutral_guarded[NEUTRAL_TAVERN] then
    call remove_hero(7)
  endif
  if IsMapFlagSet(MAP_RANDOM_HERO) then
    set hero_id[1] = GetExistingHero()
  else
    call make_hero_rp_positive()
    set chosen = ChooseHero()
    set hero_id[1] = all_heroes[chosen]
  endif
  return chosen
endfunction

function ChooseRestHeroes takes nothing returns nothing
  call make_hero_rp_positive()
  call remove_hero(chosen)
  set chosen = ChooseHero()
  set hero_id[2] = all_heroes[chosen]
  call remove_hero(chosen)
  set hero_id[3] = all_heroes[ChooseHero()]
endfunction

function GetMinesHarvested takes nothing returns integer
  local integer twm = TownWithMine()
  local integer i = twm
  local integer sum = 0
  if twm < 0 then
    return 0
  endif
  loop
    exitwhen i > twm + 3
    if TownHasMine(i) and TownCountEx(racial_expansion,true,i) > 0 then
      set sum = sum + 1
    endif
    set i = i + 1
  endloop
  return sum
endfunction

function GetGoldIncome takes nothing returns real
  local integer inc = GetMinesHarvested()*income_per_mine
  if inc > GetGoldOwned() then
    set inc = GetGoldOwned()
  endif
  return I2R(inc + GetGold())/300
endfunction

function GetIncomePercentage takes integer qty returns real
  if qty == 0 then
    return 0.0
  endif
  return 1 - 1/I2R(qty)
endfunction

function GetFactoryQty takes integer qty, integer build_time, integer gold_cost, real in_percentage returns integer
  local real gip = GetIncomePercentage(qty) * gold_income * in_percentage
  local real gic = I2R(maximum(gold_cost,1))/I2R(maximum(build_time, 1))
  return maximum(minimum(R2I(gip/gic), difficulty),1)
endfunction

function Get_f_qty takes integer qty, integer unitid, integer town  returns integer
  if unitid > unit_end or unitid == racial_peon then
    return 1
  endif
  return GetFactoryQty(qty - TownCountTown(unitid, town), GetUnitBuildTime(old_id[unitid]), GetUnitGoldCost(old_id[unitid]), income_percentage[needed1[unitid]])
endfunction

function AddBlock takes integer req_qty, integer req_type, boolean only_done, integer allow_qty, integer allow_type, integer expire_time returns nothing
  set bl_req_qty[bl_length] = req_qty
  set bl_req_type[bl_length] = req_type
  set bl_only_done[bl_length] = only_done
  set bl_allow_qty[bl_length] = allow_qty
  set bl_allow_type[bl_length] = allow_type
  set bl_expire_time[bl_length] = expire_time
  set bl_length = bl_length + 1
endfunction

function InitBlockList takes nothing returns nothing
  set bl_length = 0
endfunction

function BlockListCheck takes integer qty, integer t returns integer
  local integer i = 0
  local integer max_qty = qty
  loop
    exitwhen i >= bl_length
    if ai_time < bl_expire_time[i] and bl_allow_type[i] == t then
      if TownCountEx(bl_req_type[i], bl_only_done[i], -1) < bl_req_qty[i] then
        set max_qty = minimum(max_qty, bl_allow_qty[i])
      endif
    endif
    set i = i + 1
  endloop
  return max_qty
endfunction

function SetBuildAll takes integer t, integer mqty, integer unitid, integer town, integer prio returns nothing
    local integer i = 0
    local integer j = 0
    local integer qty = BlockListCheck(mqty, unitid)
    
    if unitid == 0 then
      return
    endif
    
    if t == BUILD_UPGRADE then
      if GetUpgradeLevel(old_id[unitid]) >= qty then
        return
      endif
    elseif t == BUILD_ITEM then
      if GetItemNumber(unitid) >= qty then
        return
      endif
    elseif TownCountTown(unitid, town) >= qty or (unitid >= NEUTRAL_UNITS_START and not neutral_available[GetNeutralNumber(unitid)]) then
      return
    endif
    call GetBuildLock()
    set j = build_length - 1
    loop
      exitwhen i >= build_length
      exitwhen build_prio[i] < prio
      if build_item[i] == unitid and build_qty[i] >= qty and build_town[i] == town then
        call ReleaseBuildLock()
        return
      endif
      set i = i + 1
    endloop
    loop
      exitwhen j < i
      set build_qty[j+1] = build_qty[j]
      set build_type[j+1] = build_type[j]
      set build_item[j+1] = build_item[j]
      set build_town[j+1] = build_town[j]
      set build_prio[j+1] = build_prio[j]
      set j = j - 1
    endloop
    set build_qty[i] = qty
    set build_type[i] = t
    set build_item[i] = unitid
    set build_town[i] = town
    set build_prio[i] = prio
    set build_length = build_length + 1
    call ReleaseBuildLock()

    call SetBuildAll(t, qty - 1, unitid, town, prio + prio_q_inc )

    if unitid > ML_UPGRADE_START and unitid < ML_UPGRADE_END then
      if qty == 1 then
        if needed1[unitid] != 0 then
          call SetBuildAll(BUILD_UNIT, Get_f_qty(qty, unitid, town), needed1[unitid], -1, prio + prio_n_inc)
        endif
      elseif qty == 2 then
        call SetBuildAll(BUILD_UPGRADE, 1, unitid, town, prio + prio_n_inc)
        if needed2[unitid] != 0 then
          call SetBuildAll(BUILD_UNIT, 1, needed2[unitid], -1, prio + prio_n_inc)
        endif
      else
        call SetBuildAll(BUILD_UPGRADE, 2, unitid, town, prio + prio_n_inc)
        if needed3[unitid] != 0 then
          call SetBuildAll(BUILD_UNIT, 1, needed3[unitid], -1, prio + prio_n_inc)
        endif
      endif
    elseif unitid < HERO_END then
      if unitid == hero_id[1] or unitid == hero_id[2] or unitid == hero_id[3] then
        if needed1[unitid] != 0 then
          call SetBuildAll(BUILD_UNIT, 1, needed1[unitid], -1, prio + prio_n_inc)
        endif
      endif
      if (unitid == hero_id[2] and not hero_built[2]) or (unitid == hero_id[3] and not hero_built[3]) then
        if needed2[unitid] != 0 then
          call SetBuildAll(BUILD_UNIT, 1, needed2[unitid], -1, prio + prio_n_inc)
        endif
      endif
      if unitid == hero_id[3] and not hero_built[3] then
        if needed3[unitid] != 0 then
          call SetBuildAll(BUILD_UNIT, 1, needed3[unitid], -1, prio + prio_n_inc)
        endif
      endif
    else
      if needed1[unitid] != 0 then
        if needed3[unitid] == UPGRADED then
          call SetBuildAll(BUILD_UNIT, qty, needed1[unitid], town, prio + prio_n_inc)
        else
          call SetBuildAll(BUILD_UNIT, Get_f_qty(qty, unitid, town), needed1[unitid], -1, prio + prio_n_inc)
        endif
      endif
      if needed2[unitid] != 0 then
        call SetBuildAll(BUILD_UNIT, 1, needed2[unitid], -1, prio + prio_n_inc)
      endif
      if needed3[unitid] != 0 and needed3[unitid] != UPGRADED then
        call SetBuildAll(BUILD_UNIT, 1, needed3[unitid], -1, prio + prio_n_inc)
      endif
    endif
    if unitid == UPG_MARK_CLAW then
      call SetBuildAll(BUILD_UPGRADE, 2, UPG_DRUID_CLAW, -1, prio + prio_n_inc)
    endif
    if unitid == UPG_MARK_TALON then
      call SetBuildAll(BUILD_UPGRADE, 2, UPG_DRUID_TALON, -1, prio + prio_n_inc)
    endif
    if unitid == BLK_SPHINX then
      call SetBuildAll(BUILD_UPGRADE, 1, UPG_BLK_SPHINX, -1, prio + prio_n_inc)
    endif
    if unitid == KNIGHT then
      call SetBuildAll(BUILD_UNIT, 1, LUMBER_MILL, -1, prio + prio_n_inc)
    endif
    if unitid == UPG_BREEDING then
      call SetBuildAll(BUILD_UNIT, 1, LUMBER_MILL, -1, prio + prio_n_inc)
    endif

endfunction

function RefreshNeeded takes integer t, integer qty, integer unitid, integer town, integer prio returns nothing
    if unitid > ML_UPGRADE_START and unitid < ML_UPGRADE_END then
      if qty == 1 then
        if needed1[unitid] != 0 then
          call SetBuildAll(BUILD_UNIT, Get_f_qty(qty, unitid, town), needed1[unitid], -1, prio + prio_n_inc)
        endif
      elseif qty == 2 then
        call SetBuildAll(BUILD_UPGRADE, 1, unitid, town, prio + prio_n_inc)
        if needed2[unitid] != 0 then
          call SetBuildAll(BUILD_UNIT, 1, needed2[unitid], -1, prio + prio_n_inc)
        endif
      else
        call SetBuildAll(BUILD_UPGRADE, 2, unitid, town, prio + prio_n_inc)
        if needed3[unitid] != 0 then
          call SetBuildAll(BUILD_UNIT, 1, needed3[unitid], -1, prio + prio_n_inc)
        endif
      endif
    elseif unitid < HERO_END then
      if unitid == hero_id[1] or unitid == hero_id[2] or unitid == hero_id[3] then
        if needed1[unitid] != 0 then
          call SetBuildAll(BUILD_UNIT, 1, needed1[unitid], -1, prio + prio_n_inc)
        endif
      endif
      if (unitid == hero_id[2] and not hero_built[2]) or (unitid == hero_id[3] and not hero_built[3]) then
        if needed2[unitid] != 0 then
          call SetBuildAll(BUILD_UNIT, 1, needed2[unitid], -1, prio + prio_n_inc)
        endif
      endif
      if unitid == hero_id[3] and not hero_built[3] then
        if needed3[unitid] != 0 then
          call SetBuildAll(BUILD_UNIT, 1, needed3[unitid], -1, prio + prio_n_inc)
        endif
      endif    
    else
      if needed1[unitid] != 0 then
        if needed3[unitid] == UPGRADED then
          call SetBuildAll(BUILD_UNIT, qty, needed1[unitid], town, prio + prio_n_inc)
        else
          call SetBuildAll(BUILD_UNIT, Get_f_qty(qty, unitid, town), needed1[unitid], -1, prio + prio_n_inc)
        endif
      endif
      if needed2[unitid] != 0 then
        call SetBuildAll(BUILD_UNIT, 1, needed2[unitid], -1, prio + prio_n_inc)
      endif
      if needed3[unitid] != 0 and needed3[unitid] != UPGRADED then
        call SetBuildAll(BUILD_UNIT, 1, needed3[unitid], -1, prio + prio_n_inc)
      endif
    endif
    if unitid == UPG_MARK_CLAW then
      call SetBuildAll(BUILD_UPGRADE, 2, UPG_DRUID_CLAW, -1, prio + prio_n_inc)
    endif
    if unitid == UPG_MARK_TALON then
      call SetBuildAll(BUILD_UPGRADE, 2, UPG_DRUID_TALON, -1, prio + prio_n_inc)
    endif
    if unitid == BLK_SPHINX then
      call SetBuildAll(BUILD_UPGRADE, 1, UPG_BLK_SPHINX, -1, prio + prio_n_inc)
    endif
    if unitid == KNIGHT then
      call SetBuildAll(BUILD_UNIT, 1, LUMBER_MILL, -1, prio + prio_n_inc)
    endif
    if unitid == UPG_BREEDING then
      call SetBuildAll(BUILD_UNIT, 1, LUMBER_MILL, -1, prio + prio_n_inc)
    endif
endfunction

function SetBuildUnit takes integer qty, integer unitid, integer prio returns nothing
    call SetBuildAll(BUILD_UNIT,qty,unitid,-1, prio)
endfunction

function SetBuildUnitEx takes integer easy, integer med, integer hard, integer unitid, integer prio returns nothing
    if difficulty == EASY then
        call SetBuildAll(BUILD_UNIT,easy,unitid,-1, prio)
    elseif difficulty == NORMAL then
        call SetBuildAll(BUILD_UNIT,med,unitid,-1, prio)
    else
        call SetBuildAll(BUILD_UNIT,hard,unitid,-1, prio)
    endif
endfunction

function SecondaryTown takes integer town, integer qty, integer unitid, integer prio returns nothing
    call SetBuildAll(BUILD_UNIT,qty,unitid,town, prio)
endfunction

function SetBuildUpgr takes integer qty, integer unitid, integer prio returns nothing
    call SetBuildAll(BUILD_UPGRADE,qty,unitid,-1, prio)
endfunction

function SetBuildUpgrEx takes integer easy, integer med, integer hard, integer unitid, integer prio returns nothing
    if difficulty == EASY then
        call SetBuildAll(BUILD_UPGRADE,easy,unitid,-1, prio)
    elseif difficulty == NORMAL then
        call SetBuildAll(BUILD_UPGRADE,med,unitid,-1, prio)
    else
        call SetBuildAll(BUILD_UPGRADE,hard,unitid,-1, prio)
    endif
endfunction

function SetBuildExpa takes integer qty, integer unitid, integer prio returns nothing
    call SetBuildAll(BUILD_EXPAND,qty,unitid,-1, prio)
endfunction

function SetBuildItem takes integer qty, integer unitid, integer prio returns nothing
    call SetBuildAll(BUILD_ITEM,qty,unitid,-1, prio)
endfunction

function InitHarass takes nothing returns nothing
  local integer i = 1
  loop
    exitwhen i > max_harass_groups
    set harass_length[i] = 0
    set harass_time[i] = -1000000
    set i = i + 1
  endloop
  set distraction_group = 0
endfunction

function AddHarass takes integer groupnum, integer qty, integer unitid returns nothing
  set harass_qty[harass_length[groupnum]*max_harass_groups + groupnum] = qty
  set harass_units[harass_length[groupnum]*max_harass_groups + groupnum] = unitid
  set harass_length[groupnum] = harass_length[groupnum] + 1
endfunction

function AddHarassUnittype takes integer groupnum, integer harassnum, group harasser returns group
  local group g = CreateGroup()
  local unit u = null
  call GroupEnumUnitsOfPlayer(g, ai_player, null)
  set g = SelectByUserData(g, UNIT_STANDARD, true)
  set g = SelectNumberOfId(g, harass_qty[harassnum*max_harass_groups + groupnum], old_id[harass_units[harassnum*max_harass_groups + groupnum]])
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    call SetUnitUserData(u, UNIT_HARASSING)
    call RemoveGuardPosition(u)
    call GroupAddUnit(harasser,u)
    call GroupRemoveUnit(g,u)
  endloop
  call DestroyGroup(g)
  set g = null
  return harasser
endfunction

function StartHarass takes integer groupnum, integer harass_target, boolean avoid_towers, real strength_limit, real flee_percent, integer flee_number, real lx, real ly returns nothing
  local integer i = 0
  local group harasser = CreateGroup()
  local string key = Int2Str(Handle2Int(harasser))
  loop
    exitwhen i >= harass_length[groupnum]
    set harasser = AddHarassUnittype(groupnum, i, harasser)
    set i = i + 1
  endloop
  set harass_time[groupnum] = ai_time
  call StoreBoolean(additional_info, key, "Avoid_Towers", avoid_towers)
  call StoreReal(additional_info, key, "Strength_Limit", strength_limit)
  call StoreBoolean(additional_info, key, "State_Attacking", true)
  call StoreReal(additional_info, key, "Flee_Percent", flee_percent)
  call StoreInteger(additional_info, key, "Flee_Number", flee_number)
  call StoreReal(additional_info, key, "LocationX", lx)
  call StoreReal(additional_info, key, "LocationY", ly)
  call TQAddGroupJob(0, HARASS, harass_target, null, harasser)
endfunction

function GetHarassGroupStrength takes integer groupnum returns real
  local integer i = 0
  local real sum = 0
  local integer id = 0
  loop
    exitwhen i >= harass_length[groupnum]
    set id = harass_units[i*max_harass_groups + groupnum]
    set sum = sum + minimum(harass_qty[i*max_harass_groups + groupnum], TownCountDone(id)) * GetFoodUsed(old_id[id]) * GetPlayerHandicap(ai_player)
    set i = i + 1
  endloop
  return sum
endfunction

function Harass takes integer groupnum, integer harass_target, boolean avoid_towers, real strength_limit, real flee_percent, integer flee_number, boolean cond, integer min_time, integer time returns nothing
  if cond and ai_time - harass_time[groupnum] >= time and ai_time >= min_time then
    call StartHarass(groupnum, harass_target, avoid_towers, strength_limit, flee_percent, flee_number, 0, 0)
  endif
endfunction

function StartUpgrade takes integer level, integer upgid returns integer
    local integer gold_cost = 0
    local integer wood_cost = 0
    local integer upg_level = GetUpgradeLevel(old_id[upgid])

    if upg_level >= level or ai_time < upgrade_time[upgid] then
      return BUILT_ALL
    endif
    
    if town_threatened then
      return BUILT_SOME
    endif

    set gold_cost = GetUpgradeGoldCost(old_id[upgid])
    set wood_cost = GetUpgradeWoodCost(old_id[upgid])

    set build_free[needed1[upgid]] = build_free[needed1[upgid]] - 1
    if build_free[needed1[upgid]] >= 0 then
      set total_gold = total_gold - gold_cost
      set total_wood = total_wood - wood_cost
      if total_gold < 0 then
        set total_gold = 0
      endif
      if total_wood < 0 then
        set total_wood = 0
      endif
    endif

    if total_gold <= 0 and total_wood <= 0 and (not (total_gold > 0 and wood_cost == 0)) and not (gold_cost == 0 and wood_cost == 0) then
      return NOT_ENOUGH_RES
    endif

    if (total_gold > 0 or gold_cost == 0) and (total_wood > 0 or wood_cost == 0) then
      if SetUpgrade(old_id[upgid]) then
        set upgrade_time[upgid] = ai_time + 10
        return BUILT_ALL
      else
        return CANNOT_BUILD
      endif
    endif
    return BUILT_SOME
endfunction

function HallsCompleted takes integer unitid returns boolean
    return GetUnitCount(old_id[unitid]) == GetUnitCountDone(old_id[unitid]) 
endfunction

function GuardSecondary takes integer townid, integer qty, integer unitid, integer prio returns nothing
    if TownHasHall(townid) and TownHasMine(townid) then
        call SecondaryTown( townid, qty, unitid, prio )
    endif
endfunction

function DefendTownsEx takes boolean only_done, integer qty, integer unitid, integer prio returns nothing
  local integer twm = maximum(TownWithMine(),1)
  local integer i = twm
  loop
    exitwhen i > twm + 2
    if TownHasMine(i) and TownCountEx(racial_expansion,only_done,i) > 0 then
      call SecondaryTown(i, qty, unitid, prio)
    endif
    set i = i + 1
  endloop
endfunction

function DefendTowns takes integer qty, integer unitid, integer prio returns nothing
  call DefendTownsEx(false, qty, unitid, prio)
endfunction

function DefendTownsDone takes integer qty, integer unitid, integer prio returns nothing
  call DefendTownsEx(true, qty, unitid, prio)
endfunction

function BasicExpansion takes boolean build_it, integer unitid, integer prio returns nothing
    if build_it and HallsCompleted(unitid) then
        call SetBuildExpa( TownCount(unitid)+1, unitid, prio )
    endif
endfunction

function UpgradeAll takes integer baseid, integer newid, integer prio returns nothing
    call SetBuildUnit( TownCountDone(baseid), newid, prio )
endfunction

function FoodPool takes integer food, boolean weak, integer id1, integer use1, boolean strong, integer id2, integer use2, integer prio returns nothing
    if strong then
        call SetBuildUnit( (food - use1 * TownCount(id1)) / use2, id2, prio )
    elseif weak then
        call SetBuildUnit( (food - use2 * TownCount(id2)) / use1, id1, prio )
    endif
endfunction

function MeleeTownHall takes integer townid, integer unitid, integer prio returns nothing
    if TownHasMine(townid) and not TownHasHall(townid) then
        call SecondaryTown ( townid, 1, unitid, prio )
    endif
endfunction

function AddRefresh takes integer t, integer qty, integer unitid, integer town, integer prio returns nothing
    set t_build_qty[t_build_length] = qty
    set t_build_type[t_build_length] = t
    set t_build_item[t_build_length] = unitid
    set t_build_town[t_build_length] = town
    set t_build_prio[t_build_length] = prio
    set t_build_length = t_build_length + 1
endfunction

function RefreshAllNeeded takes nothing returns nothing
    local integer index = 0
    loop
      exitwhen index >= t_build_length
      call RefreshNeeded(t_build_type[index], t_build_qty[index], t_build_item[index], t_build_town[index], t_build_prio[index])
      set index = index + 1
    endloop
endfunction

function GetNeutralHero takes integer unitid returns integer
  if not neutral_available[NEUTRAL_TAVERN] then
    return BUILT_ALL
  endif
  if ai_time < neutral_hero_time then
    return CANNOT_BUILD
  endif
  if (unitid == hero_id[1] and hero_built[1]) or (unitid == hero_id[2] and hero_built[2]) or (unitid == hero_id[3] and hero_built[3]) then
    if SetProduce(1,old_id[unitid],-1) then
      return BUILT_ALL
    else
      return CANNOT_BUILD
    endif
  endif
  if TownCountDone(needed1[unitid]) < 1 or (unitid != hero_id[1] and TownCountDone(needed2[unitid]) < 1) or (unitid == hero_id[3] and TownCountDone(needed3[unitid]) < 1) then
    return CANNOT_BUILD
  endif
  if not neutral_ordered[NEUTRAL_TAVERN] then
    set neutral_ordered[NEUTRAL_TAVERN] = true
    set neutral_wanted[NEUTRAL_TAVERN] = 1
    call TQAddJob(0, BUY_NEUTRAL, unitid)
  endif
  return BUILT_SOME
endfunction

function CheckNotBuiltFrom takes integer unitid returns boolean
  if unitid == BLK_SPHINX then
    return false
  endif
  return true
endfunction

function StartUnit takes integer ask_qty, integer unitid, integer town, integer prio returns integer
    local integer have_qty = 0
    local integer need_qty = 0
    local integer afford_gold = 0
    local integer afford_wood = 0
    local integer afford_food = 0
    local integer afford_qty = 0
    local integer gold_cost = 0
    local integer wood_cost = 0
    local integer food_cost = 0
    local integer cost_qty = 0
    local integer n1 = needed1[unitid]
    local real daytime = GetFloatGameState(GAME_STATE_TIME_OF_DAY)
    local integer nn = GetNeutralNumber(unitid)

    if town != -1 and (not town_built[town] or (unitid != racial_expansion and TownCountTown(racial_expansion, town) <= 0)) then
        return BUILT_ALL
    endif

    if unitid >= NEUTRAL_UNITS_START and (ai_time < available_time[unitid] or (neutral_guarded[nn] and ((daytime >= 5 and daytime < 18) or not neutral_night_buy[nn]))) then
      return BUILT_SOME
    endif

    //------------------------------------------------------------------------
    // if we have all we're asking for then make nothing
    //
        set have_qty = TownCountTown(unitid,town)

    if have_qty >= ask_qty then
        return BUILT_ALL
    endif
    set need_qty = ask_qty - have_qty

    //------------------------------------------------------------------------
    // limit the qty we're requesting to the amount of resources available
    //
    set gold_cost = GetUnitGoldCost(old_id[unitid])
    set wood_cost = GetUnitWoodCost(old_id[unitid])
    set food_cost = GetFoodUsed(old_id[unitid])

    if gold_cost == 0 then
        set afford_gold = need_qty
    else
        set afford_gold = total_gold / gold_cost
    endif
    if afford_gold < need_qty then
        set afford_qty = afford_gold
    else
        set afford_qty = need_qty
    endif

    if wood_cost == 0 then
        set afford_wood = need_qty
    else
        set afford_wood = total_wood / wood_cost
    endif
    if afford_wood < afford_qty then
        set afford_qty = afford_wood
    endif

    if food_cost == 0 then
        set afford_food = need_qty
    else
        set afford_food = total_food / food_cost
    endif
    if afford_food < afford_qty then
        set afford_qty = afford_food
    endif

    //------------------------------------------------------------------------
    // whether we make right now what we're requesting or not, assume we will
    // and deduct the cost of the units from our fake gold total right away
    //
    if ((unitid >= unit_begin and unitid <= unit_end) or unitid < HERO_END) and CheckNotBuiltFrom(unitid) then
      set cost_qty = build_free[n1]
      if cost_qty > need_qty then
        set cost_qty = need_qty
      endif
      if cost_qty < 0 then
        set cost_qty = 0
      endif
      set build_free[n1] = build_free[n1] - need_qty
      if unitid != racial_peon then
        set gold_sum[n1] = gold_sum[n1] + need_qty * gold_cost
        set build_time_sum[n1] = build_time_sum[n1] + need_qty * GetUnitBuildTime(old_id[unitid])
        set build_num[n1] = build_num[n1] + need_qty
        set prio_sum[n1] = prio_sum[n1] + need_qty * prio
      endif
    else
      set cost_qty = need_qty
    endif

    set cost_qty = minimum(cost_qty, afford_food)

    if 100 - total_food + food_cost * cost_qty > low_upkeep_border then
      if low_upkeep_allowed == UPKEEP_UNDECIDED then
        if total_gold > low_upkeep_resistance then
          set low_upkeep_allowed = UPKEEP_ALLOWED
        else
          set low_upkeep_allowed = UPKEEP_NOT_ALLOWED
        endif
      endif
      if low_upkeep_allowed == UPKEEP_NOT_ALLOWED then
        if food_cost == 0 then
          set afford_food = need_qty
        else
          set afford_food = maximum(total_food - 100 + low_upkeep_border, 0) / food_cost
        endif
      endif
    endif
    if 100 - total_food + food_cost * cost_qty > high_upkeep_border then
      if high_upkeep_allowed == UPKEEP_UNDECIDED then
        if total_gold > high_upkeep_resistance then
          set high_upkeep_allowed = UPKEEP_ALLOWED
        else
          set high_upkeep_allowed = UPKEEP_NOT_ALLOWED
        endif
      endif
      if high_upkeep_allowed == UPKEEP_NOT_ALLOWED then
        if food_cost == 0 then
          set afford_food = need_qty
        else
          set afford_food = maximum(total_food - 100 + high_upkeep_border, 0) / food_cost
        endif
      endif
    endif
    
    set cost_qty = minimum(cost_qty, afford_food)
    set afford_qty = minimum(afford_qty, cost_qty)
    
    set total_gold = total_gold - gold_cost * cost_qty
    set total_wood = total_wood - wood_cost * cost_qty
    set total_food = total_food - food_cost * cost_qty

    if total_gold < 0 then
        set total_gold = 0
    endif
    if total_wood < 0 then
        set total_wood = 0
    endif
    if total_food < 0 then
        set total_food = 0
    endif

    // if we're waiting on gold and wood; pause build orders
    if total_gold <= 0 and total_wood <= 0 and (not (total_gold > 0 and wood_cost == 0)) and not (gold_cost == 0 and wood_cost == 0) then
        return NOT_ENOUGH_RES
    elseif afford_qty < 1 then
        return BUILT_SOME
    endif

    //------------------------------------------------------------------------
    // give the AI a chance to make the units (it may not be able to right now
    // but that doesn't stop us from trying other units after this as long
    // as we have enough money to make this AND the needed, unbuilt ones)
    //


    if unitid == HEAD_HUNTER and GetUpgradeLevel(oUPG_ORC_BERSERKER) >= 1 then
      if SetProduce(afford_qty,oBERSERKER,town) then
        if (afford_qty == need_qty) and (need_qty == cost_qty) then
          return BUILT_ALL
        else
          return BUILT_SOME
        endif
      else
        return CANNOT_BUILD
      endif
    endif

    if unitid == BLK_SPHINX then
      if GetUpgradeLevel(oUPG_BLK_SPHINX) >= 1 then
        if ConvertUnits(afford_qty + have_qty, oOBSIDIAN_STATUE) then
          if (afford_qty == need_qty) and (need_qty == cost_qty) then
            return BUILT_ALL
          else
            return BUILT_SOME
          endif
        else
          return CANNOT_BUILD
        endif
      else
        return CANNOT_BUILD
      endif
    endif

    if unitid > NEUTRAL_UNITS_START then
      if not (neutral_ordered[nn] or attack_running) then
        set neutral_ordered[nn] = true
        set neutral_wanted[nn] = afford_qty + have_qty
        call TQAddJob(0, BUY_NEUTRAL, unitid)
      endif
      return BUILT_SOME
    endif

    if unitid > NEUTRAL_HERO_START and unitid < HERO_END then
      return GetNeutralHero(unitid)
    endif

    if SetProduce(afford_qty,old_id[unitid],town) then
      if town != -1 and unitid == racial_expansion then
        set town_built[town] = false
      endif
      if (afford_qty == need_qty) and (need_qty == cost_qty) then
        return BUILT_ALL
      else
        return BUILT_SOME
      endif
    else
      return CANNOT_BUILD
    endif
endfunction

function BuildExpansion takes unit peon, integer unitid returns boolean
  local unit u = CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), unitid, GetUnitX(current_expansion), GetUnitY(current_expansion), 270.0)
  local location exp_loc = GetUnitLoc(u)
  local boolean ret = false
  call SetUnitExploded(u, true)
  call KillUnit(u)
  call RemoveUnit(u)
  set ret = IssuePointOrderByIdLoc(peon, unitid, exp_loc)
  call RemoveLocation(exp_loc)
  set exp_loc = null
  return ret
endfunction

function IsWaterExpansion takes unit u returns boolean
  local integer i = 0
  loop
    exitwhen i == water_expansion_list_length
    if water_expansion_list[i] == u then
      return true
    endif
    set i = i + 1
  endloop
  return false
endfunction

function BuildMovePeonZeppelin takes unit peon, unit target returns boolean
  if build_zeppelin == null or not UnitAlive(build_zeppelin) then
    set build_zeppelin = GetUnusedZeppelinNearUnit(peon)
    if build_zeppelin == null then
      call DisplayToAll("No Zeppelin found for transporting peon")
      return false
    endif
    call SetUnitUserData(build_zeppelin, UNIT_ZEPPELIN_MOVE)
  endif
  if IsUnitInTransport(peon, build_zeppelin) then
    if DistanceBetweenUnits(build_zeppelin, target) > 300 then
      call IssuePointOrder(build_zeppelin, "move", GetUnitX(target), GetUnitY(target))
    else
      call IssueTargetOrder(build_zeppelin, "unload", peon)
    endif
  else
    if DistanceBetweenUnits(peon, target) < 400 then
      call SetUnitUserData(build_zeppelin, UNIT_STANDARD)
      set build_zeppelin = null
      return true
    else
      call IssueTargetOrder(peon, "smart", build_zeppelin)
    endif
  endif
  return false
endfunction

function StartExpansion takes integer qty, integer hall returns integer
  local integer count = TownCount(hall)
  local integer countdone = TownCountDone(hall)
  local unit    peon = null
  local integer gold_cost = 0
  local integer wood_cost = 0

  if countdone >= qty then
    return BUILT_ALL
  endif
  if (count > countdone) or town_threatened then
    return BUILT_SOME
  endif
  
  if CheckExpansionTaken(current_expansion) then
    set current_expansion = null
  endif
  
  if current_expansion == null then
    call ChooseExpansion()
    if current_expansion == null then
      return BUILT_ALL
    endif
  endif

  if GetExpFoe() != null then
    set take_exp = true
  else
    set take_exp = false
  endif

  set gold_cost = GetUnitGoldCost(old_id[hall])
  set wood_cost = GetUnitWoodCost(old_id[hall])

  set total_gold = total_gold - gold_cost
  set total_wood = total_wood - wood_cost

  if total_gold < 0 then
    set total_gold = 0
  endif
  if total_wood < 0 then
    set total_wood = 0
  endif

  if total_gold <= 0 and total_wood <= 0 then
    return NOT_ENOUGH_RES
  endif

  if take_exp or total_gold <= 0 or total_wood <= 0 then
    return BUILT_SOME
  endif

  if expansion_peon != null and UnitAlive(expansion_peon) then
    set peon = expansion_peon
  else
    set peon = GetExpansionPeon()
  endif

  if peon != null then
    if IsWaterExpansion(current_expansion) then
      if not BuildMovePeonZeppelin(peon, current_expansion) then
        return BUILT_SOME
      endif
    endif
    if own_race == R_UNDEAD then
      call IssueTargetOrderById(peon, old_id[hall], current_expansion)
    else
      call BuildExpansion(peon,old_id[hall])
    endif
  endif

  return BUILT_SOME
endfunction

function BuyItem takes integer qty, integer id returns boolean
  if attack_running or shop_ordered then
    return true
  endif
  set shop_wanted = qty
  if id < CIRCLET_OF_NOBILITY then
    set shop_unit = GetOneOfId(ai_player, old_id[racial_shop])
    set shop_distance_limit = raceshop_distance_limit
  else
    set shop_unit = nearest_neutral[NEUTRAL_MERCHANT]
    set shop_distance_limit = merchant_distance_limit
  endif
  call TQAddJob(0, BUY_ITEM, id)
  return true
endfunction

function StartItem takes integer ask_qty, integer itemid returns integer
  local integer gold_cost = gold_price[itemid]
  local integer wood_cost = wood_price[itemid]
  local integer have_qty = GetItemNumber(itemid)
  local real daytime = GetFloatGameState(GAME_STATE_TIME_OF_DAY)

  if have_qty >= ask_qty or (itemid >= CIRCLET_OF_NOBILITY and not neutral_available[NEUTRAL_MERCHANT]) then
    return BUILT_ALL
  endif

  if available_time[itemid] > ai_time or GetSlotsFree() <= 0 or (itemid >= CIRCLET_OF_NOBILITY and neutral_guarded[NEUTRAL_MERCHANT] and ((daytime >= 5 and daytime < 18) or not neutral_night_buy[NEUTRAL_MERCHANT])) then
    return BUILT_SOME
  endif

  if (needed1[itemid] != 0 and TownCountDone(needed1[itemid]) < 1) or (needed2[itemid] != 0 and TownCountDone(needed2[itemid]) < 1) or (needed3[itemid] != 0 and TownCountDone(needed3[itemid]) < 1) then
    return CANNOT_BUILD
  endif

  set total_gold = total_gold - gold_cost
  set total_wood = total_wood - wood_cost

  if total_gold < 0 then
    set total_gold = 0
  endif
  if total_wood < 0 then
    set total_wood = 0
  endif

  if total_gold <= 0 and total_wood <= 0 and (not (total_gold > 0 and wood_cost == 0)) and not (gold_cost == 0 and wood_cost == 0) then
    return NOT_ENOUGH_RES
  endif

  if (total_gold > 0 or gold_cost == 0) and (total_wood > 0 or wood_cost == 0) then
    if BuyItem(have_qty + 1, itemid) then
      return BUILT_SOME
    else
      return CANNOT_BUILD
    endif
  endif
  return BUILT_SOME
endfunction

function FarmBuilder takes nothing returns nothing
  if FoodProduced() < FoodUsed() then
    call SetBuildUnit(TownCountDone(racial_farm) + 3, racial_farm, farm_prio)
  elseif FoodProduced() - FoodUsed() <= farm_food2 then
    call SetBuildUnit(TownCountDone(racial_farm) + 2, racial_farm, farm_prio)
  elseif FoodProduced() - FoodUsed() <= farm_food then
    call SetBuildUnit(TownCountDone(racial_farm) + 1, racial_farm, farm_prio)
  endif
endfunction

function ShredderBuilder takes nothing returns nothing
  local real g = GetGold()
  local real w = maximum(GetWood(),1)
  local real gdivw = g / w
  if neutral_available[NEUTRAL_OBSERVATORY] and gdivw > 4 and g - w > 500 and ai_time - available_time[neutral_shredder] >= -1 then
    call SetBuildUnit(1, neutral_shredder, peon_prio)
  endif
endfunction

function BuildPeons takes integer number returns nothing
  call SetBuildUnit(number, racial_peon, peon_prio)
endfunction

function PeonBuilder takes nothing returns nothing
  local integer mo = GetMinesHarvested()
  local integer sc = TownCount(neutral_shredder)
  local real w = GetWood()
  if own_race == R_UNDEAD then
    set sc = 0
  else
    call ShredderBuilder()
  endif
  if mo <= 1 then
    call BuildPeons(maximum(5, R2I(LinearInterpolation(maximum_peon_wood, minimum_peon_wood, peon_1_mine_number, 5, w)) - shredder_peon_count*sc))
  elseif mo <= 2 then
    call BuildPeons(maximum(10, R2I(LinearInterpolation(maximum_peon_wood, minimum_peon_wood, peon_2_mines_number, 10, w)) - shredder_peon_count*sc))
  else
    call BuildPeons(maximum(10, R2I(LinearInterpolation(maximum_peon_wood, minimum_peon_wood, peon_mines_number, 10, w)) - shredder_peon_count*sc))
  endif
endfunction

function SetBuildFree takes nothing returns nothing
local integer i = building_begin
loop
  exitwhen i > building_end
  set build_free[i] = TownCountDone(i)
  set gold_sum[i] = 0
  set build_time_sum[i] = 0
  set build_num[i] = 0
  set prio_sum[i] = 0
  set i = i + 1
endloop
endfunction

function ExpansionBuilder takes nothing returns nothing
local integer mines = GetMinesOwned()
local integer gold_left = GetGoldOwned()
local boolean exp_prepared = false

if first_expansion_chosen and (current_expansion == null or CheckExpansionTaken(current_expansion)) then
  call ChooseExpansion()
  if current_expansion == null then
    return
  endif
endif

if mines < 2 and ai_time - exp_time_count > exp_first_time then
    if GetExpFoe() != null then
        set take_exp = true
    else
        set take_exp = false
        set exp_prepared = true
    endif
endif

if mines < 3 and ai_time - exp_time_count > exp_second_time then
    if GetExpFoe() != null then
        set take_exp = true
    else
        set take_exp = false
        set exp_prepared = true
    endif
endif

if mines < 1 or gold_left < 2000 or exp_prepared then
  if mines < 1 then
    call SetBuildExpa(TownCount(racial_expansion) + 1, racial_expansion, expa_emergency_prio)
  else
    call SetBuildExpa(TownCount(racial_expansion) + 1, racial_expansion, expa_prio)
  endif
  set exp_time_count = ai_time
endif

endfunction

function HeroReviver takes nothing returns nothing
  local integer i = 1
  loop
    exitwhen i > 3
    if GetUnitCountDone(old_id[hero_id[i]]) > 0 then
        if not hero_built[i] then
          set hero_built[i] = true
          set hero_unit[i] = GetOneOfId(ai_player, old_id[hero_id[i]])
          call InitHeroInfo(i)
          call TQAddJob(1, MICRO_HERO, i)
        endif
    elseif hero_built[i] then
        call SetBuildUnit(1, hero_id[i], hero_revive_prio[i])
    endif
    set i = i + 1
  endloop
endfunction

function ExpaRebuilder takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i  > 3
    if TownHasMine(i) and town_built[i] then
      call SecondaryTown(i, 1, racial_expansion, expa_rebuild_prio)
    endif
    set i = i + 1
  endloop
endfunction

function CheckTownBuilt takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i >= max_towns
    set town_built[i] = town_built[i] or (TownCountEx(racial_expansion, true, i) > 0 and not (TownCountEx(racial_expansion, true, 50) > 0))
    set i = i + 1
  endloop
endfunction

function TimeKeeper takes nothing returns nothing
  set ai_time = R2I(TimerGetElapsed(tq_timer)/5)
  call chat(C_CHAT)
endfunction

function FactoryNumberUpdate takes nothing returns nothing
  local integer g_sum = 0
  local integer i = building_begin
  local integer j = 0
  set gold_income = GetGoldIncome() * gold_unit_percentage
  loop
    exitwhen i > building_end
    set g_sum = g_sum + gold_sum[i]
    set i = i + 1
  endloop
  if g_sum == 0 then
    return
  endif
  set i = building_begin
  loop
    exitwhen i > building_end
    set j = i
    set income_percentage[j] = I2R(gold_sum[j]) / I2R(g_sum)
    if build_num[j] > 0 then
      call SetBuildUnit(GetFactoryQty(build_num[j], build_time_sum[j] / build_num[j], gold_sum[j] / build_num[j], income_percentage[j]), i, prio_sum[j] / build_num[j])
    endif
    set i = i + 1
  endloop
endfunction

function AddRBlock takes integer req_gold, integer req_wood, integer allow_qty, integer allow_type, integer expire_time returns nothing
  set rbl_req_gold[rbl_length] = req_gold
  set rbl_req_wood[rbl_length] = req_wood
  set rbl_allow_qty[rbl_length] = allow_qty
  set rbl_allow_type[rbl_length] = allow_type
  set rbl_expire_time[rbl_length] = expire_time
  set rbl_length = rbl_length + 1
endfunction

function InitRBlockList takes nothing returns nothing
  set rbl_length = 0
endfunction

function RBlockListCheck takes integer qty, integer t returns integer
  local integer i = 0
  local integer max_qty = qty
  loop
    exitwhen i >= rbl_length
    if ai_time < rbl_expire_time[i] and rbl_allow_type[i] == t then
      if total_gold < rbl_req_gold[i] or total_wood < rbl_req_wood[i] then
        set max_qty = minimum(max_qty, rbl_allow_qty[i])
        set blocked_gold = maximum(blocked_gold, rbl_req_gold[i])
        set blocked_wood = maximum(blocked_wood, rbl_req_wood[i])
      endif
    endif
    set i = i + 1
  endloop
  return max_qty
endfunction

function OneBuildLoop takes nothing returns nothing
    local integer index = 0
    local integer index_free = 0
    local integer qty = 0
    local integer id = 0
    local integer tp = 0
    local integer ret = 0
    local integer last_low_upkeep_allowed = UPKEEP_UNDECIDED
    local integer last_high_upkeep_allowed = UPKEEP_UNDECIDED

    call TimeKeeper()
    call CheckTownBuilt()
    call SetBuildFree()
    call FarmBuilder()
    call PeonBuilder()
    if not campaign_ai then
      call ExpansionBuilder()
      call HeroReviver()
    endif

    set total_gold   = GetGold() - gold_buffer
    set total_wood   = GetWood() - wood_buffer
    set total_food   = 100 - FoodUsed()

    if 100 - total_food > low_upkeep_border then
      set low_upkeep_allowed = UPKEEP_ALLOWED
    else
      set low_upkeep_allowed = UPKEEP_UNDECIDED
    endif
    if 100 - total_food > high_upkeep_border then
      set high_upkeep_allowed = UPKEEP_ALLOWED
    elseif GetMinesOwned() < 2 then
      set high_upkeep_allowed = UPKEEP_NOT_ALLOWED
      set last_high_upkeep_allowed = UPKEEP_NOT_ALLOWED
      set high_upkeep_time = -1
    else
      set high_upkeep_allowed = UPKEEP_UNDECIDED
    endif

    set blocked_gold = 0
    set blocked_wood = 0
    set t_build_length = 0

    call GetBuildLock()
    loop
        exitwhen index >= build_length

        set id   = build_item[index]
        set qty  = RBlockListCheck(build_qty[index], id)
        set tp   = build_type[index]

        //--------------------------------------------------------------------
        if tp == BUILD_UNIT then
            set ret = StartUnit(qty,id,build_town[index], build_prio[index])

        //--------------------------------------------------------------------
        elseif tp == BUILD_UPGRADE then
            set ret = StartUpgrade(qty,id)
            
        //--------------------------------------------------------------------
        elseif tp == BUILD_EXPAND then
            set ret = StartExpansion(qty,id)
        else
            set ret = StartItem(qty,id)
        endif

        exitwhen ret == NOT_ENOUGH_RES
        if ret == CANNOT_BUILD then
          call AddRefresh(tp, qty, id, build_town[index], build_prio[index])
        endif
        if ret == CANNOT_BUILD or ret == BUILT_SOME or (ret == BUILT_ALL and qty < build_qty[index]) then
          set build_qty[index_free] = build_qty[index]
          set build_type[index_free] = build_type[index]
          set build_item[index_free] = build_item[index]
          set build_town[index_free] = build_town[index]
          set build_prio[index_free] = build_prio[index] + prio_t_inc
          set index_free = index_free + 1
        endif

        if low_upkeep_allowed == UPKEEP_ALLOWED then
          set low_upkeep_time = -1
        elseif last_low_upkeep_allowed == UPKEEP_UNDECIDED and low_upkeep_allowed == UPKEEP_NOT_ALLOWED then
          if low_upkeep_time == -1 then
            if total_gold > 0 and total_wood > 0 then
              set low_upkeep_time = ai_time
            endif
          elseif use_linear_upkeep_saving then
            set total_gold = total_gold - R2I(LinearInterpolation(I2R(low_upkeep_time), I2R(low_upkeep_time + low_upkeep_save_time), 0, I2R(low_upkeep_resistance), I2R(ai_time)))
          elseif ai_time >= low_upkeep_time + low_upkeep_save_time then
            set total_gold = total_gold - low_upkeep_resistance
          endif
        endif
        
        if high_upkeep_allowed == UPKEEP_ALLOWED then
          set high_upkeep_time = -1
        elseif last_high_upkeep_allowed == UPKEEP_UNDECIDED and high_upkeep_allowed == UPKEEP_NOT_ALLOWED then
          if high_upkeep_time == -1 then
            if total_gold > 0 and total_wood > 0 then          
              set high_upkeep_time = ai_time
            endif
          elseif use_linear_upkeep_saving then
            set total_gold = total_gold - R2I(LinearInterpolation(I2R(high_upkeep_time), I2R(high_upkeep_time + high_upkeep_save_time), 0, I2R(high_upkeep_resistance), I2R(ai_time)))
          elseif ai_time >= high_upkeep_time + high_upkeep_save_time then
            set total_gold = total_gold - high_upkeep_resistance
          endif
        endif

        set index = index + 1
        set total_gold = total_gold - blocked_gold
        set total_wood = total_wood - blocked_wood
        set blocked_gold = 0
        set blocked_wood = 0
        set last_low_upkeep_allowed = low_upkeep_allowed
        set last_high_upkeep_allowed = high_upkeep_allowed
    endloop

    loop
          exitwhen index >= build_length
          set build_qty[index_free] = build_qty[index]
          set build_type[index_free] = build_type[index]
          set build_item[index_free] = build_item[index]
          set build_town[index_free] = build_town[index]
          set build_prio[index_free] = build_prio[index] + prio_t_inc
          set index_free = index_free + 1
          set index = index + 1
    endloop
    set build_length = index_free
    
    if low_upkeep_allowed == UPKEEP_UNDECIDED then
      set low_upkeep_time = -1
    endif
    
    if high_upkeep_allowed == UPKEEP_UNDECIDED then
      set high_upkeep_time = -1
    endif

    call ReleaseBuildLock()
    call RefreshAllNeeded()
    call FactoryNumberUpdate()
    
endfunction

function BuildLoop takes nothing returns nothing
    local integer blc = 0
    call OneBuildLoop()
    call StaggerSleep(1,5)
    loop
        set blc = blc + 1
        call OneBuildLoop()
        exitwhen player_defeated
        if blc > build_array_reset_time then
          call InitBuildArray()
          set blc = 0
        endif
        call Sleep(5 * sleep_multiplier)
    endloop
endfunction

function PlayGame takes nothing returns nothing
    call BuildLoop()
endfunction

function Conversions takes integer desire, integer unitid returns nothing
    if unitid == HIPPO_RIDER then
        call MergeUnits(desire,oARCHER,oHIPPO,oHIPPO_RIDER)
    endif
endfunction

function SetAssaultGroup takes integer qty, integer max, integer unitid returns nothing
    call Conversions(max,unitid)

    set attack_qty[attack_length] = qty
    set attack_max[attack_length] = max
    set attack_units[attack_length] = unitid
    set attack_length = attack_length + 1
endfunction

function SetMeleeGroup takes integer unitid returns nothing
    call SetAssaultGroup(0,60,unitid)
endfunction

function AttackGroupAddNeutrals takes nothing returns nothing
  local integer i = 0
  loop
    exitwhen i >= merc_number
    call SetMeleeGroup(merc_unit[i])
    set i = i + 1
  endloop
  set i = 0
  loop
    exitwhen i > 3
    call SetMeleeGroup(dragons[i])
    set i = i + 1
  endloop
endfunction

function FormGroup takes integer seconds returns nothing
    local integer index = 0
    local integer count = 0
    local integer unitid = 0
    local integer desire = 0

        call InitAssault()

        loop
            exitwhen index == attack_length

            set unitid = attack_units[index]

            if unitid == HEAD_HUNTER and GetUpgradeLevel(oUPG_ORC_BERSERKER) >= 1 then
              set unitid = BERSERKER
            endif

            set desire = attack_max[index]
            set count  = TownCountDone(unitid)

            if unitid == racial_ghoul then
              set desire = attacking_ghouls
            endif

            call Conversions(desire,unitid)

            if count >= desire then
                call AddAssault(desire,old_id[unitid])
            else
                set desire = attack_qty[index]

                if count < desire then
                    call AddAssault(desire,old_id[unitid])
                else
                    call AddAssault(count,old_id[unitid])
                endif
            endif

            set index = index + 1
        endloop
        call Sleep(seconds)
endfunction

function DoAttackJobs takes nothing returns nothing
  if major_hero == null or not UnitAlive(major_hero) then
    set major_hero = GetMajorHero()
  endif
  set battle_radius = 1500
  if major_hero != null and UnitAlive(major_hero) then
    if not retreat_controlled then
      call SetGroupsFlee(false)
      call SetTargetHeroes(false)
      call TQAddJob(2 * sleep_multiplier, RETREAT_CONTROL, 0)
    endif
  endif
endfunction

function GetDistractionTarget takes unit target returns unit
  local group g = CreateGroup()
  call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(target), null)
  set g = SelectUnittype(g, UNIT_TYPE_STRUCTURE, true)
  set g = SelectByLocation_d(g, GetUnitLoc(target), 3000, false)
  return GetFarestOfGroup_d(g, GetUnitLoc(target))
endfunction

function DoDistractionAttack takes unit target returns nothing
  local unit d_target = GetDistractionTarget(target)
  if d_target == null then
    return
  endif
  call StartHarass(distraction_group, HARASS_TARGET_LOCATION, false, 15, 0.25, 1, GetUnitX(d_target), GetUnitY(d_target))
  call Sleep(15)
endfunction

function SleepInCombat takes nothing returns nothing
    local integer count = 0
    loop
        loop
            exitwhen town_threatened
            exitwhen break_attack
            exitwhen not CaptainInCombat(true)  // goal is cleared
            exitwhen CaptainRetreating()
            call Sleep(sleep_multiplier)
        endloop
        exitwhen town_threatened
        call Sleep(0.5)
        set count = count + 1
        exitwhen count >= 8
        exitwhen break_attack
    endloop
endfunction

function ReformUntilTargetDead takes unit target returns nothing
    loop
        exitwhen town_threatened
        exitwhen break_attack
        exitwhen captain_flee and CaptainRetreating()

        exitwhen not UnitAlive(target)  // target killed
        call AttackMoveKill(target)

        call Sleep(3 * sleep_multiplier)

        if not CaptainInCombat(true) then
          call FormGroup(2)
        endif
    endloop
endfunction

function SleepUntilAtGoal takes nothing returns nothing
    local integer lcount = 0
    loop
        exitwhen town_threatened
        set lcount = lcount + 1
	      call Sleep(sleep_multiplier)
        exitwhen break_attack
	      exitwhen CaptainRetreating()
	      if lcount >= 6 then
          exitwhen CaptainAtGoal()        // reached goal
          exitwhen CaptainIsHome()        // failed to path and returned home
	      endif
        exitwhen CaptainIsEmpty()       // all units died
        call Sleep(2 * sleep_multiplier)
    endloop
endfunction

function AttackMoveKillA takes unit target returns nothing
    if target == null or not UnitAlive(target) then
        call DisplayToAllDebug("Bad target passed to AttackMoveKillA")
        call Sleep(3 * sleep_multiplier)
        return
    endif
    set attack_running = true
    call DoAttackJobs()
    if distraction_group != 0 and GetOwningPlayer(target) != Player(PLAYER_NEUTRAL_AGGRESSIVE) and GetRandomInt(1,10) < 5 then
      if GetHarassGroupStrength(distraction_group) < GetPlayerStrength(ai_player) / 2 then
        call DoDistractionAttack(target)
      endif
    endif
    call AttackMoveKill(target)
    call ReformUntilTargetDead(target)
    call chat(C_DONE)
    call SleepInCombat()
    set attack_running = false
endfunction

function AttackMoveXYA takes integer x, integer y returns nothing
    set attack_running = true
    call DoAttackJobs()
    call AttackMoveXY(x,y)
    call SleepUntilAtGoal()
    call SleepInCombat()
    set attack_running = false
endfunction

function GetIntervalCreep takes integer lower, integer upper, integer str, integer anti_air_strength, boolean allow_air, integer sd returns unit
    local unit creep = null
    local integer creep_strength = 0
    local integer middle = (lower + upper) / 2

    if sd < 0 then
      return null
    endif
    set creep = GetCreepCamp(1, middle, allow_air)
    if creep == null then
        return GetIntervalCreep(middle, upper, str, anti_air_strength, allow_air, sd - 1)
    else
      set creep_strength = GetCreepCampStrength(creep) + 1
      if balancing then
        call DisplayToAll("Creep strength: " + Int2Str(creep_strength))
        call PingMinimap(GetUnitX(creep), GetUnitY(creep), 1)
      endif
      if creep_strength <= str then
        if air_strength <= anti_air_strength then
          return creep
        else
          return GetIntervalCreep(lower, upper, str, anti_air_strength, false, sd)
        endif
      else
        return GetIntervalCreep(lower, middle, str, anti_air_strength, allow_air, sd - 1)
      endif
    endif
endfunction

function GetFittingCreep takes integer str returns unit
    local integer anti_air_strength = R2I(GetPlayerPiercingStrength(ai_player))
    local unit creep = null
    local integer creep_strength = 0
    local boolean allow_air = anti_air_strength > 10

    set creep = GetCreepCamp(1, camp_last_checked, allow_air)
    if creep == null then
      return null
    endif
    set creep_strength = GetCreepCampStrength(creep) + 1
    if balancing then
      call DisplayToAll("Creep strength: " + Int2Str(creep_strength))
      call PingMinimap(GetUnitX(creep), GetUnitY(creep), 1)
    endif
    if creep_strength <= str and air_strength <= anti_air_strength then
      set air_strength = creep_strength
      return creep
    else
      return GetIntervalCreep(1,camp_last_checked,str, anti_air_strength, allow_air, camp_scan_depth)
    endif
endfunction

function CreepAttack takes integer str returns nothing
    local unit target = GetFittingCreep(str)
    if target == null then
      if balancing then
        call DisplayToAll("No creep target found")
      endif
      call Sleep(20)
      return
    endif
    call chat(C_CREEP)
    if air_strength > 15 then
      call SetAllianceTarget(target)
    endif
    call FormGroup(3)
    call AttackMoveKillA(target)
endfunction

function QueueAttackMoveXY takes integer x, integer y returns nothing
  set attack_running = true
  call DoAttackJobs()
  loop
    call Sleep(sleep_multiplier)
    call AttackMoveXY(x,y)
    exitwhen break_attack
    exitwhen CaptainRetreating()
    exitwhen CaptainAtGoal()
    call Sleep(sleep_multiplier)
  endloop
  call SleepInCombat()
  if CaptainAtGoal() then
    call QueueGetNextCommand()
  endif
  set attack_running = false
endfunction

function GetRangePenalty takes unit target returns integer
  return R2I(DistanceBetweenUnits(major_hero, target)/1400)
endfunction

function GetWeakestEnemy takes nothing returns player
    local integer i = 0
    local integer pmin = 0
    local integer minstr = 1000
    local integer cstr = 0
    loop
      exitwhen i == 12
      if IsPlayerEnemy(Player(i),ai_player) and not IsPlayerObserver(Player(i)) then
        set cstr = GetUnexactPlayerStrength(Player(i))
        if cstr < minstr and GetBuilding(Player(i)) != null then
          set pmin = i
          set minstr = cstr
        endif
      endif
    set i = i + 1
    endloop
    return Player(pmin)
endfunction

function GetStrongestEnemy takes nothing returns player
    local integer i = 0
    local integer pmax = 0
    local integer maxstr = 0
    local integer cstr = 0
    loop
      exitwhen i == 12
      if IsPlayerEnemy(Player(i),ai_player) and not IsPlayerObserver(Player(i)) then
        set cstr = GetUnexactPlayerStrength(Player(i))
        if cstr > maxstr then
          set pmax = i
          set maxstr = cstr
        endif
      endif
    set i = i + 1
    endloop
    return Player(pmax)
endfunction

function GetWeakAndNearEnemy takes nothing returns player
    local integer i = 0
    local integer pmin = -1
    local integer minstr = 10000
    local integer cstr = 0
    local unit cbuilding = null
    loop
      exitwhen i == 12
      if IsPlayerEnemy(Player(i),ai_player) and not IsPlayerObserver(Player(i)) then
        set cbuilding = GetBuilding(Player(i))
        if cbuilding != null and UnitAlive(cbuilding) then
          set cstr = GetUnexactPlayerStrength(Player(i)) + GetRangePenalty(cbuilding)
          if cstr < minstr then
            set pmin = i
            set minstr = cstr
          endif
        endif
      endif
      set i = i + 1
    endloop
    if pmin == -1 then
      call DisplayToAllDebug("Debug: GetWeakAndNearEnemy failed!")
      set pmin = 0
    endif
    return Player(pmin)
endfunction

function GetNearestEnemy takes nothing returns player
    local integer i = 0
    local integer pmin = -1
    local integer minstr = 10000
    local integer cstr = 0
    local unit cbuilding = null
    loop
      exitwhen i == 12
      if IsPlayerEnemy(Player(i),ai_player) and not IsPlayerObserver(Player(i)) then
        set cbuilding = GetBuilding(Player(i))
        if cbuilding != null and UnitAlive(cbuilding) then
          set cstr = GetRangePenalty(cbuilding)
          if cstr < minstr then
            set pmin = i
            set minstr = cstr
          endif
        endif
      endif
      set i = i + 1
    endloop
    if pmin == -1 then
      call DisplayToAllDebug("Debug: GetNearestEnemy failed!")
      set pmin = 0
    endif
    return Player(pmin)
endfunction

function GetSecondNearestEnemy takes nothing returns player
    local integer i = 0
    local integer pmin = -1
    local integer spmin = -1
    local integer minstr = 10000
    local integer sminstr = 10000
    local integer cstr = 0
    local unit cbuilding = null
    loop
      exitwhen i == 12
      if IsPlayerEnemy(Player(i),ai_player) and not IsPlayerObserver(Player(i)) then
        set cbuilding = GetBuilding(Player(i))
        if cbuilding != null and UnitAlive(cbuilding) then
          set cstr = GetRangePenalty(cbuilding)
          if cstr < minstr then
            set spmin = pmin
            set pmin = i
            set sminstr = minstr
            set minstr = cstr
          elseif cstr < sminstr then
            set spmin = i
            set sminstr = cstr
          endif
        endif
      endif
      set i = i + 1
    endloop
    if spmin == -1 then
      call DisplayToAllDebug("Debug: GetNearestEnemy failed!")
      set spmin = 0
    endif
    return Player(spmin)
endfunction

function GetFFAEnemy takes nothing returns player
  if GetRandomInt(1, 3) == 1 then
    return GetSecondNearestEnemy()
  else
    return GetNearestEnemy()
  endif
endfunction

function GetTowerFactor takes unit target returns integer
    if IsTowered(target) then
      if h_siege then
        return tower_factor
      else
        return 100
      endif
    else
      return 0
    endif
endfunction

function GetRace takes player p returns integer
  local race r = GetPlayerRace(p)
  if r == RACE_NIGHTELF then
    return R_ELF
  elseif r == RACE_HUMAN then
    return R_HUMAN
  elseif r == RACE_ORC then
    return R_ORC
  else
    return R_UNDEAD
  endif
endfunction

function GetRaceAggression takes unit target returns integer
  return race_aggression[GetRace(GetOwningPlayer(target)) * 3 + tier - 1]
endfunction

function GetTargetStrength takes unit target returns integer
  local integer str = GetUnexactPlayerStrength(GetOwningPlayer(target))
  if str < 100 then
    set str = minimum(str + GetRangePenalty(target), 100)
  endif
  return str
endfunction

function GetEnemyAllyStrength takes player tp returns integer
  local integer i = 0
  local integer ally_sum = 0
  local integer enemy_sum = 0
  loop
    exitwhen i >= 12
    if GetPlayerSlotState(Player(i)) == PLAYER_SLOT_STATE_PLAYING then
      if IsPlayerAlly(Player(i), ai_player) then
        set ally_sum = ally_sum + GetPlayerStrength(Player(i))
      elseif IsPlayerAlly(Player(i), tp) then
        set enemy_sum = enemy_sum + GetUnexactPlayerStrength(Player(i))
      endif
    endif
    set i = i + 1
  endloop
  return (enemy_sum - ally_sum)/2
endfunction

function IsTargetGood takes unit target, integer attacker_bonus returns boolean
  return GetTargetStrength(target)/2 + GetEnemyAllyStrength(GetOwningPlayer(target)) + GetTowerFactor(target) <= own_strength/2 + attacking_aggression + added_aggression + GetRaceAggression(target) + attacker_bonus
endfunction

function ChooseEnemyExpansionTarget takes nothing returns unit
    local unit target = null
    if GetRandomReal(0.0,1.0) <= comp_chosen_target_rate then
      return null
    endif
    set target = GetEnemyExpansion()
    if target != null then
      if IsTargetGood(target, expansion_target_bonus) then
        return target
      else
        return null
      endif
    else
      return null
    endif
endfunction

function ChooseEnemyBaseTarget takes nothing returns unit
    local integer c = 0
    local unit target = null
    if GetRandomReal(0.0,1.0) <= comp_chosen_target_rate then
      return null
    endif
    call StartGetEnemyBase()
    loop
      exitwhen not WaitGetEnemyBase()
      if c > 4 then
        return null
      endif
      call Sleep(1)
      set c = c + 1
    endloop
    set target = GetEnemyBase()
    if target != null then
      if IsTargetGood(target, comp_chosen_target_bonus) then
        return target
      else
        return null
      endif
    else
      return null
    endif
endfunction

function ChooseAnyEnemyTarget takes nothing returns unit
    local unit target = null
    local player target_enemy = null
    if attacking_strategy == 1 or attacking_strategy == 3 then
      set target_enemy = GetWeakestEnemy()
    elseif attacking_strategy == 2 then
      set target_enemy = GetStrongestEnemy()
    elseif attacking_strategy == 5 then
      set target_enemy = GetFFAEnemy()
    else
      set target_enemy = GetWeakAndNearEnemy()
    endif
    set target = GetBuilding(target_enemy)
    if attacking_strategy == 3 then
      set alli_target = GetBuilding(GetStrongestEnemy())
      return target
    elseif IsTargetGood(target, 0) then
      set alli_target = target
      return target
    else
      return null
    endif
endfunction

function ChooseAttackTarget takes nothing returns unit
    local unit target = null
    set target = ChooseEnemyExpansionTarget()
    if target == null then
      set target = ChooseEnemyBaseTarget()
    endif
    set alli_target = target
    if target == null then
      set target = ChooseAnyEnemyTarget()
    endif
    return target
endfunction

function SingleMeleeAttack takes boolean needs_exp, boolean has_siege, integer ai_strength returns nothing
    local unit hall = null
    local unit mega = null
    local unit creep = null
    local unit common = null

    if town_threatened then
      call DisplayToAllDebug("Single Melee Attack, Town threatened" )
      return
    endif
    call DisplayToAllDebug("Single Melee Attack" )

    set h_siege = has_siege
    set own_strength = ai_strength

    call set_aggression()

    if no_attack then
      call DisplayToAllDebug("No Attack is on" )
      call Sleep(4 * sleep_multiplier)
      call ClearCaptainTargets()
      return
    endif

    if queue_running then

      if queue_attack_p then
        call DisplayToAllDebug("Attacking point "+Int2Str(queue_t_x)+","+Int2Str(queue_t_y) )
        call FormGroup(3)
        call QueueAttackMoveXY(queue_t_x, queue_t_y)
        call DisplayToAllDebug("Point reached or aborted" )
        return

      elseif queue_attack_u then
        if queue_t_u == null then
          call DisplayToAllDebug("No unit targeted, queue stopped" )
          set queue_running = false
        elseif not UnitAlive(queue_t_u) then
          call DisplayToAllDebug("Unit is dead, next command" )
          call QueueGetNextCommand()
        else
          call DisplayToAllDebug("Attacking unit" )
          call FormGroup(3)
          call AttackMoveKillA(queue_t_u)
          call DisplayToAllDebug("Attack complete" )
          return
        endif
      endif

    endif

    if attack_player then
      call DisplayToAllDebug("Attacking player" )
      set hall = GetBuilding(Player(attack_target_p))
      if hall == null then
        call DisplayToAllDebug("No target found" )
        set attack_player = false
        return
      endif
      call FormGroup(3)
      call AttackMoveKillA(hall)
      call DisplayToAllDebug("Attack complete" )
      return
    endif

    if attack_point then
      call DisplayToAlliesDebug("Attacking point "+Int2Str(attack_target_x)+","+Int2Str(attack_target_y) )
      call FormGroup(3)
      call AttackMoveXYA(attack_target_x, attack_target_y)
      call DisplayToAllDebug("Attack complete" )
      return
    endif

    if attack_unit then
      if target_unit == null then
        call DisplayToAllDebug("No unit targeted" )
        set attack_unit = false
      elseif not UnitAlive(target_unit) then
        call DisplayToAllDebug("Unit is dead" )
        set attack_unit = false
      else
        call DisplayToAllDebug("Attacking unit" )
        call FormGroup(3)
        call AttackMoveKillA(target_unit)
        call DisplayToAllDebug("Attack complete" )
        return
      endif
    endif


    // defend expansion from other expansion
    //
    if double_expansion_target != null then
      call SetAllianceTarget(double_expansion_target)
      call FormGroup(3)
      call AttackMoveKillA(double_expansion_target)
      if not UnitAlive(double_expansion_target) then
        set double_expansion_target = null
      endif
      return
    endif
    
    if not (no_creep_attack or ai_no_creep) then

      // take expansions as needed
      //
      if needs_exp then
        if first_expansion_chosen and (current_expansion == null or CheckExpansionTaken(current_expansion)) then
          call ChooseExpansion()
          if current_expansion == null then
            return
          endif
        endif
        set creep = GetExpFoe()
        if creep != null and UnitAlive(creep) then
          set battle_radius = 750
          call SetAllianceTarget(creep)
          call chat(C_EXPANSION)
          call FormGroup(3)
          call AttackMoveKillA(creep)
	        if GetExpFoe() == null then
            set take_exp = false
	        endif
          return
        endif
      endif

    endif

    // coordinate with allies
    //
    if not no_ai_ally then
      set common = GetAllianceTarget()
      if common != null then
        call chat(C_ALLY)
        call FormGroup(3)
        call AttackMoveKillA(common)
        call DisplayToAllDebug("Attack complete")
        call SetAllianceTarget(null)
        return
      endif
    endif

    if not no_player_attack then

      // all-out attack if the player is down
      //
      set mega = GetMegaTarget()
      if mega != null and UnitAlive(mega) then
        call chat(C_MEGA)
        call chat(C_MEGATARGET)
        call FormGroup(3)
        call AttackMoveKillA(mega)
        return
      endif

      if GetHeroXP(hero_unit[1]) < GetRandomInt(50,150) or GetHeroXP(hero_unit[1]) > GetRandomInt(300,850) or GetHeroXP(hero_unit[2]) > 450 or FoodUsed() > GetRandomInt(50,60) then

        set hall = ChooseAttackTarget()
        if hall != null and UnitAlive(hall) then
          call chat(C_ATTACK)
          if not no_ai_ally then
            call SetAllianceTarget(alli_target)
            set alli_target = null
          endif
          call FormGroup(3)
          call AttackMoveKillA(hall)
          return
        endif

      endif
    endif

    if no_creep_attack or ai_no_creep then
      call DisplayToAllDebug("no creeping" )
      call Sleep(4 * sleep_multiplier)
      return
    endif

    // nothing better to do, so kill a creep camp
    //
    set battle_radius = 750
    call CreepAttack(own_strength)

endfunction

function UnsummonAll takes nothing returns nothing
    local unit bldg = null
    loop
        set bldg = GetBuilding(ai_player)
        exitwhen bldg==null
        call Unsummon(bldg)
        call Sleep(2 * sleep_multiplier)
    endloop
endfunction

function SkillArrays takes nothing returns integer
    local integer level = GetHeroLevelAI()
    local integer hn = GetHeroNumber(GetHeroId())

    if level > max_hero_level then
        set max_hero_level = level
    endif

    return skills[(hn - 1) * 10 + level]
endfunction

function StoreSkills takes integer ta returns nothing
  local integer i = 1
  loop
    exitwhen i > 10
    set skills[(ta - 1) * 10 + i] = tempskills[i]
    set i = i + 1
  endloop
endfunction

function LoadSkillsExt takes integer sa returns nothing
  local integer i = 1
  loop
    exitwhen i > 10
    set tempskills[i] = allskills[sa + i]
    set i = i + 1
  endloop
endfunction

function LoadSkills takes integer sa, integer hn, integer ta returns nothing
  call LoadSkillsExt(sa*10+hn*30-40)
  call StoreSkills(ta)
endfunction

function AwaitMeleeHeroes takes nothing returns nothing
  local integer i = 1
  loop
    loop
      exitwhen i > 3
      if GetUnitCountDone(old_id[hero_id[i]]) > 0 and GetUnitUserData(hero_unit[i]) == UNIT_STANDARD then
        return
      endif
      set i = i + 1
    endloop
    set i = 1
    exitwhen player_defeated
    call Sleep(2 * sleep_multiplier)
  endloop
endfunction

function GetArmyHealthState takes nothing returns real
  local group g = CreateGroup()
  local unit u = null
  local real health_sum = 0.0
  local integer count = 0
  local real uhs = 0.0
  local integer hid = 0
  
  call GroupClear(healer_group)
  call GroupClear(urgent_healing_group)
  call GroupClear(medium_healing_group)
  call GroupClear(small_healing_group)
  set urgent_healing_count = 0
  set medium_healing_count = 0
  set small_healing_count = 0
  set ward_cast = false
  call GroupEnumUnitsOfPlayer(g, ai_player, null)
  loop
    set u = FirstOfGroup(g)
    exitwhen u == null
    if GetUnitTypeId(u) == 'ohwd' then
      set ward_cast = true
    endif
    if UnitAlive(u) and not (IsUnitType(u, UNIT_TYPE_PEON) or IsUnitType(u, UNIT_TYPE_STRUCTURE) or IsUnitType(u, UNIT_TYPE_SUMMONED) or IsUnitType(u, UNIT_TYPE_MECHANICAL)) then
      set uhs = GetUnitState(u, UNIT_STATE_LIFE) / GetUnitState(u, UNIT_STATE_MAX_LIFE)
      set health_sum = health_sum + 1
      set count = count + 1
      set hid = GetHealerId(GetUnitTypeId(u))
      if hid != -1 and GetUnitState(u, UNIT_STATE_MANA) >= (healer_mana_cost[hid] * 2) / 3 and ((healer_upg_id[hid] == 0) or (GetUpgradeLevel(healer_upg_id[hid]) >= healer_upg_level[hid])) then
        call GroupAddUnit(healer_group, u)
      endif
      if uhs < 0.5 then
        call GroupAddUnit(urgent_healing_group, u)
        set urgent_healing_count = urgent_healing_count + 1
      elseif uhs < 0.75 then
        call GroupAddUnit(medium_healing_group, u)
        set medium_healing_count = medium_healing_count + 1
      elseif uhs < 1 then
        call GroupAddUnit(small_healing_group, u)
        set small_healing_count = small_healing_count + 1
      endif
    endif
    call GroupRemoveUnit(g,u)
  endloop
  call DestroyGroup(g)
  set g = null
  set fountain_available = own_race != R_ELF and neutral_available[NEUTRAL_HEALING_FOUNTAIN] and (not neutral_guarded[NEUTRAL_HEALING_FOUNTAIN] or (neutral_night_buy[NEUTRAL_HEALING_FOUNTAIN] and GetFloatGameState(GAME_STATE_TIME_OF_DAY) >= 18))
  return health_sum / I2R(count)
endfunction

function MakeUnitHeal takes unit u returns nothing
  local unit healer = GetHealer()
  if healer != null then
    call RemoveGuardPosition(u)
    call SetUnitUserData(u, UNIT_HEALING)
    call TQAddUnitJob(5, RESET_GUARD_POSITION, 0, u)
    call IssuePointOrder(u, "move", GetUnitX(healer), GetUnitY(healer))
    call HealUnit(healer, u, true)
  elseif own_race != R_ELF and not IsUnitType(u, UNIT_TYPE_PEON) and not IsUnitType(u, UNIT_TYPE_MECHANICAL) and not (GetUnitTypeId(u) == old_id[racial_ghoul]) and not (GetUnitTypeId(u) == old_id[racial_militia]) and fountain_available then
    call RemoveGuardPosition(u)
    call SetUnitUserData(u, UNIT_HEALING)
    call TQAddUnitJob(8, RESET_HEALTH, 80, u)
    call IssuePointOrder(u, "move", GetUnitX(nearest_neutral[NEUTRAL_HEALING_FOUNTAIN]), GetUnitY(nearest_neutral[NEUTRAL_HEALING_FOUNTAIN]))
  endif
endfunction

function ApplyMassHealingItem takes unit u, item mh_i returns nothing
  call GroupPointOrder(urgent_healing_group, "move", GetUnitX(u), GetUnitY(u))
  call GroupPointOrder(medium_healing_group, "move", GetUnitX(u), GetUnitY(u))
  call GroupPointOrder(small_healing_group, "move", GetUnitX(u), GetUnitY(u))
  call Sleep(5 * sleep_multiplier)
  call UnitUseItem(u, mh_i)
endfunction

function HealArmy takes nothing returns nothing
  local real hs = 0.0
  local unit u = null
  local integer mh_item = 0
  local item mh_i = null
  loop
    if not (town_threatened or CaptainRetreating()) then
      set hs = GetArmyHealthState()
      if hs < 0.6 and (urgent_healing_count + medium_healing_count > 3) and (own_race == R_HUMAN or (own_race == R_UNDEAD and tier >= 3)) then
        if own_race == R_HUMAN then
          set mh_item = SCROLL_OF_REGENERATION  //todomarker
        else
          set mh_item = SCROLL_OF_HEALING
        endif
        set mh_i = GetItemOfType(mh_item)
        if mh_i != null then
          set u = GetItemHero(mh_i)
          if u != null then
            call ApplyMassHealingItem(u, mh_i)
          endif
          call Sleep(10 * sleep_multiplier)
        else
          call SetBuildItem(1, mh_item, 100)
          call Sleep(8 * sleep_multiplier)
        endif
      else
        exitwhen (((urgent_healing_count == 0) and hs > 0.8) or (FirstOfGroup(healer_group) == null and not fountain_available)) and not shop_ordered
        loop
          set u = FirstOfGroup(urgent_healing_group)
          exitwhen u == null
          if GetUnitUserData(u) == UNIT_STANDARD then
            call MakeUnitHeal(u)
          endif
          call GroupRemoveUnit(urgent_healing_group, u)
        endloop
        loop
          set u = FirstOfGroup(medium_healing_group)
          exitwhen u == null
          if GetUnitUserData(u) == UNIT_STANDARD then
            call MakeUnitHeal(u)
          endif
          call GroupRemoveUnit(medium_healing_group, u)
        endloop
        loop
          set u = FirstOfGroup(small_healing_group)
          exitwhen u == null or FirstOfGroup(healer_group) == null
          if GetUnitUserData(u) == UNIT_STANDARD then
            call MakeUnitHeal(u)
          endif
          call GroupRemoveUnit(small_healing_group, u)
        endloop
      endif
    endif
    call Sleep(2 * sleep_multiplier)
  endloop
endfunction

function DefendTown takes nothing returns nothing
  loop
    exitwhen not town_threatened
    if not teleporting then
      call AttackMoveXY(R2I(GetLocationX(town_loc[most_threatened_town])), R2I(GetLocationY(town_loc[most_threatened_town])))
    endif
    call Sleep(sleep_multiplier)
  endloop
endfunction

function universal_attack_sequence takes nothing returns nothing
    local boolean needs_exp = false
    local boolean has_siege = false
    local integer ai_strength = GetOwnStrength()
    local integer ai_antiair_strength = air_strength
    local integer exp_strength = GetExpansionStrength()

    if ai_strength < minimum_attack_strength then
      call Sleep(5 * sleep_multiplier)
      return
    endif
    if hero_unit[1] == null then
      call Sleep(sleep_multiplier)
      return
    endif
    
    if major_hero == null or not UnitAlive(major_hero) then
      set major_hero = GetMajorHero()
    endif

    set needs_exp        = take_exp and ((ai_strength >= exp_strength and ai_antiair_strength >= air_strength) or GetGoldOwned()<2000)
    set has_siege = ai_strength > 30

    call SingleMeleeAttack(needs_exp,has_siege,ai_strength)
    
    loop
      exitwhen not teleporting
      call Sleep(1)
    endloop
    
    if town_threatened then
      call DefendTown()
    endif
    
    if go_home then
      call DisplayToAllDebug("Going home" )
      call CaptainGoHome()
    endif
    set break_attack = false
    set go_home = false

endfunction

function universal_peon_assignment takes nothing returns nothing
    local integer T = TownWithMine()
    local integer g = GetGold()
    local integer w = GetWood()
    local integer pwh = 0
    local integer swh = 0
    local real gdivw = I2R(g)/I2R(maximum(w,1))
    local integer i = T + 1

    if T < 0 then
      set T = 0
    endif

    if g - w > 300 then
      set pwh = 2
    elseif g - w > 500 and w < 100 then
      set pwh = 5
    elseif g - w > 900 and w < 200 then
      set pwh = 8
    else
      set pwh = 2
    endif

    if w < 200 then
      set swh = 6 - pwh
    elseif gdivw < 0.5 then
      set swh = 0
    elseif gdivw < 0.8 then
      set swh = maximum(1 - pwh,0)
    elseif gdivw < 1.1 then
      set swh = maximum(2 - pwh,0)
    elseif gdivw < 1.4 then
      set swh = maximum(3 - pwh,0)
    elseif gdivw < 1.7 then
      set swh = maximum(4 - pwh,0)
    elseif gdivw < 2.0 then
      set swh = maximum(5 - pwh,0)
    else
      set swh = maximum(6 - pwh,0)
    endif

    set swh = maximum(swh - 4 * TownCountDone(neutral_shredder),0)

    call ClearHarvestAI()
    call HarvestGold(T,3)
    call HarvestWood(0,pwh)
    if gdivw < 3.0 or g < 300 then
      call HarvestGold(T,2)
    endif
    call HarvestWood(0,swh)

    loop
      exitwhen i > T + 3
      if TownHasMine(i) and TownCountEx(racial_expansion,true,i) > 0 then
        if gdivw < 3.0 or g < 300 then
          call HarvestGold(i,5)
        else
          call HarvestGold(i,3)
        endif
      endif
      set i = i + 1
    endloop

    call HarvestWood(0,20)
endfunction

function SetBuildReact takes integer food, integer min1, integer unit1, integer min2, integer unit2, real enemy_strength, real strength1, real strength2, integer prio returns nothing
  local integer num1 = R2I(LinearInterpolation(strength1, strength2, I2R(food), 0, enemy_strength))/GetFoodUsed(old_id[unit1])
  local integer num2 = (food - num1 * GetFoodUsed(old_id[unit1]))/GetFoodUsed(old_id[unit2])
  call SetBuildUnit(min1 + num1, unit1, prio)
  call SetBuildUnit(min2 + num2, unit2, prio)
endfunction

function SetAIResources takes integer g, integer w returns nothing
  call SetPlayerGold(ai_player, g)
  call SetPlayerWood(ai_player, w)
endfunction

function IncreaseAIResources takes integer g, integer w returns nothing
  call IncreasePlayerGold(ai_player, g)
  call IncreasePlayerWood(ai_player, w)
endfunction

function CampaignDefender takes integer qty, integer unitid returns nothing
    set defense_qty[defense_length] = qty
    set defense_units[defense_length] = unitid
    set defense_length = defense_length + 1
endfunction

function CampaignDefenderEx takes integer easy, integer med, integer hard, integer unitid returns nothing
    if difficulty == EASY then
        call CampaignDefender(easy,unitid)
    elseif difficulty == NORMAL then
        call CampaignDefender(med,unitid)
    else
        call CampaignDefender(hard,unitid)
    endif
endfunction

function CampaignAttacker takes integer qty, integer unitid returns nothing
    call SetAssaultGroup(qty,qty,unitid)
endfunction

function CampaignAttackerEx takes integer easy, integer med, integer hard, integer unitid returns nothing
    if difficulty == EASY then
        call CampaignAttacker(easy,unitid)
    elseif difficulty == NORMAL then
        call CampaignAttacker(med,unitid)
    else
        call CampaignAttacker(hard,unitid)
    endif
endfunction

function AddWaveResources takes nothing returns nothing
  local integer g = 0
  local integer w = 0
  local integer i = 0
  local integer unitid = 0
  local integer desire = 0

  loop
    exitwhen i >= attack_length
    set unitid = attack_units[i]
    set desire = attack_qty[i]
    set g = g + desire * GetUnitGoldCost(old_id[unitid])
    set w = w + desire * GetUnitWoodCost(old_id[unitid])
    set i = i + 1
  endloop

  call IncreaseAIResources(g,w)
  
endfunction

function BuildAndAttack takes player p, integer prio returns nothing
    local integer index = 0
    local integer unitid = 0
    local integer desire = 0
    local boolean group_ready = true
    
    call AddWaveResources()

    loop
      set index = 0
      set group_ready = true
      loop
        exitwhen index >= attack_length
        set unitid = attack_units[index]
        set desire = attack_qty[index] + campaign_defenders[unitid]
        if TownCountDone(unitid)<desire then
          set group_ready = false
          call SetBuildUnit(desire , unitid, prio)
        endif
        set index = index + 1
      endloop
      exitwhen group_ready
      call Sleep(5 * sleep_multiplier)
    endloop

    call FormGroup(5)
    call SuicidePlayer(p, true)
    loop
      exitwhen CaptainIsEmpty()
      call Sleep(5 * sleep_multiplier)
    endloop
    
endfunction

function BuildDefenders takes integer prio returns nothing
    local integer index = 0
    local integer unitid = 0
    local integer qty = 0
    loop
        exitwhen index >= defense_length

        set unitid = defense_units[index]
        set qty = defense_qty[index]

        call SetBuildUnit(qty, unitid, prio)
        call Conversions(qty,unitid)
        call AddDefenders(qty,old_id[unitid])
        set campaign_defenders[unitid] = qty

        set index = index + 1
    endloop
endfunction