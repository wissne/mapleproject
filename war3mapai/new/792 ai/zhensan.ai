globals
    player ai_player=null
    string message_add=""
    sound chatSound=CreateSound("Sound\\Interface\\InGameChatWhat1.wav",false,false,false,10,10,"")
    constant real bj_RADTODEG=180./3.14159
    integer array zs_action_prioty_arry
    unit budaobingW=null
    unit budaobingW2=null
    unit budaobingD=null
    unit budaobingD2=null 
    unit TowerD=null 
    unit TowerW=null
    unit NearestEnemyBubing=null
    unit FarestAllyBubing=null
    unit ZhongliEnemy=null
    boolean zs_kickoff=false
    location safeLoc=null
    real EnemyHeroHP=99999
    real EnemyHeroMP=99999
    real MyHeroHP=0
    real MyHeroMP=0
    real rangeToTowerD=99999
    real U=99999
    real rangeToHeroD=999999
    integer EnemyHeroLevel=0
    integer mHeroLevel=0
    integer EnemyCount=0
    integer ZhongliEnemyCount=0
    integer AllyCount=0
    integer crEnemyHeroOrder=0
    integer array spell_damage_m
    integer zs_prioty_index=0
    location zs_MyFireLoc=null
    real NV=999999
    integer BV=990
    gamecache zs_gamecache=InitGameCache("zhensan.w3v")
    gamecache zs_gamecache2=zs_gamecache
    integer FV=0
    string aistr=""
    integer hid_zhugeliang='H008'
    integer hid_zhaoyun='E000'
    integer hid_guanyu='O003'
    integer hid_zhangfei='O002'
    integer hid_weiyan='H004'
    integer hid_simayi='U00A'
    integer hid_guojia='U000'
    integer hid_caoren='U007'
    integer hid_dianwei='H006'
    integer hid_xun='U00I'
    integer hid_zhangliao='H005'
    integer hid_dadi='H01G'
    integer hid_gongben='N011'
    integer hid_sunquan='U00O'
    integer hid_zhanghe='E00C'
    integer hid_madai='Hvwd'
    integer uid_XiaLuMutong='hgtw'
    integer uid_ShangLuMutong='hwtw'
    integer uid_toushiche='o00C'
    integer uid_benzhen='hcas'
    integer uid_bingying='hbar'
    integer uid_judian='harm'
    integer uid_liangcang='hars'
    integer uid_chuanzhang='h00P'
    integer uid_zhonglishangdian='n015'
    integer uid_dragon='n006'
    integer uid_zhimingjiejieLv1='o00D'
    integer uid_zhimingjiejieLv2='o00G'
    integer uid_zhimingjiejieLv3='o00E'
    integer uid_zhimingjiejieLv4='o00F'
    integer uid_yanjing='otot'
    integer uid_shexingjiejieLv1='o00I'
    integer uid_shexingjiejieLv2='o00J'
    integer uid_shexingjiejieLv3='o00H'
    integer iid_zhanshenfu='tstr'
    integer iid_zhanshenkai='tst2'
    integer iid_tianxue='rspd'
    integer iid_laojiu='pgma'
    integer iid_roubao='shrs'
    integer iid_duanjian='I01M'
    integer iid_fashichangpao='I01L'
    integer iid_tuimodaozhizuoshu='bzbf'
    integer iid_tuimodao='I01I'
    integer iid_sunzibingfa='I01Y'
    integer iid_mengdeshu='jdrn'
    integer iid_qingnangshu='frgd'
    integer iid_shennongbencao='I02D'
    integer iid_wushuquanzhang='ssan'
    integer iid_gangtiezhizhui='I02B'
    integer iid_liliangshoutao='rst1'
    integer iid_eguizhuizhizuoshu='thle'
    integer iid_eguizhui='I029'
    integer iid_qixingjian='I01O'
    integer iid_yemingzhu='I009'
    integer iid_yinjian='I012'
    integer iid_qixingdaozhizuoshu='skrt'
    integer iid_xuanwufu='I02C'
    integer iid_huangzhonggong='I003'
    integer iid_zhuzhaoyongzui='I00P'
    integer iid_yuexiameiren='I01K'
    integer iid_qinglongdan='I00V'
    integer iid_zhuqueyi='I00U'
    integer iid_qilinxin='I00T'
    integer iid_bingjinyushan='I02A'
    integer iid_qinghongjian='I016'
    integer iid_yueguangqiang='I00E'
    integer iid_longzhixin='I00Z'
    integer iid_longzhixue='I013'
    integer iid_guanyuzhuanshu='I017'
    integer iid_zhiliaobang='I00J'
    integer AO=-1
    integer aid_shuxingdian='Aamk'
    integer aid_dadi_chaonong='ANta'
    integer aid_dadi_fensui='Awar'
    integer aid_dadi_yingpi='A04X'
    integer aid_dadi_dileizhen='A08J'
    integer aid_gongben_longzuishan='A067'
    integer aid_xiahouyuan_huixuanzhan='A04R'
    integer aid_zuiwoshachang='A00C'
    integer KO='A055'
    integer aid_madai_yingyan='A02D'
    integer aid_madai_cichuan='A00J'
    integer aid_madai_yuanjianshu='ACev'
    integer aid_madai_zhuihun='A066'
    integer aid_zhanghe_duwu='A05H'
    integer aid_zhanghe_dujian='A05F'
    integer aid_zhanghe_xieexingyang='A05M'
    integer aid_zhanghe_juduji='A05G'
    integer aid_sunquan_fandongjian='A05K'
    integer aid_sunquan_jianguangbi='A06S'
    integer aid_sunquan_bizhan='ACfd'
    integer ER='A053'
    item XR=null
    item OR=null
    item RR=null
    item IR=null
    item AR=null
    item NR=null
    boolean zs_NeedToBuy=true
    boolean OkSunZiBingFa=false
    boolean OkTuiMoDao=false
    integer FR=0
    boolean GR=false
    timer zs_timer1=CreateTimer()
    real array zs_ElapsedTime
    integer mGold=0
    integer lumber=0
    location suguoBaseLoc=Location(-6600,-7800)
    location weiguoBaseLoc=Location(6000,7000)
    location suguoBaseLoc2=Location(-6976,-7872)
    location weiguoBaseLoc2=Location(6500,6800)
    location zs_He_middle=Location(-850,-780)
    location zs_xialu_yinbingLoc=Location(704,-5260)
    location zs_xialu_yinbingLoc2=Location(540,-4955)
    location zs_xialu_yinbingLoc3=Location(737,-7000)
    location zs_xialu_yinbingLoc4=Location(-1682,-6942)
    location zs_xialu_WeiGuoyinbingLoc=Location(4250,-688)
    location zs_xialu_WeiGuoyinbingLoc2=Location(6600,-688)
    location zs_xialu_mutong=Location(2900,-3100)
    boolean isdebug=true
    integer MaxSlot=6
    string array digit_str
    unit mHero=null
    location BI=null
    integer CI=0
    boolean DI=false
    unit HeroD=null
    unit NearestHeroD=null
    unit zs_mutong=null
    unit EnemyBingYing=null
    unit KI=null
    unit EnemyNonAttackStructure=null
    unit MI=null
    unit zs_caoren=null
    unit QI=null
    unit SI=null
    unit array zs_AllyHeros
    unit array zs_EnemyHeros
    integer ShangluEnemyCount=0
    integer ZhongluEnemyCount=0
    integer XialuEnemyCount=0
    integer ShangluAllyCount=0
    integer ZhongluAllyCount=0
    integer XialuAllyCount=0
    integer ShangluAllyHeroCountNearFL=0
    integer ZhongluAllyHeroCountNearFL=0
    integer XialuAllyHeroCountNearFL=0
    integer ShangluEnemyHeroCountNearFL=0
    integer ZhongluEnemyHeroCountNearFL=0
    integer XialuEnemyHeroCountNearFL=0
    unit zs_weakestEnemyHero=null
    real LowestEnemyHeroHp=999999
    integer gm_AllyHeroCount=0
    integer gm_EnemyHeroCount=0
    integer gm_all_PlayerCount=0
    integer zs_AllyHeroNearMeCount=0
    integer zs_EnemyHeroNearMeCount=0
    unit zs_AllyHeroNearestToHeroD=null
    real zs_allyHeroToHeroDMinRange=999999
    unit zs_AllyHeroNearestToMe=null
    real zs_allyHeroToMeMinRange=999999
    boolean SA=false
    boolean zs_suguoyinbing=true
    boolean zs_weiguoyinbing=true
    location array zs_path_middle
    location array zs_path_shanglu
    location array zs_path_xialu
    location mBaseLoc=null
    location mEnemyBaseLoc=null
    location mdubingLoc=null
    location ON=null
    location zs_cr_attackLoc=mEnemyBaseLoc
    location zs_cr_retreatLoc=null
    location array zs_firelines
    integer zs_locindex=0
    integer debugTmpindex=-1
    boolean lockflag=false
    integer mHeroId=0
    integer mForceId=0
    integer zs_cr_fightline=1
    integer HN=0
    integer JN=-1
    integer KN=-1
    integer LN=-1
    boolean MN=false
    integer PN=-1
    unit QN=null
    integer SN=300
    integer zs_dubingParam=200
    integer array mSkillArray
    real WN=78
    real YN=78
    real ZN=1.8
    real attackRange=600
    real EB=90
    real XB=90
    real OB=300
    real RB=300
    real IB=280
    real AB=230
    real zs_chiyaoSafeRangetoEnemy=900
    real zs_SafeLocRangeToEnemyA=620
    real zs_SafeLocRangeToEnemy=620
    real DB=900
    real FB=30
    real zs_gardRange=1800
    item array HeroItems
    unit zs_buyitemtmpshop=null
    boolean bBuyItemFlag=true
    unit zs_nearestMinHpAllyBing=null
    unit zs_nearestMinHpEnemyBing=null
    unit FarestAllyBubingFromRetreatLoc=null
    unit NearestEnemyBubingFromRetreatLoc=null
    real zs_nearestAllyBingMinHp=999999
    real zs_nearestEnemyBingMinHp=999999
    real zs_nearestEnemyHeroMinRange=999999
    real zs_nearestEnemyTowerMinRange=999999
    real zs_nearestAllyTowerMinRange=999999
    real ZB=999999
    real zs_FarestAllyBingMaxRange=0
    real zs_FarestAllyBingFromRetreatLocMaxRange=0
    real zs_NearestEnemyBingFromRetreatLocMinRange=9999999
    real OC=9999999
    unit RC=null
    real IC=0
    unit AC=null
    real NC=9999999
    unit BC=null
    real CC=0
    unit DC=null
    real FC=9999999
    unit GC=null
    real HC=0
    unit JC=null
    real KC=9999999
    real LC=9999999
    real MC=.4
    real PC=1.6
    real QC=4
    real SC=1.8
    real TC=3
    real UC=1.8
    real WC=4
    real zs_myhero_preHP=0
    real zs_myhero_hpchanged=0
    integer zs_crCommand=-1
    integer ED=-1
    location XD=null
    location zs_weiguoBuyItemZhongliLoc=Location(1782,550)
    unit HeroCrAttackUnit=null
    real ND=280
    real BD=6
    unit zs_attackEnemyBing=null
    unit DD=null
    integer zs_CCPlayerID=-1
    item GD=null
    integer array zs_FirelocShanglu
    integer array zs_FirelocZhonglu
    integer array zs_FirelocXialu
    boolean LD=true
    boolean zs_canspelltoHerod=true
    integer zs_HeroPower=0
    unit array zs_EnemyBingNearHeros
    unit array zs_AllyBingNearHeros
    real array zs_NearHeroBingsLifeAlly
    real array zs_NearHeroBingsLifeEnemy
    real array WD
    integer YD=0
    group zs_toushiche_group=null
    group VF=null
    group EF=null
    group XF=null
    unit array zs_judianw
    unit array RF
    unit array IF
    unit AF=null
    unit NF=null
    unit BF=null
    location array CF
    unit array DF
    location array FF
    unit GF=null
    unit HF=null
    location JF=null
    location KF=null
    boolean LF=false
    integer hiddenX=7000
    integer hiddenY=-7960
    item array zs_itemCanUse
    item array zs_itemNotCanUse
    integer array zs_itemID1
    integer array zs_itemID2
    location WF=null
    boolean YF=false
    boolean ZF=false
    unit zs_shizhe=null
    integer XG=0
    boolean OG=true
    boolean RG=true
    boolean IG=false
    boolean canBuyFireCar=false
    integer NG=0
    unit UnitTouShiChe=null
    real RangeToTouShiChe=999999
    integer zs_player_index=-1
    integer FG=0
    boolean GG=false
    integer HG=0
    integer JG=9999999
    integer KG=0
    integer LG=9999999
    integer MG=0
    unit PG=null
    unit QG=null
    location SG=null
    location TG=null
    integer UG=0
    integer WG=0
    integer YG=0
    integer ZG=0
    integer VH=0
    integer EH=0
    boolean XH=false
    integer RH=0
    integer IH=0
    integer array AH
    integer NH=0
    boolean BH=false
    integer CH=0
    location DH=null
    unit FH=null
    unit GH=null
    integer HH=0
    integer JH=0
    real KH=999999
    boolean LH=false
    boolean MH=false
    boolean PH=false
    boolean QH=false
    unit SH=null
    location TH=null
    unit UH=null
    location WH=null
    unit UnitZhiMingJieJie=null
    unit UnitYanJin=null
    unit UnitSheXingJieJie=null
    unit EJ=null
    unit XJ=null
    unit OJ=null
    unit RJ=null
    boolean quanZheYingMoShi=false
    boolean AJ=false
    integer NJ=2600
    boolean zhuLiMoShi=true
endglobals

function AK takes handle h returns integer
    return h
    return 0
endfunction

function NK takes integer i returns unit
    return i
    return null
endfunction

function BK takes integer i returns location
    return i
    return null
endfunction

function CK takes integer i returns item
    return i
    return null
endfunction

function DisplayToAll takes string s returns nothing
    call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,15,message_add+s)
    call StartSound(chatSound)
endfunction

function absolute takes real HK returns real
    if HK<0 then
        return(-HK)
    else
        return(HK)
    endif
endfunction

function YK takes unit u returns boolean
    return GetPlayerController(GetOwningPlayer(u))==MAP_CONTROL_USER
endfunction

function GetGold takes nothing returns integer
    return GetPlayerState(ai_player,PLAYER_STATE_RESOURCE_GOLD)
endfunction

function GetWood takes nothing returns integer
    return GetPlayerState(ai_player,PLAYER_STATE_RESOURCE_LUMBER)
endfunction

function GetSlotsFreeOnUnit takes unit u returns integer
    local integer i=0
    local integer XL=0
    loop
        exitwhen i>5
        if UnitItemInSlot(u,i)==null then
            set XL=XL+1
        endif
        set i=i+1
    endloop
    return XL
endfunction

function debugstr takes string s returns nothing
    if isdebug then
        call DisplayToAll(s)
    endif
endfunction

function ITS takes integer ic returns string
    local string s=""
    local integer i=ic
    local integer NL=0
    local boolean BL=false
    if i==0 then
        return"0"
    endif
    if i<0 then
        set BL=true
        set i=-i
    endif
    loop
        exitwhen i==0
        set NL=i
        set i=i/ 10
        set s=digit_str[NL-10*i]+s
    endloop
    if BL then
        return"-"+s
    endif
    return s
endfunction

function isZhongLiEnemy takes unit u returns boolean
    return(IsUnitOwnedByPlayer(u,Player(12)))
endfunction

function IsUnitDeadBJ takes unit whichUnit returns boolean
    return GetUnitState(whichUnit,UNIT_STATE_LIFE)<=0
endfunction

function IsDead takes unit TheUnit returns boolean
    return(TheUnit==null)or(IsUnitType(TheUnit,UNIT_TYPE_DEAD))or(IsUnitDeadBJ(TheUnit))
endfunction

function IsAlive takes unit TheUnit returns boolean
    return(TheUnit!=null)and(IsDead(TheUnit)==false)
endfunction

function GetLocLevel takes location theLoc returns integer
    local integer TheLvl=0
    set TheLvl=(GetTerrainCliffLevel(GetLocationX(theLoc),GetLocationY(theLoc)))
    return TheLvl
endfunction

function GetUnitLocLevel takes unit TheUnit returns integer
    local integer TheLvl=0
    if(TheUnit!=null)and(IsAlive(TheUnit))then
        set TheLvl=(GetTerrainCliffLevel(GetUnitX(TheUnit),GetUnitY(TheUnit)))
    endif
    return TheLvl
endfunction

function AngleBetweenPoints takes location locA,location locB returns real
    return bj_RADTODEG*Atan2(GetLocationY(locB)-GetLocationY(locA),GetLocationX(locB)-GetLocationX(locA))
endfunction

function AngleBetweenUnits takes unit u1,unit u2 returns real
    return bj_RADTODEG*Atan2(GetUnitY(u2)-GetUnitY(u1),GetUnitX(u2)-GetUnitX(u1))
endfunction

function AngleBetweenThreeUnits takes unit u1,unit u2,unit u3 returns boolean
    local real YL=AngleBetweenUnits(u3,u1)
    local real ZL=AngleBetweenUnits(u3,u2)
    return absolute(YL-ZL)<60
endfunction

function RangeLocToLoc takes location TheStart,location TheTarget returns real
    local real TheXRange
    local real TheYRange
    set TheXRange=GetLocationX(TheTarget)-GetLocationX(TheStart)
    set TheXRange=TheXRange*TheXRange
    set TheYRange=GetLocationY(TheTarget)-GetLocationY(TheStart)
    set TheYRange=TheYRange*TheYRange
    return(SquareRoot(TheXRange+TheYRange))
endfunction

function debugLoc takes location loc,integer id returns nothing
    local effect fx
    if not isdebug then
        return
    endif
    if id==1 then
        set fx=AddSpecialEffectLoc("Abilities\\Spells\\Other\\Monsoon\\MonsoonBoltTarget.mdl",loc)
    endif
    if id==2 then
        set fx=AddSpecialEffectLoc("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl",loc)
    endif
    if id==3 then
        set fx=AddSpecialEffectLoc("Abilities\\Spells\\Orc\\Reincarnation\\ReincarnationTarget.mdl",loc)
    endif
    call DestroyEffect(fx)
endfunction

function GetItemLoc takes item whichItem returns location
    return Location(GetItemX(whichItem),GetItemY(whichItem))
endfunction

function HeroStop takes unit u returns boolean
    return IssueImmediateOrderById(u,851972)
endfunction

function DM takes location FM,location GM,location HM returns real
    local real dX
    local real dY
    local real TheRange
    set dX=GetLocationX(GM)-GetLocationX(FM)
    set dY=GetLocationY(GM)-GetLocationY(FM)
    set TheRange=SquareRoot((dX*dX)+(dY*dY))
    if TheRange==0 then
        set TheRange=RangeLocToLoc(FM,HM)
    else
        set TheRange=absolute((dY*GetLocationX(HM))+((-dX)*GetLocationY(HM)))/TheRange
    endif
    return(TheRange)
endfunction

function isUnitInShanglu takes unit u returns boolean
    return GetUnitY(u)>5000 or GetUnitX(u)<-5000
endfunction

function isUnitInXiaLu takes unit u returns boolean
    return GetUnitY(u)<-5000 or GetUnitX(u)>5000
endfunction

function isUnitInMiddleLine takes unit theUnit returns boolean
    local location theLoc=null
    local boolean rb=false
    if theUnit==null or IsDead(theUnit)then
        return false
    endif
    set theLoc=GetUnitLoc(theUnit)
    if DM(suguoBaseLoc2,weiguoBaseLoc2,theLoc)<1200 then
        set rb=true
    endif
    call RemoveLocation(theLoc)
    set theLoc=null
    return rb
endfunction

function RangeToLoc takes unit TheUnit,location TheTarget returns real
    local real TheXRange
    local real TheYRange
    if(TheUnit!=null)and(IsAlive(TheUnit))then
        set TheXRange=GetLocationX(TheTarget)-GetUnitX(TheUnit)
        set TheXRange=TheXRange*TheXRange
        set TheYRange=GetLocationY(TheTarget)-GetUnitY(TheUnit)
        set TheYRange=TheYRange*TheYRange
        return(SquareRoot(TheXRange+TheYRange))
    endif
    return .0
endfunction

function RangeTo takes unit TheUnit,unit TheTarget returns real
    local real TheXRange
    local real TheYRange
    if(TheUnit!=null)and(TheTarget!=null)and(IsAlive(TheUnit))and(IsAlive(TheTarget))then
        set TheXRange=GetUnitX(TheTarget)-GetUnitX(TheUnit)
        set TheXRange=TheXRange*TheXRange
        set TheYRange=GetUnitY(TheTarget)-GetUnitY(TheUnit)
        set TheYRange=TheYRange*TheYRange
        return(SquareRoot(TheXRange+TheYRange))
    endif
    return .0
endfunction

function GetAngle takes location LocA,location LocB returns real
    local real TheAngle=AngleBetweenPoints(LocA,LocB)
    if TheAngle<0 then
        set TheAngle=TheAngle+360
    endif
    return TheAngle
endfunction

function GetUnitToOuterLocAngle takes unit TheUnit,unit TheTarget,real TheRange,real angle returns location
    local location TargetLoc
    local location UnitLoc
    local real TheDir
    if(TheUnit!=null)and(TheTarget!=null)and(IsAlive(TheUnit))and(IsAlive(TheTarget))then
        set TargetLoc=GetUnitLoc(TheTarget)
        set UnitLoc=GetUnitLoc(TheUnit)
        set TheDir=Deg2Rad(GetAngle(TargetLoc,UnitLoc)+angle+180)
        call RemoveLocation(UnitLoc)
        set UnitLoc=null
        call RemoveLocation(TargetLoc)
        set TargetLoc=null
        return(Location(TheRange*Cos(TheDir)+GetUnitX(TheTarget),TheRange*Sin(TheDir)+GetUnitY(TheTarget)))
    endif
    return null
endfunction

function GetLocToOuterLocAngle takes location loc1,location loc2,real TheRange,real angle returns location
    local real TheDir
    if loc1==null or loc2==null then
        return null
    endif
    set TheDir=Deg2Rad(GetAngle(loc1,loc2)+angle)
    return(Location(TheRange*Cos(TheDir)+GetLocationX(loc2),TheRange*Sin(TheDir)+GetLocationY(loc2)))
endfunction

function GetUnitBackLoc takes unit TheTarget,real TheRange returns location
    local real TheDir
    if(TheTarget!=null)and(IsAlive(TheTarget))then
        set TheDir=Deg2Rad(GetUnitFacing(TheTarget)+180)
        return(Location(TheRange*Cos(TheDir)+GetUnitX(TheTarget),TheRange*Sin(TheDir)+GetUnitY(TheTarget)))
    endif
    return null
endfunction

function GetUnitFrontLoc takes unit TheTarget,real TheRange returns location
    local real TheDir
    if(TheTarget!=null)and(IsAlive(TheTarget))then
        set TheDir=Deg2Rad(GetUnitFacing(TheTarget))
        return(Location(TheRange*Cos(TheDir)+GetUnitX(TheTarget),TheRange*Sin(TheDir)+GetUnitY(TheTarget)))
    endif
    return null
endfunction

function CP takes unit u1,unit u2,integer range returns location
    local integer index=0
    set index=-120
    loop
        exitwhen index>-60
        if DH!=null then
            call RemoveLocation(DH)
            set DH=null
        endif
        set DH=GetUnitToOuterLocAngle(zs_AllyHeroNearestToHeroD,HeroD,range,90)
        if IsTerrainPathable(GetLocationX(DH),GetLocationY(DH),PATHING_TYPE_WALKABILITY)and not IsLocationVisibleToPlayer(DH,GetOwningPlayer(u2))then
            return DH
        endif
        set index=index+10
    endloop
    set index=120
    loop
        exitwhen index<60
        if DH!=null then
            call RemoveLocation(DH)
            set DH=null
        endif
        set DH=GetUnitToOuterLocAngle(zs_AllyHeroNearestToHeroD,HeroD,range,90)
        if IsTerrainPathable(GetLocationX(DH),GetLocationY(DH),PATHING_TYPE_WALKABILITY)and not IsLocationVisibleToPlayer(DH,GetOwningPlayer(u2))then
            return DH
        endif
        set index=index-10
    endloop
    return null
endfunction

function FP takes unit u1,unit u2 returns location
    local location rl=null
    set rl=CP(u1,u2,1400)
    if rl!=null then
        return rl
    endif
    set rl=CP(u1,u2,1200)
    if rl!=null then
        return rl
    endif
    set rl=CP(u1,u2,1000)
    if rl!=null then
        return rl
    endif
    return null
endfunction

function GetLocBetweenTwoLocsRangeToFirst takes location TheLoc1,location TheLoc2,real TheRange returns location
    local real TheDir
    local real rdm=0
    set TheDir=Deg2Rad(GetAngle(TheLoc2,TheLoc1)+180)
    return(Location(TheRange*Cos(TheDir)+GetLocationX(TheLoc1),TheRange*Sin(TheDir)+GetLocationY(TheLoc1)))
    return null
endfunction

function GetLocBetweenTwoUnitsRangeToFirst takes unit u1,unit u2,real TheRange returns location
    local real TheDir
    local real rdm=0
    local location TheLoc1=GetUnitLoc(u1)
    local location TheLoc2=GetUnitLoc(u2)
    local location loc3=null
    set TheDir=Deg2Rad(GetAngle(TheLoc2,TheLoc1)+180)
    set loc3=(Location(TheRange*Cos(TheDir)+GetLocationX(TheLoc1),TheRange*Sin(TheDir)+GetLocationY(TheLoc1)))
    call RemoveLocation(TheLoc1)
    set TheLoc1=null
    call RemoveLocation(TheLoc2)
    set TheLoc2=null
    return loc3
endfunction

function GetItemSlotByID takes unit TheUnit,integer TheItemID returns integer
    local integer MaxSlot=UnitInventorySize(TheUnit)
    local integer TheSlot=0
    if(MaxSlot>0)then
        set TheSlot=0
        loop
            exitwhen(TheSlot>=MaxSlot)or(GetItemTypeId(UnitItemInSlot(TheUnit,TheSlot))==TheItemID)
            set TheSlot=TheSlot+1
        endloop
        if(TheSlot<MaxSlot)then
            return(TheSlot)
        endif
    endif
    return(-1)
endfunction

function GetItemByID takes unit TheUnit,integer TheItemID returns item
    local integer MaxSlot=UnitInventorySize(TheUnit)
    local integer TheSlot=0
    if(MaxSlot>0)then
        set TheSlot=0
        loop
            exitwhen(TheSlot>=MaxSlot)or(GetItemTypeId(UnitItemInSlot(TheUnit,TheSlot))==TheItemID)
            set TheSlot=TheSlot+1
        endloop
        if(TheSlot<MaxSlot)then
            return(UnitItemInSlot(TheUnit,TheSlot))
        endif
    endif
    return(null)
endfunction

function GetItemChargesById takes unit TheUnit,integer itemid returns integer
    return GetItemCharges(GetItemByID(TheUnit,itemid))
endfunction

function GetNumberOfItemByID takes unit TheUnit,integer TheItemID returns integer
    local integer MaxSlot=UnitInventorySize(TheUnit)
    local integer TheSlot=0
    local integer TheResult=0
    if(MaxSlot>0)then
        set TheSlot=0
        loop
            exitwhen(TheSlot>=MaxSlot)
            if(GetItemTypeId(UnitItemInSlot(TheUnit,TheSlot))==TheItemID)then
                set TheResult=TheResult+1
            endif
            set TheSlot=TheSlot+1
        endloop
    endif
    return TheResult
endfunction

function gotoLocation takes unit u,location loc,real stopRange returns boolean
    if loc==null then
        return true
    endif
    if(RangeToLoc(u,loc)<=stopRange)then
        call IssueImmediateOrderById(u,851972)
        return true
    else
        if XD==null or RangeLocToLoc(XD,loc)>8 or GetUnitCurrentOrder(u)!=851986 then
            call IssuePointOrderByIdLoc(u,851986,loc)
            call RemoveLocation(XD)
            set XD=null
            set XD=Location(GetLocationX(loc),GetLocationY(loc))
        endif
        set zs_crCommand=1
        return false
    endif
endfunction

function gotoLocation2 takes unit u,unit u2,real stopRange returns boolean
    local location loc=GetUnitLoc(u2)
    local boolean rb=false
    set rb=gotoLocation(u,loc,stopRange)
    call RemoveLocation(loc)
    set loc=null
    return rb
endfunction

function IQ takes unit u,unit u2,real stopRange returns boolean
    local location loc
    local location loc2=null
    local boolean rb=false
    set loc=GetUnitLoc(u2)
    set loc2=GetLocBetweenTwoLocsRangeToFirst(loc,mBaseLoc,stopRange-130)
    set rb=gotoLocation(u,loc2,20)
    call RemoveLocation(loc)
    call RemoveLocation(loc2)
    set loc2=null
    set loc=null
    return rb
endfunction

function ariveLoc takes unit u,location loc,real bias returns nothing
    loop
        exitwhen(u==null or IsDead(u))or gotoLocation(u,loc,bias)
        call Sleep(1)
    endloop
endfunction

function ariveUnit takes unit u,unit u2,real bias returns nothing
    loop
        exitwhen(u==null or IsDead(u))or gotoLocation2(u,u2,bias)
        call Sleep(1)
    endloop
endfunction

function HeroAttack takes unit TheUnit returns boolean
    local boolean rb=false
    if HeroCrAttackUnit==null or HeroCrAttackUnit!=TheUnit or GetUnitCurrentOrder(mHero)!=851983 then
        set HeroCrAttackUnit=TheUnit
        set rb=IssueTargetOrderById(mHero,851983,TheUnit)
    endif
    set zs_crCommand=2
    return rb
endfunction

function DQ takes unit FQ,unit TheUnit returns boolean
    local boolean rb=false
    set rb=IssueTargetOrderById(FQ,851983,TheUnit)
    call IssueImmediateOrderById(FQ,851972)
    return rb
endfunction

function GQ takes widget HQ returns nothing
    call IssueTargetOrderById(mHero,851983,HQ)
endfunction

function JQ takes location loc returns nothing
    call IssuePointOrderByIdLoc(mHero,851990,loc)
    call HeroStop(mHero)
endfunction

function PickItem takes unit TheUnit,item Target returns boolean
    local boolean TheOK
    if Target==null then
        return false
    endif
    call ariveLoc(TheUnit,GetItemLoc(Target),120)
    set TheOK=IssueTargetOrderById(TheUnit,851971,Target)
    call Sleep(.3)
    return TheOK
endfunction

function GiveItemByID takes unit TheUnit,integer ItemID,unit TheTarget returns boolean
    local item TheItem=GetItemByID(TheUnit,ItemID)
    local boolean rb=false
    if TheItem!=null then
        set rb=(UnitDropItemTarget(TheUnit,TheItem,TheTarget))
        call Sleep(1)
        return rb
    endif
    return false
endfunction

function IsBianXing takes unit TheUnit returns boolean
    return(GetUnitAbilityLevel(TheUnit,'BOhx')>0)
endfunction

function IsRangeAttacker takes unit TheUnit returns boolean
    return(IsUnitType(TheUnit,UNIT_TYPE_RANGED_ATTACKER))
endfunction

function IsGroundAttacker takes unit TheUnit returns boolean
    return(IsUnitType(TheUnit,UNIT_TYPE_ATTACKS_GROUND))
endfunction

function IsStunned takes unit TheUnit returns boolean
    return(IsUnitType(TheUnit,UNIT_TYPE_STUNNED))or(GetUnitAbilityLevel(TheUnit,'BUim')>0)or GetUnitAbilityLevel(TheUnit,'BPSE')>0 or IsUnitPaused(TheUnit)or GetUnitAbilityLevel(TheUnit,'B012')>0 or GetUnitAbilityLevel(TheUnit,'B000')>0 or GetUnitAbilityLevel(TheUnit,'Bsta')>0
endfunction

function IsJuFeng takes unit TheUnit returns boolean
    return(GetUnitAbilityLevel(TheUnit,'Bcy2')>0 or GetUnitAbilityLevel(TheUnit,'Bcyc')>0)
endfunction

function IsLocked takes unit TheUnit returns boolean
    return(IsUnitType(TheUnit,UNIT_TYPE_STUNNED))or(IsUnitType(TheUnit,UNIT_TYPE_SNARED))
endfunction

function IsSlowed takes unit TheUnit returns boolean
    return(IsUnitType(TheUnit,UNIT_TYPE_POISONED))or(IsUnitType(TheUnit,UNIT_TYPE_POLYMORPHED))or(IsUnitType(TheUnit,UNIT_TYPE_ETHEREAL))or(IsUnitType(TheUnit,UNIT_TYPE_PLAGUED))
endfunction

function IsSlowStriked takes unit TheUnit returns boolean
    return(GetUnitAbilityLevel(TheUnit,'BEsh')>0)or(GetUnitAbilityLevel(TheUnit,'BEsi')>0)or(GetUnitAbilityLevel(TheUnit,'B001')>0)
endfunction

function canZhuGong takes unit TheUnit returns boolean
	return (IsBianXing(TheUnit)) or (IsStunned(TheUnit)) or (IsLocked(TheUnit)) or (IsSlowed(TheUnit)) or (IsSlowStriked(TheUnit))
endfunction

function setItemCanUse takes unit u,boolean flag returns nothing
    if flag then
        call SetUnitUserData(u,0)
    else
        call SetUnitUserData(u,11)
    endif
endfunction

function getCanUseItemIndex takes integer id returns integer
    local integer index=0
    loop
        exitwhen zs_itemID1[index]==null
        if zs_itemID1[index]==id then
            return index
        endif
        set index=index+1
    endloop
    return-1
endfunction

function getCanUseItemIndex2 takes integer id returns integer
    local integer index=0
    loop
        exitwhen zs_itemID2[index]==null
        if zs_itemID2[index]==id then
            return index
        endif
        set index=index+1
    endloop
    return-1
endfunction

function GetMP takes unit TheUnit returns real
    return(GetUnitState(TheUnit,UNIT_STATE_MANA))
endfunction

function AS takes nothing returns integer
    return R2I(TimerGetElapsed(zs_timer1))
endfunction

function NS takes nothing returns real
    return TimerGetElapsed(zs_timer1)
endfunction

function BS takes string s,integer i returns nothing
    call StoreInteger(zs_gamecache,"storevaluei",s,i)
endfunction

function CS takes string s returns integer
    return GetStoredInteger(zs_gamecache,"storevaluei",s)
endfunction

function FS takes integer GS,integer level,integer cd returns nothing
    call StoreInteger(zs_gamecache,"cd"+ITS(level),ITS(GS),cd)
endfunction

function JS takes integer GS,integer level returns integer
    return GetStoredInteger(zs_gamecache,"cd"+ITS(level),ITS(GS))
endfunction

function KS takes integer LS,integer index,integer MS returns nothing
    call StoreInteger(zs_gamecache,"ha"+ITS(LS),ITS(index),MS)
endfunction

function PS takes integer LS,integer index returns integer
    return GetStoredInteger(zs_gamecache,"ha"+ITS(LS),ITS(index))
endfunction

function QS takes integer LS,integer count returns nothing
    call StoreInteger(zs_gamecache,ITS(LS),"hacount",count)
endfunction

function TS takes integer LS returns integer
    return GetStoredInteger(zs_gamecache,ITS(LS),"hacount")
endfunction

function VT takes integer GS returns integer
    return GetStoredInteger(zs_gamecache,"aspelltype",ITS(GS))
endfunction

function ET takes integer GS,integer level,integer mp returns nothing
    call StoreInteger(zs_gamecache,"mpneed"+ITS(level),ITS(GS),mp)
endfunction

function XT takes integer GS,integer level returns integer
    return GetStoredInteger(zs_gamecache,"mpneed"+ITS(level),ITS(GS))
endfunction

function OT takes integer GS,integer range returns nothing
    call StoreInteger(zs_gamecache,"abilityrange",ITS(GS),range)
endfunction

function RT takes integer GS,integer IT returns nothing
    call StoreInteger(zs_gamecache,"abilityOderId",ITS(GS),IT)
endfunction

function NT takes unit theUnit,integer GS,integer time returns nothing
    if theUnit==null then
        return
    endif
    call StoreInteger(zs_gamecache,ITS(AK(theUnit))+"abilityLastSpellTime",ITS(GS),time)
endfunction

function CT takes unit theUnit,integer GS returns integer
    if theUnit==null then
        return 999999
    endif
    return GetStoredInteger(zs_gamecache,ITS(AK(theUnit))+"abilityLastSpellTime",ITS(GS))
endfunction

function DT takes unit theUnit,integer GS returns integer
    local integer level=1
    local integer FT=CT(theUnit,GS)
    if theUnit==null then
        return 999999
    endif
    if FT==0 then
        return 0
    endif
    set level=GetUnitAbilityLevel(theUnit,GS)
    if level<1 then
        return 999999
    endif
    return JS(GS,level)-AS()+FT
endfunction

function GT takes unit theUnit,integer GS returns integer
    local integer FT=CT(theUnit,GS)
    if theUnit==null then
        return 999999
    endif
    if FT==0 then
        return 0
    endif
    return JS(GS,1)-AS()+FT
endfunction

function HT takes unit theUnit,integer JT returns boolean
    local integer level=GetUnitAbilityLevel(theUnit,JT)
    if level<1 then
        return false
    endif
    return DT(theUnit,JT)<=0 and GetMP(theUnit)>=XT(JT,level)
endfunction

function KT takes unit theUnit,integer id returns boolean
    local integer index=-1
    if GetItemByID(theUnit,id)!=null then
        return true
    endif
    set index=getCanUseItemIndex(id)
    if index<0 then
        return false
    endif
    if GetItemByID(theUnit,zs_itemID2[index])!=null then
        return true
    endif
    return false
endfunction

function LT takes unit theUnit,integer itemid returns boolean
    if IsDead(theUnit)then
        return false
    endif
    if IsBianXing(theUnit)or IsStunned(theUnit)then
        return false
    endif
    if not KT(theUnit,itemid)then
        return false
    endif
    return GT(theUnit,itemid)<=0 and GetMP(theUnit)>=XT(itemid,1)
endfunction

function MT takes unit theUnit,integer itemid returns nothing
    call NT(theUnit,itemid,AS())
endfunction

function hiddenitem takes item itm returns nothing
    call SetItemPosition(itm,hiddenX,hiddenY)
    call SetItemVisible(itm,false)
    call SetItemInvulnerable(itm,true)
endfunction

function ItemToNotUsableState takes unit TheUnit,integer itemid returns nothing
    local integer index=0
    local item item1=null
    local item item2=null
    local integer itmp=0
    local integer itemTypeid=0
    set item1=GetItemByID(TheUnit,itemid)
    if item1==null then
        return
    endif
    set itemTypeid=GetItemTypeId(item1)
    set itmp=getCanUseItemIndex(itemTypeid)
    if itmp>-1 then
        if zs_itemNotCanUse[itmp]==null then
            set zs_itemNotCanUse[itmp]=CreateItem(zs_itemID2[itmp],hiddenX,hiddenY)
        endif
        set item2=zs_itemNotCanUse[itmp]
        call SetItemCharges(item2,GetItemCharges(item1))
        set zs_itemCanUse[itmp]=item1
        call UnitRemoveItem(TheUnit,item1)
        call hiddenitem(item1)
        call UnitAddItem(TheUnit,item2)
    endif
endfunction

function ItemToUseState takes unit TheUnit,integer id returns boolean
    local item item1=null
    local item item2=null
    local integer itmp=0
    local integer itemTypeid2=0
    set itmp=getCanUseItemIndex(id)
    if itmp<0 then
        return false
    endif
    set itemTypeid2=zs_itemID2[itmp]
    set item2=GetItemByID(TheUnit,itemTypeid2)
    if item2==null then
        return false
    endif
    call UnitRemoveItem(TheUnit,item2)
    call hiddenitem(item2)
    set item1=zs_itemCanUse[itmp]
    call UnitAddItem(TheUnit,item1)
    return true
endfunction

function AddDropedItem takes unit TheUnit returns nothing
    local integer index=0
    loop
        exitwhen index==20
        if zs_itemCanUse[index]!=null then
            call UnitAddItem(TheUnit,zs_itemCanUse[index])
        endif
        set index=index+1
    endloop
endfunction

function UseItemByID takes unit TheUnit,integer ItemID,real delay returns boolean
    local item TheItem=null
    local boolean rb=false
    call ItemToUseState(TheUnit,ItemID)
    set TheItem=GetItemByID(TheUnit,ItemID)
    if TheItem==null or TheUnit==null then
        call debugstr("UseItemByID-item-null")
        return false
    endif
    call setItemCanUse(TheUnit,true)
    set rb=(TheItem!=null)and(UnitUseItem(TheUnit,TheItem))
    call setItemCanUse(TheUnit,false)
    call Sleep(delay)
    call ItemToNotUsableState(TheUnit,ItemID)
    call MT(TheUnit,ItemID)
    return rb
endfunction

function RU takes unit TheUnit,integer ItemID,real delay returns boolean
    local item TheItem=null
    local boolean rb=false
    set TheItem=GetItemByID(TheUnit,ItemID)
    if TheItem==null or TheUnit==null then
        call debugstr("UseItemByID-item-null")
        return false
    endif
    call setItemCanUse(TheUnit,true)
    call SetItemCharges(TheItem,1)
    call Sleep(.02)
    set rb=(TheItem!=null)and(UnitUseItem(TheUnit,TheItem))
    call setItemCanUse(TheUnit,false)
    call Sleep(delay)
    if GetItemCharges(TheItem)==0 then
        call MT(TheUnit,ItemID)
    endif
    return rb
endfunction

function IU takes unit TheUnit,integer ItemID returns boolean
    local item TheItem=null
    local boolean rb=false
    set TheItem=GetItemByID(TheUnit,ItemID)
    if TheItem==null or TheUnit==null then
        call debugstr("UseItemByID-item-null")
        return false
    endif
    call setItemCanUse(TheUnit,true)
    set rb=(TheItem!=null)and(UnitUseItem(TheUnit,TheItem))
    call setItemCanUse(TheUnit,false)
    return rb
endfunction

function AU takes unit whichUnit,item whichItem,location loc returns boolean
    local boolean rb=false
    call setItemCanUse(whichUnit,true)
    set rb=UnitUseItemPoint(whichUnit,whichItem,GetLocationX(loc),GetLocationY(loc))
    call setItemCanUse(whichUnit,false)
    return rb
endfunction

function NU takes unit TheUnit,integer ItemID,location TheLoc,real delay returns boolean
    local item TheItem=null
    local boolean rb=false
    call ItemToUseState(TheUnit,ItemID)
    set TheItem=GetItemByID(TheUnit,ItemID)
    set rb=(TheItem!=null)and(AU(TheUnit,TheItem,TheLoc))
    call Sleep(delay)
    call ItemToNotUsableState(TheUnit,ItemID)
    if rb then
        call MT(TheUnit,ItemID)
    endif
    return rb
endfunction

function UseItemTargetByID takes unit TheUnit,integer ItemID,widget TheTarget,real delay returns boolean
    local item TheItem=null
    local boolean rb=false
    call ItemToUseState(TheUnit,ItemID)
    set TheItem=GetItemByID(TheUnit,ItemID)
    if TheItem==null then
        call debugstr("item-null---UseItemTargetByID")
        return false
    endif
    if TheTarget==null then
        call debugstr("TheTarget-null---UseItemTargetByID")
        return false
    endif
    if TheUnit==null then
        call debugstr("TheUnit-null---UseItemTargetByID")
        return false
    endif
    call setItemCanUse(TheUnit,true)
    set rb=(TheItem!=null)and(UnitUseItemTarget(TheUnit,TheItem,TheTarget))
    call setItemCanUse(TheUnit,false)
    if rb then
    endif
    call Sleep(delay)
    call ItemToNotUsableState(TheUnit,ItemID)
    if rb then
        call MT(TheUnit,ItemID)
    endif
    return rb
endfunction

function DU takes unit TheUnit,integer ItemID,widget TheTarget,real delay returns boolean
    local item TheItem=null
    local boolean rb=false
    set TheItem=GetItemByID(TheUnit,ItemID)
    if TheItem==null then
        call debugstr("item-null---UseItemTargetByID")
        return false
    endif
    if TheTarget==null then
        call debugstr("TheTarget-null---UseItemTargetByID")
        return false
    endif
    if TheUnit==null then
        call debugstr("TheUnit-null---UseItemTargetByID")
        return false
    endif
    call setItemCanUse(TheUnit,true)
    call SetItemCharges(TheItem,1)
    call Sleep(.002)
    set rb=(TheItem!=null)and(UnitUseItemTarget(TheUnit,TheItem,TheTarget))
    call setItemCanUse(TheUnit,false)
    if rb then
    endif
    call Sleep(delay)
    if GetItemCharges(TheItem)==0 then
        call MT(TheUnit,ItemID)
    endif
    return rb
endfunction

function FU takes unit TheUnit,integer ItemID,widget TheTarget returns boolean
    local item TheItem=null
    local boolean rb=false
    set TheItem=GetItemByID(TheUnit,ItemID)
    if TheItem==null then
        call debugstr("item-null---UseItemTargetByID")
        return false
    endif
    if TheTarget==null then
        call debugstr("TheTarget-null---UseItemTargetByID")
        return false
    endif
    if TheUnit==null then
        call debugstr("TheUnit-null---UseItemTargetByID")
        return false
    endif
    call setItemCanUse(TheUnit,true)
    set rb=(TheItem!=null)and(UnitUseItemTarget(TheUnit,TheItem,TheTarget))
    call setItemCanUse(TheUnit,false)
    return rb
endfunction

function can_UseItemByID takes unit TheUnit,integer ItemID returns boolean
    local integer oldorder=0
    local item TheItem=null
    local boolean rb=false
    call ItemToUseState(TheUnit,ItemID)
    set TheItem=GetItemByID(TheUnit,ItemID)
    set oldorder=GetUnitCurrentOrder(TheUnit)
    if TheItem==null or TheUnit==null then
    endif
    call setItemCanUse(TheUnit,true)
    set rb=(TheItem!=null)and(UnitUseItem(TheUnit,TheItem))
    call setItemCanUse(TheUnit,false)
    if rb then
        call IssueImmediateOrderById(TheUnit,oldorder)
    endif
    call ItemToNotUsableState(TheUnit,ItemID)
    return rb
endfunction

function can_UseItemByIDTarget takes unit TheUnit,integer ItemID returns boolean
    local item TheItem=null
    local boolean rb=false
    call ItemToUseState(TheUnit,ItemID)
    set TheItem=GetItemByID(TheUnit,ItemID)
    if TheItem==null or TheUnit==null then
    endif
    call setItemCanUse(TheUnit,true)
    set rb=(TheItem!=null)and(UnitUseItem(TheUnit,TheItem))
    call setItemCanUse(TheUnit,false)
    if rb then
    endif
    call ItemToNotUsableState(TheUnit,ItemID)
    return rb
endfunction

function can_UseItemByIDTarget2 takes unit TheUnit,integer ItemID returns boolean
    local item TheItem=null
    local boolean rb=false
    set TheItem=GetItemByID(TheUnit,ItemID)
    if TheItem==null or TheUnit==null then
    endif
    call setItemCanUse(TheUnit,true)
    set rb=(TheItem!=null)and(UnitUseItem(TheUnit,TheItem))
    call setItemCanUse(TheUnit,false)
    if rb then
    endif
    return rb
endfunction

function GetHP takes unit TheUnit returns real
    return(GetUnitState(TheUnit,UNIT_STATE_LIFE))
endfunction

function GetHPVoided takes unit TheUnit returns real
    return(GetUnitState(TheUnit,UNIT_STATE_MAX_LIFE)-GetUnitState(TheUnit,UNIT_STATE_LIFE))
endfunction

function IsRestoreHP takes unit TheUnit returns boolean
    return(GetUnitAbilityLevel(TheUnit,'BIrl')>0)
endfunction

function IsRestoreMP takes unit TheUnit returns boolean
    return(GetUnitAbilityLevel(TheUnit,'BIrm')>0)
endfunction

function GetManaVoided takes unit TheUnit returns real
    return(GetUnitState(TheUnit,UNIT_STATE_MAX_MANA)-GetUnitState(TheUnit,UNIT_STATE_MANA))
endfunction

function GetUnitStatePercent takes unit whichUnit,unitstate whichState,unitstate whichMaxState returns real
    local real value=GetUnitState(whichUnit,whichState)
    local real maxValue=GetUnitState(whichUnit,whichMaxState)
    if(whichUnit==null)or(maxValue==0)then
        return .0
    endif
    return value/ maxValue*100.
endfunction

function GetUnitManaPercent takes unit whichUnit returns real
    return GetUnitStatePercent(whichUnit,UNIT_STATE_MANA,UNIT_STATE_MAX_MANA)
endfunction

function IsManaAlmostFull takes unit TheUnit returns boolean
    return((GetMP(TheUnit)>=1200)or(GetUnitManaPercent(TheUnit)>85))
endfunction

function GetUnitLifePercent takes unit whichUnit returns real
    return GetUnitStatePercent(whichUnit,UNIT_STATE_LIFE,UNIT_STATE_MAX_LIFE)
endfunction

function IsLifeAlmostFull takes unit TheUnit returns boolean
    return(GetUnitLifePercent(TheUnit)>85)
endfunction

function CW takes unit TheUnit returns boolean
    local real DW=180
    local integer FW=20
    set FW=FW+GetUnitLevel(TheUnit)/2
    if IsDead(TheUnit)then
        return false
    endif
    return((GetUnitLifePercent(TheUnit)<FW)or(GetUnitState(TheUnit,UNIT_STATE_LIFE)<DW))
endfunction

function IsImmune takes unit TheUnit returns boolean
    return(IsUnitType(TheUnit,UNIT_TYPE_MAGIC_IMMUNE))
endfunction

function CanAttack takes unit TheUnit returns boolean
    return((GetUnitAbilityLevel(TheUnit,'Aatk')>0)or(IsUnitType(TheUnit,UNIT_TYPE_RANGED_ATTACKER))or(IsUnitType(TheUnit,UNIT_TYPE_MELEE_ATTACKER))or(IsUnitType(TheUnit,UNIT_TYPE_ATTACKS_GROUND))or(IsUnitType(TheUnit,UNIT_TYPE_ATTACKS_FLYING))or(IsUnitType(TheUnit,UNIT_TYPE_SAPPER))or(IsUnitType(TheUnit,UNIT_TYPE_SUMMONED)))or(GetUnitTypeId(TheUnit)==uid_shexingjiejieLv1 or GetUnitTypeId(TheUnit)==uid_shexingjiejieLv2 or GetUnitTypeId(TheUnit)==uid_shexingjiejieLv3)
endfunction

function CanMove takes unit TheUnit returns boolean
    return(GetUnitAbilityLevel(TheUnit,'Amov')>0)
endfunction

function IsStructure takes unit TheUnit returns boolean
    return(IsUnitType(TheUnit,UNIT_TYPE_STRUCTURE))
endfunction

function IsTower takes unit TheUnit returns boolean
    return((IsUnitType(TheUnit,UNIT_TYPE_STRUCTURE))and(CanAttack(TheUnit)))
endfunction

function IsUnitHero takes unit TheUnit returns boolean
    return((IsUnitType(TheUnit,UNIT_TYPE_HERO))and(IsUnitIllusion(TheUnit)==false))
endfunction

function IsNotHero takes unit TheUnit returns boolean
    return(IsUnitHero(TheUnit)==false)
endfunction

function IsEnemyBing takes unit TheUnit returns boolean
    return((IsUnitEnemy(TheUnit,ai_player))and(not IsUnitHero(TheUnit))and(not IsStructure(TheUnit))and(CanAttack(TheUnit))and(UnitAlive(TheUnit))and(CanMove(TheUnit))and not isZhongLiEnemy(TheUnit))
endfunction

function IsZhongliEnemyBing takes unit TheUnit returns boolean
    return((IsUnitEnemy(TheUnit,ai_player))and(CanAttack(TheUnit))and(UnitAlive(TheUnit))and(CanMove(TheUnit))and isZhongLiEnemy(TheUnit))
endfunction

function IsEnemyTower takes unit TheUnit returns boolean
    return(IsUnitEnemy(TheUnit,ai_player)and(UnitAlive(TheUnit))and IsTower(TheUnit))
endfunction

function IsAllyTower takes unit TheUnit returns boolean
    return(IsUnitAlly(TheUnit,ai_player)and(UnitAlive(TheUnit))and IsTower(TheUnit))
endfunction

function IsAllyBing takes unit TheUnit returns boolean
    return((IsUnitAlly(TheUnit,ai_player))and(not IsUnitHero(TheUnit))and(not IsStructure(TheUnit))and(CanAttack(TheUnit))and(UnitAlive(TheUnit))and(CanMove(TheUnit)))
endfunction

function GetPlayerGold takes player p returns integer
    return GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)
endfunction

function GetPlayerWood takes player p returns integer
    return GetPlayerState(p,PLAYER_STATE_RESOURCE_LUMBER)
endfunction

function IsMoving takes unit TheUnit returns boolean
    local integer TheOrder=GetUnitCurrentOrder(TheUnit)
    return(TheOrder==851986)or(TheOrder==851988)or(TheOrder==852525)or(TheOrder==851990)or(TheOrder==851983)or(TheOrder==851971)
endfunction

function IsAttacking takes unit TheUnit returns boolean
    local integer TheOrder=GetUnitCurrentOrder(TheUnit)
    return TheOrder==851983
endfunction

function IsAllyBingAttaker takes unit TheUnit returns boolean
    if not IsAttacking(TheUnit)then
        return false
    endif
    if mForceId==1 and GetPlayerId(GetOwningPlayer(TheUnit))==0 then
        return true
    endif
    if mForceId==2 and GetPlayerId(GetOwningPlayer(TheUnit))==6 then
        return true
    endif
    return false
endfunction

function IsEnemyBingAttaker takes unit TheUnit returns boolean
    if not(CanAttack(TheUnit)and CanMove(TheUnit))then
        return false
    endif
    if mForceId==1 and GetPlayerId(GetOwningPlayer(TheUnit))==6 then
        return true
    endif
    if mForceId==2 and GetPlayerId(GetOwningPlayer(TheUnit))==0 then
        return true
    endif
    return false
endfunction

function IsUnitAlive takes unit TheUnit returns boolean
    if IsDead(TheUnit)then
        return false
    endif
    if not(CanAttack(TheUnit))then
        return false
    endif
    if mForceId==1 and(GetPlayerId(GetOwningPlayer(TheUnit))>=6 and GetPlayerId(GetOwningPlayer(TheUnit))<=11)then
        return true
    endif
    if mForceId==2 and(GetPlayerId(GetOwningPlayer(TheUnit))>=0 and GetPlayerId(GetOwningPlayer(TheUnit))<=5)then
        return true
    endif
    return false
endfunction

function HasBuff takes unit TheUnit,integer buffid returns boolean
    return GetUnitAbilityLevel(TheUnit,buffid)>0
endfunction

function isZhaoYunHasB takes unit theunit returns boolean
    return HasBuff(theunit,'B00F')
endfunction

function isGuanyuXuanFeng takes unit theunit returns boolean
    return HasBuff(theunit,'BOww')
endfunction

function isHeroHasJinglinghuo takes unit theunit returns boolean
    return HasBuff(theunit,'Bfae')
endfunction

function iszhangfeihasb takes unit theunit returns boolean
    return HasBuff(theunit,'Bbsk')
endfunction

function HY takes unit theunit returns boolean
    return HasBuff(theunit,'BOwk')or HasBuff(theunit,'BPSE')
endfunction

function GetUnitAbilityLevelZs takes unit TheUnit,integer abilcode returns integer
    local integer ri=0
    local player ThePlayer=ai_player
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    set ri=GetUnitAbilityLevel(TheUnit,abilcode)
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    return ri
endfunction

function MY takes unit u,integer di returns nothing
    local integer index=0
    local integer MS=0
    local integer PY=0
    loop
        set MS=PS(GetUnitTypeId(u),index)
        exitwhen index>5 or MS<1
        set PY=VT(MS)
        if PY==di then
            call SelectHeroSkill(u,MS)
        endif
        set index=index+1
    endloop
endfunction

function QY takes unit u returns nothing
    call MY(u,5)
    call MY(u,4)
    call MY(u,3)
    call MY(u,2)
    call MY(u,0)
    call MY(u,6)
    call MY(u,1)
    call SelectHeroSkill(u,aid_shuxingdian)
endfunction

function SY takes unit theunit returns nothing
    if not GG then
        call QY(theunit)
    endif
endfunction

function TY takes unit TheUnit,integer abilcode returns boolean
    local integer LastPoint=GetHeroSkillPoints(TheUnit)
    local integer i=0
    local player ThePlayer=ai_player
    local boolean rb=false
    call SelectHeroSkill(TheUnit,abilcode)
    set rb=GetHeroSkillPoints(TheUnit)<LastPoint
    return rb
endfunction

function RaiseSkill takes unit TheUnit,integer abilcode returns boolean
    local integer LastPoint=GetHeroSkillPoints(TheUnit)
    local integer i=0
    local player ThePlayer=ai_player
    local boolean rb=false
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    call SelectHeroSkill(TheUnit,abilcode)
    if abilcode=='A083' then
        call SelectHeroSkill(TheUnit,'A07R')
        call SelectHeroSkill(TheUnit,'A07M')
        call SelectHeroSkill(TheUnit,'A07I')
    endif
    if abilcode=='A00A' then
        call SelectHeroSkill(TheUnit,'A02V')
    endif
    set rb=GetHeroSkillPoints(TheUnit)<LastPoint
    if abilcode!='A03P' then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    endif
    if abilcode=='A00O' then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode=='A00U' then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode=='A019' then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode=='A01B' then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode=='A00C' then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode=='A06D' then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode=='A03R' then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode=='Amgr' then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode=='A00D' then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode=='A01B' then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode=='A022' then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode==aid_dadi_fensui then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode==aid_dadi_yingpi then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode==aid_madai_yuanjianshu then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode==aid_madai_cichuan then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode==aid_zhanghe_xieexingyang then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode==aid_zuiwoshachang then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode==KO then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if abilcode==aid_sunquan_jianguangbi then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    endif
    if not rb then
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
        loop
            exitwhen i>24 or mSkillArray[i]==null
            call SelectHeroSkill(TheUnit,mSkillArray[i])
            set i=i+1
        endloop
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    endif
    if not rb then
        call SY(TheUnit)
    endif
    return rb
endfunction

function YY takes unit TheUnit,integer abilcode,string order returns boolean
    local boolean canCast=false
    local real angle=0
    local player ThePlayer=ai_player
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    call SetUnitUserData(mHero,19)
    set canCast=IssueImmediateOrder(TheUnit,order)
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    if canCast then
        call IssueImmediateOrderById(TheUnit,851972)
    endif
    return canCast
endfunction

function SleepCanBreak takes real time returns nothing
    local real t=time/.02
    local real r=0
    loop
        exitwhen r>t or FR>0
        set r=r+1
        call Sleep(.02)
    endloop
    if FR>0 then
        set FR=FR-1
    endif
endfunction

function XZ takes real time returns nothing
    local real t=time/.02
    local real r=0
    loop
        exitwhen r>t or MG>0
        set r=r+1
        call Sleep(.02)
    endloop
    if MG>0 then
        set MG=MG-1
    endif
endfunction

function CanCastAbilityOrderById takes unit TheUnit,integer abilcode,integer order returns boolean
    local boolean canCast=false
    local player ThePlayer=ai_player
    local integer oldorder=0
    set oldorder=GetUnitCurrentOrder(TheUnit)
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    call SetUnitUserData(TheUnit,200)
    set canCast=IssueImmediateOrderById(TheUnit,order)
    if canCast then
        call IssueImmediateOrderById(TheUnit,851972)
    endif
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    call Sleep(.0005)
    call SetUnitUserData(TheUnit,11)
    return canCast
endfunction

function CanCastAbilityOrder takes unit TheUnit,integer abilcode,string order returns boolean
    return CanCastAbilityOrderById(TheUnit,abilcode,OrderId(order))
endfunction

function CanCastAbilityOrderById2 takes unit TheUnit,integer abilcode,integer order returns boolean
    local boolean canCast=false
    local player ThePlayer=ai_player
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    set canCast=IssueImmediateOrderById(TheUnit,order)
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    return canCast
endfunction

function CanCastAbilityOrder2 takes unit TheUnit,integer abilcode,string order returns boolean
    return CanCastAbilityOrderById(TheUnit,abilcode,OrderId(order))
endfunction

function CastPointSkillByOderStr takes unit TheUnit,integer abilcode,string order,location TheLoc returns boolean
    local player ThePlayer=ai_player
    local integer PlayerID=GetPlayerId(ThePlayer)
    local boolean Casted
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    set Casted=IssuePointOrderLoc(TheUnit,order,TheLoc)
    if Casted then
    endif
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    return(Casted)
endfunction

function CastTargetSkillByOderStrDelayed takes unit TheUnit,integer abilcode,string order,location TheLoc,real delay returns boolean
    local player ThePlayer=ai_player
    local integer PlayerID=GetPlayerId(ThePlayer)
    local boolean Casted
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    set Casted=IssuePointOrderLoc(TheUnit,order,TheLoc)
    call Sleep(delay)
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    return(Casted)
endfunction

function CastTargetSkillByOderIdDelayed takes unit TheUnit,integer abilcode,integer Order,unit TheTaget,real delay returns boolean
    local player ThePlayer=ai_player
    local integer PlayerID=GetPlayerId(ThePlayer)
    local location Loc=null
    local boolean Casted
    set Loc=GetUnitLoc(TheTaget)
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    set Casted=IssuePointOrderByIdLoc(TheUnit,Order,Loc)
    call Sleep(delay-.25)
    if not IsUnitInRangeLoc(TheTaget,Loc,250)then
        call IssueImmediateOrderById(TheUnit,851972)
        call debugstr("stop dazhao sima==========================")
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
        call RemoveLocation(Loc)
        set Loc=null
        return false
    endif
    call Sleep(.55)
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    call RemoveLocation(Loc)
    set Loc=null
    return(Casted)
endfunction

function CastTargetSkillByOderIdDelayed2 takes unit TheUnit,integer abilcode,integer Order,unit TheTaget,real delay returns boolean
    local player ThePlayer=ai_player
    local integer PlayerID=GetPlayerId(ThePlayer)
    local location Loc=null
    local boolean Casted
    set Loc=GetUnitFrontLoc(TheTaget,200)
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    set Casted=IssuePointOrderByIdLoc(TheUnit,Order,Loc)
    call Sleep(delay-.25)
    if not IsUnitInRangeLoc(TheTaget,Loc,220)then
        call IssueImmediateOrderById(TheUnit,851972)
        call debugstr("stop dazhao sima==========================")
        call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
        call RemoveLocation(Loc)
        set Loc=null
        return false
    endif
    call Sleep(.55)
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    call RemoveLocation(Loc)
    set Loc=null
    return(Casted)
endfunction

function CastTargetSkillByOderStr takes unit TheUnit,integer abilcode,string order,unit TheTarget returns boolean
    local player ThePlayer=ai_player
    local integer PlayerID=GetPlayerId(ThePlayer)
    local boolean Casted
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    set Casted=IssueTargetOrder(TheUnit,order,TheTarget)
    if Casted then
    endif
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    return(Casted)
endfunction

function CastTargetSkillByOderId takes unit TheUnit,integer abilcode,integer order,unit TheTarget returns boolean
    local player ThePlayer=ai_player
    local integer PlayerID=GetPlayerId(ThePlayer)
    local boolean Casted
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    set Casted=IssueTargetOrderById(TheUnit,order,TheTarget)
    if Casted then
    endif
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    return(Casted)
endfunction

function CastTargetSkillByID takes unit TheUnit,integer abilcode,integer order,unit TheTarget,real time returns boolean
    local player ThePlayer=ai_player
    local integer PlayerID=GetPlayerId(ThePlayer)
    local boolean Casted
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    set Casted=IssueTargetOrderById(TheUnit,order,TheTarget)
    if Casted then
    endif
    call Sleep(time)
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    return(Casted)
endfunction

function CastImdSkillByID takes unit TheUnit,integer abilcode,integer order returns boolean
    local player ThePlayer=ai_player
    local integer PlayerID=GetPlayerId(ThePlayer)
    local boolean Casted
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    set Casted=IssueImmediateOrderById(TheUnit,order)
    if Casted then
    endif
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    return(Casted)
endfunction

function CastImdSkillByStr takes unit TheUnit,integer abilcode,string order returns boolean
    local player ThePlayer=ai_player
    local integer PlayerID=GetPlayerId(ThePlayer)
    local boolean Casted
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,true)
    set Casted=IssueImmediateOrder(TheUnit,order)
    if Casted then
    endif
    call SetPlayerAbilityAvailable(ThePlayer,abilcode,false)
    return(Casted)
endfunction

function BuyItem_im takes unit FromShop,integer TheItemID,unit ToUnit returns boolean
    local boolean rb=false
    set rb=(IssueNeutralImmediateOrderById(ai_player,FromShop,TheItemID))or(IssueImmediateOrderById(FromShop,TheItemID))
    return rb
endfunction

function TZ takes nothing returns nothing
    set QI=CreateUnit(Player(13),hid_zhangliao,hiddenX+100,hiddenY-100,0)
    call SetHeroLevel(QI,25,false)
    call UnitAddAbility(QI,'Atru')
    call SetUnitInvulnerable(QI,true)
    call ShowUnit(QI,false)
    set SI=CreateUnit(Player(12),hid_zhangliao,hiddenX+100,hiddenY-100,0)
    call SetHeroLevel(SI,25,false)
endfunction

function UZ takes nothing returns nothing
    local integer index=0
    loop
        exitwhen index==6
        call SetItemVisible(UnitRemoveItemFromSlot(QI,index),false)
        set index=index+1
    endloop
    call RemoveUnit(QI)
    call RemoveUnit(SI)
endfunction

function WZ takes nothing returns nothing
    local item item1=null
    local integer YZ=hiddenX
    local integer ZZ=hiddenY
    call TZ()
    set item1=CreateItem('ssan',YZ,ZZ)
    call SetItemVisible(item1,false)
    if item1!=null then
        call SetItemCharges(item1,1)
        call UnitAddItem(QI,item1)
        call FU(QI,'ssan',SI)
        call Sleep(.3)
        call UnitRemoveBuffs(SI,true,true)
        set XR=item1
    endif
    set item1=CreateItem(iid_qingnangshu,YZ,ZZ)
    call SetItemVisible(item1,false)
    if item1!=null then
        call SetItemCharges(item1,1)
        call UnitAddItem(QI,item1)
        call IU(QI,iid_qingnangshu)
        call Sleep(.3)
        call UnitRemoveBuffs(SI,true,true)
        set OR=item1
    endif
    set item1=CreateItem(iid_mengdeshu,YZ,ZZ)
    call SetItemVisible(item1,false)
    if item1!=null then
        call SetItemCharges(item1,1)
        call UnitAddItem(QI,item1)
        call FU(QI,iid_mengdeshu,SI)
        call Sleep(.3)
        call SetWidgetLife(SI,3000)
        set RR=item1
    endif
    set item1=CreateItem('I02C',YZ,ZZ)
    call SetItemVisible(item1,false)
    if item1!=null then
        call SetItemCharges(item1,1)
        call UnitAddItem(QI,item1)
        call IU(QI,'I02C')
        call Sleep(.5)
        call UnitRemoveBuffs(QI,true,true)
        set IR=item1
    endif
    call UZ()
endfunction

function V0 takes unit TheUnit,integer itemid returns nothing
    local integer index=0
    local item item1=null
    local item item2=null
    local integer itmp=0
    local integer itemTypeid=0
    set item1=GetItemByID(TheUnit,itemid)
    if item1!=null and GetItemUserData(item1)!=11 then
        if itemid==iid_xuanwufu then
            if IR==null then
                call WZ()
            endif
            call SetItemUserData(IR,11)
            call UnitRemoveItem(TheUnit,item1)
            call SetItemPosition(item1,hiddenX,hiddenY)
            set NR=item1
            call SetItemVisible(item1,false)
            call UnitAddItem(TheUnit,IR)
        endif
        if itemid=='ssan' then
            if XR==null then
                call WZ()
            endif
            call SetItemUserData(XR,11)
            call UnitRemoveItem(TheUnit,item1)
            call SetItemPosition(item1,hiddenX,hiddenY)
            set AR=item1
            call SetItemVisible(item1,false)
            call UnitAddItem(TheUnit,XR)
        endif
    endif
endfunction

function E0 takes unit TheUnit,integer itemid returns nothing
    local integer index=0
    local item item1=null
    local item item2=null
    local integer itmp=0
    local integer itemTypeid=0
    set item1=GetItemByID(TheUnit,itemid)
    if item1!=null and GetItemUserData(item1)==11 then
        if itemid==iid_xuanwufu then
            call UnitRemoveItem(TheUnit,item1)
            call SetItemPosition(item1,hiddenX,hiddenY)
            call SetItemVisible(item1,false)
            call UnitAddItem(TheUnit,NR)
        endif
        if itemid=='ssan' then
            call UnitRemoveItem(TheUnit,item1)
            call SetItemPosition(item1,hiddenX,hiddenY)
            call SetItemVisible(item1,false)
            call UnitAddItem(TheUnit,AR)
        endif
    endif
endfunction

function X0 takes unit TheUnit returns nothing
    local integer index=0
    local item item1=null
    local item item2=null
    local integer itmp=0
    local integer itemTypeid=0
    loop
        exitwhen index==6
        set item1=UnitItemInSlot(TheUnit,index)
        if item1!=null then
            set itemTypeid=GetItemTypeId(item1)
            set itmp=getCanUseItemIndex(itemTypeid)
            if itmp>-1 then
                if zs_itemNotCanUse[itmp]==null then
                    set zs_itemNotCanUse[itmp]=CreateItem(zs_itemID2[itmp],hiddenX,hiddenY)
                endif
                set item2=zs_itemNotCanUse[itmp]
                call SetItemCharges(item2,GetItemCharges(item1))
                set zs_itemCanUse[itmp]=item1
                call UnitRemoveItem(TheUnit,item1)
                call hiddenitem(item1)
                call UnitAddItem(TheUnit,item2)
            endif
        endif
        set index=index+1
    endloop
    call V0(mHero,iid_xuanwufu)
    call V0(mHero,'ssan')
endfunction

function ItemToUseStateAll takes unit TheUnit returns nothing
    local integer index=0
    local item item1=null
    local item item2=null
    local integer itmp=0
    local integer itemTypeid=0
    loop
        exitwhen index==6
        set item2=UnitItemInSlot(TheUnit,index)
        if item2!=null then
            set itemTypeid=GetItemTypeId(item2)
            set itmp=getCanUseItemIndex2(itemTypeid)
            if itmp>-1 then
                set item1=zs_itemCanUse[itmp]
                if item1!=null then
                    call UnitRemoveItem(TheUnit,item2)
                    call hiddenitem(item2)
                    call UnitAddItem(TheUnit,item1)
                endif
            endif
        endif
        set index=index+1
    endloop
endfunction

function isZhuGeLiang takes nothing returns boolean
    return mHeroId==hid_zhugeliang
endfunction

function isSiMaYi takes nothing returns boolean
    return mHeroId==hid_simayi
endfunction

function iszhaoyun takes nothing returns boolean
    return mHeroId==hid_zhaoyun
endfunction

function iszhangliao takes nothing returns boolean
    return mHeroId==hid_zhangliao
endfunction

function isguanyu takes nothing returns boolean
    return mHeroId==hid_guanyu
endfunction

function iszhangfei takes nothing returns boolean
    return mHeroId==hid_zhangfei
endfunction

function isweiyan takes nothing returns boolean
    return mHeroId==hid_weiyan
endfunction

function isguojia takes nothing returns boolean
    return mHeroId==hid_guojia
endfunction

function iscaoren takes nothing returns boolean
    return mHeroId==hid_caoren
endfunction

function isdianwei takes nothing returns boolean
    return mHeroId==hid_dianwei
endfunction

function isxun takes nothing returns boolean
    return mHeroId==hid_xun
endfunction

function isdadi takes nothing returns boolean
    return mHeroId==hid_dadi
endfunction

function isgongben takes nothing returns boolean
    return mHeroId==hid_gongben
endfunction

function ismadai takes nothing returns boolean
    return mHeroId==hid_madai
endfunction

function iszhanghe takes nothing returns boolean
    return mHeroId==hid_zhanghe
endfunction

function issunquan takes nothing returns boolean
    return mHeroId==hid_sunquan
endfunction

function setAttackRange takes nothing returns nothing
    if iszhaoyun()or iszhangliao()or isguanyu()or iszhangfei()or isweiyan()or iscaoren()or isdianwei()or isdadi()or FG==2 then
        set attackRange=220
        set WN=WN-16
        set YN=YN-16
        set SC=PC-.5
        set IB=IB+80
        set AB=AB+80
        set TC=QC+1.6
    endif
endfunction

function T0 takes nothing returns nothing
    if FG==0 and GetUnitTypeId(mHero)!=hid_zhugeliang then
        set WN=72
        set YN=72
        set PC=1.5
        set ZN=1.58
    endif
endfunction

function setFightLine takes nothing returns nothing
    if isZhuGeLiang()or isSiMaYi()then
        set zs_cr_fightline=1
        set HN=1
        set SA=true
        set GG=true
    endif
    if isZhuGeLiang()or isguojia()then
        set NG=0
    endif
    if iszhaoyun()or isdadi()or iscaoren()then
        set zs_cr_fightline=1
        set HN=1
        set NG=0
        set GG=true
    endif
    if isweiyan()or isxun()or isdianwei()or iszhangliao()then
        set zs_cr_fightline=1
        set HN=1
        set GG=true
    endif
    if isguanyu()or iszhangfei()then
        set zs_cr_fightline=0
        set HN=1
        set GG=true
    endif
    if isguojia()or iscaoren()then
        set zs_cr_fightline=0
        set HN=1
        set GG=true
    endif
    if ismadai()or iszhanghe()or isgongben()or issunquan()then
        set GG=true
    endif
    if XH or quanZheYingMoShi then
        if FG==0 or FG==1 then
            if CS("zhongehc"+ITS(mForceId))==0 then
                set zs_cr_fightline=1
                set HN=1
                set NG=0
                call BS("zhongehc"+ITS(mForceId),1)
                set AJ=true
            endif
        endif
        if not AJ then
            if CS("shanghc"+ITS(mForceId))<2 then
                set zs_cr_fightline=1
                set HN=1
                call BS("shanghc"+ITS(mForceId),1+CS("shanghc"+ITS(mForceId)))
                set AJ=true
            endif
        endif
        if not AJ then
            if CS("xiahc"+ITS(mForceId))<2 then
                set zs_cr_fightline=1
                set HN=1
                call BS("xiahc"+ITS(mForceId),1+CS("xiahc"+ITS(mForceId)))
                set AJ=true
            endif
        endif
        if not AJ then
            if CS("zhongehc"+ITS(mForceId))==0 then
                set zs_cr_fightline=1
                set HN=1
                set NG=0
                call BS("zhongehc"+ITS(mForceId),1)
                set AJ=true
            endif
        endif
    endif
    if HN==1 then
        set SA=true
    endif
    set PN=HN
endfunction

function initSkillArry_zhugeliang takes nothing returns nothing
    set mSkillArray[0]='A087'
    set mSkillArray[1]='A085'
    set mSkillArray[2]='A087'
    set mSkillArray[3]='A087'
    set mSkillArray[4]='A08I'
    set mSkillArray[5]='A083'
    set mSkillArray[6]='A087'
    set mSkillArray[7]='A08I'
    set mSkillArray[8]='A08I'
    set mSkillArray[9]='A08I'
    set mSkillArray[10]='A083'
    set mSkillArray[11]='A085'
    set mSkillArray[12]='A08I'
    set mSkillArray[13]='A08I'
    set mSkillArray[14]='A08I'
    set mSkillArray[15]='A083'
    set mSkillArray[16]='A08I'
    set mSkillArray[17]='A08I'
    set mSkillArray[18]='A08I'
    set mSkillArray[19]='A085'
    set mSkillArray[20]='A085'
    set mSkillArray[21]='A08A'
    set mSkillArray[22]='A08A'
    set mSkillArray[23]='A08A'
    set mSkillArray[24]='A08A'
endfunction

function initSkillArry_simayi takes nothing returns nothing
    set mSkillArray[0]='A07A'
    set mSkillArray[1]='A03O'
    set mSkillArray[2]='A07A'
    set mSkillArray[3]='A03O'
    set mSkillArray[4]='A07A'
    set mSkillArray[5]='A03O'
    set mSkillArray[6]='A07A'
    set mSkillArray[7]='A03O'
    set mSkillArray[8]='A03P'
    set mSkillArray[9]='A041'
    set mSkillArray[10]='A041'
    set mSkillArray[11]='Aamk'
    set mSkillArray[12]='Aamk'
    set mSkillArray[13]='Aamk'
    set mSkillArray[14]='Aamk'
    set mSkillArray[15]='A041'
    set mSkillArray[16]='A03P'
    set mSkillArray[17]='A03P'
    set mSkillArray[18]='A03P'
    set mSkillArray[19]='Aamk'
    set mSkillArray[20]='Aamk'
    set mSkillArray[21]='Aamk'
    set mSkillArray[22]='Aamk'
    set mSkillArray[23]='Aamk'
    set mSkillArray[24]='Aamk'
endfunction

function initSkillArry_zhaoyun takes nothing returns nothing
    set mSkillArray[0]='A06K'
    set mSkillArray[1]='A019'
    set mSkillArray[2]='Aamk'
    set mSkillArray[3]='A019'
    set mSkillArray[4]='Aamk'
    set mSkillArray[5]='A01V'
    set mSkillArray[6]='A019'
    set mSkillArray[7]='Aamk'
    set mSkillArray[8]='A019'
    set mSkillArray[9]='Aamk'
    set mSkillArray[10]='A01V'
    set mSkillArray[11]='A06K'
    set mSkillArray[12]='A06K'
    set mSkillArray[13]='A06K'
    set mSkillArray[14]='A01B'
    set mSkillArray[15]='A01V'
    set mSkillArray[16]='A01B'
    set mSkillArray[17]='A01B'
    set mSkillArray[18]='A01B'
    set mSkillArray[19]='Aamk'
    set mSkillArray[20]='Aamk'
    set mSkillArray[21]='Aamk'
    set mSkillArray[22]='Aamk'
    set mSkillArray[23]='Aamk'
    set mSkillArray[24]='Aamk'
endfunction

function initSkillArry_zhangliao takes nothing returns nothing
    set mSkillArray[0]='AOsh'
    set mSkillArray[1]='AHtb'
    set mSkillArray[2]='AOsh'
    set mSkillArray[3]='AHtb'
    set mSkillArray[4]='AOsh'
    set mSkillArray[5]='A00O'
    set mSkillArray[6]='AOsh'
    set mSkillArray[7]='AHtb'
    set mSkillArray[8]='AHtb'
    set mSkillArray[9]='Aamk'
    set mSkillArray[10]='A00O'
    set mSkillArray[11]='A00U'
    set mSkillArray[12]='A00U'
    set mSkillArray[13]='A00U'
    set mSkillArray[14]='A00U'
    set mSkillArray[15]='A00O'
    set mSkillArray[16]='Aamk'
    set mSkillArray[17]='Aamk'
    set mSkillArray[18]='Aamk'
    set mSkillArray[19]='Aamk'
    set mSkillArray[20]='Aamk'
    set mSkillArray[21]='Aamk'
    set mSkillArray[22]='Aamk'
    set mSkillArray[23]='Aamk'
    set mSkillArray[24]='Aamk'
endfunction

function initSkillArry_guanyu takes nothing returns nothing
    set mSkillArray[0]='A011'
    set mSkillArray[1]='A00R'
    set mSkillArray[2]='A011'
    set mSkillArray[3]='A00R'
    set mSkillArray[4]='A011'
    set mSkillArray[5]='A00A'
    set mSkillArray[6]='A011'
    set mSkillArray[7]='A00R'
    set mSkillArray[8]='A00R'
    set mSkillArray[9]='A00C'
    set mSkillArray[10]='A00A'
    set mSkillArray[11]='A00C'
    set mSkillArray[12]='A00C'
    set mSkillArray[13]='A00C'
    set mSkillArray[14]='Aamk'
    set mSkillArray[15]='A00A'
    set mSkillArray[16]='Aamk'
    set mSkillArray[17]='Aamk'
    set mSkillArray[18]='Aamk'
    set mSkillArray[19]='Aamk'
    set mSkillArray[20]='Aamk'
    set mSkillArray[21]='Aamk'
    set mSkillArray[22]='Aamk'
    set mSkillArray[23]='Aamk'
    set mSkillArray[24]='Aamk'
endfunction

function initSkillArry_zhangfei takes nothing returns nothing
    set mSkillArray[0]='A04W'
    set mSkillArray[1]='Aamk'
    set mSkillArray[2]='A04W'
    set mSkillArray[3]='Aamk'
    set mSkillArray[4]='A04W'
    set mSkillArray[5]='A006'
    set mSkillArray[6]='A04W'
    set mSkillArray[7]='Amgr'
    set mSkillArray[8]='A009'
    set mSkillArray[9]='A009'
    set mSkillArray[10]='A006'
    set mSkillArray[11]='A009'
    set mSkillArray[12]='A009'
    set mSkillArray[13]='Amgr'
    set mSkillArray[14]='Amgr'
    set mSkillArray[15]='A006'
    set mSkillArray[16]='Amgr'
    set mSkillArray[17]='Aamk'
    set mSkillArray[18]='Aamk'
    set mSkillArray[19]='Aamk'
    set mSkillArray[20]='Aamk'
    set mSkillArray[21]='Aamk'
    set mSkillArray[22]='Aamk'
    set mSkillArray[23]='Aamk'
    set mSkillArray[24]='Aamk'
endfunction

function initSkillArry_weiyan takes nothing returns nothing
    set mSkillArray[0]='A02A'
    set mSkillArray[1]='Aamk'
    set mSkillArray[2]='A02A'
    set mSkillArray[3]='Aamk'
    set mSkillArray[4]='A02A'
    set mSkillArray[5]='A00H'
    set mSkillArray[6]='A02A'
    set mSkillArray[7]='A00D'
    set mSkillArray[8]='A00D'
    set mSkillArray[9]='A00D'
    set mSkillArray[10]='A00H'
    set mSkillArray[11]='A00D'
    set mSkillArray[12]='A01B'
    set mSkillArray[13]='A01B'
    set mSkillArray[14]='A01B'
    set mSkillArray[15]='A00H'
    set mSkillArray[16]='A01B'
    set mSkillArray[17]='Aamk'
    set mSkillArray[18]='Aamk'
    set mSkillArray[19]='Aamk'
    set mSkillArray[20]='Aamk'
    set mSkillArray[21]='Aamk'
    set mSkillArray[22]='Aamk'
    set mSkillArray[23]='Aamk'
    set mSkillArray[24]='Aamk'
endfunction

function initSkillArry_guojia takes nothing returns nothing
    set mSkillArray[0]='A00W'
    set mSkillArray[1]='A022'
    set mSkillArray[2]='A00W'
    set mSkillArray[3]='A022'
    set mSkillArray[4]='A00W'
    set mSkillArray[5]='A01F'
    set mSkillArray[6]='A00W'
    set mSkillArray[7]='A022'
    set mSkillArray[8]='A022'
    set mSkillArray[9]='Aamk'
    set mSkillArray[10]='A01F'
    set mSkillArray[11]='Aamk'
    set mSkillArray[12]='Aamk'
    set mSkillArray[13]='Aamk'
    set mSkillArray[14]='Aamk'
    set mSkillArray[15]='A01F'
    set mSkillArray[16]='Aamk'
    set mSkillArray[17]='Aamk'
    set mSkillArray[18]='Aamk'
    set mSkillArray[19]='Aamk'
    set mSkillArray[20]='Aamk'
    set mSkillArray[21]='AUfu'
    set mSkillArray[22]='AUfu'
    set mSkillArray[23]='AUfu'
    set mSkillArray[24]='AUfu'
endfunction

function initSkillArry_caoren takes nothing returns nothing
    set mSkillArray[0]='AUcs'
    set mSkillArray[1]='AUsl'
    set mSkillArray[2]='AUcs'
    set mSkillArray[3]='Aamk'
    set mSkillArray[4]='AUcs'
    set mSkillArray[5]='A030'
    set mSkillArray[6]='AUcs'
    set mSkillArray[7]='Aamk'
    set mSkillArray[8]='Aamk'
    set mSkillArray[9]='Aamk'
    set mSkillArray[10]='A030'
    set mSkillArray[11]='AUsl'
    set mSkillArray[12]='AUsl'
    set mSkillArray[13]='AUsl'
    set mSkillArray[14]='Aamk'
    set mSkillArray[15]='A030'
    set mSkillArray[16]='Auhf'
    set mSkillArray[17]='Auhf'
    set mSkillArray[18]='Auhf'
    set mSkillArray[19]='Auhf'
    set mSkillArray[20]='Aamk'
    set mSkillArray[21]='Aamk'
    set mSkillArray[22]='Aamk'
    set mSkillArray[23]='Aamk'
    set mSkillArray[24]='Aamk'
endfunction

function initSkillArry_dianwei takes nothing returns nothing
    set mSkillArray[0]='A04W'
    set mSkillArray[1]='A03R'
    set mSkillArray[2]='A04W'
    set mSkillArray[3]='A03R'
    set mSkillArray[4]='A04W'
    set mSkillArray[5]='A00L'
    set mSkillArray[6]='A04W'
    set mSkillArray[7]='A03R'
    set mSkillArray[8]='A03R'
    set mSkillArray[9]='A06D'
    set mSkillArray[10]='A00L'
    set mSkillArray[11]='A06D'
    set mSkillArray[12]='A06D'
    set mSkillArray[13]='A06D'
    set mSkillArray[14]='Aamk'
    set mSkillArray[15]='A00L'
    set mSkillArray[16]='Aamk'
    set mSkillArray[17]='Aamk'
    set mSkillArray[18]='Aamk'
    set mSkillArray[19]='Aamk'
    set mSkillArray[20]='Aamk'
    set mSkillArray[21]='Aamk'
    set mSkillArray[22]='Aamk'
    set mSkillArray[23]='Aamk'
    set mSkillArray[24]='Aamk'
endfunction

function initSkillArry_xun takes nothing returns nothing
    set mSkillArray[0]='A060'
    set mSkillArray[1]='A02E'
    set mSkillArray[2]='A060'
    set mSkillArray[3]='Aamk'
    set mSkillArray[4]='A060'
    set mSkillArray[5]='A065'
    set mSkillArray[6]='A060'
    set mSkillArray[7]='Aamk'
    set mSkillArray[8]='A02E'
    set mSkillArray[9]='A02E'
    set mSkillArray[10]='A065'
    set mSkillArray[11]='A02E'
    set mSkillArray[12]='AOhw'
    set mSkillArray[13]='AOhw'
    set mSkillArray[14]='AOhw'
    set mSkillArray[15]='A065'
    set mSkillArray[16]='AOhw'
    set mSkillArray[17]='Aamk'
    set mSkillArray[18]='Aamk'
    set mSkillArray[19]='Aamk'
    set mSkillArray[20]='Aamk'
    set mSkillArray[21]='Aamk'
    set mSkillArray[22]='Aamk'
    set mSkillArray[23]='Aamk'
    set mSkillArray[24]='Aamk'
endfunction

function initSkillArry_dadi takes nothing returns nothing
    set mSkillArray[0]=aid_dadi_yingpi
    set mSkillArray[1]=aid_dadi_fensui
    set mSkillArray[2]=aid_dadi_yingpi
    set mSkillArray[3]=aid_dadi_fensui
    set mSkillArray[4]=aid_dadi_yingpi
    set mSkillArray[5]=aid_dadi_dileizhen
    set mSkillArray[6]=aid_dadi_chaonong
    set mSkillArray[7]=aid_dadi_fensui
    set mSkillArray[8]=aid_dadi_fensui
    set mSkillArray[9]=aid_dadi_chaonong
    set mSkillArray[10]=aid_dadi_dileizhen
    set mSkillArray[11]=aid_shuxingdian
    set mSkillArray[12]=aid_shuxingdian
    set mSkillArray[13]=aid_dadi_chaonong
    set mSkillArray[14]=aid_dadi_chaonong
    set mSkillArray[15]=aid_dadi_dileizhen
    set mSkillArray[16]=aid_dadi_yingpi
    set mSkillArray[17]=aid_shuxingdian
    set mSkillArray[18]=aid_shuxingdian
    set mSkillArray[19]=aid_shuxingdian
    set mSkillArray[20]=aid_shuxingdian
    set mSkillArray[21]=aid_shuxingdian
    set mSkillArray[22]=aid_shuxingdian
    set mSkillArray[23]=aid_shuxingdian
    set mSkillArray[24]=aid_shuxingdian
endfunction

function initSkillArry_gongben takes nothing returns nothing
    set mSkillArray[0]=aid_gongben_longzuishan
    set mSkillArray[1]=aid_xiahouyuan_huixuanzhan
    set mSkillArray[2]=aid_gongben_longzuishan
    set mSkillArray[3]=aid_xiahouyuan_huixuanzhan
    set mSkillArray[4]=aid_gongben_longzuishan
    set mSkillArray[5]=KO
    set mSkillArray[6]=aid_gongben_longzuishan
    set mSkillArray[7]=aid_xiahouyuan_huixuanzhan
    set mSkillArray[8]=aid_xiahouyuan_huixuanzhan
    set mSkillArray[9]=aid_shuxingdian
    set mSkillArray[10]=KO
    set mSkillArray[11]=aid_zuiwoshachang
    set mSkillArray[12]=aid_zuiwoshachang
    set mSkillArray[13]=aid_zuiwoshachang
    set mSkillArray[14]=aid_zuiwoshachang
    set mSkillArray[15]=KO
    set mSkillArray[16]=aid_shuxingdian
    set mSkillArray[17]=aid_shuxingdian
    set mSkillArray[18]=aid_shuxingdian
    set mSkillArray[19]=aid_shuxingdian
    set mSkillArray[20]=aid_shuxingdian
    set mSkillArray[21]=aid_shuxingdian
    set mSkillArray[22]=aid_shuxingdian
    set mSkillArray[23]=aid_shuxingdian
    set mSkillArray[24]=aid_shuxingdian
endfunction

function initSkillArry_madai takes nothing returns nothing
    set mSkillArray[0]=aid_madai_yuanjianshu
    set mSkillArray[1]=aid_shuxingdian
    set mSkillArray[2]=aid_madai_yuanjianshu
    set mSkillArray[3]=aid_shuxingdian
    set mSkillArray[4]=aid_madai_yuanjianshu
    set mSkillArray[5]=aid_madai_zhuihun
    set mSkillArray[6]=aid_madai_yuanjianshu
    set mSkillArray[7]=aid_madai_yingyan
    set mSkillArray[8]=aid_madai_yingyan
    set mSkillArray[9]=aid_madai_cichuan
    set mSkillArray[10]=aid_madai_zhuihun
    set mSkillArray[11]=aid_madai_cichuan
    set mSkillArray[12]=aid_madai_cichuan
    set mSkillArray[13]=aid_madai_cichuan
    set mSkillArray[14]=aid_madai_yingyan
    set mSkillArray[15]=aid_madai_zhuihun
    set mSkillArray[16]=aid_madai_yingyan
    set mSkillArray[17]=aid_shuxingdian
    set mSkillArray[18]=aid_shuxingdian
    set mSkillArray[19]=aid_shuxingdian
    set mSkillArray[20]=aid_shuxingdian
    set mSkillArray[21]=aid_shuxingdian
    set mSkillArray[22]=aid_shuxingdian
    set mSkillArray[23]=aid_shuxingdian
    set mSkillArray[24]=aid_shuxingdian
endfunction

function initSkillArry_zhanghe takes nothing returns nothing
    set mSkillArray[0]=aid_zhanghe_dujian
    set mSkillArray[1]=aid_zhanghe_xieexingyang
    set mSkillArray[2]=aid_zhanghe_dujian
    set mSkillArray[3]=aid_zhanghe_xieexingyang
    set mSkillArray[4]=aid_zhanghe_dujian
    set mSkillArray[5]=aid_zhanghe_juduji
    set mSkillArray[6]=aid_zhanghe_dujian
    set mSkillArray[7]=aid_zhanghe_xieexingyang
    set mSkillArray[8]=aid_zhanghe_xieexingyang
    set mSkillArray[9]=aid_shuxingdian
    set mSkillArray[10]=aid_zhanghe_juduji
    set mSkillArray[11]=aid_shuxingdian
    set mSkillArray[12]=aid_shuxingdian
    set mSkillArray[13]=aid_shuxingdian
    set mSkillArray[14]=aid_shuxingdian
    set mSkillArray[15]=aid_zhanghe_juduji
    set mSkillArray[16]=aid_zhanghe_duwu
    set mSkillArray[17]=aid_zhanghe_duwu
    set mSkillArray[18]=aid_zhanghe_duwu
    set mSkillArray[19]=aid_zhanghe_duwu
    set mSkillArray[20]=aid_shuxingdian
    set mSkillArray[21]=aid_shuxingdian
    set mSkillArray[22]=aid_shuxingdian
    set mSkillArray[23]=aid_shuxingdian
    set mSkillArray[24]=aid_shuxingdian
endfunction

function initSkillArry_sunquan takes nothing returns nothing
    set mSkillArray[0]=aid_sunquan_bizhan
    set mSkillArray[1]=aid_sunquan_jianguangbi
    set mSkillArray[2]=aid_sunquan_bizhan
    set mSkillArray[3]=aid_sunquan_jianguangbi
    set mSkillArray[4]=aid_sunquan_bizhan
    set mSkillArray[5]=ER
    set mSkillArray[6]=aid_sunquan_bizhan
    set mSkillArray[7]=aid_sunquan_jianguangbi
    set mSkillArray[8]=aid_sunquan_jianguangbi
    set mSkillArray[9]=aid_shuxingdian
    set mSkillArray[10]=ER
    set mSkillArray[11]=aid_shuxingdian
    set mSkillArray[12]=aid_shuxingdian
    set mSkillArray[13]=aid_sunquan_fandongjian
    set mSkillArray[14]=aid_sunquan_fandongjian
    set mSkillArray[15]=ER
    set mSkillArray[16]=aid_sunquan_fandongjian
    set mSkillArray[17]=aid_sunquan_fandongjian
    set mSkillArray[18]=aid_shuxingdian
    set mSkillArray[19]=aid_shuxingdian
    set mSkillArray[20]=aid_shuxingdian
    set mSkillArray[21]=aid_shuxingdian
    set mSkillArray[22]=aid_shuxingdian
    set mSkillArray[23]=aid_shuxingdian
    set mSkillArray[24]=aid_shuxingdian
endfunction

function initSkillArry takes nothing returns nothing
    if mHeroId=='H008' then
        call initSkillArry_zhugeliang()
    endif
    if mHeroId=='U00A' then
        call initSkillArry_simayi()
    endif
    if mHeroId=='E000' then
        call initSkillArry_zhaoyun()
    endif
    if mHeroId=='H005' then
        call initSkillArry_zhangliao()
    endif
    if isguojia()then
        call initSkillArry_guojia()
    endif
    if isxun()then
        call initSkillArry_xun()
    endif
    if iscaoren()then
        call initSkillArry_caoren()
    endif
    if isdianwei()then
        call initSkillArry_dianwei()
    endif
    if isguanyu()then
        call initSkillArry_guanyu()
    endif
    if iszhangfei()then
        call initSkillArry_zhangfei()
    endif
    if isweiyan()then
        call initSkillArry_weiyan()
    endif
    if isdadi()then
        call initSkillArry_dadi()
    endif
    if ismadai()then
        call initSkillArry_madai()
    endif
    if iszhanghe()then
        call initSkillArry_zhanghe()
    endif
    if isgongben()then
        call initSkillArry_gongben()
    endif
    if issunquan()then
        call initSkillArry_sunquan()
    endif
endfunction

function J1 takes nothing returns nothing
    local location loc=null
    set loc=GetUnitToOuterLocAngle(HeroD,mHero,600,GetRandomInt(-1,1)*90)
    call gotoLocation(mHero,loc,50)
    call RemoveLocation(loc)
    set loc=null
    call Sleep(1.1)
endfunction

function K1 takes location L1 returns boolean
    local location loc=null
    local integer index=-1
    local real M1=0
    local integer angle=-2
    loop
        exitwhen index==2
        set loc=GetUnitToOuterLocAngle(HeroD,mHero,500,index*90)
        if RangeLocToLoc(loc,L1)>M1 then
            set angle=index
            set M1=RangeLocToLoc(loc,L1)
        endif
        call RemoveLocation(loc)
        set loc=null
        set index=index+1
    endloop
    set loc=GetUnitToOuterLocAngle(HeroD,mHero,300,angle*90)
    if RangeLocToLoc(loc,L1)>230 then
        call RemoveLocation(loc)
        set loc=null
        set loc=GetUnitToOuterLocAngle(HeroD,mHero,600,angle*90)
        call gotoLocation(mHero,loc,50)
        call Sleep(1.1)
        call RemoveLocation(loc)
        set loc=null
        return true
    endif
    return false
endfunction

function P1 takes nothing returns nothing
    local location loc=null
    local integer Q1=1
    if GetRandomInt(0,1)==1 then
        set Q1=-1
    endif
    set loc=GetUnitToOuterLocAngle(mHero,HeroD,600,Q1*120)
    call gotoLocation(mHero,loc,50)
    call RemoveLocation(loc)
    set loc=null
    call Sleep(1.2)
    set loc=GetUnitToOuterLocAngle(mHero,HeroD,600,Q1*120)
    call gotoLocation(mHero,loc,50)
    call RemoveLocation(loc)
    set loc=null
    call Sleep(1.2)
endfunction

function setAIPlayerName takes nothing returns nothing
    if GetAIDifficulty(ai_player)==AI_DIFFICULTY_NEWBIE then
        set aistr="简单"
    endif
    if GetAIDifficulty(ai_player)==AI_DIFFICULTY_NORMAL then
        set aistr="普通"
    endif
    if GetAIDifficulty(ai_player)==AI_DIFFICULTY_INSANE then
        set aistr="疯狂"
    endif
    if isZhuGeLiang()then
        set aistr=aistr+"诸葛亮"
    endif
    if isweiyan()then
        set aistr=aistr+"魏严"
    endif
    if isguanyu()then
        set aistr=aistr+"关羽"
    endif
    if iszhangfei()then
        set aistr=aistr+"张飞"
    endif
    if iszhaoyun()then
        set aistr=aistr+"赵云"
    endif
    if isSiMaYi()then
        set aistr=aistr+"司马懿"
    endif
    if isdianwei()then
        set aistr=aistr+"典韦"
    endif
    if iszhangliao()then
        set aistr=aistr+"张辽"
    endif
    if isguojia()then
        set aistr=aistr+"郭嘉"
    endif
    if isxun()then
        set aistr=aistr+"荀彧"
    endif
    if iscaoren()then
        set aistr=aistr+"曹仁"
    endif
    if isdadi()then
        set aistr=aistr+"团团"
    endif
    if issunquan()then
        set aistr=aistr+"孙权"
    endif
    if ismadai()then
        set aistr=aistr+"马岱"
    endif
    if iszhanghe()then
        set aistr=aistr+"张合"
    endif
    if isgongben()then
        set aistr=aistr+"宫本武藏"
    endif
    call SetPlayerName(ai_player,aistr)
endfunction

function zs_IsTimeOut takes integer id,real period returns boolean
    if TimerGetElapsed(zs_timer1)-zs_ElapsedTime[id]>period then
        set zs_ElapsedTime[id]=TimerGetElapsed(zs_timer1)
        return true
    endif
    return false
endfunction

function W1 takes group NearestEnemyBubing returns integer
    local integer count=0
    local integer index=0
    local unit u=null
    local group rg=null
    if NearestEnemyBubing==null then
        return-1
    endif
    set rg=CreateGroup()
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen index>=13
        if u!=null and IsAlive(u)then
            call SetUnitAcquireRange(u,61)
            set count=count+1
            call GroupAddUnit(rg,u)
        endif
        set index=index+1
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    if NearestEnemyBubing==VF then
        set VF=rg
    endif
    if NearestEnemyBubing==zs_toushiche_group then
        set zs_toushiche_group=rg
    endif
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    return count
endfunction

function SelectUnitsById takes player ThePlayer,integer uid returns group
    local unit u=null
    local group NearestEnemyBubing=CreateGroup()
    local group rg=CreateGroup()
    call GroupEnumUnitsOfPlayer(NearestEnemyBubing,ThePlayer,null)
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if(GetUnitTypeId(u)==uid and IsAlive(u))then
            call SetUnitAcquireRange(u,61)
            call GroupAddUnit(rg,u)
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    return rg
endfunction

function SelectToushiche takes player ThePlayer returns group
    return SelectUnitsById(ThePlayer,uid_toushiche)
endfunction

function SelectUnitsByIlussion takes player ThePlayer returns group
    local unit u=null
    local group NearestEnemyBubing=CreateGroup()
    local group rg=CreateGroup()
    call GroupEnumUnitsOfPlayer(NearestEnemyBubing,ThePlayer,null)
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if(IsUnitIllusion(u)and IsAlive(u))then
            call GroupAddUnit(rg,u)
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    return rg
endfunction

function SelectWard takes player ThePlayer returns group
    local unit u=null
    local group NearestEnemyBubing=CreateGroup()
    local group rg=CreateGroup()
    call GroupEnumUnitsOfPlayer(NearestEnemyBubing,ThePlayer,null)
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if(GetUnitTypeId(u)=='o00H' or GetUnitTypeId(u)=='o00I' or GetUnitTypeId(u)=='o00J')and IsAlive(u)then
            call GroupAddUnit(rg,u)
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    return rg
endfunction

function R2 takes integer range returns nothing
    local integer index=0
    loop
        exitwhen index==NH
        if AH[index]==range then
            return
        endif
        set index=index+1
    endloop
    set AH[NH]=range
    set NH=NH+1
endfunction

function I2 takes nothing returns nothing
    local integer index=0
    local string ds=""
    loop
        exitwhen index==NH
        set AH[index]=0
        set index=index+1
    endloop
    set NH=0
endfunction

function A2 takes unit theunit,integer N2 returns integer
    local integer index=0
    loop
        exitwhen index==NH
        if AH[index]>=RangeTo(mHero,theunit)and AH[index]<=N2 then
            return AH[index]
        endif
        set index=index+1
    endloop
    return-1
endfunction

function B2 takes unit u,string id returns nothing
    call StoreInteger(zs_gamecache,"units",id,AK(u))
endfunction

function C2 takes string id returns unit
    if GetStoredInteger(zs_gamecache,"units",id)<1 then
        return null
    endif
    return NK(GetStoredInteger(zs_gamecache,"units",id))
endfunction

function D2 takes location loc returns nothing
    local unit F2=FirstOfGroup(VF)
    if F2!=null then
        call GroupPointOrderByIdLoc(VF,851986,loc)
    endif
endfunction

function G2 takes nothing returns nothing
    local unit H2=null
    local integer index=0
    loop
        set H2=FirstOfGroup(VF)
        exitwhen index>=20
        if H2!=null and IsAlive(H2)then
            call GroupAddUnit(zs_toushiche_group,H2)
        endif
        set index=index+1
        call GroupRemoveUnit(VF,H2)
    endloop
    call DestroyGroup(VF)
    set VF=null
endfunction

function J2 takes nothing returns nothing
    local unit tmp=zs_judianw[2]
    local unit H2=null
    local location L2=null
    local group rg=CreateGroup()
    local integer index=0
    local unit M2=null
    if YD<1 then
        return
    endif
    set M2=FirstOfGroup(zs_toushiche_group)
    if M2==null then
        set M2=mHero
    endif
    if(IsDead(zs_judianw[2])or GetHPVoided(zs_judianw[2])>100)or(zs_judianw[0]!=null and IsAlive(zs_judianw[0])and RangeTo(M2,zs_judianw[0])<=RangeTo(M2,zs_judianw[2]))then
        set tmp=zs_judianw[0]
    endif
    if IsDead(tmp)or GetHPVoided(tmp)>100 then
        set tmp=GF
    endif
    set YD=0
    call G2()
    set VF=CreateGroup()
    loop
        set H2=FirstOfGroup(zs_toushiche_group)
        exitwhen index>=20
        if H2!=null and IsAlive(H2)then
            set YD=YD+1
            if(GetUnitLifePercent(H2)>40 and RangeTo(H2,tmp)>1100)or GetUnitLifePercent(H2)>96 then
                call SetUnitAcquireRange(H2,61)
                call GroupAddUnit(rg,H2)
            else
                call GroupAddUnit(VF,H2)
            endif
        endif
        set index=index+1
        call GroupRemoveUnit(zs_toushiche_group,H2)
    endloop
    call DestroyGroup(zs_toushiche_group)
    set zs_toushiche_group=null
    set zs_toushiche_group=rg
    set L2=GetUnitLoc(tmp)
    call D2(L2)
    call RemoveLocation(L2)
    set L2=null
endfunction

function P2 takes location loc returns boolean
    local unit F2=FirstOfGroup(zs_toushiche_group)
    if F2!=null then
        if RangeToLoc(F2,loc)<800 then
            return true
        endif
        call J2()
        call GroupPointOrderByIdLoc(zs_toushiche_group,851986,loc)
    endif
    return false
endfunction

function Q2 takes nothing returns nothing
    local integer S2=GetStoredInteger(zs_gamecache,"zs_itemNearHero","playerid"+ITS(GetPlayerId(ai_player)))
    set GD=null
    if S2>0 then
        set GD=CK(S2)
    endif
endfunction

function T2 takes nothing returns nothing
    set GD=null
    call StoreInteger(zs_gamecache,"zs_itemNearHero","playerid"+ITS(GetPlayerId(ai_player)),-1)
endfunction

function U2 takes integer JT,integer level,integer cd,integer mp,integer range,integer W2 returns nothing
    call FS(JT,level,cd)
    call ET(JT,level,mp)
    call OT(JT,range)
    call RT(JT,W2)
endfunction

function Z2 takes unit TheUnit,location loc returns real
    local real TheAngle
    local location TheLoc=null
    if(TheUnit!=null)and(IsAlive(TheUnit))then
        set TheLoc=GetUnitLoc(TheUnit)
        set TheAngle=GetAngle(loc,TheLoc)
        call RemoveLocation(TheLoc)
        set TheLoc=null
        return(TheAngle)
    endif
    return-.001
endfunction

function V3 takes unit TheUnit returns real
    local real TheAngle
    local location TheTarget=null
    local location TheLoc=null
    return Z2(TheUnit,zs_cr_retreatLoc)
    if(TheUnit!=null)and(IsAlive(TheUnit))then
        set TheTarget=mBaseLoc
        set TheLoc=GetUnitLoc(TheUnit)
        set TheAngle=GetAngle(TheTarget,TheLoc)
        call RemoveLocation(TheLoc)
        set TheLoc=null
        set TheTarget=null
        return(TheAngle)
    endif
    return-.001
endfunction

function E3 takes unit TheTarget,real TheRange returns location
    local real TheDir
    if(TheTarget!=null)and(IsAlive(TheTarget))then
        set TheDir=Deg2Rad(V3(TheTarget)+180)
        return(Location(TheRange*Cos(TheDir)+GetUnitX(TheTarget),TheRange*Sin(TheDir)+GetUnitY(TheTarget)))
    endif
    return null
endfunction

function X3 takes unit TheTarget,real TheRange returns location
    local real TheDir
    local real rdm=0
    set rdm=GetRandomInt(-1,1)*FB
    if(TheTarget!=null)and(IsAlive(TheTarget))then
        set TheDir=Deg2Rad(V3(TheTarget)+180+rdm)
        return(Location(TheRange*Cos(TheDir)+GetUnitX(TheTarget),TheRange*Sin(TheDir)+GetUnitY(TheTarget)))
    endif
    return null
endfunction

function getForceId takes nothing returns integer
    if(GetPlayerId(ai_player)<6)then
        return 1
    endif
    return 2
endfunction

function getBaseLoc takes nothing returns location
    if(mForceId==1)then
        return suguoBaseLoc
    endif
    return weiguoBaseLoc
endfunction

function getEnemyBaseLoc takes nothing returns location
    if(mForceId==2)then
        return suguoBaseLoc
    endif
    return weiguoBaseLoc
endfunction

function getDuBingLoc takes nothing returns location
    if(mForceId==1)then
        return Location(-4110,-5100)
    endif
    return Location(3300,3700)
endfunction

function getUnitByid takes integer iunitid,location loc,real radius returns unit
    local real TheRange
    local real nearestRange=999999
    local unit u=null
    local unit ru=null
    local group NearestEnemyBubing=CreateGroup()
    call GroupEnumUnitsInRangeOfLoc(NearestEnemyBubing,loc,radius,null)
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if(GetUnitTypeId(u)==iunitid)then
            set TheRange=RangeToLoc(u,loc)
            if TheRange<nearestRange then
                set nearestRange=TheRange
                set ru=u
            endif
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    if(ru==null)then
    endif
    return ru
endfunction

function F3 takes nothing returns nothing
    local unit u=null
    local group NearestEnemyBubing=CreateGroup()
    call GroupEnumUnitsInRangeOfLoc(NearestEnemyBubing,TH,600,null)
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if GetUnitTypeId(u)==uid_dragon and IsAlive(u)then
            set SH=u
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
endfunction

function G3 takes unit TheUnit,real Radius,boolean includeInvisible returns unit
    local real TheRange
    local location Loc=null
    local real nearestRange=999999
    local unit u=null
    local unit ru=null
    local group NearestEnemyBubing=CreateGroup()
    if(TheUnit==null)and(not IsAlive(TheUnit))then
        return null
    endif
    set Loc=GetUnitLoc(TheUnit)
    call GroupEnumUnitsInRangeOfLoc(NearestEnemyBubing,Loc,Radius,null)
    call RemoveLocation(Loc)
    set Loc=null
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if IsUnitEnemy(u,ai_player)and IsAlive(u)then
            if GetUnitTypeId(u)==uid_zhimingjiejieLv1 or GetUnitTypeId(u)==uid_zhimingjiejieLv2 or GetUnitTypeId(u)==uid_zhimingjiejieLv3 or GetUnitTypeId(u)==uid_zhimingjiejieLv4 then
                set EJ=u
            endif
            if GetUnitTypeId(u)==uid_yanjing then
                set XJ=u
            endif
            if GetUnitTypeId(u)==uid_shexingjiejieLv1 or GetUnitTypeId(u)==uid_shexingjiejieLv2 or GetUnitTypeId(u)==uid_shexingjiejieLv3 then
                set OJ=u
            endif
        endif
        if IsUnitEnemy(u,ai_player)and IsAlive(u)then
            if(includeInvisible)or(IsUnitInvisible(u,ai_player)==false)then
                set TheRange=RangeTo(TheUnit,u)
                if TheRange<nearestRange then
                    set nearestRange=TheRange
                    set ru=u
                endif
            endif
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    if(ru!=null)then
    endif
    set u=null
    return ru
endfunction

function GetNearestEnemyImportantStructs takes unit TheUnit,real Radius,boolean includeInvisible returns unit
    local location Loc=null
    local unit u=null
    local unit ru=null
    local group NearestEnemyBubing=CreateGroup()
    if(TheUnit==null)and(not IsAlive(TheUnit))then
        return null
    endif
    set Loc=GetUnitLoc(TheUnit)
    call GroupEnumUnitsInRangeOfLoc(NearestEnemyBubing,Loc,Radius,null)
    call RemoveLocation(Loc)
    set Loc=null
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null or ru!=null
        if IsUnitEnemy(u,ai_player)and IsAlive(u)then
            if(includeInvisible)or(IsUnitInvisible(u,ai_player)==false)then
                if GetUnitTypeId(u)==uid_benzhen or GetUnitTypeId(u)==uid_bingying or GetUnitTypeId(u)==uid_judian or GetUnitTypeId(u)==uid_liangcang then
                    set ru=u
                endif
            endif
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    set u=null
    if ru==null then
        if NF!=null and RangeTo(TheUnit,NF)<2800 then
            set ru=NF
        endif
    endif
    return ru
endfunction

function GetNearestEnemyTower takes unit TheUnit,real Radius returns unit
    local real TheRange
    local location Loc=null
    local real nearestRange=999999
    local unit u=null
    local unit ru=null
    local group NearestEnemyBubing=CreateGroup()
    if(TheUnit==null)and(not IsAlive(TheUnit))then
        return null
    endif
    set Loc=GetUnitLoc(TheUnit)
    call GroupEnumUnitsInRangeOfLoc(NearestEnemyBubing,Loc,Radius,null)
    call RemoveLocation(Loc)
    set Loc=null
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if(IsEnemyTower(u))then
            set TheRange=RangeTo(TheUnit,u)
            if TheRange<nearestRange then
                set nearestRange=TheRange
                set ru=u
            endif
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    if(ru!=null)then
    endif
    set u=null
    return ru
endfunction

function GetEnemyBingInRangeCount takes location Loc,real Radius,boolean includeInvisible returns integer
    local integer result=0
    local unit u=null
    local group NearestEnemyBubing=CreateGroup()
    call GroupEnumUnitsInRangeOfLoc(NearestEnemyBubing,Loc,Radius,null)
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if(IsEnemyBing(u)and IsAlive(u))then
            if(includeInvisible)or(IsUnitInvisible(u,ai_player)==false)then
                set result=result+1
            endif
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    set u=null
    return result
endfunction

function GetAllyBingInRangeCount takes location Loc,real Radius,boolean includeInvisible returns integer
    local integer result=0
    local unit u=null
    local group NearestEnemyBubing=CreateGroup()
    call GroupEnumUnitsInRangeOfLoc(NearestEnemyBubing,Loc,Radius,null)
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if(IsAllyBing(u)and IsAlive(u))then
            if(includeInvisible)or(IsUnitInvisible(u,ai_player)==false)then
                set result=result+1
            endif
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    set u=null
    return result
endfunction

function GetZhongliEnemyInRangeCount takes location Loc,real Radius,boolean includeInvisible returns integer
    local integer result=0
    local unit u=null
    local group NearestEnemyBubing=CreateGroup()
    call GroupEnumUnitsInRangeOfLoc(NearestEnemyBubing,Loc,Radius,null)
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if(isZhongLiEnemy(u)and IsAlive(u))then
            if(includeInvisible)or(IsUnitInvisible(u,ai_player)==false)then
                set result=result+1
            endif
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    set u=null
    return result
endfunction

function GetFarestAllyBubingNearHeroFromBase takes unit TheUnit,real Radius,boolean includeInvisible returns unit
    local real TheRange
    local location Loc=null
    local real fareastRange=0
    local unit u=null
    local unit ru=null
    local group NearestEnemyBubing=CreateGroup()
    if(TheUnit==null)or(not IsAlive(TheUnit))then
        return null
    endif
    set Loc=GetUnitLoc(TheUnit)
    call GroupEnumUnitsInRangeOfLoc(NearestEnemyBubing,Loc,Radius,null)
    call RemoveLocation(Loc)
    set Loc=null
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if(IsAllyBing(u)and IsMoving(u))then
            if(includeInvisible)or(IsUnitInvisible(u,ai_player)==false)then
                set TheRange=RangeToLoc(u,mBaseLoc)
                if TheRange>fareastRange then
                    set fareastRange=TheRange
                    set ru=u
                endif
            endif
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    if(ru!=null)then
    endif
    set u=null
    return ru
endfunction

function GetFarestAllyFromBaseInMiddleLine takes nothing returns unit
    local real TheRange
    local real FarestRange=0
    local unit u=null
    local unit ru=null
    local group NearestEnemyBubing=CreateGroup()
    call GroupEnumUnitsInRangeOfLoc(NearestEnemyBubing,mBaseLoc,999999,null)
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if(IsAllyBingAttaker(u)and isUnitInMiddleLine(u))then
            set TheRange=RangeToLoc(u,mBaseLoc)
            if TheRange>FarestRange then
                set FarestRange=TheRange
                set ru=u
            endif
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    if(ru==null)then
    endif
    set u=null
    return ru
endfunction

function GetNearestEnemyFromBaseInMiddleLine takes nothing returns unit
    local real TheRange
    local real NearestRange=999999
    local unit u=null
    local unit ru=null
    local group NearestEnemyBubing=CreateGroup()
    call GroupEnumUnitsInRangeOfLoc(NearestEnemyBubing,mBaseLoc,999999,null)
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if(IsEnemyBingAttaker(u)and isUnitInMiddleLine(u))then
            set TheRange=RangeToLoc(u,mBaseLoc)
            if TheRange<NearestRange then
                set NearestRange=TheRange
                set ru=u
            endif
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    if(ru==null)then
    endif
    set u=null
    return ru
endfunction

function getFireMiddleLineLoc takes nothing returns location
    local unit unit1=null
    local unit unit2=null
    local location rtloc=null
    set unit1=GetFarestAllyFromBaseInMiddleLine()
    set unit2=GetNearestEnemyFromBaseInMiddleLine()
    if unit1==null or unit2==null then
        return null
    endif
    set rtloc=Location((GetUnitX(unit1)+GetUnitX(unit2))/2,(GetUnitY(unit1)+GetUnitY(unit2))/2)
    set unit1=null
    set unit2=null
    return rtloc
endfunction

function R4 takes nothing returns boolean
    if zs_nearestMinHpEnemyBing==null then
        return false
    endif
    return GetUnitLocLevel(mHero)<GetUnitLocLevel(zs_nearestMinHpEnemyBing)
endfunction

function I4 takes nothing returns location
    local real angle=-120
    local location A4=null
    if zs_MyFireLoc==null then
        return null
    endif
    loop
        exitwhen angle>120
        set A4=GetLocToOuterLocAngle(zs_cr_retreatLoc,zs_MyFireLoc,400,angle)
        if GetLocLevel(A4)>=GetUnitLocLevel(zs_nearestMinHpEnemyBing)then
            return A4
        endif
        call RemoveLocation(A4)
        set A4=null
        set angle=angle+15
    endloop
    return null
endfunction

function N4 takes nothing returns unit
    local real r1=999999
    local real r2=999999
    local real r3=999999
    local real B4=999999
    local unit ru=TowerD
    if TowerD!=null then
        set r1=rangeToTowerD
        set B4=r1
    endif
    if NearestEnemyBubing!=null then
        set r2=RangeTo(mHero,NearestEnemyBubing)
    endif
    if NearestHeroD!=null then
        set r3=KH
    endif
    if r2<r1 then
        set ru=NearestEnemyBubing
        set B4=r2
    endif
    if r3<B4 then
        set ru=NearestHeroD
        set B4=r3
    endif
    return ru
endfunction

function C4 takes nothing returns unit
    local real r1=999999
    local real r2=999999
    local real r3=999999
    local real B4=999999
    local unit ru=TowerD
    if TowerD!=null then
        set r1=rangeToTowerD-DB
        set B4=r1
    endif
    if NearestEnemyBubing!=null then
        set r2=RangeTo(mHero,NearestEnemyBubing)-zs_SafeLocRangeToEnemy
    endif
    if NearestHeroD!=null then
        set r3=KH-900
    endif
    if r2<r1 then
        set ru=NearestEnemyBubing
        set B4=r2
    endif
    if r3<B4 then
        set ru=NearestHeroD
        set B4=r3
    endif
    return ru
endfunction

function D4 takes nothing returns location
    local location loc1=null
    local unit ru=C4()
    if ru==null then
        return null
    endif
    if IsUnitHero(ru)then
        set loc1=X3(ru,900)
    else
        if IsTower(ru)then
            set loc1=X3(ru,DB)
        else
            set loc1=X3(ru,zs_SafeLocRangeToEnemy)
        endif
    endif
    return loc1
endfunction

function F4 takes real range returns location
    local unit u=null
    local unit uTower=null
    local location loc1=null
    local location loc2=null
    local location loc3=null
    set u=N4()
    if u==null then
        return null
    endif
    set loc1=E3(u,range)
    return loc1
endfunction

function GetEnemyNearestBubingNearHero takes unit TheUnit,real Radius,boolean includeInvisible returns unit
    local real TheRange
    local location Loc=null
    local real fareastRange=999999
    local unit u=null
    local unit ru=null
    local group NearestEnemyBubing=CreateGroup()
    if(TheUnit==null)or(not IsAlive(TheUnit))then
        return null
    endif
    set Loc=GetUnitLoc(TheUnit)
    call GroupEnumUnitsInRangeOfLoc(NearestEnemyBubing,Loc,Radius,null)
    call RemoveLocation(Loc)
    set Loc=null
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if(IsEnemyBing(u)and IsAlive(u))then
            if(includeInvisible)or(IsUnitInvisible(u,ai_player)==false)then
                set TheRange=RangeTo(mHero,u)
                if TheRange<fareastRange then
                    set fareastRange=TheRange
                    set ru=u
                endif
            endif
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    if(ru!=null)then
    endif
    set u=null
    return ru
endfunction

function GetEnemyWeakestBubingNearHero takes unit TheUnit,real Radius,boolean includeInvisible returns unit
    local real TheRange
    local location Loc=null
    local real fareastRange=999999
    local unit u=null
    local unit ru=null
    local group NearestEnemyBubing=CreateGroup()
    if(TheUnit==null)or(not IsAlive(TheUnit))then
        call debugstr(" unit null")
        return null
    endif
    set Loc=GetUnitLoc(TheUnit)
    call GroupEnumUnitsInRangeOfLoc(NearestEnemyBubing,Loc,Radius,null)
    call RemoveLocation(Loc)
    set Loc=null
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if(IsEnemyBing(u)and IsAlive(u))then
            if(includeInvisible)or(IsUnitInvisible(u,ai_player)==false)then
                set TheRange=GetHP(u)
                if TheRange<fareastRange then
                    set fareastRange=TheRange
                    set ru=u
                endif
            endif
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    if(ru!=null)then
    endif
    set u=null
    return ru
endfunction

function initlifearry takes nothing returns nothing
    local integer i=0
    loop
        exitwhen i==60
        set zs_NearHeroBingsLifeAlly[i]=-1
        set zs_NearHeroBingsLifeEnemy[i]=-1
        set i=i+1
    endloop
endfunction

function GetEnemyBingCountNearFireLoc takes nothing returns integer
    local integer index=0
    local unit theunit=null
    local integer count=0
    loop
        exitwhen index==20
        set theunit=zs_EnemyBingNearHeros[index]
        if theunit!=null and IsAlive(theunit)and RangeToLoc(theunit,zs_MyFireLoc)<601 then
            set count=count+1
        endif
        set index=index+1
    endloop
    set theunit=null
    return count
endfunction

function GetAllyBingCountNearFireLoc takes nothing returns integer
    local integer index=0
    local unit theunit=null
    local integer count=0
    loop
        exitwhen index==20
        set theunit=zs_AllyBingNearHeros[index]
        if theunit!=null and IsAlive(theunit)and RangeToLoc(theunit,zs_MyFireLoc)<601 then
            set count=count+1
        endif
        set index=index+1
    endloop
    set theunit=null
    return count
endfunction

function setLowestEnemyLifeBing takes nothing returns nothing
    local integer index=0
    local real min=999999
    local unit utmp=null
    local unit theunit=null
    loop
        exitwhen index==20
        set theunit=zs_EnemyBingNearHeros[index]
        if theunit!=null and GetHP(theunit)<min and IsAlive(theunit)and GetHP(theunit)>0 then
            set utmp=theunit
            set min=GetHP(theunit)
        endif
        set index=index+1
    endloop
    set zs_nearestEnemyBingMinHp=min
    set zs_nearestMinHpEnemyBing=utmp
    set utmp=null
    set theunit=null
endfunction

function setLowestAllyLifeBing takes nothing returns nothing
    local integer index=0
    local real min=999999
    local unit utmp=null
    local unit theunit=null
    loop
        exitwhen index==20
        set theunit=zs_AllyBingNearHeros[index]
        if theunit!=null and GetHP(theunit)<min and IsAlive(theunit)and GetHP(theunit)>0 then
            set utmp=theunit
            set min=GetHP(theunit)
        endif
        set index=index+1
    endloop
    set zs_nearestAllyBingMinHp=min
    set zs_nearestMinHpAllyBing=utmp
    set utmp=null
    set theunit=null
endfunction

function setSecondsOfUnitsAlly takes nothing returns nothing
    local real min=999999
    local real time=0
    local unit utmp=null
    local unit theunit=null
    local integer index=0
    if lockflag then
        return
    endif
    set LC=99999
    loop
        exitwhen index==20
        set theunit=zs_AllyBingNearHeros[index]
        if theunit!=null and GetHP(theunit)>0 and zs_NearHeroBingsLifeAlly[index]>0 then
            if absolute(zs_NearHeroBingsLifeAlly[index]-GetHP(theunit))>3 then
                set time=GetHP(theunit)/(zs_NearHeroBingsLifeAlly[index]-GetHP(theunit))
                set time=absolute(time)
                if time<min then
                    set utmp=theunit
                    set min=time
                endif
            endif
        endif
        if theunit!=null then
            set zs_NearHeroBingsLifeAlly[index]=GetHP(theunit)
        endif
        set index=index+1
    endloop
    set LC=min
    set zs_nearestMinHpAllyBing=utmp
    if GetUnitLifePercent(zs_nearestMinHpAllyBing)>90 then
        set LC=999999
        set zs_nearestMinHpAllyBing=null
    endif
    set zs_myhero_hpchanged=MyHeroHP-zs_myhero_preHP
    set zs_myhero_preHP=MyHeroHP
    set utmp=null
    set theunit=null
endfunction

function T4 takes nothing returns integer
    local integer index=0
    local real U4=999999
    local integer ri=0
    loop
        exitwhen index==20
        if isZhuGeLiang()and index<5 then
        endif
        if zs_EnemyBingNearHeros[index]==null or IsDead(zs_EnemyBingNearHeros[index])then
            set WD[index]=999999
        endif
        if WD[index]<U4 and WD[index]>0 then
            set U4=WD[index]
            set ri=index
        endif
        set index=index+1
    endloop
    return ri
endfunction

function setSecondsOfUnitsEnemy takes nothing returns nothing
    local real min=999999
    local real time=0
    local unit utmp=null
    local unit theunit=null
    local integer index=0
    local real altered=0
    local real max=0
    local integer V5=0
    if lockflag then
        return
    endif
    set DD=null
    set KC=999999
    loop
        exitwhen index==20
        set theunit=zs_EnemyBingNearHeros[index]
        if theunit!=null and GetHP(theunit)>0 and zs_NearHeroBingsLifeEnemy[index]>0 then
            set altered=absolute(zs_NearHeroBingsLifeEnemy[index]-GetHP(theunit))
            if altered==0 then
            else
                set time=GetHP(theunit)/(altered)
                if time>=BD then
                endif
            endif
            if absolute(altered)>0 then
                set time=GetHP(theunit)/(altered)
                set WD[index]=time
            endif
        endif
        if theunit!=null then
            set zs_NearHeroBingsLifeEnemy[index]=GetHP(theunit)
        endif
        set index=index+1
    endloop
    set V5=T4()
    set KC=WD[V5]
    set zs_nearestMinHpEnemyBing=zs_EnemyBingNearHeros[V5]
    if zs_nearestMinHpEnemyBing==null then
        set KC=999999
    endif
    if isZhuGeLiang()then
        if KC<5 then
        endif
    endif
    set utmp=null
    set theunit=null
endfunction

function resetParam takes nothing returns nothing
    set AllyCount=0
    set EnemyCount=0
    set ZhongliEnemyCount=0
    set zs_nearestEnemyHeroMinRange=999999
    set zs_nearestEnemyTowerMinRange=999999
    set zs_nearestAllyTowerMinRange=999999
    set ZB=999999
    set zs_FarestAllyBingMaxRange=0
    set zs_FarestAllyBingFromRetreatLocMaxRange=0
    set zs_NearestEnemyBingFromRetreatLocMinRange=9999999
    set budaobingD=null
    set budaobingW=null
    set budaobingD2=null
    set budaobingW2=null
    set UnitZhiMingJieJie=null
    set UnitYanJin=null
    set UnitSheXingJieJie=null
    set RJ=null
    set OC=9999999
    set RC=null
    set IC=0
    set AC=null
    set NC=9999999
    set BC=null
    set CC=0
    set DC=null
    set FC=9999999
    set GC=null
    set HC=0
    set JC=null
    set EnemyBingYing=null
    set EnemyNonAttackStructure=null
    set zs_mutong=null
    set BF=null
    if IsDead(NF)then
        set NF=null
    endif
    if HeroD!=null then
        if zs_IsTimeOut(96,5)then
            set HeroD=null
            set NearestHeroD=null
        endif
        if IsUnitInvisible(HeroD,ai_player)and HY(HeroD)then
            set HeroD=null
        endif
        if IsDead(HeroD)then
            set HeroD=null
        endif
    endif
    set TowerD=null
    set TowerW=null
    if IsDead(zs_nearestMinHpAllyBing)then
        set zs_nearestMinHpAllyBing=null
    endif
    if IsDead(zs_nearestMinHpEnemyBing)then
        set zs_nearestMinHpEnemyBing=null
    endif
    set NearestEnemyBubing=null
    set ZhongliEnemy=null
    set FarestAllyBubing=null
    set FarestAllyBubingFromRetreatLoc=null
    set NearestEnemyBubingFromRetreatLoc=null
    set zs_attackEnemyBing=null
    set UnitTouShiChe=null
    set RangeToTouShiChe=999999
endfunction

function X5 takes nothing returns nothing
    if IsDead(budaobingD)then
        set budaobingD=null
    endif
    if IsDead(budaobingW)then
        set budaobingW=null
    endif
    if IsDead(budaobingD2)then
        set budaobingD2=null
    endif
    if IsDead(HeroD)then
        set HeroD=null
    endif
    if IsDead(budaobingW2)then
        set budaobingW2=null
    endif
endfunction

function setAllyBingNearHero takes unit TheUnit returns nothing
    if(IsAllyBing(TheUnit))then
        if RangeTo(mHero,TheUnit)<=1200 then
            if GetHP(TheUnit)<600 and AllyCount<20 then
                set zs_AllyBingNearHeros[AllyCount]=TheUnit
            endif
            set AllyCount=AllyCount+1
        endif
        if GetHP(TheUnit)<zs_nearestAllyBingMinHp then
            set zs_nearestAllyBingMinHp=GetHP(TheUnit)
            set zs_nearestMinHpAllyBing=TheUnit
        endif
        if RangeTo(TheUnit,mHero)>zs_FarestAllyBingMaxRange then
            set zs_FarestAllyBingMaxRange=RangeTo(TheUnit,mHero)
            set FarestAllyBubing=TheUnit
        endif
    endif
endfunction

function setAllyFarestBingNearHeroFromRetreatLoc takes unit TheUnit returns nothing
    if(IsAllyBing(TheUnit))then
        if RangeToLoc(TheUnit,zs_cr_retreatLoc)>zs_FarestAllyBingFromRetreatLocMaxRange then
            set zs_FarestAllyBingFromRetreatLocMaxRange=RangeToLoc(TheUnit,zs_cr_retreatLoc)
            set FarestAllyBubingFromRetreatLoc=TheUnit
        endif
    endif
endfunction

function setEnemyNereastBingNearHeroFromRetreatLoc takes unit TheUnit returns nothing
    if(IsEnemyBing(TheUnit))then
        if RangeToLoc(TheUnit,zs_cr_retreatLoc)<zs_NearestEnemyBingFromRetreatLocMinRange then
            set zs_NearestEnemyBingFromRetreatLocMinRange=RangeToLoc(TheUnit,zs_cr_retreatLoc)
            set NearestEnemyBubingFromRetreatLoc=TheUnit
        endif
    endif
endfunction

function A5 takes nothing returns nothing
    local integer index=0
    loop
        exitwhen index==20
        if IsDead(zs_EnemyBingNearHeros[index])or RangeTo(mHero,zs_EnemyBingNearHeros[index])>1200 then
            set zs_EnemyBingNearHeros[index]=null
        endif
        set index=index+1
    endloop
endfunction

function debugenemyhp takes nothing returns nothing
    local integer index=0
    local string ds=""
    local integer count=0
    loop
        exitwhen index==20
        if zs_EnemyBingNearHeros[index]!=null then
            set count=count+1
            set ds=ds+"_id"+ITS(index)+":"+ITS(R2I(GetHP(zs_EnemyBingNearHeros[index])))
        endif
        set index=index+1
    endloop
    call debugstr(ITS(count)+"#"+ds)
endfunction

function N5 takes unit u returns integer
    local integer index=0
    local integer ri=-1
    local boolean B5=false
    loop
        exitwhen index==20
        if zs_EnemyBingNearHeros[index]==null and ri==-1 then
            set ri=index
        endif
        if zs_EnemyBingNearHeros[index]!=null then
            if zs_EnemyBingNearHeros[index]==u then
                set B5=true
            endif
        endif
        set index=index+1
    endloop
    if not B5 then
        return ri
    endif
    return-1
endfunction

function setEnemyBingNearHero takes unit TheUnit returns nothing
    local integer D5=0
    if(IsZhongliEnemyBing(TheUnit))then
        if RangeTo(mHero,TheUnit)<=800 then
            set ZhongliEnemyCount=ZhongliEnemyCount+1
            set ZhongliEnemy=TheUnit
        endif
    endif
    if IsUnitEnemy(TheUnit,ai_player)and GetUnitTypeId(TheUnit)=='orai' then
        set RJ=TheUnit
    endif
    if(IsEnemyBing(TheUnit))then
        if RangeTo(mHero,TheUnit)<=1200 then
            if GetHP(TheUnit)<800 then
                set D5=N5(TheUnit)
                if D5>-1 then
                    set zs_EnemyBingNearHeros[D5]=TheUnit
                    set zs_NearHeroBingsLifeEnemy[D5]=GetHP(TheUnit)
                    set WD[D5]=999999
                endif
            endif
        endif
        if IsUnitAlive(TheUnit) and RangeTo(mHero,TheUnit)<=1200 and GetUnitTypeId(TheUnit)!=uid_toushiche then
            set EnemyCount=EnemyCount+1
        endif
        if RangeTo(TheUnit,mHero)<ZB and GetUnitTypeId(TheUnit)!=uid_toushiche then
            set ZB=RangeTo(TheUnit,mHero)
            set NearestEnemyBubing=TheUnit
        endif
        if GetHP(TheUnit)>ND and(zs_attackEnemyBing==null or RangeTo(TheUnit,mHero)<RangeTo(zs_attackEnemyBing,mHero))then
            if not isZhongLiEnemy(TheUnit)then
                set zs_nearestEnemyBingMinHp=GetHP(TheUnit)
                set zs_attackEnemyBing=TheUnit
            endif
        endif
        if GetUnitTypeId(TheUnit)==uid_toushiche and RangeTo(mHero,TheUnit)<RangeToTouShiChe then
            set UnitTouShiChe=TheUnit
            set RangeToTouShiChe=RangeTo(mHero,TheUnit)
        endif
    endif
endfunction

function F5 takes unit TheUnit returns nothing
    if IsUnitEnemy(TheUnit,ai_player)and IsAlive(TheUnit)then
        if GetUnitTypeId(TheUnit)==uid_zhimingjiejieLv1 or GetUnitTypeId(TheUnit)==uid_zhimingjiejieLv2 or GetUnitTypeId(TheUnit)==uid_zhimingjiejieLv3 or GetUnitTypeId(TheUnit)==uid_zhimingjiejieLv4 then
            set UnitZhiMingJieJie=TheUnit
        endif
        if GetUnitTypeId(TheUnit)==uid_yanjing then
            set UnitYanJin=TheUnit
        endif
        if GetUnitTypeId(TheUnit)==uid_shexingjiejieLv1 or GetUnitTypeId(TheUnit)==uid_shexingjiejieLv2 or GetUnitTypeId(TheUnit)==uid_shexingjiejieLv3 then
            set UnitSheXingJieJie=TheUnit
        endif
    endif
endfunction

function setEnemyTowerNearHero takes unit TheUnit returns nothing
    if(IsEnemyTower(TheUnit))then
        if RangeTo(TheUnit,mHero)<zs_nearestEnemyTowerMinRange then
            set zs_nearestEnemyTowerMinRange=RangeTo(TheUnit,mHero)
            set TowerD=TheUnit
        endif
    endif
endfunction

function setAllyTowerNearHero takes unit TheUnit returns nothing
    if(IsAllyTower(TheUnit))then
        if RangeTo(TheUnit,mHero)<zs_nearestAllyTowerMinRange then
            set zs_nearestAllyTowerMinRange=RangeTo(TheUnit,mHero)
            set TowerW=TheUnit
        endif
    endif
endfunction

function setEnemyHeroNearMyHero takes unit TheUnit returns nothing
    if(IsUnitHero(TheUnit)and IsUnitEnemy(TheUnit,ai_player)and(not IsUnitHidden(TheUnit)))then
        if RangeTo(TheUnit,mHero)<zs_nearestEnemyHeroMinRange then
            set zs_nearestEnemyHeroMinRange=RangeTo(TheUnit,mHero)
            set NearestHeroD=TheUnit
        endif
    endif
endfunction

function setEnemyNonAttackStructureNearMyHero takes unit TheUnit returns nothing
    if(IsUnitEnemy(TheUnit,ai_player)and IsAlive(TheUnit)and IsUnitVisible(TheUnit,ai_player))then
        if RangeTo(TheUnit,mHero)<1300 then
            if GetUnitTypeId(TheUnit)==uid_chuanzhang then
                set BF=TheUnit
            endif
        endif
        if RangeTo(TheUnit,mHero)<1300 then
            if GetUnitTypeId(TheUnit)==uid_judian or GetUnitTypeId(TheUnit)==uid_benzhen or GetUnitTypeId(TheUnit)==uid_bingying or GetUnitTypeId(TheUnit)==uid_liangcang then
                set EnemyNonAttackStructure=TheUnit
            endif
            if GetUnitTypeId(TheUnit)==uid_benzhen or GetUnitTypeId(TheUnit)==uid_bingying then
                set EnemyBingYing=TheUnit
            endif
            if GetUnitTypeId(TheUnit)==uid_ShangLuMutong or GetUnitTypeId(TheUnit)==uid_XiaLuMutong then
                set zs_mutong=TheUnit
            endif
        endif
    endif
endfunction

function initUnitsArrayNearHero takes nothing returns nothing
    local integer index=0
    loop
        exitwhen index==20
        set zs_EnemyBingNearHeros[index]=null
        set zs_AllyBingNearHeros[index]=null
        set index=index+1
    endloop
endfunction

function enumUnitsNearMyHero takes nothing returns nothing
    local unit u=null
    local group NearestEnemyBubing=CreateGroup()
    local integer i=0
    call GroupEnumUnitsInRange(NearestEnemyBubing,GetUnitX(mHero),GetUnitY(mHero),zs_gardRange,null)
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if(IsAlive(u)and CanAttack(u))then
            if not IsUnitInvisible(u,ai_player)then
                call setAllyBingNearHero(u)
                call setEnemyHeroNearMyHero(u)
                call setAllyTowerNearHero(u)
                call setAllyFarestBingNearHeroFromRetreatLoc(u)
            endif
            call setEnemyNereastBingNearHeroFromRetreatLoc(u)
            call setEnemyBingNearHero(u)
            call setEnemyTowerNearHero(u)
        endif
        if(IsAlive(u))then
            call setEnemyNonAttackStructureNearMyHero(u)
        endif
        call F5(u)
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    set u=null
endfunction

function HeroBuyItem takes unit whichHero,integer shopid,integer Itemid returns integer
    local integer ri=0
    local boolean bbuyed=false
    local boolean isnearby=false
    local location Loc=null
    local unit shop=null
    set shop=getUnitByid(shopid,mBaseLoc,8888)
    if shopid==uid_zhonglishangdian then
        set shop=UH
    endif
    if shop!=null then
        set Loc=GetUnitLoc(shop)
        set isnearby=gotoLocation(whichHero,Loc,SN)
        call RemoveLocation(Loc)
        set Loc=null
        if(isnearby)then
            set ri=1
            set bbuyed=BuyItem_im(shop,Itemid,whichHero)
            set shop=null
        endif
    else
        call debugstr("no Itemshop found")
    endif
    if bbuyed then
        set ri=2
    endif
    set shop=null
    return ri
endfunction

function HeroBuyItemGuWuDian takes unit whichHero,integer Itemid returns boolean
    local boolean bbuyed=false
    local boolean isnearby=false
    local location Loc=null
    local unit shop=null
    set shop=getUnitByid('u005',mBaseLoc,8888)
    if shop!=null then
        if mForceId==2 and RangeTo(mHero,shop)>RangeToLoc(mHero,zs_weiguoBuyItemZhongliLoc)then
            set isnearby=gotoLocation(whichHero,zs_weiguoBuyItemZhongliLoc,26)
        else
            set Loc=GetUnitLoc(shop)
            set isnearby=gotoLocation(whichHero,Loc,SN)
            call RemoveLocation(Loc)
            set Loc=null
        endif
        if(isnearby)then
            if RangeToLoc(whichHero,zs_weiguoBuyItemZhongliLoc)<200 then
                call SetUnitPositionLoc(whichHero,zs_weiguoBuyItemZhongliLoc)
            endif
            set bbuyed=BuyItem_im(shop,Itemid,whichHero)
            set shop=null
        endif
    endif
    if bbuyed then
    endif
    set shop=null
    return bbuyed
endfunction

function getfirstHeroOfPlayer takes player p returns unit
    local unit u=null
    local unit ru=null
    local group NearestEnemyBubing=CreateGroup()
    call GroupEnumUnitsOfPlayer(NearestEnemyBubing,p,null)
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null or ru!=null
        if(IsUnitType(u,UNIT_TYPE_HERO) and GetUnitUserData(u)<100)then
            set ru=u
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    set u=null
    return ru
endfunction

function V6 takes unit u returns integer
    if not IsRangeAttacker(u)then
        return 2
    endif
    if IsRangeAttacker(u)then
        if GetHeroInt(u,false)>GetHeroAgi(u,false)then
            return 0
        else
            return 1
        endif
    endif
    return 0
endfunction

function getfirstHero takes nothing returns unit
    local unit ru=getfirstHeroOfPlayer(ai_player)
    if(ru!=null)then
        set mHero=ru
        set mHeroId=GetUnitTypeId(mHero)
        if iscaoren()then
            set zs_caoren=ru
        endif
        set FG=V6(mHero)
        call setItemCanUse(mHero,false)
        call UnitRemoveAbility(mHero,'A088')
        call initSkillArry()
        call SetUnitAcquireRange(mHero,60)
        call setFightLine()
        // if not XH then
            // call setAIPlayerName()
        // endif
        call setAttackRange()
        call T0()
    endif
    return ru
endfunction

function ControlHero takes unit u returns boolean
    if u==null or IsDead(u)then
        return false
    endif
    if zs_CCPlayerID>-1 then
        return false
    endif
    set zs_CCPlayerID=GetPlayerId(GetOwningPlayer(u))
    set mHero=u
    set ai_player=GetOwningPlayer(u)
    set mHeroId=GetUnitTypeId(mHero)
    set FG=V6(mHero)
    call setItemCanUse(mHero,false)
    call UnitRemoveAbility(mHero,'A088')
    call initSkillArry()
    call SetUnitAcquireRange(mHero,60)
    call setFightLine()
    call setAttackRange()
    call X0(mHero)
    return true
endfunction

function ReleaseHero takes integer index returns nothing
    local integer i=0
    if mHero==null or IsDead(mHero)then
        return
    endif
    if zs_CCPlayerID!=index then
        return
    endif
    if isZhuGeLiang()then
        call UnitAddAbility(mHero,'A088')
    endif
    call setItemCanUse(mHero,true)
    call SetUnitAcquireRange(mHero,600)
    call ItemToUseStateAll(mHero)
    call SetItemCharges(GetItemByID(mHero,iid_xuanwufu),0)
    call SetItemCharges(GetItemByID(mHero,'ssan'),0)
    loop
        exitwhen i>24 or mSkillArray[i]==null
        call SetPlayerAbilityAvailable(ai_player,mSkillArray[i],true)
        set i=i+1
    endloop
    set zs_CCPlayerID=-1
endfunction

function getGSOfPlayer takes player p returns unit
    local unit u=null
    local unit ru=null
    local group NearestEnemyBubing=CreateGroup()
    call GroupEnumUnitsOfPlayer(NearestEnemyBubing,p,null)
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null or ru!=null
        if(IsImmune(u)and IsNotHero(u)and UnitHasBuffsEx(u,false,false,false,false,true,false,false))then
            set ru=u
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    set u=null
    return ru
endfunction

function setHeroArry takes nothing returns nothing
    local integer index
    local player indexPlayer=null
    local integer ially=0
    local integer ienemy=0
    local unit utmp=null
    if gm_AllyHeroCount+gm_EnemyHeroCount>=gm_all_PlayerCount and gm_all_PlayerCount>0 then
        return
    endif
    set index=1
    set gm_all_PlayerCount=0
    loop
        set indexPlayer=Player(index)
        if((GetPlayerSlotState(indexPlayer)==PLAYER_SLOT_STATE_PLAYING)and(index!=6))then
            set gm_all_PlayerCount=gm_all_PlayerCount+1
            set utmp=getfirstHeroOfPlayer(indexPlayer)
            if utmp!=null then
                if IsPlayerAlly(ai_player,indexPlayer)then
                    set zs_AllyHeros[ially]=utmp
                    set ially=ially+1
                else
                    set zs_EnemyHeros[ienemy]=utmp
                    set ienemy=ienemy+1
                endif
            endif
        endif
        set index=index+1
        exitwhen index==12
    endloop
    set gm_AllyHeroCount=ially
    set gm_EnemyHeroCount=ienemy
    set indexPlayer=null
    set utmp=null
endfunction

function setHeroCountNearMe takes nothing returns nothing
    local integer index=0
    set zs_AllyHeroNearMeCount=0
    set zs_EnemyHeroNearMeCount=0
    set zs_allyHeroToHeroDMinRange=999999
    set zs_AllyHeroNearestToHeroD=null
    set zs_AllyHeroNearestToMe=null
    set zs_allyHeroToMeMinRange=999999
    set LowestEnemyHeroHp=999999
    set zs_weakestEnemyHero=null
    set ShangluEnemyCount=0
    set ZhongluEnemyCount=0
    set XialuEnemyCount=0
    set ShangluAllyCount=0
    set ZhongluAllyCount=0
    set XialuAllyCount=0
    set ShangluAllyHeroCountNearFL=0
    set ZhongluAllyHeroCountNearFL=0
    set XialuAllyHeroCountNearFL=0
    set ShangluEnemyHeroCountNearFL=0
    set ZhongluEnemyHeroCountNearFL=0
    set XialuEnemyHeroCountNearFL=0
    loop
        exitwhen index==6
        if zs_AllyHeros[index]!=null and UnitAlive(zs_AllyHeros[index])and zs_AllyHeros[index]!=mHero then
            if((RangeTo(mHero,zs_AllyHeros[index])<1200)or(HeroD!=null and RangeTo(HeroD,zs_AllyHeros[index])<1300)or(NearestHeroD!=null and RangeTo(NearestHeroD,zs_AllyHeros[index])<1300))and GetHP(zs_AllyHeros[index])>EH then
                set zs_AllyHeroNearMeCount=zs_AllyHeroNearMeCount+1
            endif
            if isUnitInShanglu(zs_AllyHeros[index])then
                set ShangluAllyCount=ShangluAllyCount+1
            endif
            if isUnitInMiddleLine(zs_AllyHeros[index])then
                set ZhongluAllyCount=ZhongluAllyCount+1
            endif
            if isUnitInXiaLu(zs_AllyHeros[index])then
                set XialuAllyCount=XialuAllyCount+1
            endif
            if RangeToLoc(zs_AllyHeros[index],zs_firelines[0])<2000 then
                set ShangluAllyHeroCountNearFL=ShangluAllyHeroCountNearFL+1
            endif
            if RangeToLoc(zs_AllyHeros[index],zs_firelines[1])<2000 then
                set ZhongluAllyHeroCountNearFL=ZhongluAllyHeroCountNearFL+1
            endif
            if RangeToLoc(zs_AllyHeros[index],zs_firelines[2])<2000 then
                set XialuAllyHeroCountNearFL=XialuAllyHeroCountNearFL+1
            endif
            if HeroD!=null and RangeTo(HeroD,zs_AllyHeros[index])<zs_allyHeroToHeroDMinRange then
                set zs_allyHeroToHeroDMinRange=RangeTo(HeroD,zs_AllyHeros[index])
                set zs_AllyHeroNearestToHeroD=zs_AllyHeros[index]
            endif
            if RangeTo(mHero,zs_AllyHeros[index])<zs_allyHeroToMeMinRange then
                set zs_allyHeroToMeMinRange=RangeTo(mHero,zs_AllyHeros[index])
                set zs_AllyHeroNearestToMe=zs_AllyHeros[index]
            endif
        endif
        if zs_EnemyHeros[index]!=null and UnitAlive(zs_EnemyHeros[index])then
            if RangeTo(mHero,zs_EnemyHeros[index])<1300 then
                set zs_EnemyHeroNearMeCount=zs_EnemyHeroNearMeCount+1
            endif
            if isUnitInShanglu(zs_EnemyHeros[index])then
                set ShangluEnemyCount=ShangluEnemyCount+1
            endif
            if isUnitInMiddleLine(zs_EnemyHeros[index])then
                set ZhongluEnemyCount=ZhongluEnemyCount+1
            endif
            if isUnitInXiaLu(zs_EnemyHeros[index])then
                set XialuEnemyCount=XialuEnemyCount+1
            endif
            if RangeToLoc(zs_EnemyHeros[index],zs_firelines[0])<2000 then
                set ShangluEnemyHeroCountNearFL=ShangluEnemyHeroCountNearFL+1
            endif
            if RangeToLoc(zs_EnemyHeros[index],zs_firelines[1])<2000 then
                set ZhongluEnemyHeroCountNearFL=ZhongluEnemyHeroCountNearFL+1
            endif
            if RangeToLoc(zs_EnemyHeros[index],zs_firelines[2])<2000 then
                set XialuEnemyHeroCountNearFL=XialuEnemyHeroCountNearFL+1
            endif
            if GetHP(zs_EnemyHeros[index])<LowestEnemyHeroHp then
                set LowestEnemyHeroHp=GetHP(zs_EnemyHeros[index])
                set zs_weakestEnemyHero=zs_EnemyHeros[index]
            endif
        endif
        set index=index+1
    endloop
endfunction

function D6 takes unit TheUnit returns unit
    local integer index=0
    local real F6=999999
    local unit ru=null
    local unit G6=null
    loop
        exitwhen index==6
        if IsUnitEnemy(TheUnit,ai_player)then
            set G6=zs_AllyHeros[index]
            if G6!=null and UnitAlive(G6)then
                if RangeTo(TheUnit,G6)<F6 then
                    set ru=G6
                    set F6=RangeTo(TheUnit,G6)
                endif
            endif
        endif
        if not IsUnitEnemy(TheUnit,ai_player)then
            set G6=zs_EnemyHeros[index]
            if G6!=null and UnitAlive(G6)then
                if RangeTo(TheUnit,G6)<F6 then
                    set ru=G6
                    set F6=RangeTo(TheUnit,G6)
                endif
            endif
        endif
        set index=index+1
    endloop
    set G6=null
    return ru
endfunction

function H6 takes unit TheUnit returns unit
    local integer index=0
    local real F6=999999
    local unit ru=null
    local unit G6=null
    loop
        exitwhen index==6
        if not IsUnitEnemy(TheUnit,ai_player)then
            set G6=zs_AllyHeros[index]
            if G6!=null and UnitAlive(G6)and G6!=TheUnit then
                if RangeTo(TheUnit,G6)<F6 then
                    set ru=G6
                    set F6=RangeTo(TheUnit,G6)
                endif
            endif
        endif
        if IsUnitEnemy(TheUnit,ai_player)then
            set G6=zs_EnemyHeros[index]
            if G6!=null and UnitAlive(G6)and G6!=TheUnit then
                if RangeTo(TheUnit,G6)<F6 then
                    set ru=G6
                    set F6=RangeTo(TheUnit,G6)
                endif
            endif
        endif
        set index=index+1
    endloop
    set G6=null
    return ru
endfunction

function J6 takes location TheLoc,real TheRange returns integer
    local integer index=0
    local integer count=0
    local unit G6=null
    loop
        exitwhen index==6
        set G6=zs_EnemyHeros[index]
        if G6!=null and UnitAlive(G6)then
            if RangeToLoc(G6,TheLoc)<TheRange then
                set count=count+1
            endif
        endif
        set index=index+1
    endloop
    return count
endfunction

function K6 takes unit theunit,real TheRange returns integer
    local integer index=0
    local integer count=0
    local unit G6=null
    loop
        exitwhen index==6
        set G6=zs_EnemyHeros[index]
        if G6!=null and UnitAlive(G6)then
            if RangeTo(G6,theunit)<TheRange then
                set count=count+1
            endif
        endif
        set index=index+1
    endloop
    return count
endfunction

function L6 takes unit theunit,real TheRange returns integer
    local integer index=0
    local integer count=0
    local unit G6=null
    loop
        exitwhen index==6
        set G6=zs_AllyHeros[index]
        if G6!=null and UnitAlive(G6)then
            if RangeTo(G6,theunit)<TheRange then
                set count=count+1
            endif
        endif
        set index=index+1
    endloop
    set G6=null
    return count
endfunction

function M6 takes nothing returns nothing
    local integer index=0
    local real P6=999999
    loop
        exitwhen index==6
        if zs_AllyHeros[index]!=null and UnitAlive(zs_AllyHeros[index])and zs_AllyHeros[index]!=mHero then
        endif
        if zs_EnemyHeros[index]!=null and UnitAlive(zs_EnemyHeros[index])and not IsUnitInvisible(zs_EnemyHeros[index],ai_player)then
            if RangeTo(mHero,zs_EnemyHeros[index])<1000 and(not IsUnitHidden(zs_EnemyHeros[index]))then
                if GetHP(zs_EnemyHeros[index])<P6 then
                    set P6=GetHP(zs_EnemyHeros[index])
                    set HeroD=zs_EnemyHeros[index]
                endif
            endif
        endif
        set index=index+1
    endloop
endfunction

function isZhugeCastingE takes nothing returns boolean
    if not IsUnitEnemy(PG,ai_player)then
        return false
    endif
    return UG==852592and GetUnitTypeId(PG)==hid_zhugeliang
endfunction

function isZhugeCastingX takes nothing returns boolean
    if not IsUnitEnemy(PG,ai_player)then
        return false
    endif
    return UG==852127 and GetUnitTypeId(PG)==hid_zhugeliang
endfunction

function T6 takes nothing returns boolean
    if not IsUnitEnemy(PG,ai_player)then
        return false
    endif
    return UG==852224 and GetUnitTypeId(PG)==hid_simayi
endfunction

function U6 takes nothing returns boolean
    if not IsUnitEnemy(PG,ai_player)then
        return false
    endif
    if UG==852127and RangeTo(mHero,PG)<280 then
        return true
    endif
    return false
endfunction

function W6 takes nothing returns boolean
    if PG==null then
        return false
    endif
    if RangeTo(mHero,PG)>800 then
        return false
    endif
    if not IsUnitEnemy(PG,ai_player)then
        return false
    endif
    if UG==852555and QG==mHero then
        return true
    endif
    if UG==852127and RangeTo(mHero,PG)<280 then
        return true
    endif
    if UG==852095and QG==mHero then
        return true
    endif
    if UG==852592and GetUnitTypeId(PG)==hid_zhugeliang then
        return true
    endif
    return false
endfunction

function Y6 takes nothing returns boolean
    if PG==null then
        return false
    endif
    if RangeTo(mHero,PG)>1100 then
        return false
    endif
    if not IsUnitEnemy(PG,ai_player)then
        return false
    endif
    if isZhugeCastingX()or T6()then
        return true
    endif
    if UG==852504and GetUnitTypeId(PG)==hid_xun then
        return true
    endif
    if UG==852555and GetUnitTypeId(PG)==hid_guojia then
        return true
    endif
    return false
endfunction

function Z6 takes nothing returns boolean
    return(isZhugeCastingX()or T6())or(UG==852504and GetUnitTypeId(PG)==hid_xun)or(UG==852555and GetUnitTypeId(PG)==hid_guojia)or(isZhaoYunHasB(NearestHeroD)and EnemyHeroHP>300 and IsImmune(NearestHeroD))or(IsImmune(NearestHeroD)and GetUnitTypeId(NearestHeroD)==hid_guanyu and RangeTo(NearestHeroD,mHero)<300)
endfunction

function BuyHero takes integer shopid,integer heroid returns boolean
    local unit shop=getUnitByid(shopid,mBaseLoc,9999999)
    local boolean bgeted=false
    if shop==null then
        return false
    endif
    set bgeted=IssueNeutralImmediateOrderById(ai_player,shop,heroid)
    if(bgeted)then
        call getfirstHero()
    endif
    set shop=null
    return bgeted
endfunction

function buyDueNumberOfItem takes integer shopid,integer itemid,integer num returns nothing
    local integer itmp=0
    local integer ibuyed=0
    local integer i=0
    loop
        exitwhen itmp==num or i==20
        set ibuyed=HeroBuyItem(mHero,shopid,itemid)
        if ibuyed==2 then
            set itmp=itmp+1
            call Sleep(.5)
        endif
        call Sleep(.3)
        if ibuyed==1 then
            set i=i+1
        endif
    endloop
endfunction

function buyDueNumberOfItem2 takes integer itemid,integer num returns nothing
    local integer itmp=0
    local boolean b=false
    loop
        exitwhen itmp==num
        set b=HeroBuyItemGuWuDian(mHero,itemid)
        if b then
            set itmp=itmp+1
            call Sleep(1)
        endif
        call Sleep(.3)
    endloop
endfunction

function sellItemById takes integer shopid,integer itemid returns boolean
    local unit shop=null
    local location Loc=null
    if GetNumberOfItemByID(mHero,itemid)==0 then
        return false
    endif
    set shop=getUnitByid(shopid,mBaseLoc,8888)
    if shop==null then
        return false
    endif
    set Loc=GetUnitLoc(shop)
    call ariveLoc(mHero,Loc,200)
    call RemoveLocation(Loc)
    set Loc=null
    if GiveItemByID(mHero,itemid,shop)then
        set shop=null
        return true
    endif
    set shop=null
    return false
endfunction

function dropItem takes integer slotIndex,unit Target returns item
    local item item5=UnitItemInSlot(mHero,slotIndex)
    local boolean rb=false
    if item5==null then
        return null
    endif
    set rb=UnitDropItemPoint(mHero,item5,GetUnitX(Target),GetUnitY(Target))
    call Sleep(.5)
    if rb then
        call SetItemPlayer(item5,ai_player,false)
        call SetItemDropID(item5,GetUnitTypeId(mHero))
        return item5
    endif
    return null
endfunction

function dropAllItems takes unit Target returns nothing
    local integer i=3
    local location Loc=null
    if Target==null then
        return
    endif
    set Loc=GetUnitLoc(Target)
    call ariveLoc(mHero,Loc,400)
    call RemoveLocation(Loc)
    set Loc=null
    loop
        exitwhen i==6
        set HeroItems[i]=dropItem(i,mHero)
        set i=i+1
    endloop
endfunction

function PickAllItems takes nothing returns nothing
    local integer i=3
    loop
        exitwhen i==6
        call PickItem(mHero,HeroItems[i])
        set i=i+1
    endloop
endfunction

function sellLowPrice takes nothing returns nothing
    if sellItemById('n00R','I01R')then
        return
    endif
    if sellItemById('n00R','pclr')then
        return
    endif
    if sellItemById('n00R','rde1')then
        return
    endif
    if sellItemById('n00R','rst1')then
        return
    endif
    if sellItemById('n00R','I004')then
        return
    endif
    if sellItemById('n00R','hslv')then
        return
    endif
    if sellItemById('n00R','sor2')then
        return
    endif
    if sellItemById('n00R',iid_fashichangpao)then
        return
    endif
endfunction

function can_buy_xie takes nothing returns boolean
    return(mGold>=500 and GetNumberOfItemByID(mHero,'bspd')<1 and GetNumberOfItemByID(mHero,'desc')<1)
endfunction

function can_BuyItems_fashi takes nothing returns boolean
    local unit shop=null
    local item tempDroped=null
    local boolean rb=false
    if GetSlotsFreeOnUnit(mHero)==6 then
        set rb=true
    endif
    set mGold=GetPlayerGold(ai_player)
    set lumber=GetPlayerWood(ai_player)
    if mGold>=500 and GetNumberOfItemByID(mHero,'bspd')<1 and GetNumberOfItemByID(mHero,'desc')<1 then
        set rb=true
    endif
    if mGold>=55 and GetItemChargesById(mHero,'hslv')<4 then
        set rb=true
        call debugstr("can-buy- hp")
    endif
    if mGold>=45 and GetNumberOfItemByID(mHero,'I01S')<1 and GetItemChargesById(mHero,'sneg')<1 and GetNumberOfItemByID(mHero,'ssan')<1 and GetItemChargesById(mHero,'pclr')<3 then
        set rb=true
        call debugstr("can-buy- mp")
    endif
    if mGold>=505 and GetNumberOfItemByID(mHero,'I004')<2 and(GetNumberOfItemByID(mHero,'sneg')>0 or GetNumberOfItemByID(mHero,'ssan')>0)then
        if GetSlotsFreeOnUnit(mHero)<1 then
            if GetNumberOfItemByID(mHero,'I01R')>0 or GetNumberOfItemByID(mHero,'pclr')>0 then
                set rb=true
                call debugstr("can-buy- liliang")
            endif
        endif
        if GetSlotsFreeOnUnit(mHero)>0 then
            call debugstr("can-buy- liliang")
            set rb=true
        endif
    endif
    if mGold>=1050 and GetNumberOfItemByID(mHero,'wneg')<1 and GetNumberOfItemByID(mHero,'sneg')<1 and GetNumberOfItemByID(mHero,'ssan')<1 then
        set rb=true
        call debugstr("can-buy- fujue")
    endif
    if mGold>=950 and GetNumberOfItemByID(mHero,'I01S')<1 and GetNumberOfItemByID(mHero,'sneg')<1 and GetNumberOfItemByID(mHero,'ssan')<1 then
        set rb=true
        call debugstr("can-buy- huodan")
    endif
    if mGold>=450 and GetNumberOfItemByID(mHero,'I01S')>0 and GetNumberOfItemByID(mHero,'wneg')>0 then
        call debugstr("can-buy- fengzhang")
        set rb=true
    endif
    if mGold>=2350 and GetNumberOfItemByID(mHero,'bspd')>0 and GetNumberOfItemByID(mHero,'desc')<1 then
        call debugstr("can-buy- feixie")
        set rb=true
    endif
    if mGold>=1100 and GetNumberOfItemByID(mHero,'I00F')<1 and GetNumberOfItemByID(mHero,'sneg')>0 and GetNumberOfItemByID(mHero,'ssan')<1 then
        set rb=true
        call debugstr("can-buy- zhuanshi")
    endif
    if mGold>=950 and GetNumberOfItemByID(mHero,'I01S')<1 and GetNumberOfItemByID(mHero,'I00F')>0 and GetNumberOfItemByID(mHero,'sneg')>0 and GetNumberOfItemByID(mHero,'ssan')<1 then
        set rb=true
        call debugstr("can-buy- huodan2")
    endif
    if mGold>=900 and GetNumberOfItemByID(mHero,'I01S')>0 and GetNumberOfItemByID(mHero,'I00F')>0 and GetNumberOfItemByID(mHero,'sneg')>0 then
        call debugstr("can-buy- bianyang")
        set rb=true
    endif
    if mGold>=1700 and GetNumberOfItemByID(mHero,'I00U')<1 and GetNumberOfItemByID(mHero,'I010')<1 then
        set rb=true
        call debugstr("can-buy- 1700")
    endif
    if mGold>=3200 and GetNumberOfItemByID(mHero,'I001')<1 and GetNumberOfItemByID(mHero,'I010')<1 then
        set rb=true
        call debugstr("can-buy- 3200")
    endif
    if mGold>=1350 and GetNumberOfItemByID(mHero,'I001')>0 and GetNumberOfItemByID(mHero,'I00U')>0 then
        call debugstr("can-buy- 1350")
        set rb=true
    endif
    set shop=null
    set tempDroped=null
    return rb
endfunction

function zs_buyHiItem takes integer gold,integer shopid,integer itemid,integer enditemid returns nothing
    set mGold=GetPlayerGold(ai_player)
    if mGold<gold or GetNumberOfItemByID(mHero,itemid)>0 or(enditemid>0 and GetNumberOfItemByID(mHero,enditemid)>0)then
        return
    endif
    if GetSlotsFreeOnUnit(mHero)<1 then
        call sellLowPrice()
    endif
    if GetSlotsFreeOnUnit(mHero)>0 then
        call buyDueNumberOfItem(shopid,itemid,1)
    endif
endfunction

function P7 takes integer gold,integer Q7 returns boolean
    set mGold=GetPlayerGold(ai_player)
    if mGold<=gold then
        return false
    endif
    if not UnitDropItemSlot(mHero,GetItemByID(mHero,Q7),0)then
        call UnitDropItemSlot(mHero,GetItemByID(mHero,Q7),1)
    endif
    call dropAllItems(mHero)
    return true
endfunction

function zs_buyHiItemMxNum takes integer gold,integer itemid,integer enditemid returns nothing
    set mGold=GetPlayerGold(ai_player)
    if mGold<gold or GetNumberOfItemByID(mHero,itemid)>0 or GetNumberOfItemByID(mHero,enditemid)>0 then
        return
    endif
    if GetSlotsFreeOnUnit(mHero)<1 then
        call sellLowPrice()
    endif
    if GetSlotsFreeOnUnit(mHero)>0 then
        call buyDueNumberOfItem2(itemid,1)
    endif
endfunction

function zs_buyshu takes integer gold,integer reqid1,integer reqid2,integer reqid3,integer shopid,integer shuid returns nothing
    local boolean canbuy=true
    local item tempDroped=null
    set mGold=GetPlayerGold(ai_player)
    if mGold<gold then
        return
    endif
    if reqid1>0 then
        set canbuy=canbuy and GetNumberOfItemByID(mHero,reqid1)>0
        if not UnitDropItemSlot(mHero,GetItemByID(mHero,reqid1),0)then
            call UnitDropItemSlot(mHero,GetItemByID(mHero,reqid1),4)
        endif
        call Sleep(.1)
    endif
    if reqid2>0 then
        set canbuy=canbuy and GetNumberOfItemByID(mHero,reqid2)>0
        if not UnitDropItemSlot(mHero,GetItemByID(mHero,reqid2),1)then
            call UnitDropItemSlot(mHero,GetItemByID(mHero,reqid2),4)
        endif
        call Sleep(.1)
    endif
    if reqid3>0 then
        set canbuy=canbuy and GetNumberOfItemByID(mHero,reqid3)>0
        if not UnitDropItemSlot(mHero,GetItemByID(mHero,reqid3),2)then
            call UnitDropItemSlot(mHero,GetItemByID(mHero,reqid3),4)
        endif
        call Sleep(.1)
    endif
    if canbuy then
        set zs_buyitemtmpshop=getUnitByid(shopid,mBaseLoc,8888)
        call ariveUnit(mHero,zs_buyitemtmpshop,400)
        set tempDroped=dropItem(5,mHero)
        if GetSlotsFreeOnUnit(mHero)>0 then
            call buyDueNumberOfItem(shopid,shuid,1)
        endif
        if tempDroped!=null then
            call PickItem(mHero,tempDroped)
        endif
    endif
endfunction

function zs_buyxie takes nothing returns nothing
    set mGold=GetPlayerGold(ai_player)
    if mGold>=500 and GetNumberOfItemByID(mHero,'bspd')<1 and GetNumberOfItemByID(mHero,'desc')<1 then
        if GetSlotsFreeOnUnit(mHero)<1 then
            call sellItemById('n00S','I01R')
        endif
        if GetSlotsFreeOnUnit(mHero)>0 then
            call buyDueNumberOfItem('n00S','bspd',1)
        endif
    endif
endfunction

function zs_buyHong takes integer num returns nothing
    local item tempDroped=null
    set mGold=GetPlayerGold(ai_player)
    if mGold>=55 and GetItemChargesById(mHero,'hslv')<num then
        if GetSlotsFreeOnUnit(mHero)>0 then
            call buyDueNumberOfItem('n013','hslv',1)
        else
            if GetSlotsFreeOnUnit(mHero)<1 and GetNumberOfItemByID(mHero,'hslv')>0 then
                set zs_buyitemtmpshop=getUnitByid('n013',mBaseLoc,8888)
                call ariveUnit(mHero,zs_buyitemtmpshop,400)
                call UnitDropItemSlot(mHero,GetItemByID(mHero,'hslv'),4)
                set tempDroped=dropItem(5,mHero)
                if GetSlotsFreeOnUnit(mHero)>0 then
                    call buyDueNumberOfItem('n013','hslv',1)
                endif
            endif
            if GetSlotsFreeOnUnit(mHero)<1 and GetNumberOfItemByID(mHero,'hslv')<1 then
                if GetNumberOfItemByID(mHero,'I01R')>0 or GetNumberOfItemByID(mHero,'pclr')>0 or GetNumberOfItemByID(mHero,'rde1')>0 or GetNumberOfItemByID(mHero,'rst1')>0 then
                    if(sellItemById('n013','I01R')or sellItemById('n013','pclr')or sellItemById('n013','rde1')or sellItemById('n013','rst1'))then
                        if GetSlotsFreeOnUnit(mHero)>0 then
                            call buyDueNumberOfItem('n013','hslv',1)
                        endif
                    endif
                endif
            endif
            if tempDroped!=null then
                call PickItem(mHero,tempDroped)
            endif
        endif
    endif
endfunction

function zs_buyLan takes integer num returns nothing
    local item tempDroped=null
    set mGold=GetPlayerGold(ai_player)
    if mGold>=45 and GetNumberOfItemByID(mHero,'I01S')<1 and GetItemChargesById(mHero,'sneg')<1 and GetNumberOfItemByID(mHero,'ssan')<1 and GetItemChargesById(mHero,'pclr')<num then
        if GetSlotsFreeOnUnit(mHero)<1 and GetNumberOfItemByID(mHero,'pclr')>0 then
            set zs_buyitemtmpshop=getUnitByid('n013',mBaseLoc,8888)
            call ariveUnit(mHero,zs_buyitemtmpshop,400)
            call UnitDropItemSlot(mHero,GetItemByID(mHero,'pclr'),4)
            set tempDroped=dropItem(5,mHero)
        endif
        if GetSlotsFreeOnUnit(mHero)<1 and GetNumberOfItemByID(mHero,'pclr')<1 then
            if GetNumberOfItemByID(mHero,'I01R')>0 then
                call sellItemById('n00S','I01R')
            endif
        endif
        if GetSlotsFreeOnUnit(mHero)>0 then
            call buyDueNumberOfItem('n013','pclr',1)
        endif
        if tempDroped!=null then
            call PickItem(mHero,tempDroped)
        endif
    endif
endfunction

function zs_buyshuzhi takes integer num returns nothing
    set mGold=GetPlayerGold(ai_player)
    if mGold>=50 and GetNumberOfItemByID(mHero,'I01R')<num then
        if GetSlotsFreeOnUnit(mHero)>0 then
            call buyDueNumberOfItem('n00R','I01R',1)
        endif
    endif
endfunction

function zs_buylilianquantaoNum takes integer num returns nothing
    set mGold=GetPlayerGold(ai_player)
    if mGold>=150 and GetNumberOfItemByID(mHero,'rst1')<num then
        if GetNumberOfItemByID(mHero,'I01R')>0 and GetSlotsFreeOnUnit(mHero)<1 then
            call sellItemById('n003','I01R')
        endif
        if GetSlotsFreeOnUnit(mHero)>0 then
            call buyDueNumberOfItem('n00R','rst1',1)
        endif
    endif
endfunction

function zs_buyhuwanNum takes integer num returns nothing
    set mGold=GetPlayerGold(ai_player)
    if mGold>=175 and GetNumberOfItemByID(mHero,'rde1')<num then
        if GetNumberOfItemByID(mHero,'I01R')>0 and GetSlotsFreeOnUnit(mHero)<1 then
            call sellItemById('n003','I01R')
        endif
        if GetSlotsFreeOnUnit(mHero)>0 then
            call buyDueNumberOfItem('n003','rde1',1)
        endif
    endif
endfunction

function zs_buyLilianghuwan takes integer num returns nothing
    set mGold=GetPlayerGold(ai_player)
    if mGold>=505 and GetNumberOfItemByID(mHero,'I004')<num then
        if GetSlotsFreeOnUnit(mHero)<1 then
            if GetNumberOfItemByID(mHero,'I01R')>0 or GetNumberOfItemByID(mHero,'pclr')>0 or GetNumberOfItemByID(mHero,'rde1')>0 or GetNumberOfItemByID(mHero,'rst1')>0 then
                if sellItemById('n013','I01R')or sellItemById('n013','pclr')or sellItemById('n013','rde1')or sellItemById('n013','rst1')then
                endif
            endif
        endif
        if GetSlotsFreeOnUnit(mHero)>0 then
            call UnitDropItemSlot(mHero,GetItemByID(mHero,'rde1'),0)
            call UnitDropItemSlot(mHero,GetItemByID(mHero,'rst1'),1)
            set zs_buyitemtmpshop=getUnitByid('n003',mBaseLoc,8888)
            call dropAllItems(zs_buyitemtmpshop)
            if GetNumberOfItemByID(mHero,'rde1')<1 then
                call buyDueNumberOfItem('n003','rde1',1)
            endif
            if GetNumberOfItemByID(mHero,'rst1')<1 then
                call buyDueNumberOfItem('n00R','rst1',1)
            endif
            call buyDueNumberOfItem('n007','sor2',1)
            call PickAllItems()
        endif
    endif
endfunction

function zs_buyfoujue takes nothing returns nothing
    set mGold=GetPlayerGold(ai_player)
    if mGold>=1050 and GetNumberOfItemByID(mHero,'wneg')<1 and GetNumberOfItemByID(mHero,'sneg')<1 and GetNumberOfItemByID(mHero,'ssan')<1 then
        if GetSlotsFreeOnUnit(mHero)<1 then
            call sellLowPrice()
        endif
        if GetSlotsFreeOnUnit(mHero)>0 then
            call buyDueNumberOfItem('n00R','wneg',1)
            call UnitDropItemSlot(mHero,GetItemByID(mHero,'wneg'),0)
        endif
    endif
endfunction

function zs_buyhuodan takes nothing returns nothing
    set mGold=GetPlayerGold(ai_player)
    if mGold>=950 and GetNumberOfItemByID(mHero,'I01S')<1 and GetNumberOfItemByID(mHero,'sneg')<1 and GetNumberOfItemByID(mHero,'ssan')<1 then
        if GetSlotsFreeOnUnit(mHero)<1 then
            call sellLowPrice()
        endif
        if GetSlotsFreeOnUnit(mHero)>0 then
            call buyDueNumberOfItem('n00S','I01S',1)
            call UnitDropItemSlot(mHero,GetItemByID(mHero,'I01S'),1)
        endif
    endif
endfunction

function zs_buyFengzhangshu takes nothing returns nothing
    set mGold=GetPlayerGold(ai_player)
    if mGold>=450 and GetNumberOfItemByID(mHero,'I01S')>0 and GetNumberOfItemByID(mHero,'wneg')>0 then
        set zs_buyitemtmpshop=getUnitByid('n014',mBaseLoc,8888)
        if not UnitDropItemSlot(mHero,GetItemByID(mHero,'wneg'),0)then
            call UnitDropItemSlot(mHero,GetItemByID(mHero,'wneg'),2)
        endif
        if not UnitDropItemSlot(mHero,GetItemByID(mHero,'I01S'),1)then
            call UnitDropItemSlot(mHero,GetItemByID(mHero,'I01S'),2)
        endif
        call dropAllItems(zs_buyitemtmpshop)
        call buyDueNumberOfItem('n014','glsk',1)
        call PickAllItems()
    endif
endfunction

function zs_buyfeixieshu takes nothing returns boolean
    local item tempDroped=null
    set mGold=GetPlayerGold(ai_player)
    if mGold>=2350 and GetNumberOfItemByID(mHero,'bspd')>0 and GetNumberOfItemByID(mHero,'desc')<1 then
        if GetSlotsFreeOnUnit(mHero)<1 then
            set zs_buyitemtmpshop=getUnitByid('n014',mBaseLoc,8888)
            call ariveUnit(mHero,zs_buyitemtmpshop,400)
            call UnitDropItemSlot(mHero,GetItemByID(mHero,'bspd'),4)
            set tempDroped=dropItem(5,mHero)
        endif
        if GetSlotsFreeOnUnit(mHero)>0 then
            call buyDueNumberOfItem('n014','ktrm',1)
        endif
        if tempDroped!=null then
            call PickItem(mHero,tempDroped)
        endif
    endif
    if GetNumberOfItemByID(mHero,'desc')>0 then
        return true
    endif
    return false
endfunction

function zs_buyzhuanshi takes nothing returns nothing
    set mGold=GetPlayerGold(ai_player)
    if mGold>=1100 and GetNumberOfItemByID(mHero,'I00F')<1 and GetNumberOfItemByID(mHero,'sneg')>0 and GetNumberOfItemByID(mHero,'ssan')<1 then
        if GetSlotsFreeOnUnit(mHero)<1 then
            call sellLowPrice()
        endif
        if GetSlotsFreeOnUnit(mHero)>0 then
            call buyDueNumberOfItem('n013','I00F',1)
            call UnitDropItemSlot(mHero,GetItemByID(mHero,'I00F'),0)
        endif
    endif
endfunction

function zs_buyhuodan2 takes nothing returns nothing
    set mGold=GetPlayerGold(ai_player)
    if mGold>=950 and GetNumberOfItemByID(mHero,'I01S')<1 and GetNumberOfItemByID(mHero,'I00F')>0 and GetNumberOfItemByID(mHero,'sneg')>0 and GetNumberOfItemByID(mHero,'ssan')<1 then
        if GetSlotsFreeOnUnit(mHero)<1 then
            call sellLowPrice()
        endif
        if GetSlotsFreeOnUnit(mHero)>0 then
            call buyDueNumberOfItem('n00S','I01S',1)
            call UnitDropItemSlot(mHero,GetItemByID(mHero,'I01S'),1)
            call UnitDropItemSlot(mHero,GetItemByID(mHero,'sneg'),2)
        endif
    endif
endfunction

function zs_buyfaqiu takes integer gold,integer shopid,integer id,integer id2,integer enditemid returns boolean
    local item tempDroped=null
    set mGold=GetPlayerGold(ai_player)
    if mGold>=gold and GetNumberOfItemByID(mHero,enditemid)<1 then
        call sellLowPrice()
        if GetSlotsFreeOnUnit(mHero)<1 and(GetNumberOfItemByID(mHero,id)>0 or GetNumberOfItemByID(mHero,id2)>0)then
            set zs_buyitemtmpshop=getUnitByid(shopid,mBaseLoc,8888)
            if zs_buyitemtmpshop!=null then
                call ariveUnit(mHero,zs_buyitemtmpshop,400)
            endif
            if GetNumberOfItemByID(mHero,id)>0 then
                call UnitDropItemSlot(mHero,GetItemByID(mHero,id),4)
            endif
            if GetNumberOfItemByID(mHero,id2)>0 then
                call UnitDropItemSlot(mHero,GetItemByID(mHero,id2),3)
            endif
            set tempDroped=dropItem(5,mHero)
        endif
        if GetSlotsFreeOnUnit(mHero)>0 then
            call buyDueNumberOfItem(shopid,id,1)
        endif
        if tempDroped!=null then
            call PickItem(mHero,tempDroped)
        endif
    endif
    if GetNumberOfItemByID(mHero,enditemid)>0 then
        return true
    endif
    return false
endfunction

function zs_buybianyangshu takes nothing returns nothing
    call zs_buyshu(900,'I01S','I00F','sneg','n008','cnhn')
endfunction

function zs_buyzhuqueyi takes nothing returns nothing
    call zs_buyHiItem(1700,'n013','I00U','I010')
endfunction

function zs_buydafu takes nothing returns nothing
    call zs_buyHiItem(3200,'n00R','I001','I010')
endfunction

function zs_buydadifushu takes nothing returns nothing
    call zs_buyshu(1350,'I001','I00U',-1111,'n008','dphe')
endfunction

function S8 takes unit u returns boolean
    return GetNumberOfItemByID(mHero,iid_zhiliaobang)>0
    return false
endfunction

function T8 takes nothing returns nothing
    if GetSlotsFreeOnUnit(mHero)==0 then
        if UnitDropItemPoint(mHero,GetItemByID(mHero,'I01R'),GetUnitX(mHero),GetUnitY(mHero))then
            call Sleep(.5)
        endif
        if UnitDropItemPoint(mHero,GetItemByID(mHero,zs_itemID1[4]),GetUnitX(mHero),GetUnitY(mHero))then
            call Sleep(.5)
        endif
        if UnitDropItemPoint(mHero,GetItemByID(mHero,zs_itemID2[4]),GetUnitX(mHero),GetUnitY(mHero))then
            call Sleep(.5)
        endif
        if UnitDropItemPoint(mHero,GetItemByID(mHero,zs_itemID1[5]),GetUnitX(mHero),GetUnitY(mHero))then
            call Sleep(.5)
        endif
        if UnitDropItemPoint(mHero,GetItemByID(mHero,zs_itemID2[5]),GetUnitX(mHero),GetUnitY(mHero))then
            call Sleep(.5)
        endif
    endif
    if GetSlotsFreeOnUnit(mHero)==0 then
        if UnitDropItemPoint(mHero,GetItemByID(mHero,'I004'),GetUnitX(mHero),GetUnitY(mHero))then
            call Sleep(.5)
        endif
    endif
    call zs_buyHiItem(620,uid_zhonglishangdian,iid_zhiliaobang,0)
endfunction

function zs_buyliliang takes nothing returns nothing
    call zs_buyHiItem(1000,'n00R','I000','I02C')
endfunction

function zs_buytiejian takes nothing returns nothing
    call zs_buyHiItem(1150,'n003','I00X','I02C')
endfunction

function zs_buyxuanwushu takes nothing returns nothing
    call zs_buyshu(1450,'I00X','I000',-1111,'n014','kygh')
endfunction

function zs_buyxuanwujia takes nothing returns nothing
    call zs_buyHiItem(1550,'n003','I024','I01N')
endfunction

function zs_buybaicaowan takes nothing returns nothing
    call zs_buyHiItem(870,'n00S','I00G','I01N')
endfunction

function zs_yuanshikaijiashu takes nothing returns nothing
    call zs_buyshu(750,'I024','I00G',0,'n008','kybl')
endfunction

function zs_buytieqiang takes nothing returns nothing
    call zs_buyHiItem(1200,'n003','I01B','I01C')
endfunction

function zs_buyyinjian takes nothing returns nothing
    call zs_buyHiItem(2600,'u005','I012','I01C')
endfunction

function zs_xuefushu takes nothing returns nothing
    call zs_buyshu(1650,'I01B','I012',-1111,'n008','dkfw')
endfunction

function zs_buyxixuebishou takes nothing returns nothing
    call zs_buyHiItem(1600,'n003','I011','I014')
endfunction

function zs_buyyinjian2 takes nothing returns nothing
    call zs_buyHiItem(2600,'u005','I012','I014')
endfunction

function zs_yitianjianshu takes nothing returns nothing
    call zs_buyshu(850,'I011','I012',-1111,'n008','sorf')
endfunction

function zs_buylieyu takes nothing returns boolean
    return zs_buyfaqiu(1400,'n00U','tmmt','oflg','rnsp')
endfunction

function zs_buyleiyu takes nothing returns boolean
    return zs_buyfaqiu(1500,'n00U','gobm','tels','stwa')
endfunction

function zs_buyduanjian takes nothing returns nothing
    call zs_buyHiItem(1000,'n00R',iid_duanjian,iid_tuimodao)
endfunction

function zs_fashichangpao takes nothing returns nothing
    call zs_buyHiItem(450,'n00S',iid_fashichangpao,iid_tuimodao)
endfunction

function zs_tuimodaoshu takes nothing returns nothing
    call zs_buyshu(1500,iid_duanjian,iid_fashichangpao,-1111,'n014',iid_tuimodaozhizuoshu)
endfunction

function zs_tuimodaobuchong takes nothing returns nothing
    call zs_buyshu(1500,iid_tuimodao,-1111,-1111,'n014',iid_tuimodaozhizuoshu)
endfunction

function VJV takes nothing returns nothing
    call zs_buyHiItem(1400,'n013',iid_qinglongdan,iid_qilinxin)
endfunction

function VKV takes nothing returns nothing
    call zs_buyHiItem(1700,'n013',iid_zhuqueyi,iid_qilinxin)
endfunction

function VLV takes nothing returns nothing
    call zs_buyshu(1400,iid_qilinxin,'sneg',0,'n013',iid_qinglongdan)
endfunction

function VMV takes nothing returns boolean
    return(GetNumberOfItemByID(mHero,iid_bingjinyushan)>0)
endfunction

function VPV takes nothing returns boolean
    if GetNumberOfItemByID(mHero,iid_bingjinyushan)>0 then
        return true
    endif
    call VJV()
    call VKV()
    call VLV()
    return false
endfunction

function VQV takes nothing returns nothing
    call zs_buyHiItem(3000,'u005',iid_qinghongjian,iid_guanyuzhuanshu)
endfunction

function VSV takes nothing returns nothing
    call zs_buyHiItem(2300,'n003',iid_yueguangqiang,iid_guanyuzhuanshu)
endfunction

function VTV takes nothing returns boolean
    if GetNumberOfItemByID(mHero,iid_guanyuzhuanshu)>0 then
        return true
    endif
    call VQV()
    if GetNumberOfItemByID(mHero,iid_longzhixin)>0 then
        call VSV()
    else
        call zs_buyfeixieshu()
    endif
    return false
endfunction

function VUV takes nothing returns boolean
    return(GetItemChargesById(mHero,iid_tuimodao)<1)
endfunction

function VWV takes nothing returns boolean
    call zs_buyduanjian()
    call zs_fashichangpao()
    call zs_tuimodaoshu()
    if VUV()then
        call zs_tuimodaobuchong()
    endif
    if GetNumberOfItemByID(mHero,iid_tuimodao)>0 then
        return true
    endif
    return false
endfunction

function zs_gangtiezhizhui takes nothing returns nothing
    call zs_buyHiItem(1650,'n003',iid_gangtiezhizhui,iid_eguizhui)
endfunction

function zs_liliangshoutao takes nothing returns nothing
    call zs_buyHiItem(150,'n00R',iid_liliangshoutao,iid_eguizhui)
endfunction

function zs_eguizhuishu takes nothing returns nothing
    call zs_buyshu(1350,iid_gangtiezhizhui,iid_liliangshoutao,-1111,'n014',iid_eguizhuizhizuoshu)
endfunction

function zs_eguizhui takes nothing returns boolean
    call zs_gangtiezhizhui()
    call zs_liliangshoutao()
    call zs_eguizhuishu()
    if GetNumberOfItemByID(mHero,iid_eguizhui)>0 then
        return true
    endif
    return false
endfunction

function V0V takes nothing returns nothing
    call zs_buyHiItem(3600,'n00R',iid_huangzhonggong,iid_yuexiameiren)
endfunction

function V1V takes nothing returns nothing
    call zs_buyshu(1500,'I01B',iid_huangzhonggong,0,'n00S',iid_zhuzhaoyongzui)
endfunction

function V2V takes nothing returns boolean
    if GetNumberOfItemByID(mHero,iid_yuexiameiren)>0 then
        return true
    endif
    call zs_buytieqiang()
    call V0V()
    call V1V()
    if P7(5100,'I01B')then
        call V0V()
        call V1V()
        call PickAllItems()
    endif
    if GetNumberOfItemByID(mHero,iid_yuexiameiren)>0 then
        return true
    endif
    if P7(2700,iid_huangzhonggong)then
        call zs_buytieqiang()
        call V1V()
        call PickAllItems()
    endif
    if GetNumberOfItemByID(mHero,iid_yuexiameiren)>0 then
        return true
    endif
    return false
endfunction

function zs_yemingzhu takes nothing returns nothing
    call zs_buyHiItem(2400,'n013',iid_yemingzhu,iid_qixingjian)
endfunction

function zs_yinjian takes nothing returns nothing
    call zs_buyHiItem(2600,'u005',iid_yinjian,iid_qixingjian)
endfunction

function zs_qixingshu takes nothing returns nothing
    call zs_buyshu(1650,iid_yemingzhu,iid_yinjian,0,'n008',iid_qixingdaozhizuoshu)
endfunction

function zs_qixing takes nothing returns boolean
    if GetNumberOfItemByID(mHero,iid_qixingjian)>0 then
        return true
    endif
    call zs_yemingzhu()
    call zs_yinjian()
    call zs_qixingshu()
    if P7(4250,iid_yemingzhu)then
        call zs_buyyinjian()
        call zs_qixingshu()
        call PickAllItems()
    endif
    return false
endfunction

function zs_sunzibingfa takes nothing returns nothing
    call zs_buyHiItemMxNum(2100,iid_sunzibingfa,-1111)
endfunction

function zs_mengde takes nothing returns nothing
    call zs_buyHiItemMxNum(3000,iid_mengdeshu,-1111)
endfunction

function zs_qingnang takes nothing returns nothing
    call zs_buyHiItemMxNum(1100,iid_qingnangshu,-1111)
endfunction

function zs_shennongbencao takes nothing returns nothing
    call zs_buyHiItemMxNum(2100,iid_shennongbencao,-1111)
endfunction

function zs_xuanwu takes nothing returns boolean
    call zs_buyliliang()
    call zs_buytiejian()
    call zs_buyxuanwushu()
    if GetNumberOfItemByID(mHero,'I02C')>0 then
        return true
    endif
    return false
endfunction

function zs_yuanshikaijia takes nothing returns boolean
    call zs_buyxuanwujia()
    call zs_buybaicaowan()
    call zs_yuanshikaijiashu()
    if GetNumberOfItemByID(mHero,'I01N')>0 then
        return true
    endif
    return false
endfunction

function zs_xuefu takes nothing returns boolean
    if GetNumberOfItemByID(mHero,'I01C')>0 then
        return true
    endif
    call zs_buytieqiang()
    call zs_buyyinjian()
    call zs_xuefushu()
    if P7(4250,'I01B')then
        call zs_buyyinjian()
        call zs_xuefushu()
        call PickAllItems()
    endif
    if GetNumberOfItemByID(mHero,'I01C')>0 then
        return true
    endif
    return false
endfunction

function zs_yitianjian takes nothing returns boolean
    call zs_buyxixuebishou()
    call zs_buyyinjian2()
    call zs_yitianjianshu()
    if GetNumberOfItemByID(mHero,'I014')>0 then
        return true
    endif
    return false
endfunction

function zs_dadifu takes nothing returns boolean
    call zs_buyzhuqueyi()
    call zs_buydafu()
    call zs_buydadifushu()
    if GetNumberOfItemByID(mHero,'I010')>0 then
        return true
    endif
    return false
endfunction

function zs_fengzhang takes nothing returns boolean
    call zs_buyfoujue()
    call zs_buyhuodan()
    call zs_buyFengzhangshu()
    if GetNumberOfItemByID(mHero,'sneg')>0 then
        return true
    endif
    return false
endfunction

function zs_bianxing takes nothing returns boolean
    call zs_buyzhuanshi()
    call zs_buyhuodan2()
    call zs_buybianyangshu()
    if GetNumberOfItemByID(mHero,'ssan')>0 then
        return true
    endif
    return false
endfunction

function zs_buyItems_Action_fashi takes nothing returns nothing
    if GetSlotsFreeOnUnit(mHero)==6 then
        if isguojia()or isxun()then
            //call Sleep(21)
        endif
        call zs_buyHong(4)
        call zs_buyLan(2)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
    endif
    call zs_buyxie()
    call zs_buyHong(4)
    call zs_buyLan(2)
    if GetNumberOfItemByID(mHero,'sneg')>0 or GetNumberOfItemByID(mHero,'ssan')>0 then
        call zs_buyLilianghuwan(2)
    endif
    if not zs_fengzhang()then
        return
    endif
    call zs_sunzibingfa()
    if not zs_buyfeixieshu()then
        return
    endif
    if not zs_bianxing()then
        return
    endif
    if not zs_dadifu()then
        return
    endif
    if isxun()or isZhuGeLiang()then
        call zs_qingnang()
    else
        call zs_mengde()
    endif
    set zs_NeedToBuy=false
endfunction

function EBV takes nothing returns nothing
    if GetSlotsFreeOnUnit(mHero)==6 then
        call Sleep(21)
        call zs_buyHong(4)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buylilianquantaoNum(2)
    endif
    call zs_buyxie()
    call zs_buyHong(4)
    if GetNumberOfItemByID(mHero,'sneg')>0 or GetNumberOfItemByID(mHero,'ssan')>0 then
        call zs_buyLilianghuwan(2)
    endif
    call zs_sunzibingfa()
    if not VMV()and not zs_fengzhang()then
        return
    endif
    if not VPV()then
        return
    endif
    if not zs_buyfeixieshu()then
        return
    endif
    if not zs_fengzhang()then
        return
    endif
    if not zs_bianxing()then
        return
    endif
    if not zs_dadifu()then
        return
    endif
    call zs_qingnang()
    set zs_NeedToBuy=false
endfunction

function ECV takes nothing returns nothing
    if GetSlotsFreeOnUnit(mHero)==6 then
        call zs_buyHong(4)
        call zs_buyLan(2)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
    endif
    if GetNumberOfItemByID(mHero,'sneg')>0 or GetNumberOfItemByID(mHero,'ssan')>0 then
        call zs_buyLilianghuwan(2)
    endif
    call zs_buyHong(4)
    call zs_buyLan(2)
    if not zs_fengzhang()then
        return
    endif
    call zs_buyxie()
    if not zs_buyfeixieshu()then
        return
    endif
    if not zs_bianxing()then
        return
    endif
    if not zs_dadifu()then
        return
    endif
    if not zs_xuanwu()then
        return
    endif
    if not VWV()then
        return
    endif
    call zs_qingnang()
    set zs_NeedToBuy=false
endfunction

function zs_buyItems_caoren takes nothing returns nothing
    set mHero=zs_caoren
    if GetSlotsFreeOnUnit(mHero)==6 then
        call Sleep(18)
        call zs_buyHong(4)
        call zs_buyLan(2)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
    endif
    call zs_buyxie()
    call zs_buyHong(4)
    call zs_buyLan(2)
    if GetNumberOfItemByID(mHero,'sneg')>0 or GetNumberOfItemByID(mHero,'ssan')>0 then
        call zs_buyLilianghuwan(2)
    endif
    call zs_sunzibingfa()
    call zs_mengde()
    if not zs_yuanshikaijia()then
        return
    endif
    if not zs_buyfeixieshu()then
        return
    endif
    if not zs_dadifu()then
        return
    endif
    call zs_qingnang()
    set zs_NeedToBuy=false
endfunction

function zs_buyItems_zhaoyun takes nothing returns nothing
    call zs_buyxie()
    call zs_buyHong(4)
    if not zs_xuanwu()then
        return
    endif
    if not zs_yuanshikaijia()then
        return
    endif
    if not VWV()then
        return
    endif
    if not zs_yitianjian()then
        return
    endif
    if not zs_buyfeixieshu()then
        return
    endif
    set zs_NeedToBuy=false
endfunction

function zs_buyItems_zhangliao takes nothing returns nothing
    if GetSlotsFreeOnUnit(mHero)==6 then
        call Sleep(13)
        call zs_buylilianquantaoNum(2)
        call zs_buylilianquantaoNum(2)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buyHong(4)
        call zs_buyLan(2)
        call zs_buyHong(4)
        call zs_buyLan(2)
        call zs_buyhuwanNum(2)
    endif
    call zs_buyxie()
    call zs_buyHong(3)
    call zs_buyLan(2)
    call zs_buyLilianghuwan(3)
    if not zs_buyfeixieshu()then
        return
    endif
    if not zs_yuanshikaijia()then
        return
    endif
    if not zs_dadifu()then
        return
    endif
    if not zs_xuefu()then
        return
    endif
    if not zs_qixing()then
        return
    endif
    if not zs_buylieyu()then
        return
    endif
    set zs_NeedToBuy=false
endfunction

function zs_buyItems_zhangfei takes nothing returns nothing
    if GetSlotsFreeOnUnit(mHero)==6 then
        call Sleep(16)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buyHong(4)
        call zs_buyLan(2)
        call zs_buylilianquantaoNum(2)
        call zs_buylilianquantaoNum(2)
        call zs_buyHong(4)
        call zs_buyHong(4)
        call zs_buyhuwanNum(2)
    endif
    call zs_buyxie()
    call zs_buyHong(4)
    call zs_buyLan(2)
    call zs_buyLilianghuwan(3)
    if not zs_buyfeixieshu()then
        return
    endif
    if not zs_buylieyu()then
        return
    endif
    if not zs_yuanshikaijia()then
        return
    endif
    if not zs_dadifu()then
        return
    endif
    if not zs_xuefu()then
        return
    endif
    set zs_NeedToBuy=false
endfunction

function zs_buyItems_madai takes nothing returns nothing
    if GetSlotsFreeOnUnit(mHero)==6 then
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buylilianquantaoNum(2)
        call zs_buyHong(4)
        call zs_buyHong(4)
        call zs_buyHong(4)
        call zs_buyshuzhi(4)
    endif
    call zs_buyxie()
    call zs_buyHong(4)
    call zs_buyLilianghuwan(2)
    if not zs_buylieyu()then
        return
    endif
    if not zs_qixing()then
        return
    endif
    if not zs_buyfeixieshu()then
        return
    endif
    if not zs_xuefu()then
        return
    endif
    if not zs_yuanshikaijia()then
        return
    endif
    if not V2V()then
        return
    endif
    set zs_NeedToBuy=false
endfunction

function EKV takes nothing returns nothing
    if GetSlotsFreeOnUnit(mHero)==6 then
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buyshuzhi(4)
        call zs_buylilianquantaoNum(2)
        call zs_buyHong(4)
        call zs_buyHong(4)
        call zs_buyHong(4)
        call zs_buyshuzhi(4)
    endif
    call zs_buyxie()
    call zs_buyHong(4)
    call zs_buyLilianghuwan(2)
    if not zs_xuefu()then
        return
    endif
    if not zs_qixing()then
        return
    endif
    if not zs_buyfeixieshu()then
        return
    endif
    if not zs_yuanshikaijia()then
        return
    endif
    if not zs_dadifu()then
        return
    endif
    if not V2V()then
        return
    endif
    set zs_NeedToBuy=false
endfunction

function zs_buyItems_guanyu takes nothing returns nothing
    if GetSlotsFreeOnUnit(mHero)==6 then
        call Sleep(16)
        call zs_buyshuzhi(4)
        call zs_buylilianquantaoNum(2)
        call zs_buylilianquantaoNum(2)
        call zs_buyHong(4)
        call zs_buyLan(2)
        call zs_buyHong(4)
        call zs_buyLan(4)
        call zs_buyhuwanNum(2)
    endif
    call zs_buyxie()
    call zs_buyHong(4)
    call zs_buyLan(2)
    call zs_buyLilianghuwan(3)
    if not VWV()then
        return
    endif
    if not VTV()then
        return
    endif
    if not zs_buyfeixieshu()then
        return
    endif
    if not zs_yuanshikaijia()then
        return
    endif
    if not zs_dadifu()then
        return
    endif
    if not zs_qixing()then
        return
    endif
    set zs_NeedToBuy=false
endfunction

function zs_buyItems_dianwei takes nothing returns nothing
    if GetSlotsFreeOnUnit(mHero)==6 then
        call Sleep(17)
        call zs_buyshuzhi(4)
        call zs_buylilianquantaoNum(2)
        call zs_buylilianquantaoNum(2)
        call zs_buyHong(4)
        call zs_buyLan(4)
        call zs_buyHong(4)
        call zs_buyHong(4)
        call zs_buyhuwanNum(2)
    endif
    call zs_buyxie()
    call zs_buyHong(4)
    call zs_buyLan(2)
    call zs_buyLilianghuwan(3)
    if not zs_buyfeixieshu()then
        return
    endif
    if not zs_xuanwu()then
        return
    endif
    if not zs_buylieyu()then
        return
    endif
    if not zs_yuanshikaijia()then
        return
    endif
    if not zs_dadifu()then
        return
    endif
    if not zs_xuefu()then
        return
    endif
    set zs_NeedToBuy=false
endfunction

function zs_buyItems_weiyan takes nothing returns nothing
    if GetSlotsFreeOnUnit(mHero)==6 then
        call Sleep(18)
        call zs_buyshuzhi(4)
        call zs_buylilianquantaoNum(2)
        call zs_buylilianquantaoNum(2)
        call zs_buyHong(4)
        call zs_buyLan(4)
        call zs_buyHong(4)
        call zs_buyLan(2)
        call zs_buyhuwanNum(2)
    endif
    call zs_buyxie()
    call zs_buyHong(4)
    call zs_buyLan(2)
    call zs_buyLilianghuwan(3)
    if not zs_buyleiyu()then
        return
    endif
    if not zs_yuanshikaijia()then
        return
    endif
    if not zs_dadifu()then
        return
    endif
    if not zs_buyfeixieshu()then
        return
    endif
    if not zs_xuefu()then
        return
    endif
    set zs_NeedToBuy=false
endfunction

function zs_buyItems_dadi takes nothing returns nothing
    if GetSlotsFreeOnUnit(mHero)==6 then
        call Sleep(17)
        call zs_buyshuzhi(2)
        call zs_buylilianquantaoNum(2)
        call zs_buylilianquantaoNum(2)
        call zs_buyHong(4)
        call zs_buyHong(4)
        call zs_buyHong(4)
        call zs_buyhuwanNum(2)
    endif
    call zs_buyxie()
    call zs_buyHong(4)
    call zs_buyLilianghuwan(3)
    if not zs_buyfeixieshu()then
        return
    endif
    if not zs_xuanwu()then
        return
    endif
    if not zs_dadifu()then
        return
    endif
    call zs_buyxuanwujia()
    if not zs_qixing()then
        return
    endif
    call V2V()
    set zs_NeedToBuy=false
endfunction

function zs_buyItems_Action_common takes integer index returns nothing
    local integer i=0
    if index==81 then
        if GetSlotsFreeOnUnit(mHero)<1 then
            call dropItem(GetItemSlotByID(mHero,'I01R'),mHero)
        endif
        if GetSlotsFreeOnUnit(mHero)>0 then
            call zs_sunzibingfa()
        endif
    endif
    if index==82 then
        if zs_action_prioty_arry[82]==68 then
            call BuyItem_im(zs_judianw[0],'I00O',mHero)
        endif
        if zs_action_prioty_arry[82]==69 then
            call BuyItem_im(zs_judianw[2],'I00O',mHero)
        endif
    endif
    if index!=80 then
        return
    endif
    if mHeroLevel>1 then
        call ItemToUseStateAll(mHero)
        call AddDropedItem(mHero)
    endif
    loop
        exitwhen i==5
        if not GG then
            if FG==0 then
                call zs_buyItems_Action_fashi()
            endif
            if FG==1 then
                call zs_buyItems_zhangliao()
            endif
            if FG==2 then
                call zs_buyItems_zhaoyun()
            endif
        endif
        if isguojia()then
            if IG then
                call ECV()
            else
                call EBV()
            endif
        endif
        if isZhuGeLiang()or isSiMaYi()or isxun()then
            if IG then
                call ECV()
            else
                call zs_buyItems_Action_fashi()
            endif
        endif
        if iszhaoyun()then
            call zs_buyItems_zhaoyun()
        endif
        if iszhangliao()then
            call zs_buyItems_zhangliao()
        endif
        if iszhangfei()then
            call zs_buyItems_zhangfei()
        endif
        if isguanyu()then
            call zs_buyItems_guanyu()
        endif
        if isweiyan()then
            call zs_buyItems_weiyan()
        endif
        if isdianwei()then
            call zs_buyItems_dianwei()
        endif
        if iscaoren()then
            call zs_buyItems_caoren()
        endif
        if isdadi()then
            call zs_buyItems_dadi()
        endif
        if ismadai()then
            call zs_buyItems_madai()
        endif
        if iszhanghe()or isgongben()or issunquan()then
            call EKV()
        endif
        set i=i+1
    endloop
    set bBuyItemFlag=false
    set zs_buyitemtmpshop=null
    call X0(mHero)
endfunction

function zs_buyItems_condition takes nothing returns nothing
    if RangeToLoc(mHero,mBaseLoc)<1200 and bBuyItemFlag then
        set zs_action_prioty_arry[80]=89
    endif
    if isZhuGeLiang()or isSiMaYi()or isguojia()then
        if GetPlayerGold(ai_player)>=2100 and GetNumberOfItemByID(mHero,iid_sunzibingfa)<1 and(GetSlotsFreeOnUnit(mHero)>0)and not IG then
            set zs_action_prioty_arry[81]=88
        endif
    endif
    if RangeToLoc(mHero,mBaseLoc)>2000 then
        set bBuyItemFlag=true
    endif
    if zs_IsTimeOut(62,20)then
        if GetHPVoided(mHero)>300 and IsAlive(zs_judianw[0])and RangeTo(mHero,zs_judianw[0])<1200 then
            set zs_action_prioty_arry[82]=68
        endif
        if GetHPVoided(mHero)>300 and IsAlive(zs_judianw[2])and RangeTo(mHero,zs_judianw[2])<1200 then
            set zs_action_prioty_arry[82]=69
        endif
    endif
endfunction

function zs_buyToushiche takes nothing returns nothing
    local unit tmp=zs_judianw[2]
    if RangeTo(mHero,zs_judianw[0])<=RangeTo(mHero,zs_judianw[2])then
        set tmp=zs_judianw[0]
    endif
    call IssueNeutralImmediateOrderById(ai_player,tmp,uid_toushiche)
    call Sleep(.3)
    call DestroyGroup(zs_toushiche_group)
    set zs_toushiche_group=null
    set zs_toushiche_group=SelectToushiche(ai_player)
    set YD=W1(zs_toushiche_group)
    set YD=YD+W1(VF)
    set tmp=null
endfunction

function zs_buyunit_condition takes nothing returns nothing
    local integer EYV=0
    local integer EZV=0
    local location loc=null
    set mGold=GetPlayerGold(ai_player)
    set lumber=GetPlayerWood(ai_player)
    if zs_shizhe==null then
        if mForceId==1 then
            set zs_shizhe=getUnitByid('h00S',mBaseLoc,6666)
        endif
        if mForceId==2 then
            set zs_shizhe=getUnitByid('h00Z',mBaseLoc,6666)
        endif
    endif
    if mGold>=300 and lumber>=30 then
        set loc=CF[0]
        if RangeLocToLoc(loc,zs_firelines[0])<1500 then
            set EYV=GetEnemyBingInRangeCount(loc,1800,false)
            set EZV=GetAllyBingInRangeCount(loc,1800,false)
            if EYV+1>=EZV then
                call IssueNeutralImmediateOrderById(ai_player,zs_shizhe,'nbds')
                call IssueNeutralImmediateOrderById(ai_player,zs_shizhe,'nfor')
            endif
        endif
    endif
    set mGold=GetPlayerGold(ai_player)
    set lumber=GetPlayerWood(ai_player)
    if mGold>=300 and lumber>=30 then
        set loc=CF[1]
        if RangeLocToLoc(loc,zs_firelines[1])<1200 then
            set EYV=GetEnemyBingInRangeCount(loc,1800,false)
            set EZV=GetAllyBingInRangeCount(loc,1800,false)
            if EYV+1>=EZV then
                call IssueNeutralImmediateOrderById(ai_player,zs_shizhe,'nfot')
                call IssueNeutralImmediateOrderById(ai_player,zs_shizhe,'nbdo')
            endif
        endif
    endif
    set mGold=GetPlayerGold(ai_player)
    set lumber=GetPlayerWood(ai_player)
    if mGold>=300 and lumber>=30 then
        set loc=CF[2]
        if RangeLocToLoc(loc,zs_firelines[2])<1200 then
            set EYV=GetEnemyBingInRangeCount(loc,1800,false)
            set EZV=GetAllyBingInRangeCount(loc,1800,false)
            if EYV+1>=EZV then
                call IssueNeutralImmediateOrderById(ai_player,zs_shizhe,'nenc')
                call IssueNeutralImmediateOrderById(ai_player,zs_shizhe,'nfod')
            endif
        endif
    endif
    set loc=null
    if(not zs_NeedToBuy)and mGold>=960 and lumber>=80 then
        set zs_action_prioty_arry[85]=91
    endif
    if mGold>=220 and lumber>=12 then
        if NG>0 and canBuyFireCar then
            set YD=W1(zs_toushiche_group)
            set YD=YD+W1(VF)
            if YD<NG then
                call zs_buyToushiche()
            endif
        endif
    endif
endfunction

function zs_buyunit_action takes integer index returns nothing
    local unit shop=null
    if index==85 then
        set mGold=GetPlayerGold(ai_player)
        set lumber=GetPlayerWood(ai_player)
        if mForceId==1 then
            set shop=getUnitByid('h00S',mBaseLoc,6666)
            if shop!=null then
                call IssueNeutralImmediateOrderById(ai_player,shop,'h019')
                call IssueNeutralImmediateOrderById(ai_player,shop,'nfot')
                call IssueNeutralImmediateOrderById(ai_player,shop,'nbdo')
            endif
        endif
        if mForceId==2 then
            set shop=getUnitByid('h00Z',mBaseLoc,6666)
            if shop!=null then
                call IssueNeutralImmediateOrderById(ai_player,shop,'h01C')
                call IssueNeutralImmediateOrderById(ai_player,shop,'nfot')
                call IssueNeutralImmediateOrderById(ai_player,shop,'nbdo')
            endif
        endif
    endif
    set shop=null
endfunction

function WeiGuoXialuYinbing takes unit Hero returns nothing
    if gotoLocation(Hero,zs_xialu_WeiGuoyinbingLoc,300)then
        if GetZhongliEnemyInRangeCount(zs_xialu_WeiGuoyinbingLoc,600,false)>0 then
            call ariveLoc(Hero,zs_xialu_WeiGuoyinbingLoc2,200)
            call HeroStop(Hero)
            call Sleep(2)
            set zs_weiguoyinbing=false
            call gotoLocation(Hero,zs_xialu_mutong,300)
            call Sleep(6)
        endif
    else
        call Sleep(.2)
    endif
endfunction

function XialuYinbing takes unit Hero returns nothing
    local integer count=0
    call ariveLoc(Hero,zs_xialu_yinbingLoc,50)
    set count=GetAllyBingInRangeCount(zs_xialu_yinbingLoc4,700,false)
    if count>0 then
        call ariveLoc(Hero,zs_xialu_yinbingLoc2,50)
        call ariveLoc(Hero,zs_xialu_yinbingLoc3,50)
        set zs_suguoyinbing=false
    endif
endfunction

function dubing takes location Loc returns boolean
    local integer enemyCount=0
    local unit utmp=null
    local location tmploc=null
    set enemyCount=EnemyCount
    if enemyCount>0 or HeroD!=null then
        set SA=false
        return false
    endif
    if TowerW!=null and RangeToLoc(TowerW,zs_MyFireLoc)<1000 then
        set SA=false
        return false
    endif
    if mForceId==1 then
        if RangeToLoc(mHero,mBaseLoc)-RangeLocToLoc(zs_path_middle[2],mBaseLoc)>400 then
            set zs_dubingParam=187
        else
            set zs_dubingParam=261
        endif
    endif
    set utmp=GetFarestAllyBubingNearHeroFromBase(mHero,900,false)
    if utmp==null then
        call gotoLocation(mHero,Loc,20)
        call Sleep(.8)
    endif
    if utmp!=null then
        call RemoveLocation(tmploc)
        set tmploc=null
        set tmploc=GetUnitFrontLoc(utmp,zs_dubingParam)
        call gotoLocation(mHero,tmploc,20)
        call Sleep(.3)
    endif
    set utmp=null
    return true
endfunction

function LearnSkill takes nothing returns nothing
    local integer pt=0
    set pt=GetHeroSkillPoints(mHero)
    if pt<1 then
        return
    endif
    call RaiseSkill(mHero,mSkillArray[GetHeroLevel(mHero)-pt])
    if GetUnitTypeId(mHero)=='H008' then
    endif
endfunction

function isHeroHasHong takes unit TheHero returns boolean
    return(GetNumberOfItemByID(TheHero,'I01V')>0 or GetNumberOfItemByID(TheHero,'hslv')>0)
endfunction

function isHeroHasLan takes unit TheHero returns boolean
    return(GetNumberOfItemByID(TheHero,'I01G')>0 or GetNumberOfItemByID(TheHero,'pclr')>0)
endfunction

function isHeroHasFengZhang takes unit TheHero returns boolean
    return GetNumberOfItemByID(TheHero,'sneg')>0 or GetNumberOfItemByID(TheHero,'I00N')>0
endfunction

function isHeroHasMengDe takes unit TheHero returns boolean
    return GetNumberOfItemByID(TheHero,iid_mengdeshu)>0 or GetNumberOfItemByID(TheHero,'I005')>0
endfunction

function XXV takes unit theUnit returns boolean
    local boolean result=false
    set result=LT(theUnit,iid_xuanwufu)
    return result
endfunction

function XOV takes nothing returns boolean
    local boolean result=false
    set result=RU(mHero,'I02C',.16)
    return result
endfunction

function XRV takes unit u returns boolean
    local boolean result=false
    set result=RU(u,'I02C',.1)
    return result
endfunction

function XIV takes unit theUnit returns boolean
    local boolean result=false
    return LT(theUnit,iid_bingjinyushan)
endfunction

function XAV takes unit theUnit returns boolean
    return UseItemByID(theUnit,iid_bingjinyushan,.3)
endfunction

function can_SunZiBingFa takes unit theUnit returns boolean
    local boolean result=false
    return LT(theUnit,iid_sunzibingfa)
    if GetItemByID(theUnit,iid_sunzibingfa)!=null then
        if zs_IsTimeOut(81,20)then
            return true
        endif
    endif
    return false
    set result=can_UseItemByID(theUnit,iid_sunzibingfa)
    if result then
    endif
    return result
endfunction

function UseSunZiBingFa takes nothing returns boolean
    local boolean result=false
    set result=UseItemByID(mHero,iid_sunzibingfa,.1)
    if result then
        set OkSunZiBingFa=false
    endif
    return result
endfunction

function can_QingNangShu takes unit theUnit returns boolean
    local boolean result=false
    return LT(theUnit,iid_qingnangshu)
    if GetNumberOfItemByID(theUnit,iid_qingnangshu)>0 or GetNumberOfItemByID(theUnit,'I00A')>0 then
        if zs_IsTimeOut(80,20)then
            return true
        endif
    endif
    return false
    set result=can_UseItemByID(theUnit,iid_qingnangshu)
    if result then
    endif
    return result
endfunction

function UseQingNangShu takes nothing returns boolean
    local boolean result=false
    set result=UseItemByID(mHero,iid_qingnangshu,.2)
    return result
endfunction

function can_UseFengZhang takes unit theUnit returns boolean
    local boolean result=false
    if not zs_canspelltoHerod then
        return false
    endif
    return GetItemChargesById(mHero,'sneg')>0 or GetItemChargesById(mHero,'I00N')>0
    set result=can_UseItemByIDTarget(theUnit,'sneg')
    if result then
    endif
    return result
endfunction

function XGV takes unit Target returns boolean
    local boolean result=false
    if RangeTo(mHero,Target)>600 then
        return false
    endif
    call SetUnitLookAt(mHero,"head",Target,0,0,0)
    set result=UseItemTargetByID(mHero,'sneg',Target,.06)
    call Sleep(.45)
    return result
endfunction

function XHV takes unit Target returns boolean
    local boolean result=false
    call SetUnitLookAt(mHero,"head",Target,0,0,0)
    set result=UseItemTargetByID(mHero,'sneg',Target,.06)
    call Sleep(.45)
    return result
endfunction

function can_MengDe takes unit theUnit returns boolean
    local boolean result=false
    if not zs_canspelltoHerod then
        return false
    endif
    if not isHeroHasMengDe(mHero)then
        return false
    endif
    set result=LT(theUnit,iid_mengdeshu)
    return result
endfunction

function UseMengDe takes unit Target returns boolean
    local boolean result=false
    set result=UseItemTargetByID(mHero,iid_mengdeshu,Target,.46)
    return result
endfunction

function can_ShenNongBenCao takes unit theUnit returns boolean
    local boolean result=false
    set result=can_UseItemByIDTarget(theUnit,iid_shennongbencao)
    if result then
    endif
    return result
endfunction

function UseShenNongBenCao takes unit Target returns boolean
    local boolean result=false
    set result=UseItemTargetByID(mHero,iid_shennongbencao,Target,.4)
    return result
endfunction

function can_TuiMoDao takes unit theUnit returns boolean
    local boolean result=false
    if not zs_canspelltoHerod then
        return false
    endif
    return GetItemChargesById(mHero,iid_tuimodao)>0 or GetItemChargesById(mHero,'I00R')>0
    set result=can_UseItemByIDTarget(theUnit,iid_tuimodao)
    if result then
    endif
    return result
endfunction

function UseTuiMoDao takes unit Target returns boolean
    local boolean result=false
    set result=UseItemTargetByID(mHero,iid_tuimodao,Target,.1)
    return result
endfunction

function isHeroHasBianYang takes unit TheHero returns boolean
    return GetNumberOfItemByID(TheHero,'I00Q')>0 or GetNumberOfItemByID(TheHero,'ssan')>0
endfunction

function can_UseBianXing takes unit theUnit returns boolean
    local boolean result=false
    if not zs_canspelltoHerod then
        return false
    endif
    set result=LT(theUnit,iid_wushuquanzhang)
    return result
endfunction

function UseBianXing takes unit Target returns boolean
    local boolean result=false
    if not zs_canspelltoHerod then
        return false
    endif
    set result=DU(mHero,'ssan',Target,.44)
    return result
endfunction

function isHeroHasFeiXie takes unit TheHero returns boolean
    return GetNumberOfItemByID(TheHero,'desc')>0
endfunction

function can_UseFeiXie takes unit theUnit returns boolean
    local boolean result=false
    set result=can_UseItemByIDTarget2(theUnit,'desc')
    return result
endfunction

function UseFeiXie takes location Target returns boolean
    local boolean result=false
    set result=NU(mHero,'desc',Target,.2)
    return result
endfunction

function X_V takes location Target returns boolean
    local boolean result=false
    set result=NU(mHero,iid_zhiliaobang,Target,.8)
    return result
endfunction

function UseFeiXieU takes unit Target returns boolean
    local boolean result=false
    local location loc=GetLocBetweenTwoUnitsRangeToFirst(Target,mHero,-160)
    set result=UseFeiXie(loc)
    call RemoveLocation(loc)
    set loc=null
    return result
endfunction

function intoUnitRange takes unit Target,real range returns boolean
    local location loc=null
    local boolean rb=false
    local real rl=999999
    if Target==null then
        return false
    endif
    set rl=RangeTo(mHero,Target)
    if rl<range then
        set HG=0
        return true
    endif
    set HG=R2I(range)
    set loc=GetLocBetweenTwoUnitsRangeToFirst(Target,mHero,-range)
    call gotoLocation(mHero,loc,30)
    call RemoveLocation(loc)
    set loc=null
    if rl-range>80 then
        call SleepCanBreak(.4)
    else
        call SleepCanBreak(.2)
    endif
    set rl=RangeTo(mHero,Target)
    if rl<range then
        set HG=0
        return true
    endif
    return false
endfunction

function X2V takes unit Target,real range returns boolean
    local real rl=999999
    if Target==null then
        return false
    endif
    set rl=RangeTo(mHero,Target)
    if rl<=range then
        set KG=-1
        return true
    endif
    set KG=R2I(range)
    call R2(KG)
    return false
endfunction

function can_sima_cast_ef takes nothing returns boolean
    local boolean b1=CanCastAbilityOrder(mHero,'A07A',"impale")
    local boolean b2=CanCastAbilityOrder(mHero,'A03O',"rainoffire")
    if(b1==false or b2==false)then
        return false
    endif
    return true
endfunction

function can_sima_cast_e takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'A07A',"impale")
endfunction

function sima_cast_e takes unit TheTarget returns boolean
    local boolean rb=false
    if TheTarget==null or IsDead(TheTarget)then
        return false
    endif
    set rb=CastTargetSkillByOderStr(mHero,'A07A',"impale",TheTarget)
    call Sleep(.77)
    return rb
endfunction

function can_sima_cast_f takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'A03O',"rainoffire")
endfunction

function sima_cast_f takes location Loc returns boolean
    local boolean rb=false
    set rb=CastPointSkillByOderStr(mHero,'A03O',"rainoffire",Loc)
    call Sleep(.5)
    return rb
endfunction

function sima_cast_fu takes unit u returns boolean
    local boolean rb=false
    local location loc=GetUnitLoc(u)
    if u!=null and IsAlive(u)then
        set rb=sima_cast_f(loc)
    endif
    call RemoveLocation(loc)
    set loc=null
    return rb
endfunction

function sima_cast_fu2 takes unit u returns boolean
    local boolean rb=false
    local location loc=GetUnitFrontLoc(u,300)
    if u!=null and IsAlive(u)then
        set rb=sima_cast_f(loc)
    endif    
    call RemoveLocation(loc)
    set loc=null
    return rb
endfunction

function OVV takes unit u returns boolean
    local boolean rb=false
    local location loc=GetLocBetweenTwoUnitsRangeToFirst(u,mHero,-200)
    if u!=null and IsAlive(u)then
		set rb=sima_cast_f(loc)
    endif
    call RemoveLocation(loc)
    set loc=null
    return rb
endfunction

function can_sima_cast_n takes nothing returns boolean
    return CanCastAbilityOrderById(mHero,'A041',852224)
endfunction

function sima_cast_n takes unit TheUnit returns boolean
    local boolean rb=false
    if TheUnit!=null and IsAlive(TheUnit)then
		call SetUnitLookAt(mHero,"head",TheUnit,0,0,0)
		set rb=CastTargetSkillByOderIdDelayed(mHero,'A041',852224,TheUnit,2.)
		call Sleep(.3)
    endif
    return rb
endfunction

function sima_cast_nu takes unit TheUnit returns boolean
    local boolean rb=false
    if TheUnit!=null and IsAlive(TheUnit)then
		call SetUnitLookAt(mHero,"head",TheUnit,0,0,0)
		set rb=CastTargetSkillByOderIdDelayed2(mHero,'A041',852224,TheUnit,2.3)
    endif
    return rb
endfunction

function sima_cast_ef takes unit TheTarget returns boolean
    local location loc=null
    if not can_sima_cast_ef()then
        return false
    endif
    call sima_cast_e(TheTarget)
	if IsAlive(TheTarget) then
		set loc=GetUnitLoc(TheTarget)
		call sima_cast_f(loc)
		call RemoveLocation(loc)
		set loc=null
	endif
    return true
endfunction

function sima_cast_fe takes unit TheTarget returns boolean
    local location loc=null
    if not can_sima_cast_ef()then
        return false
    endif
    set loc=GetUnitLoc(TheTarget)
    call sima_cast_f(loc)
    call RemoveLocation(loc)
    set loc=null
	if IsAlive(TheTarget) then	
		call sima_cast_e(TheTarget)	
	endif
    return true
endfunction

function can_sima_cast_n_ef takes nothing returns boolean
    return(can_sima_cast_n()and can_sima_cast_ef()and MyHeroMP>800)
endfunction

function sima_cast_n_ef takes unit Target returns nothing
    local location loc=null
    if sima_cast_nu(Target)then
        call HeroAttack(Target)
        call Sleep(1.5)
        call sima_cast_ef(Target)
    endif
endfunction

function can_sima_cast_feng_n_ef takes nothing returns boolean
    return(can_UseFengZhang(mHero)and can_sima_cast_n()and can_sima_cast_ef()and MyHeroMP>800)
endfunction

function sima_cast_feng_n_ef takes unit Target returns nothing
    local location loc=null
    if Target==null then
        return
    endif
    set loc=GetLocBetweenTwoUnitsRangeToFirst(Target,mHero,800)
    if XGV(Target)then
        call gotoLocation(mHero,loc,20)
        call Sleep(1.955)
        call sima_cast_n(Target)
        call Sleep(.25)
        call intoUnitRange(HeroD,600)
        call Sleep(.15)
        call HeroAttack(HeroD)
        call Sleep(1)
        call sima_cast_ef(Target)
        call HeroAttack(HeroD)
        call Sleep(.9)
    endif
    call RemoveLocation(loc)
    set loc=null
endfunction

function can_sima_cast_bian_ef takes nothing returns boolean
    if isHeroHasBianYang(mHero) and  can_sima_cast_ef() and MyHeroMP>300 then
        return true
    endif
    return false
endfunction
function sima_cast_bian_ef takes unit Target returns nothing
    local location loc=null
    if (not isHeroHasBianYang(mHero)) or (not can_sima_cast_ef())  then
        return
    endif
    set loc=GetLocBetweenTwoUnitsRangeToFirst(Target,mHero,700)
    if UseBianXing(Target) then
        call HeroAttack(Target)
        call Sleep(0.8)
        call HeroAttack(Target)
        call Sleep(0.8)
        call sima_cast_ef(Target)
    endif
    call RemoveLocation(loc)
    set loc=null
endfunction

function can_sima_cast_bian_n_ef takes nothing returns boolean
    return(can_UseBianXing(mHero)and can_sima_cast_n()and can_sima_cast_ef()and MyHeroMP>700)
endfunction

function sima_cast_bian_n_ef takes unit Target returns nothing
    local location loc=null
    if(not isHeroHasBianYang(mHero))or(not can_sima_cast_n())then
        return
    endif
    set loc=GetLocBetweenTwoUnitsRangeToFirst(Target,mHero,700)
    if UseBianXing(Target)then
        call gotoLocation(mHero,loc,20)
        call sima_cast_nu(Target)
        call sima_cast_ef(Target)
    endif
    call RemoveLocation(loc)
    set loc=null
endfunction

function can_sima_cast_ef_feng_n_feng_fe takes nothing returns boolean
    return(can_UseFengZhang(mHero)and can_sima_cast_n()and can_sima_cast_ef()and MyHeroMP>950)
endfunction

function sima_cast_ef_feng_n_feng_fe takes unit Target returns nothing
    local location loc=null
    if Target==null then
        return
    endif
    set loc=GetLocBetweenTwoUnitsRangeToFirst(Target,mHero,820)
    call sima_cast_ef(Target)
    call HeroAttack(Target)
    call Sleep(.84)
    if XGV(Target)then
        call gotoLocation(mHero,loc,30)
        call Sleep(1.79)
        call sima_cast_n(Target)
        call Sleep(.3)
        call gotoLocation2(mHero,HeroD,600)
        call Sleep(.4)
        call HeroAttack(Target)
        call Sleep(1.6)
        if XHV(Target)then
            call Sleep(4.52)
            if can_sima_cast_e()then
                call sima_cast_e(Target)
            endif
            if can_sima_cast_f()then
                call sima_cast_fu(Target)
            endif
            call HeroAttack(Target)
            call Sleep(.9)
        endif
    endif
    call RemoveLocation(loc)
    set loc=null
endfunction

function can_zhuge_cast_g takes nothing returns boolean
    return CanCastAbilityOrderById(mHero,'A087',852119)
endfunction

function zhuge_cast_g takes unit TheTarget returns nothing
    if TheTarget!=null and IsAlive(TheTarget)then
		call CastTargetSkillByOderId(mHero,'A087',852119,TheTarget)
		call Sleep(.5)        
    endif
endfunction

function can_zhuge_cast_e takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'A085',"silence")
endfunction

function zhuge_cast_e takes unit TheTarget returns boolean
    local location loc=null
    local boolean rb=false
    if TheTarget==null or IsDead(TheTarget)then
        return false
    endif	
    set loc=GetUnitLoc(TheTarget)
    call SetUnitLookAt(mHero,"head",TheTarget,0,0,0)
    call CastPointSkillByOderStr(mHero,'A085',"silence",loc)
    call Sleep(.44)
    if RangeToLoc(TheTarget,loc)<220 then
        set rb=true
    endif
    call RemoveLocation(loc)
    set loc=null
    return rb
endfunction

function OMV takes unit TheTarget returns boolean
    local location loc=null
	local boolean rb=false
    if TheTarget==null or IsDead(TheTarget)then
        return false
    endif	
    set loc=GetUnitLoc(TheTarget)
    call SetUnitLookAt(mHero,"head",TheTarget,0,0,0)
    call CastPointSkillByOderStr(mHero,'A085',"silence",loc)
    call Sleep(.45)
    call HeroAttack(TheTarget)
    call Sleep(.8)
    if RangeToLoc(TheTarget,loc)<220 then
        set rb=true
    endif
    call RemoveLocation(loc)
    set loc=null
    return rb
endfunction

function can_zhuge_cast_eg takes nothing returns boolean
    return can_zhuge_cast_e()and can_zhuge_cast_g()
endfunction

function can_zhuge_cast_x takes nothing returns boolean
    return CanCastAbilityOrderById(mHero,'A083',852127)
endfunction

function can_zhuge_cast_w takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'A08A',"evileye")
endfunction

function zhuge_cast_w2 takes location Loc returns boolean
    local boolean rb=false
    set rb=CastPointSkillByOderStr(mHero,'A08A',"evileye",Loc)
    call Sleep(.8)
    return rb
endfunction

function zhuge_cast_w takes unit u returns boolean
    local boolean rb=false
    local location loc=GetUnitLoc(u)
    set rb=zhuge_cast_w2(loc)
    call RemoveLocation(loc)
    set loc=null
    return rb
endfunction

function zhuge_cast_lei takes nothing returns nothing
	local real rs = 0
    if not can_zhuge_cast_x()then
        return
    endif	
	set rs = GetRandomInt(1,1000)/1000
	call Sleep(rs)
	if zs_weakestEnemyHero == null or IsDead(zs_weakestEnemyHero) then
		return
	endif
    call UnitAddAbility(mHero,'A089')
    call Sleep(.1)
    call IssueImmediateOrderById(mHero,852100)
    call Sleep(.2)
    call IssueImmediateOrderById(mHero,852127)
    call Sleep(.3)
    call UnitRemoveAbility(mHero,'A089')
endfunction

function zhuge_cast_xue takes nothing returns nothing
    if not can_zhuge_cast_x()then
        return
    endif
    call UnitAddAbility(mHero,'A082')
    call Sleep(.1)
    call IssueImmediateOrderById(mHero,852520)
    call Sleep(.2)
    call IssueImmediateOrderById(mHero,852127)
    call Sleep(.3)
    call UnitRemoveAbility(mHero,'A082')
endfunction

function zhuge_cast_wu takes nothing returns nothing
    if not can_zhuge_cast_x()then
        return
    endif
    call UnitAddAbility(mHero,'A08B')
    call Sleep(.1)
    call IssueImmediateOrderById(mHero,852164)
    call Sleep(.2)
    call IssueImmediateOrderById(mHero,852127)
    call Sleep(.3)
    call UnitRemoveAbility(mHero,'A08B')
endfunction

function zhuge_cast_x takes unit Target returns nothing
    if Target!=null and IsAlive(Target)then
		call SetUnitLookAt(mHero,"head",Target,0,0,0)
		call CastImdSkillByID(mHero,'A083',852127)
		call Sleep(.36)
    endif
endfunction

function zhuge_cast_x_move takes unit Target returns nothing
    local location loc=null
    call zhuge_cast_x(Target)
    set loc=GetLocBetweenTwoUnitsRangeToFirst(Target,mHero,150)
    call gotoLocation(mHero,loc,20)
    call RemoveLocation(loc)
    set loc=null
    call Sleep(.8)
    set loc=GetLocBetweenTwoUnitsRangeToFirst(Target,mHero,150)
    call gotoLocation(mHero,loc,20)
    call Sleep(.8)
    call RemoveLocation(loc)
    set loc=null
    call HeroAttack(Target)
    call Sleep(1.6)
endfunction

function can_zhuge_cast_x_move_g takes nothing returns boolean
    return can_zhuge_cast_x()and can_zhuge_cast_g()
endfunction

function zhuge_cast_x_move_g takes unit Target returns nothing
    call zhuge_cast_x_move(Target)
    call zhuge_cast_g(Target)
endfunction

function can_zhuge_cast_fei_e_x_g takes nothing returns boolean
    return(can_UseFeiXie(mHero)and can_zhuge_cast_x()and can_zhuge_cast_e()and can_zhuge_cast_g()and MyHeroMP>700)
endfunction

function zhuge_cast_fei_e_x_g takes unit Target returns nothing
    local location loc=null
    if(not isHeroHasFeiXie(mHero))or(not can_zhuge_cast_x())then
        return
    endif
    set loc=GetLocBetweenTwoUnitsRangeToFirst(Target,mHero,100)
    if can_UseBianXing(mHero)then
        call UseBianXing(Target)
    endif
    call UseFeiXie(loc)
    call zhuge_cast_e(Target)
    call zhuge_cast_x(Target)
    call zhuge_cast_g(Target)
    call HeroAttack(Target)
    call Sleep(1)
    call RemoveLocation(loc)
    set loc=null
endfunction

function can_zhuge_cast_feng_e_x_g takes nothing returns boolean
    return(can_UseFengZhang(mHero)and can_zhuge_cast_x()and can_zhuge_cast_e()and can_zhuge_cast_g()and MyHeroMP>700)
endfunction

function zhuge_cast_feng_e_x_g takes unit Target returns nothing
    local location loc=null
    if XGV(Target)then
        set loc=GetLocBetweenTwoUnitsRangeToFirst(Target,mHero,100)
        call gotoLocation(mHero,loc,10)
        call Sleep(4.35)
        call zhuge_cast_e(Target)
        call zhuge_cast_x(Target)
        call zhuge_cast_g(Target)
        call HeroAttack(Target)
        call Sleep(1)
        call RemoveLocation(loc)
        set loc=null
    endif
endfunction

function can_zhuge_cast_bian_e_x_g takes nothing returns boolean
    return(can_UseBianXing(mHero)and can_zhuge_cast_x()and can_zhuge_cast_e()and can_zhuge_cast_g()and MyHeroMP>700)
endfunction

function zhuge_cast_bian_e_x_g takes unit Target returns nothing
    local location loc=null
    if(not isHeroHasBianYang(mHero))or(not can_zhuge_cast_x())then
        return
    endif
    call UseBianXing(Target)
    set loc=GetLocBetweenTwoUnitsRangeToFirst(Target,mHero,100)
    call gotoLocation(mHero,loc,10)
    call Sleep(1)
    call zhuge_cast_e(Target)
    call zhuge_cast_x(Target)
    set loc=GetLocBetweenTwoUnitsRangeToFirst(Target,mHero,100)
    call gotoLocation(mHero,loc,10)
    set loc=GetLocBetweenTwoUnitsRangeToFirst(Target,mHero,100)
    call zhuge_cast_g(Target)
    call gotoLocation(mHero,loc,10)
    call Sleep(.5)
    call HeroAttack(Target)
    call Sleep(1)
    call RemoveLocation(loc)
    set loc=null
endfunction

function can_zhangliao_cast_w takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'AOsh',"shockwave")
endfunction

function zhangliao_cast_w takes location loc returns nothing
    call CastTargetSkillByOderStrDelayed(mHero,'AOsh',"shockwave",loc,.7)
endfunction

function zhangliao_cast_wu takes unit u returns nothing
    local location loc=GetUnitLoc(u)
    call zhangliao_cast_w(loc)
    call RemoveLocation(loc)
    set loc=null
endfunction

function can_zhangliao_cast_f takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'AHtb',"thunderbolt")
endfunction

function zhangliao_cast_f takes unit target returns nothing
    call CastTargetSkillByOderStr(mHero,'AHtb',"thunderbolt",target)
    call Sleep(1.2)
endfunction

function can_zhangliao_cast_fw takes nothing returns boolean
    return can_zhangliao_cast_w()and can_zhangliao_cast_f()
endfunction

function zhangliao_cast_fw takes unit target returns nothing
    call zhangliao_cast_f(target)
    call Sleep(1.1)
    call HeroAttack(target)
    call Sleep(1.2)
    if IsAlive(target)then
        if RangeTo(mHero,target)<300 then
            call zhangliao_cast_wu(target)
        endif
    endif
endfunction

function can_zhaoyun_cast_c takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'A06K',"thunderbolt")
endfunction

function zhaoyun_cast_c takes unit target returns nothing
    call CastTargetSkillByOderStr(mHero,'A06K',"thunderbolt",target)
    call Sleep(.3)
endfunction

function can_zhaoyun_cast_b takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'A01V',"frenzy")
endfunction

function zhaoyun_cast_b takes nothing returns nothing
    call CastImdSkillByStr(mHero,'A01V',"frenzy")
    call Sleep(.3)
endfunction

function can_guanyu_cast_x takes nothing returns boolean
    if IsImmune(mHero)then
        return false
    endif
    return CanCastAbilityOrderById(mHero,'A011',852231)
endfunction

function guanyu_cast_x takes unit target returns nothing
    call CastTargetSkillByOderId(mHero,'A011',852231,target)
    call Sleep(1.1)
endfunction

function can_guanyu_cast_d takes nothing returns boolean
    if IsImmune(mHero)then
        return false
    endif
    return CanCastAbilityOrder(mHero,'A00R',"blizzard")
endfunction

function guanyu_cast_d takes location loc returns nothing
    call CastPointSkillByOderStr(mHero,'A00R',"blizzard",loc)
    call Sleep(.7)
endfunction

function guanyu_cast_du takes unit u returns nothing
    local location loc=GetUnitLoc(u)
    call guanyu_cast_d(loc)
    call RemoveLocation(loc)
    set loc=null
endfunction

function can_guanyu_cast_xd takes nothing returns boolean
    return can_guanyu_cast_x()and can_guanyu_cast_d()
endfunction

function guanyu_cast_xd takes unit target returns nothing
    call guanyu_cast_x(target)
    call guanyu_cast_du(target)
endfunction

function RKV takes nothing returns boolean
    local boolean rb=false
    if IsImmune(mHero)then
        return false
    endif
    if PH then
        set rb=HT(mHero,'A02V')
    else
        set rb=HT(mHero,'A00A')
    endif
    if rb then
    endif
    return rb
endfunction

function RLV takes nothing returns nothing
    if not CastImdSkillByStr(mHero,'A00A',"whirlwind")then
        call CastImdSkillByStr(mHero,'A02V',"whirlwind")
    endif
    call Sleep(.1)
endfunction

function RMV takes nothing returns boolean
    return HT(mHero,'A04W')
endfunction

function RPV takes nothing returns nothing
    call CastImdSkillByStr(mHero,'A04W',"stomp")
    call Sleep(.5)
endfunction

function RQV takes nothing returns boolean
    return HT(mHero,'A009')
    return YY(mHero,'A009',"berserk")
endfunction

function zhangfei_cast_b takes nothing returns nothing
    call CastImdSkillByStr(mHero,'A009',"berserk")
    call Sleep(.4)
endfunction

function can_zhangfei_cast_v takes nothing returns boolean
    return HT(mHero,'A006')
    return YY(mHero,'A006',"avatar")
endfunction

function zhangfei_cast_v takes nothing returns nothing
    call CastImdSkillByStr(mHero,'A006',"avatar")
    call Sleep(.3)
endfunction

function can_weiyan_cast_t takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'A02A',"thunderbolt")
endfunction

function weiyan_cast_t takes unit target returns nothing
    call CastTargetSkillByOderStr(mHero,'A02A',"thunderbolt",target)
    call Sleep(.68)
endfunction

function can_weiyan_cast_r takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'A00H',"mirrorimage")
endfunction

function weiyan_cast_r takes nothing returns nothing
    call CastImdSkillByStr(mHero,'A00H',"mirrorimage")
    call Sleep(.6)
endfunction

function can_guojia_cast_n takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'A00W',"frostnova")
endfunction

function guojia_cast_n takes unit target returns nothing
    call CastTargetSkillByOderStr(mHero,'A00W',"frostnova",target)
    call Sleep(.8)
endfunction

function can_guojia_cast_c takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'A01F',"impale")
endfunction

function guojia_cast_c takes unit target returns nothing
    call CastTargetSkillByOderStr(mHero,'A01F',"impale",target)
    call Sleep(.7)
endfunction

function can_guojia_cast_f takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'AUfu',"frostarmor")
endfunction

function guojia_cast_f takes unit target returns nothing
    call CastTargetSkillByOderStr(mHero,'AUfu',"frostarmor",target)
    call Sleep(.5)
endfunction

function can_dianwei_cast_t takes nothing returns boolean
    return HT(mHero,'A04W')
    return CanCastAbilityOrder(mHero,'A04W',"stomp")
endfunction

function dianwei_cast_t takes nothing returns nothing
    call CastImdSkillByStr(mHero,'A04W',"stomp")
    call Sleep(.5)
endfunction

function can_dianwei_cast_r takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'A00L',"faeriefire")
endfunction

function dianwei_cast_r takes unit target returns nothing
    call CastTargetSkillByOderStr(mHero,'A00L',"faeriefire",target)
    call Sleep(.76)
endfunction

function can_caoren_cast_c takes nothing returns boolean
    return CanCastAbilityOrder2(mHero,'AUcs',"carrionswarm")
endfunction

function caoren_cast_c takes unit target returns nothing
    call CastTargetSkillByOderStr(mHero,'AUcs',"carrionswarm",target)
    call Sleep(.39)
endfunction

function can_caoren_cast_e takes nothing returns boolean
    return CanCastAbilityOrder2(mHero,'AUsl',"sleep")
endfunction

function caoren_cast_e takes unit target returns nothing
    call CastTargetSkillByOderStr(mHero,'AUsl',"sleep",target)
    call Sleep(.39)
endfunction

function can_caoren_cast_f takes nothing returns boolean
    return CanCastAbilityOrder2(mHero,'AUhf',"unholyfrenzy")
endfunction

function caoren_cast_f takes unit target returns nothing
    call CastTargetSkillByOderStr(mHero,'AUhf',"unholyfrenzy",target)
    call Sleep(.55)
endfunction

function can_caoren_cast_g takes nothing returns boolean
    return CanCastAbilityOrder2(mHero,'A030',"silence")
endfunction

function caoren_cast_g takes location loc returns nothing
    call SetPlayerAbilityAvailable(ai_player,'Awrs',true)
    call CastPointSkillByOderStr(mHero,'A030',"silence",loc)
    call Sleep(1.5)
    call SetPlayerAbilityAvailable(ai_player,'Awrs',false)
    if iscaoren()then
        if IsUnitHidden(zs_caoren)then
            set LF=true
            if MI==null then
                set MI=getGSOfPlayer(ai_player)
            endif
            set mHero=MI
        endif
        if not IsUnitHidden(zs_caoren)then
            set mHero=zs_caoren
            set LF=false
            set MI=null
        endif
        if IsDead(mHero)then
            set mHero=zs_caoren
        endif
    endif
endfunction

function caoren_cast_gu takes unit TheTarget returns nothing
    local location loc=GetUnitLoc(TheTarget)
    call caoren_cast_g(loc)
    call RemoveLocation(loc)
    set loc=null
endfunction

function can_caozixiao_cast_t takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'Awrs',"stomp")
endfunction

function caozixiao_cast_t takes nothing returns nothing
    call CastImdSkillByStr(mHero,'Awrs',"stomp")
    call Sleep(.5)
endfunction

function can_xun_cast_g takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'A060',"healingward")
endfunction

function xun_cast_g takes location loc returns nothing
    call CastPointSkillByOderStr(mHero,'A060',"healingward",loc)
    call Sleep(.4)
endfunction

function xun_cast_gu takes unit u returns nothing
    local location loc=null
    set loc=GetUnitLoc(u)
    call xun_cast_g(loc)
    call RemoveLocation(loc)
    set loc=null
endfunction

function can_xun_cast_t takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'A02E',"stasistrap")
endfunction

function xun_cast_t takes location loc returns nothing
    call CastPointSkillByOderStr(mHero,'A02E',"stasistrap",loc)
    call Sleep(.5)
endfunction

function can_xun_cast_w takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'A065',"ward")
endfunction

function xun_cast_w takes location loc returns nothing
    call CastPointSkillByOderStr(mHero,'A065',"ward",loc)
    call Sleep(.6)
endfunction

function can_xun_cast_e takes nothing returns boolean
    return CanCastAbilityOrder(mHero,'AOhw',"healingwave")
endfunction

function xun_cast_e takes unit target returns nothing
    call CastTargetSkillByOderStr(mHero,'AOhw',"healingwave",target)
    call Sleep(.7)
endfunction

function can_dadi_cast_t takes nothing returns boolean
    return CanCastAbilityOrderById(mHero,aid_dadi_chaonong,852520)
endfunction

function dadi_cast_t takes nothing returns nothing
    call CastImdSkillByID(mHero,aid_dadi_chaonong,852520)
    call Sleep(.5)
endfunction

function can_dadi_cast_c takes nothing returns boolean
    return CanCastAbilityOrderById(mHero,aid_dadi_dileizhen,852581)
endfunction

function dadi_cast_c takes nothing returns nothing
    call CastImdSkillByID(mHero,aid_dadi_dileizhen,852581)
    call Sleep(.5)
endfunction

function GoToSaveLocation takes unit u returns nothing
    if(safeLoc==null)then
        call gotoLocation(u,zs_cr_attackLoc,50)
        call SleepCanBreak(.8)
    else
        if not gotoLocation(u,safeLoc,50)then
            call SleepCanBreak(.8)
        else
            call SleepCanBreak(.5)
        endif
    endif
endfunction

function MoveAttackUnit takes unit Target,real range returns boolean
    local location loc=null
    local boolean rb=false
    if Target==null then
        return false
    endif
    if intoUnitRange(Target,range)then
        call HeroAttack(Target)
        call SleepCanBreak(.9)
        set loc=X3(mHero,500)
        call gotoLocation(mHero,loc,20)
        call RemoveLocation(loc)
        set loc=null
        call SleepCanBreak(.8)
    endif
    return true
endfunction

function MoveAttackUnit2 takes unit Target,real range returns boolean
    local location loc=null
    local boolean rb=false
    if Target==null then
        return false
    endif
    if intoUnitRange(Target,range)then
        call HeroAttack(Target)
        call SleepCanBreak(1)
        set loc=X3(mHero,500)
        call gotoLocation(mHero,loc,20)
        call RemoveLocation(loc)
        set loc=null
        call SleepCanBreak(.6)
    endif
    return true
endfunction

function ChaseAttackUnit takes unit Target returns boolean
    local location loc=null
    local boolean rb=false
    if Target==null then
        return false
    endif
    if intoUnitRange(Target,600)then
        call HeroAttack(Target)
        call SleepCanBreak(.9)
    endif
    if attackRange>=500 then
        if RangeTo(mHero,Target)<=330 then
            return true
        endif
    endif
    set loc=GetLocBetweenTwoUnitsRangeToFirst(mHero,Target,600)
    call gotoLocation(mHero,loc,50)
    call RemoveLocation(loc)
    set loc=null
    call SleepCanBreak(.5)
    return true
endfunction

function attackUnitAround takes unit Target returns boolean
    local location loc=null
    local boolean rb=false
    if Target==null then
        return false
    endif
    if intoUnitRange(Target,600)then
        call HeroAttack(Target)
        call SleepCanBreak(.9)
    endif
    if attackRange>=500 then
        if RangeTo(mHero,Target)<=390 and(NearestEnemyBubing==null or RangeTo(mHero,NearestEnemyBubing)>500)then
            return true
        endif
    endif
    if NearestEnemyBubing==null then
        set loc=GetLocBetweenTwoUnitsRangeToFirst(mHero,Target,600)
    endif
    if NearestEnemyBubing!=null then
        set loc=GetLocBetweenTwoUnitsRangeToFirst(Target,NearestEnemyBubing,-500)
    endif
    call gotoLocation(mHero,loc,50)
    call RemoveLocation(loc)
    set loc=null
    call SleepCanBreak(.5)
    return true
endfunction

function attackUnitAround2 takes unit Target returns boolean
    local location loc=null
    local boolean rb=false
    if Target==null then
        return false
    endif
    if intoUnitRange(Target,220)then
        call HeroAttack(Target)
        call SleepCanBreak(.9)
    endif
    if RangeTo(mHero,Target)<180 then
        return true
    endif
    set loc=GetUnitToOuterLocAngle(mHero,Target,220,30)
    call gotoLocation(mHero,loc,50)
    call RemoveLocation(loc)
    set loc=null
    call SleepCanBreak(.5)
    return true
endfunction

function AlterDefendRange takes nothing returns nothing
    if IsRestoreHP(mHero)or IsRestoreMP(mHero)then
        set zs_SafeLocRangeToEnemy=zs_chiyaoSafeRangetoEnemy
    else
        set zs_SafeLocRangeToEnemy=zs_SafeLocRangeToEnemyA
    endif
endfunction

function islocBetweenTwoLocs takes unit theunit,location start,location end returns boolean
    if RangeToLoc(theunit,start)<=700 then
        return true
    endif
    if RangeToLoc(theunit,end)<700 then
        return false
    endif
    return RangeToLoc(theunit,start)<RangeLocToLoc(start,end)and RangeToLoc(theunit,end)<RangeLocToLoc(start,end)
endfunction

function getlocindex takes integer I7V,unit theUnit returns integer
    local integer i=0
    local integer i2=0
    local location loc=null
    local real max=999999
    if I7V==0 then
        loop
            exitwhen(zs_path_shanglu[i+1]==null or i==20)
            if islocBetweenTwoLocs(theUnit,zs_path_shanglu[i],zs_path_shanglu[i+1])then
                return i
            endif
            if RangeToLoc(theUnit,zs_path_shanglu[i])<max then
                set i2=i
                set max=RangeToLoc(theUnit,zs_path_shanglu[i])
            endif
            set i=i+1
        endloop
    endif
    if I7V==1 then
        loop
            exitwhen(zs_path_middle[i+1]==null or i==20)
            if islocBetweenTwoLocs(theUnit,zs_path_middle[i],zs_path_middle[i+1])then
                return i
            endif
            if RangeToLoc(theUnit,zs_path_middle[i])<max then
                set i2=i
                set max=RangeToLoc(theUnit,zs_path_middle[i])
            endif
            set i=i+1
        endloop
    endif
    if I7V==2 then
        loop
            exitwhen(zs_path_xialu[i+1]==null or i==20)
            if islocBetweenTwoLocs(theUnit,zs_path_xialu[i],zs_path_xialu[i+1])then
                return i
            endif
            if RangeToLoc(theUnit,zs_path_xialu[i])<max then
                set i2=i
                set max=RangeToLoc(theUnit,zs_path_xialu[i])
            endif
            set i=i+1
        endloop
    endif
    return i2
endfunction

function I8V takes unit TheUnit returns nothing
    if AO>99 or zs_cr_fightline>99 then
        set zs_cr_retreatLoc=mBaseLoc
    endif
    if zs_cr_fightline>99 then
        set zs_cr_attackLoc=zs_firelines[zs_cr_fightline]
        return
    endif
    set zs_locindex=getlocindex(zs_cr_fightline,TheUnit)
    if zs_cr_fightline==0 and zs_locindex>-1 then
        set zs_cr_attackLoc=zs_path_shanglu[zs_locindex+1]
        set zs_cr_retreatLoc=zs_path_shanglu[zs_locindex]
        if RangeToLoc(TheUnit,zs_cr_retreatLoc)<800 and zs_locindex-1>-1 then
            set zs_cr_retreatLoc=zs_path_shanglu[zs_locindex-1]
        endif
    endif
    if zs_cr_fightline==1 and zs_locindex>-1 then
        set zs_cr_attackLoc=zs_path_middle[zs_locindex+1]
        set zs_cr_retreatLoc=zs_path_middle[zs_locindex]
        if RangeToLoc(TheUnit,zs_cr_retreatLoc)<800 and zs_locindex-1>-1 then
            set zs_cr_retreatLoc=zs_path_middle[zs_locindex-1]
        endif
    endif
    if zs_cr_fightline==2 and zs_locindex>-1 then
        set zs_cr_attackLoc=zs_path_xialu[zs_locindex+1]
        set zs_cr_retreatLoc=zs_path_xialu[zs_locindex]
        if RangeToLoc(TheUnit,zs_cr_retreatLoc)<800 and zs_locindex-1>-1 then
            set zs_cr_retreatLoc=zs_path_xialu[zs_locindex-1]
        endif
    endif
endfunction

function I9V takes unit theunit returns integer
    local integer index=0
    local real min=999999
    local integer ri=1
    loop
        exitwhen index==3
        if RangeToLoc(theunit,zs_firelines[index])<min then
            set ri=index
            set min=RangeToLoc(theunit,zs_firelines[index])
        endif
        set index=index+1
    endloop
    return ri
endfunction

function AVV takes unit TheUnit returns nothing
    local integer AEV=0
    set KN=I9V(TheUnit)
    set AEV=getlocindex(KN,TheUnit)
    if KN==0 and AEV>-1 then
        set JF=zs_path_shanglu[AEV+1]
        set KF=zs_path_shanglu[AEV]
        if RangeToLoc(TheUnit,KF)<800 and AEV-1>-1 then
            set KF=zs_path_shanglu[AEV-1]
        endif
    endif
    if KN==1 and AEV>-1 then
        set JF=zs_path_middle[AEV+1]
        set KF=zs_path_middle[AEV]
        if RangeToLoc(TheUnit,KF)<800 and AEV-1>-1 then
            set KF=zs_path_middle[AEV-1]
        endif
    endif
    if KN==2 and AEV>-1 then
        set JF=zs_path_xialu[AEV+1]
        set KF=zs_path_xialu[AEV]
        if RangeToLoc(TheUnit,KF)<800 and AEV-1>-1 then
            set KF=zs_path_xialu[AEV-1]
        endif
    endif
endfunction

function setShangluFireLoc takes nothing returns nothing
    call RemoveLocation(zs_firelines[0])
    set zs_firelines[0]=null
    set zs_firelines[0]=Location(zs_FirelocShanglu[0],zs_FirelocShanglu[1])
endfunction

function setZhongLuFireLoc takes nothing returns nothing
    call RemoveLocation(zs_firelines[1])
    set zs_firelines[1]=null
    set zs_firelines[1]=Location(zs_FirelocZhonglu[0],zs_FirelocZhonglu[1])
endfunction

function setXiaLuFireLoc takes nothing returns nothing
    call RemoveLocation(zs_firelines[2])
    set zs_firelines[2]=null
    set zs_firelines[2]=Location(zs_FirelocXialu[0],zs_FirelocXialu[1])
endfunction

function AIV takes nothing returns nothing
    local integer AAV=0
    set GR=false
    if W6()then
        set GR=true
    endif
    if Y6()then
        set GR=true
    endif
    if GR and not IsImmune(mHero)then
        set FR=3
        set MG=3
    endif
endfunction

function handleCommands takes nothing returns nothing
    local integer i=0
    local integer command=-1
    local integer data=-1
    local unit utmp=null
    local integer ADV=0
    local integer AFV=0
    loop
        exitwhen CommandsWaiting()==0 or GetLastCommand()<1
        set command=GetLastCommand()
        set data=GetLastData()
        if command==1000 and data>-1 and data<16 then
            set utmp=getfirstHeroOfPlayer(Player(data))
            if ControlHero(utmp)then
                call DisplayToAll("电脑控制成功!")
            else
                call DisplayToAll("电脑控制失败!!")
            endif
            set utmp=null
        endif
        if command==1001 then
            call ReleaseHero(data)
        endif
        if command==2000 and data>0 then
        endif
        if command==2001 then
        endif
        if command==3000 then
            set zs_FirelocShanglu[0]=data
        endif
        if command==3001 then
            set zs_FirelocShanglu[1]=data
        endif
        if command==3002 then
            set zs_FirelocZhonglu[0]=data
        endif
        if command==3003 then
            set zs_FirelocZhonglu[1]=data
        endif
        if command==3004 then
            set zs_FirelocXialu[0]=data
        endif
        if command==3005 then
            set zs_FirelocXialu[1]=data
        endif
        if command==4000 then
            set LD=true
            call DisplayToAll("帮助中路英雄开启!")
        endif
        if command==4001 then
            set LD=false
            call setFightLine()
            call DisplayToAll("帮助中路英雄关闭!")
        endif
        if command==4002 then
            set IG=true
            set canBuyFireCar=false
            call DisplayToAll("中法1v1开启!")
        endif
        if command==4003 then
            set IG=false
            call DisplayToAll("中法1v1关闭!")
        endif
        if command==4004 then
            set canBuyFireCar=false
            call DisplayToAll("禁止出车!")
        endif
        if command==4005 then
            set canBuyFireCar=true
            call DisplayToAll("允许出车!")
        endif
        if command==4006 then
            set quanZheYingMoShi=true
			set zhuLiMoShi=false
        endif
        if command==4007 then
            set zhuLiMoShi=true
			set quanZheYingMoShi=false
            call DisplayToAll("真三主力英雄模式开启！")
        endif
        if command==5000 then
        endif
        if mHero!=null and IsAlive(mHero)then
            if command==6000 then
                set PG=NK(data)
            endif
            if command==6001 then
                set QG=NK(data)
            endif
            if command==6004 then
                set SG=BK(data)
            endif
            if command==6005 then
                set UG=data
            endif
            if command==6006 then
                set WG=data
                call AIV()
            endif
        endif
        if command==6200 then
            call Sleep(.1)
            set XH=true
            set FR=1
            call getfirstHero()
        endif
        if command==6300 then
            set ADV=data
        endif
        if command==6301 then
            set AFV=data
        endif
        if command==6302 then
            if(mForceId==1 and data<=5)or(mForceId==2 and data>=6)then
                if ADV!=0 and AFV!=0 then
                    if WH!=null then
                        call RemoveLocation(WH)
                        set WH=null
                    endif
                    if isdebug then
                    endif
                    set WH=Location(ADV,AFV)
                    if AO!=101 and AO!=102 then
                        set AO=103
                        set zs_firelines[103]=WH
                    endif
                endif
            endif
        endif
        if command>=3000 and command<=3100 then
        endif
        call PopLastCommand()
        set i=i+1
    endloop
endfunction

function HeroRetreat takes integer range returns nothing
    local location safeLoc2=F4(range)
    if(safeLoc2==null)then
        call gotoLocation(mHero,zs_cr_attackLoc,50)
        call SleepCanBreak(1)
    else
        call gotoLocation(mHero,safeLoc2,50)
        call SleepCanBreak(.8)
    endif
    call RemoveLocation(safeLoc2)
    set safeLoc2=null
endfunction

function zs_budao_d_condition takes nothing returns nothing
    if budaobingD==null then
        set zs_action_prioty_arry[0]=0
    else
        set zs_action_prioty_arry[0]=50
    endif
endfunction

function zs_budao_d_action takes integer index returns nothing
    if index!=0 then
        return
    endif
    if budaobingD==null then
        return
    else
        call HeroAttack(budaobingD)
        call Sleep(.9)
    endif
endfunction

function zs_budao_w_condition takes nothing returns nothing
    if budaobingW==null or HeroD==null then
        set zs_action_prioty_arry[1]=0
    else
        set zs_action_prioty_arry[1]=51
    endif
endfunction

function zs_budao_w_action takes integer index returns nothing
    if index!=1 then
        return
    endif
    if budaobingW==null then
        return
    else
        call HeroAttack(budaobingW)
        call SleepCanBreak(.9)
    endif
endfunction

function zs_buchonghp_condition takes nothing returns nothing
    if not isHeroHasHong(mHero)then
        set zs_action_prioty_arry[2]=0
        return
    endif
    if IsRestoreHP(mHero)then
        set zs_action_prioty_arry[2]=0
        return
    endif
    if GetHPVoided(mHero)>500 then
        set zs_action_prioty_arry[2]=56
    endif
    if MyHeroHP<300 then
        set zs_action_prioty_arry[2]=60
    endif
    if HeroD!=null and MyHeroHP<500 and EnemyHeroMP>320 and EnemyHeroLevel>5 then
        set zs_action_prioty_arry[2]=63
    endif
    if GetHPVoided(mHero)>800 and not X2V(HeroD,760)then
        set zs_action_prioty_arry[2]=70
    endif
endfunction

function zs_buchonghp_action takes integer index returns nothing
    if index!=2 then
        return
    endif
	if rangeToHeroD<1000 or AllyCount<2 then
		call HeroRetreat(1600)
	endif
    if(NearestEnemyBubing==null or(not X2V(NearestEnemyBubing,500)and AllyCount>0))and(TowerD==null or not X2V(TowerD,900))and(HeroD==null or not X2V(HeroD,800))then
        call UseItemTargetByID(mHero,'hslv',mHero,.15)
    endif
endfunction

function zs_buchongmp_condition takes nothing returns nothing
    if not isHeroHasLan(mHero)then
        set zs_action_prioty_arry[3]=0
        return
    endif
    if IsRestoreMP(mHero)then
        set zs_action_prioty_arry[3]=0
        return
    endif
    if GetManaVoided(mHero)>180 then
        set zs_action_prioty_arry[3]=49
    endif
endfunction

function zs_buchongmp_action takes integer index returns nothing
    if index!=3 then
        return
    endif
    call HeroRetreat(1600)
    if(NearestEnemyBubing==null or not X2V(NearestEnemyBubing,500))and(TowerD==null or not X2V(TowerD,900))and(HeroD==null or not X2V(HeroD,800))then
        call UseItemByID(mHero,'pclr',.15)
    endif
endfunction

function AUV takes nothing returns nothing
    local integer AWV=8
    set EH=0
    if EnemyHeroLevel<8 then
        set AWV=EnemyHeroLevel
    endif
    if HeroD==null then
        if mHeroLevel<8 then
            set AWV=mHeroLevel
        endif
    endif
    if EnemyHeroMP>145 and EnemyHeroMP<=290 then
        set EH=(AWV/2)*70+50
    endif
    if EnemyHeroMP>295 then
        set EH=AWV*70+50
    endif
    set EH=EH+EnemyHeroLevel*10
    if V6(HeroD)!=0 then
        set EH=R2I(EH*.8)
    endif
    if V6(HeroD)==0 and GetUnitTypeId(HeroD)!=hid_simayi and GetUnitTypeId(NearestHeroD)!=hid_simayi then
        set EH=R2I(EH*.9)
    endif
    if HeroD!=null then
        set ZG=R2I((GetUnitMoveSpeed(mHero)-GetUnitMoveSpeed(HeroD))/49)
        set RG=OG
        if(YG<-6)or(rangeToHeroD>800 and ZG<=0)or MyHeroHP<EH then
            set OG=false
        endif
        if(YG<-6)or(rangeToHeroD>400 and ZG<=0)or MyHeroHP<EH then
            set RG=false
        endif
        if(YG>1)and(rangeToHeroD<800 and RangeToLoc(mHero,zs_cr_retreatLoc)-RangeToLoc(HeroD,zs_cr_retreatLoc)>-200)and MyHeroHP>EH then
            set OG=true
        endif
        if(YG>1)and(rangeToHeroD<800 and RangeToLoc(mHero,zs_cr_retreatLoc)-RangeToLoc(HeroD,zs_cr_retreatLoc)>-200)and MyHeroHP>EH then
            set RG=true
        endif
        if YG<-3 and rangeToTowerD<BV and HeroD!=null and NV>600 then
            set RG=false
            set OG=false
        endif
        if YG<0 and MyHeroHP<EH*1.5 and zs_EnemyHeroNearMeCount>1 then
            set RG=false
            set OG=false
        endif
        if IsRestoreHP(mHero)and MyHeroHP<EH*1.5 and zs_EnemyHeroNearMeCount>1 then
            set RG=false
            set OG=false
        endif
        if zs_HeroPower<-1 then
            set OG=false
            set RG=false
        endif
        if zs_HeroPower<0 and(ZG<0 or(K6(mHero,800)>1 and EnemyHeroLevel>3))then
            set OG=false
            set RG=false
        endif
        if zs_HeroPower>1 and YG>-5 and MyHeroHP>EH then
            set OG=true
            set RG=true
        endif
        if(zs_HeroPower==1 and YG>-2 and zs_allyHeroToHeroDMinRange<630)and MyHeroHP>EH and(TowerD==null or RangeTo(TowerD,HeroD)>800)then
            set OG=true
            set RG=true
        endif
        if(zs_HeroPower==1 and YG>-5 and zs_AllyHeroNearMeCount>0)and(zs_allyHeroToHeroDMinRange<700 or not AngleBetweenThreeUnits(mHero,zs_AllyHeroNearestToHeroD,HeroD))and MyHeroHP>EH and(TowerD==null or RangeTo(TowerD,HeroD)>700)then
            set OG=true
            set RG=true
        endif
        if(zs_HeroPower>0 and YG>-5 and(IsStunned(HeroD)or ZG>0))and MyHeroHP>EH then
            set OG=true
            set RG=true
        endif
        if zs_HeroPower<2 and zs_allyHeroToHeroDMinRange>1000 and ZG<=0 then
            set OG=false
            set RG=false
        endif
        if IsImmune(mHero)and MyHeroHP>EH+200 and YG>-4 and zs_HeroPower>-1 then
            set OG=true
            set RG=true
        endif
        if CW(mHero)then
            set OG=false
            set RG=false
        endif
        if CW(HeroD)and(rangeToHeroD<620 or ZG>0)then
            set OG=true
            set RG=true
        endif
    endif
endfunction

function AYV takes nothing returns nothing
    local location loc=null
    local location loc2=null
    if RangeToLoc(mHero,mBaseLoc)<700 then
        return
        set DI=false
    endif
    if isguanyu()then
        if can_guanyu_cast_d()then
            set loc2=GetUnitLoc(mHero)
            set loc=GetLocBetweenTwoLocsRangeToFirst(loc2,zs_cr_retreatLoc,700)
            call RemoveLocation(loc2)
            set loc2=null
            if RangeToLoc(mHero,zs_cr_retreatLoc)<700 then
                call guanyu_cast_d(zs_cr_attackLoc)
            else
                call guanyu_cast_d(loc)
                call RemoveLocation(loc)
                set loc=null
                set DI=false
                return
            endif
        endif
    endif
    if can_UseFeiXie(mHero)then
        call UseFeiXie(zs_cr_retreatLoc)
        set DI=false
    endif
endfunction

function AZV takes nothing returns nothing
    local location loc=null
    if IsDead(SH)then
        call debugstr("no!!!! huanglong")
    endif
    if gotoLocation(mHero,TH,500)then
        call debugstr("nearhuanglong")
        call HeroAttack(SH)
        call SleepCanBreak(.8)
    else
        call SleepCanBreak(.8)
        call debugstr("go1")
        return
    endif
    if(GetUnitLifePercent(mHero)<75 or(zs_allyHeroToMeMinRange<700 and GetUnitLifePercent(zs_AllyHeroNearestToMe)<75))and S8(mHero)and zs_IsTimeOut(58,20)then
        set loc=GetUnitBackLoc(mHero,200)
        call X_V(loc)
        call RemoveLocation(loc)
        set loc=null
    endif
    if zs_AllyHeroNearMeCount>0 and zs_EnemyHeroNearMeCount==0 then
        if isguanyu()then
            if can_guanyu_cast_x()then
                call guanyu_cast_x(SH)
            endif
        endif
        if isweiyan()then
            if can_weiyan_cast_t()then
                call weiyan_cast_t(SH)
            endif
            if can_weiyan_cast_r()then
                call weiyan_cast_r()
            endif
        endif
        if isZhuGeLiang()then
            if can_zhuge_cast_g()then
                call zhuge_cast_g(SH)
            endif
            if can_zhuge_cast_e()then
                call zhuge_cast_e(SH)
            endif
        endif
        if iszhaoyun()then
            if can_zhaoyun_cast_c()then
                call zhaoyun_cast_c(SH)
            endif
            if can_zhaoyun_cast_b()then
                call can_zhaoyun_cast_b()
            endif
        endif
        if iszhangfei()then
            if RQV()then
                call zhangfei_cast_b()
            endif
        endif
    endif
endfunction

function zs_move_condition takes nothing returns nothing
    local integer A0V=0
    set BH=false
    set BH=rangeToTowerD<BV and(zs_HeroPower<1 or MyHeroHP<800 or mHeroLevel<11)
    if not BH and zs_HeroPower<2 and YG<-4 then
        set BH=true
    endif
    set zs_action_prioty_arry[4]=10
    set YG=0
    set FV=0
    if mHeroLevel>7 then
        set YG=YG+zs_AllyHeroNearMeCount*2
    endif
    set YG=YG+R2I(MyHeroHP/700)
    if isdadi()then
        set YG=YG+5
    endif
    if RangeTo(mHero,NearestEnemyBubing)<260 and attackRange>=500 then
        set FV=FV-1
        set zs_action_prioty_arry[4]=38
        set YG=YG-1
    endif
    if MyHeroHP<EH-100 then
        set zs_action_prioty_arry[2]=60
    endif
    if attackRange>=500 and AllyCount>1 and R4()then
        set FV=FV-2
        call RemoveLocation(WF)
        set WF=null
        set WF=I4()
        if WF!=null then
            set zs_action_prioty_arry[19]=46
        endif
        set YG=YG-2
    endif
    if NV>300 and EnemyCount>0 then
        set FV=FV-3
        set zs_action_prioty_arry[4]=42
        set YG=YG-3
    endif
    if NV<-300 and AllyCount>0 then
        set FV=FV+3
        set YG=YG+3
    endif
    if HeroD!=null and rangeToHeroD<1000 and NearestEnemyBubing!=null and RangeTo(mHero,NearestEnemyBubing)<400 then
        set zs_action_prioty_arry[4]=47
    endif
    set FV=FV+(AllyCount-EnemyCount)/3
    set YG=YG+(AllyCount-EnemyCount)/3
    if AllyCount==0 then
        set FV=FV+(AllyCount-EnemyCount)/2
        set YG=YG+(AllyCount-EnemyCount)/2
    endif
    if EnemyCount>AllyCount+2 and AllyCount<2 then
        set zs_action_prioty_arry[5]=44
    endif
    if NearestEnemyBubingFromRetreatLoc!=null and FarestAllyBubingFromRetreatLoc!=null and RangeTo(mHero,NearestEnemyBubingFromRetreatLoc)<RangeTo(NearestEnemyBubingFromRetreatLoc,FarestAllyBubingFromRetreatLoc)then
        set zs_action_prioty_arry[5]=40
        set FV=FV-2
        set YG=YG-2
    endif
    if EnemyCount>AllyCount+3 and HeroD!=null then
        set zs_action_prioty_arry[5]=48
    endif
    if EnemyCount>2 and AllyCount==1 and GetHP(FarestAllyBubingFromRetreatLoc)<200 then
        set zs_action_prioty_arry[5]=49
        set FV=FV-2
        set YG=YG-2
    endif
    if HeroD==null and(zs_myhero_hpchanged<-10 or(AllyCount==0 and EnemyCount>0 and ZhongliEnemy==null))then
        set zs_action_prioty_arry[5]=47
    endif
    if MyHeroHP<500 and HeroD!=null and EnemyHeroMP>350 and EnemyHeroLevel>5 and rangeToHeroD<900 then
        set zs_action_prioty_arry[5]=49
    endif
    if attackRange<=400 and rangeToTowerD<600 and mHeroLevel<11 then
        set zs_action_prioty_arry[8]=51
        set FV=FV-2
        set YG=YG-2
    endif
    if rangeToTowerD<BV then
        if(FarestAllyBubingFromRetreatLoc==null or(FarestAllyBubingFromRetreatLoc!=null and RangeTo(FarestAllyBubingFromRetreatLoc,TowerD)>500))then
            set FV=FV-6
            set YG=YG-6
        else
            set FV=FV-3
            set YG=YG-3
        endif
    endif
    if U<600 then
        set FV=FV+2
        set YG=YG+2
    endif
    if HeroD!=null then
        set FV=FV+mHeroLevel/5
        set FV=FV+R2I((mHeroLevel-EnemyHeroLevel)/2)
        set FV=FV+R2I((MyHeroHP-EnemyHeroHP)/100)
        set A0V=R2I((MyHeroMP-EnemyHeroMP)/200)
        if A0V>3 then
            set A0V=3
        endif
        if EnemyHeroMP<120 then
            set A0V=A0V+1
        endif
        if MyHeroMP<120 then
            set A0V=A0V-1
        endif
        if EnemyHeroMP<300 then
            set A0V=A0V+1
        endif
        if MyHeroMP<300 then
            set A0V=A0V-1
        endif
        set FV=FV+A0V
        set FV=FV
        set FV=FV+(zs_HeroPower)*5
        if MyHeroHP<600 and EnemyHeroLevel>5 then
            set FV=FV-4
        endif
        if EnemyHeroHP<600 and mHeroLevel>5 then
            set FV=FV+4
        endif
        if CW(mHero)then
            set FV=FV-10
        endif
        if CW(HeroD)then
            set FV=FV+11
        endif
        if ZG<0 then
            set FV=FV-2
        endif
        if ZG>0 then
            set FV=FV+2
        endif
    endif
    if AllyCount==0 and ZhongliEnemy!=null and mHeroLevel<10 then
        set FV=FV-1
    endif
    if MyHeroHP<400 and rangeToTowerD<BV then
        set zs_action_prioty_arry[8]=55
    endif
    if AllyCount==0 and EnemyCount>0 then
        set zs_action_prioty_arry[5]=54
    endif
    if UnitZhiMingJieJie!=null and RangeTo(mHero,UnitZhiMingJieJie)<500 then
        set zs_action_prioty_arry[5]=50
    endif
    if AllyCount==0 and EnemyCount>2 and MyHeroHP<600 then
        set zs_action_prioty_arry[5]=58
    endif
    if HeroD!=null and EnemyCount>2 and AllyCount==1 and GetHP(FarestAllyBubingFromRetreatLoc)<200 then
        set zs_action_prioty_arry[5]=59
    endif
    if HeroD!=null and NV>500 and EnemyCount>2 and mHeroLevel<10 and MyHeroHP<800 and zs_HeroPower<1 then
        set zs_action_prioty_arry[5]=60
    endif
    if MyHeroHP<400 and HeroD!=null and(EnemyHeroMP>280 or IsManaAlmostFull(HeroD))and rangeToHeroD<800 and EnemyHeroLevel>3 then
        set zs_action_prioty_arry[5]=62
    endif
    if zs_AllyHeroNearMeCount==0 and zs_EnemyHeroNearMeCount>=2 and KH<900 then
        set zs_action_prioty_arry[5]=64
    endif
    if MyHeroHP<400 and HeroD!=null and(EnemyHeroMP>350 or IsManaAlmostFull(HeroD))and rangeToHeroD<800 and EnemyHeroLevel>3 then
        set zs_action_prioty_arry[5]=65
    endif
    if HeroD!=null and((AllyCount==0 and EnemyCount>2)or(AllyCount==1 and EnemyCount>5))and MyHeroHP<600 then
        set zs_action_prioty_arry[5]=65
    endif
    if MyHeroHP<300 and HeroD!=null and(EnemyHeroMP>260 or IsManaAlmostFull(HeroD))and rangeToHeroD<800 and EnemyHeroLevel>1 then
        set zs_action_prioty_arry[5]=66
    endif
    if MyHeroHP<600 and HeroD!=null and(EnemyHeroMP>290 or IsManaAlmostFull(HeroD))and EnemyHeroLevel>7 and rangeToHeroD<1000 then
        set zs_action_prioty_arry[5]=67
    endif
    if zs_HeroPower<0 and EnemyHeroLevel>6 and KH<600 then
        set zs_action_prioty_arry[5]=69
    endif
    if HeroD==null and zs_myhero_hpchanged<-80 and MyHeroHP<1000 then
        set zs_action_prioty_arry[5]=70
    endif
    if HeroD!=null and MyHeroHP+300<EnemyHeroHP and MyHeroHP<800 and EnemyHeroMP>350 and EnemyHeroLevel>4 and rangeToHeroD<1000 then
        set zs_action_prioty_arry[5]=69
    endif
    if AllyCount==0 and EnemyCount>2 and MyHeroHP<500 then
        set zs_action_prioty_arry[5]=70
    endif
    if HeroD==null and zs_myhero_hpchanged<-100 and zs_myhero_hpchanged>-200 and MyHeroHP<1000 then
        set zs_action_prioty_arry[5]=70
    endif
    if HeroD!=null and rangeToHeroD>700 and ZG<=0 and zs_allyHeroToHeroDMinRange>600 and(EnemyCount>AllyCount+2 or zs_myhero_hpchanged<-30)then
        set zs_action_prioty_arry[5]=71
    endif
    if HeroD!=null and BH then
        if zs_myhero_hpchanged<-80 then
            set zs_action_prioty_arry[8]=72
        endif
    endif
    if zs_HeroPower<-1 and EnemyHeroLevel>7 and KH<900 then
        set zs_action_prioty_arry[8]=72
    endif
    if MyHeroHP<EH and HeroD!=null and(EnemyHeroMP>300 or IsManaAlmostFull(HeroD))and X2V(HeroD,800)then
        set zs_action_prioty_arry[5]=73
    endif
    if MyHeroHP<600 and HeroD!=null and(EnemyHeroMP>290 or IsManaAlmostFull(HeroD))and EnemyHeroLevel>10 and rangeToHeroD<1000 then
        set zs_action_prioty_arry[5]=74
    endif
    if MyHeroHP<300 and HeroD!=null and rangeToHeroD<800 and EnemyHeroLevel>4 then
        set zs_action_prioty_arry[5]=74
    endif
    if zs_myhero_hpchanged<-80 and BH then
        set zs_action_prioty_arry[8]=74
    endif
    if HeroD!=null and((AllyCount==0 and EnemyCount>5)or(AllyCount==1 and EnemyCount>8))and MyHeroHP<600 then
        set zs_action_prioty_arry[5]=74
    endif
    if MyHeroHP<500 and HeroD!=null and MyHeroHP<EnemyHeroHP-200 and rangeToHeroD<800 and EnemyHeroLevel>5 then
        set zs_action_prioty_arry[5]=74
    endif
    if MyHeroHP<600 and HeroD!=null and rangeToHeroD<800 and EnemyHeroLevel>7 and EnemyHeroMP>290 then
        set zs_action_prioty_arry[5]=74
    endif
    if MyHeroHP<EnemyHeroLevel*75 and HeroD!=null and rangeToHeroD<700 and EnemyHeroLevel<8 and EnemyHeroMP>290 then
        set zs_action_prioty_arry[5]=74
    endif
    if UnitSheXingJieJie!=null and RangeTo(mHero,UnitSheXingJieJie)<930 then
        set zs_action_prioty_arry[5]=73
    endif
    if UnitYanJin!=null and RangeTo(mHero,UnitYanJin)<530 and KH<1500 then
        set zs_action_prioty_arry[5]=77
    endif
    if BH and attackRange<500 and zs_cr_fightline!=1 then
        set zs_action_prioty_arry[8]=75
    endif
    if zs_HeroPower<-2 and EnemyHeroLevel>7 then
        set zs_action_prioty_arry[8]=78
        if ZG<0 then
            set zs_action_prioty_arry[8]=100
        endif
        if KH<800 then
            set OkSunZiBingFa=true
            set VH=1
        endif
    endif
    if HeroD!=null and EnemyCount>AllyCount+5 and MyHeroHP<500 and rangeToHeroD<900 then
        set zs_action_prioty_arry[5]=76
    endif
    if ((zs_AllyHeroNearMeCount==0 and zs_EnemyHeroNearMeCount>=2) or (zs_EnemyHeroNearMeCount - zs_AllyHeroNearMeCount) > 2) then
        set zs_action_prioty_arry[5]=77
        set OkSunZiBingFa=true
        set VH=1
    endif
    if CW(mHero)and HeroD!=null then
        set zs_action_prioty_arry[8]=78
        set OkSunZiBingFa=true
        set VH=1
    endif
    if NearestHeroD!=null and(isZhaoYunHasB(NearestHeroD)or(IsImmune(NearestHeroD)and GetUnitTypeId(NearestHeroD)==hid_guanyu))and(not CW(NearestHeroD))and rangeToHeroD<430 then
        set zs_action_prioty_arry[5]=79
        set OkSunZiBingFa=true
        set VH=1
    endif
    if BH and(FarestAllyBubingFromRetreatLoc==null or(FarestAllyBubingFromRetreatLoc!=null and RangeTo(FarestAllyBubingFromRetreatLoc,TowerD)>500))then
        set zs_action_prioty_arry[8]=60
        if HeroD!=null and rangeToHeroD<800 and GetUnitMoveSpeed(mHero)<=GetUnitMoveSpeed(HeroD)+50 then
            set zs_action_prioty_arry[8]=79
            if MyHeroHP<700 then
                set zs_action_prioty_arry[8]=99
            endif
        endif
    endif
    if BH then
        if HeroD!=null and rangeToHeroD>600 and GetUnitMoveSpeed(mHero)<=GetUnitMoveSpeed(HeroD)+50 then
            set zs_action_prioty_arry[8]=79
            if MyHeroHP<700 and rangeToHeroD>600 then
                set zs_action_prioty_arry[8]=99
            endif
        endif
    endif
    if zs_HeroPower<-1 and EnemyHeroLevel>10 then
        set zs_action_prioty_arry[8]=82
        if KH<800 then
            set OkSunZiBingFa=true
            set VH=1
        endif
    endif
    if zs_HeroPower<-2 and EnemyHeroLevel>11 then
        set zs_action_prioty_arry[8]=92
        if KH<900 then
            set OkSunZiBingFa=true
            set VH=1
        endif
    endif
    if HeroD!=null and EnemyCount-AllyCount>5 and MyHeroHP<600 and rangeToHeroD>600 and GetUnitMoveSpeed(mHero)<=GetUnitMoveSpeed(HeroD)+50 then
        set zs_action_prioty_arry[5]=83
    endif
    if HeroD!=null and AllyCount==0 and EnemyCount>5 and MyHeroHP<500 and zs_HeroPower<2 then
        set zs_action_prioty_arry[5]=85
        set OkSunZiBingFa=true
        set VH=1
    endif
    if HeroD!=null and EnemyCount-AllyCount>10 and MyHeroHP<1000 and zs_HeroPower<2 then
        set zs_action_prioty_arry[8]=86
        set OkSunZiBingFa=true
        set VH=1
    endif
    if HeroD!=null and AllyCount==0 and EnemyCount>6 and(MyHeroHP<800)and zs_HeroPower<2 then
        set zs_action_prioty_arry[5]=88
        set OkSunZiBingFa=true
        set VH=1
    endif
    if HeroD==null and zs_myhero_hpchanged<-260 then
        set zs_action_prioty_arry[5]=99
        set OkSunZiBingFa=true
        set VH=1
    endif
    if HeroD!=null and MyHeroHP<1000 and IsImmune(HeroD)and not CW(HeroD)and V6(mHero)==0 then
        set zs_action_prioty_arry[8]=99
    endif
    if HeroD!=null and MyHeroHP<800 and IsImmune(HeroD)and not CW(HeroD)and V6(mHero)==0 and V6(HeroD)==1 and EnemyHeroLevel>15 then
        set zs_action_prioty_arry[8]=99
    endif
    if IG and zs_IsTimeOut(31,10)then
        if GetPlayerGold(ai_player)>=2450 and zs_NeedToBuy and bBuyItemFlag and(not isHeroHasFengZhang(mHero)and not isHeroHasBianYang(mHero))then
            set zs_action_prioty_arry[6]=59
        endif
        if(not isHeroHasFengZhang(mHero)and not isHeroHasBianYang(mHero))and((GetPlayerGold(ai_player)>1450 and(GetNumberOfItemByID(mHero,'I01S')>0 or GetNumberOfItemByID(mHero,'wneg')>0))or(GetPlayerGold(ai_player)>=450 and GetNumberOfItemByID(mHero,'I01S')>0 and GetNumberOfItemByID(mHero,'wneg')>0))then
            set zs_action_prioty_arry[6]=59
        endif
    endif
    if zs_HeroPower<0 and GetPlayerGold(ai_player)>=1600 and zs_NeedToBuy then
        set zs_action_prioty_arry[6]=60
    endif
    if(not IsLifeAlmostFull(mHero)or not IsManaAlmostFull(mHero))and RangeToLoc(mHero,mBaseLoc)<1600 then
        set zs_action_prioty_arry[6]=63
    endif
    if HeroD!=null and(GetUnitLifePercent(mHero)<40)and MyHeroMP<130 and not isHeroHasLan(mHero)then
        set zs_action_prioty_arry[6]=65
    endif
    if zs_HeroPower<0 and(GetUnitLifePercent(mHero)<60)and MyHeroMP<130 and not isHeroHasLan(mHero)then
        set zs_action_prioty_arry[6]=65
    endif
    if zs_HeroPower<-1 and(GetUnitLifePercent(mHero)<80)then
        set zs_action_prioty_arry[6]=68
    endif
    if zs_HeroPower<0 and(GetUnitLifePercent(mHero)<60 and GetHPVoided(mHero)>1000)then
        set zs_action_prioty_arry[6]=68
    endif
    if zs_AllyHeroNearMeCount==0 and zs_EnemyHeroNearMeCount>2 then
        set zs_action_prioty_arry[6]=69
    endif
    if CW(mHero)and(not LF)and(not isHeroHasHong(mHero))and not IsRestoreHP(mHero)then
        set zs_action_prioty_arry[6]=82
    endif
    if MyHeroHP<300 and(not LF)and(not isHeroHasHong(mHero))and not IsRestoreHP(mHero)and EnemyHeroLevel>4 then
        set zs_action_prioty_arry[6]=83
    endif
    if MyHeroHP<600 and(not LF)and(not isHeroHasHong(mHero))and not IsRestoreHP(mHero)and EnemyHeroMP>350 and EnemyHeroLevel>7 then
        set zs_action_prioty_arry[6]=84
    endif
    if MyHeroHP<800 and mHeroLevel>13 and(not isHeroHasHong(mHero))and not IsRestoreHP(mHero)and zs_HeroPower<1 then
        set zs_action_prioty_arry[6]=84
    endif
    if MyHeroHP<700 and GetHPVoided(mHero)>1000 then
        set zs_action_prioty_arry[6]=84
    endif
    if rangeToHeroD>800 then
        if zs_IsTimeOut(30,120)then
            if GetPlayerGold(ai_player)>=3200 and zs_NeedToBuy and bBuyItemFlag then
                set zs_action_prioty_arry[6]=70
            endif
        endif
    endif
    if RJ!=null and RangeTo(mHero,RJ)<500 then
        set zs_action_prioty_arry[8]=77
    endif
    if TowerD!=null and HeroD!=null then
        if mHeroLevel<6 and MyHeroHP<700 and rangeToTowerD<BV and(FarestAllyBubingFromRetreatLoc==null or(FarestAllyBubingFromRetreatLoc!=null and RangeTo(FarestAllyBubingFromRetreatLoc,TowerD)>600))and zs_myhero_hpchanged<-20 then
            set zs_action_prioty_arry[8]=78
        endif
    endif
    if(HeroD!=null and YG<-7 and ZG<=0 and rangeToHeroD>650)then
        set zs_action_prioty_arry[8]=78
    endif
    if rangeToTowerD<BV and HeroD!=null and MyHeroHP<700 and zs_myhero_hpchanged<-60 then
        set zs_action_prioty_arry[8]=78
    endif
    if zs_AllyHeroNearMeCount==0 and zs_EnemyHeroNearMeCount>1 and KH<800 then
        set zs_action_prioty_arry[8]=77
    endif
    if(HeroD!=null and YG<-5 and(ZG<0 or(ZG==0 and zs_allyHeroToHeroDMinRange>600))and rangeToHeroD>650)then
        set zs_action_prioty_arry[8]=89
    endif
    if zs_AllyHeroNearMeCount==0 and zs_EnemyHeroNearMeCount>2 and KH<900 then
        set OkSunZiBingFa=true
        set VH=1
        set zs_action_prioty_arry[8]=90
    endif
    if mHeroLevel<3 and(not LF)and rangeToTowerD<BV and MyHeroHP<600 then
        set zs_action_prioty_arry[8]=90
    endif
    if RangeToLoc(mHero,mEnemyBaseLoc)<1300 then
        set zs_action_prioty_arry[8]=110
    endif
    if(IsRestoreHP(mHero)or IsRestoreMP(mHero))and AllyCount==0 and EnemyCount>0 then
        set zs_action_prioty_arry[9]=73
    endif
    if(IsRestoreHP(mHero)or IsRestoreMP(mHero))then
        if((HeroD!=null and X2V(HeroD,930))or rangeToTowerD<BV or RangeTo(mHero,NearestEnemyBubing)<600)then
            set zs_action_prioty_arry[9]=73
        endif
        if zs_HeroPower<0 then
            set zs_action_prioty_arry[9]=76
        endif
    endif
    if EnemyCount==0 then
        if SA and zs_cr_fightline==1 and mHeroLevel<10 then
            set zs_action_prioty_arry[11]=42
        endif
        if(SA and zs_cr_fightline==1 and mHeroLevel<11 and(FarestAllyBubingFromRetreatLoc!=null and RangeToLoc(FarestAllyBubingFromRetreatLoc,mBaseLoc)-RangeToLoc(mHero,mBaseLoc)<1600))then
            set zs_action_prioty_arry[11]=43
        endif
    endif
    if HeroD!=null and zs_MyFireLoc!=null and(EnemyCount>AllyCount+3 or AllyCount<2)and(TowerD!=null and RangeToLoc(TowerD,zs_MyFireLoc)<800)then
        set zs_action_prioty_arry[12]=54
    endif
    if budaobingD2!=null then
        set zs_action_prioty_arry[13]=41
    endif
    if HeroD!=null and budaobingW2!=null then
        set zs_action_prioty_arry[14]=40
    endif
    if zs_suguoyinbing and HN==2 and mForceId==1 and mHeroLevel<10 and not isweiyan()then
        set zs_action_prioty_arry[15]=62
    endif
    if zs_weiguoyinbing and HN==2 and mForceId==2 and mHeroLevel<10 then
        set zs_action_prioty_arry[16]=62
    endif
    set LH=rangeToHeroD>800 and(zs_HeroPower>1 or(zs_HeroPower==1 and zs_EnemyHeroNearMeCount==1))and ZG<=0 and zs_AllyHeroNearestToHeroD!=null and zs_allyHeroToHeroDMinRange>700 and KH>700 and MyHeroHP>EH-50 and MyHeroMP>135
    if HN!=zs_cr_fightline and LH and AngleBetweenThreeUnits(mHero,zs_AllyHeroNearestToHeroD,HeroD)then
        if zs_IsTimeOut(50,2)then
            if FP(zs_AllyHeroNearestToHeroD,HeroD)!=null then
                set CH=1
            endif
        endif
    endif
    if KH<700 or YG<-4 or KH>1800 then
        set CH=0
    endif
    if CH==1 then
        set zs_action_prioty_arry[17]=80
    endif
    if mHeroLevel>10 then
        set NJ=3600
    endif
    if mHeroLevel>18 then
        set NJ=4600
    endif
    if KH>900 and MyHeroHP>EH and MyHeroMP>135 and HH==0 and zs_IsTimeOut(52,2)then
        set FH=H6(mHero)
        if FH!=null and RangeTo(mHero,FH)<NJ then
            set GH=D6(FH)
            if GH!=null and RangeTo(GH,FH)<1300 and not AngleBetweenThreeUnits(mHero,FH,GH)then
                set HH=1
            endif
        endif
        if HH==0 then
            set GH=D6(mHero)
            if GH!=null and RangeTo(mHero,GH)<NJ then
                set FH=D6(GH)
                if FH!=null and FH!=mHero then
                    if RangeTo(GH,FH)<1300 and not AngleBetweenThreeUnits(mHero,FH,GH)then
                        set HH=1
                    endif
                    if RangeTo(GH,FH)<NJ and RangeTo(GH,FH)>1300 and RangeTo(GH,mHero)>1300 and RangeToLoc(GH,TH)>900 then
                        set HH=1
                    endif
                endif
            endif
        endif
    endif
    if HH>=1 and((HeroD!=null and rangeToHeroD<800)or IsDead(GH)or RangeTo(mHero,GH)>NJ or MyHeroHP<EH or GetHP(FH)<EH or YG<-4)then
        set HH=0
    endif
    if HH>=1 then
        set zs_action_prioty_arry[18]=55
    endif
	if zs_HeroPower<0 or (zs_EnemyHeroNearMeCount-zs_AllyHeroNearMeCount)>=0 and HeroD != null and rangeToHeroD<800 and (GetHPVoided(mHero)>=(GetHP(mHero)/2)) then
		set zs_action_prioty_arry[20]=49
	endif
    if zs_cr_fightline==103 or zs_cr_fightline==101 then
        if zs_cr_fightline==AO then
            set AO=-1
            set zs_cr_fightline=I9V(mHero)
        endif
    endif
    if zs_cr_fightline!=AO then
        if(AO<100 and(KH<800 or YG<-5 or BH))or(AO>99 and(zs_HeroPower<-1 or YG<-11))then
            set zs_cr_fightline=I9V(mHero)
            set AO=-1
            set YF=false
            set ZF=false
        endif
    endif
    if FV<-7 and MyHeroHP<1000 then
        if zs_action_prioty_arry[5]<59 then
            set zs_action_prioty_arry[5]=59
        endif
    endif
    if FV<-12 and MyHeroHP<1000 then
        if zs_action_prioty_arry[5]<78 then
            set zs_action_prioty_arry[5]=78
        endif
    endif
    if UnitSheXingJieJie!=null and RangeTo(mHero,UnitSheXingJieJie)<100 then
        call AYV()
    endif
    if DI then
        call AYV()
    endif
endfunction

function zs_move_action takes integer index returns nothing
    local location loc=null
	local integer retreatDistance=0
    if index==4 then
        call GoToSaveLocation(mHero)
    endif
    if index==5 then
        call HeroRetreat(1600)
    endif
    if index==6 then
        if can_UseFeiXie(mHero)and RangeToLoc(mHero,mBaseLoc)>3800 then
            call UseFeiXie(zs_cr_retreatLoc)
        endif
        if RangeToLoc(mHero,mBaseLoc)>3800 then
            set OkSunZiBingFa=true
        endif
        call ariveLoc(mHero,mBaseLoc,360)
    endif
    if index==8 then
        call HeroRetreat(1800)
        call SleepCanBreak(1)
    endif
    if index==9 then
        set FR=0
        set MG=0
        call HeroRetreat(1600)
        call SleepCanBreak(.5)
    endif
    if index==11 then
        if zs_action_prioty_arry[11]==32 then
            call gotoLocation(mHero,mdubingLoc,30)
            //call Sleep(.2)
        else
            call dubing(mdubingLoc)
        endif
    endif
    if index==12 then
        call HeroRetreat(3000)
        call SleepCanBreak(3.8)
        set SA=true
    endif
    if index==13 then
        if IQ(mHero,budaobingD2,attackRange)then
            call HeroStop(mHero)
            call SleepCanBreak(.2)
        else
            call SleepCanBreak(.5)
        endif
    endif
    if index==14 then
        if IQ(mHero,budaobingW2,attackRange)then
            call HeroStop(mHero)
            call SleepCanBreak(.5)
        else
            call SleepCanBreak(.5)
        endif
    endif
    if index==15 then
        call XialuYinbing(mHero)
    endif
    if index==16 then
        call WeiGuoXialuYinbing(mHero)
    endif
    if index==17 then
        if DH!=null then
            call debugLoc(DH,1)
            if gotoLocation(mHero,DH,100)then
                set CH=0
                call SleepCanBreak(.5)
            else
                call SleepCanBreak(.8)
            endif
        else
            set CH=0
            call SleepCanBreak(.5)
        endif
    endif
    if index==18 then
        if HH==1 and((TowerD!=null and RangeTo(GH,TowerD)<900))then
            call HeroStop(mHero)
            call SleepCanBreak(.8)
        else
            set HH=2
        endif
        if HH==2 then
            set loc=GetUnitToOuterLocAngle(FH,GH,600,0)
            if gotoLocation(mHero,loc,600)or rangeToHeroD<800 or YG<-4 or zs_HeroPower<0 then
                set HH=0
                call SleepCanBreak(.3)
            else
                call SleepCanBreak(.5)
            endif
            call RemoveLocation(loc)
            set loc=null
        endif
    endif
    if index==19 and WF!=null then
        call gotoLocation(mHero,WF,20)
        call SleepCanBreak(.5)
    endif
	if index==20 then
		set retreatDistance=R2I(GetHPVoided(mHero))
		call debugstr("rd:"+ITS(retreatDistance))
		call HeroRetreat(retreatDistance)
	endif
    if index==75 then
        if TowerD!=null and RangeTo(NearestHeroD,TowerD)<600 then
            call SleepCanBreak(.8)
        else
            set JH=2
        endif
        if JH==2 then
            set loc=GetUnitToOuterLocAngle(H6(mHero),H6(mHero),600,180)
            if gotoLocation(mHero,loc,600)or rangeToHeroD<700 then
                set JH=0
            else
                call SleepCanBreak(.8)
            endif
        endif
    endif
endfunction

function zs_attack_condition_fashi takes nothing returns nothing
    if HeroD!=null then
        if(FV>1 and YG>1)and OG then
            set zs_action_prioty_arry[40]=42
        endif
        if X2V(HeroD,650)or(rangeToHeroD<800 and absolute(RangeToLoc(mHero,zs_cr_retreatLoc)-RangeToLoc(HeroD,zs_cr_retreatLoc))<650)then
            set zs_action_prioty_arry[40]=52
        endif
        if(X2V(HeroD,650)or(rangeToHeroD<800 and absolute(RangeToLoc(mHero,zs_cr_retreatLoc)-RangeToLoc(HeroD,zs_cr_retreatLoc))<650))and FV>4 and YG>-1 then
            set zs_action_prioty_arry[41]=53
        endif
        if MyHeroHP>EnemyHeroHP and MyHeroMP>EnemyHeroMP and OG then
            set zs_action_prioty_arry[41]=55
        endif
        if zs_HeroPower>0 and YG>-3 and OG then
            set zs_action_prioty_arry[41]=58
        endif
        if MyHeroHP>EnemyHeroHP+200 and OG then
            set zs_action_prioty_arry[41]=63
        endif
        if zs_HeroPower>0 and MyHeroHP>600 and OG then
            set zs_action_prioty_arry[41]=71
        endif
        if canZhuGong(HeroD) and(zs_prioty_index!=5 and zs_prioty_index!=8)then
            set zs_action_prioty_arry[41]=60
        endif
        if EnemyHeroHP<300 and(IsLifeAlmostFull(mHero)or MyHeroHP>=600)and OG then
            set zs_action_prioty_arry[41]=76
        endif
        if zs_HeroPower>0 and MyHeroHP>600 and EnemyHeroHP<1000 and OG then
            set zs_action_prioty_arry[41]=77
        endif
        if zs_HeroPower>1 and MyHeroHP>600 and OG then
            set zs_action_prioty_arry[41]=78
        endif
        if zs_HeroPower>1 and MyHeroHP>600 then
            set OkSunZiBingFa=true
            if rangeToHeroD>560 and ZG<=0 then
                set OkTuiMoDao=true
            endif
        endif
        if CW(HeroD)and OG then
            set zs_action_prioty_arry[41]=78
        endif
        if CW(HeroD)and rangeToHeroD<600 then
            set zs_action_prioty_arry[41]=79
        endif
    endif
    if TowerD!=null and MyHeroHP>300 and(FarestAllyBubingFromRetreatLoc!=null and RangeTo(FarestAllyBubingFromRetreatLoc,TowerD)<400)then
        if(HeroD==null or rangeToHeroD>1000)and mHeroLevel>7 then
            set zs_action_prioty_arry[42]=49
        endif
    endif
    if HeroD==null and rangeToTowerD>BV and EnemyCount==1 and NearestEnemyBubing!=null and MyHeroHP>500 and mHeroLevel>3 then
        if AllyCount>0 then
            set zs_action_prioty_arry[46]=38
        else
            set zs_action_prioty_arry[46]=54
        endif
    endif
    if HeroD==null and mHeroLevel>10 and ZhongliEnemy!=null and GetUnitLevel(ZhongliEnemy)<8 and MyHeroHP>300 then
        set zs_action_prioty_arry[45]=72
    endif
    if HeroD==null and rangeToTowerD>BV and EnemyCount<3 and NearestEnemyBubing!=null and MyHeroHP>500 and mHeroLevel>11 then
        if AllyCount>0 then
            set zs_action_prioty_arry[46]=46
        else
            set zs_action_prioty_arry[46]=54
        endif
    endif
    if HeroD==null and rangeToTowerD>BV and mHeroLevel>16 and NearestEnemyBubing!=null and MyHeroHP>500 then
        if AllyCount>0 then
            set zs_action_prioty_arry[46]=46
        else
            set zs_action_prioty_arry[46]=54
        endif
    endif
    if zs_mutong!=null then
        set zs_action_prioty_arry[47]=56
    endif
    if TowerD!=null and GetHP(TowerD)<120 and MyHeroHP>300 and HeroD==null then
        set zs_action_prioty_arry[42]=101
    endif
    if TowerD!=null and GetHP(TowerD)<60 and(AllyCount>0 or MyHeroHP>500)then
        set zs_action_prioty_arry[42]=101
    endif
    if TowerW!=null and GetHP(TowerW)<160 then
        set zs_action_prioty_arry[48]=79
    endif
    if zs_attackEnemyBing!=null then
        set zs_action_prioty_arry[49]=36
    endif
    if UnitTouShiChe!=null and YG>0 then
        set zs_action_prioty_arry[70]=52
    endif
    if UnitYanJin!=null and DQ(mHero,UnitYanJin)then
        set zs_action_prioty_arry[73]=70
    endif
    if UnitZhiMingJieJie!=null then
        set zs_action_prioty_arry[73]=50
    endif
endfunction

function zs_attack_action_fashi takes integer index returns nothing
    if index==40 then
        call MoveAttackUnit(HeroD,attackRange)
    endif
    if index==41 then
        if zs_action_prioty_arry[41]>=75 and rangeToHeroD>1000 and can_UseFeiXie(mHero) and zs_EnemyHeroNearMeCount <= 2 then
            call UseFeiXieU(HeroD)
        endif
        if zs_action_prioty_arry[41]>=75 and rangeToHeroD>600 and can_SunZiBingFa(mHero) and zs_EnemyHeroNearMeCount <= zs_AllyHeroNearMeCount then
            set OkSunZiBingFa=true
        endif
        if zs_action_prioty_arry[41]>=75 and GetUnitMoveSpeed(HeroD)>380 and can_TuiMoDao(mHero) then
            set OkTuiMoDao=true
        endif
        if zs_action_prioty_arry[41]>=75 and rangeToHeroD>600 and can_TuiMoDao(mHero) then
            set OkTuiMoDao=true
        endif
        if (MyHeroHP>700 or(MyHeroHP>EnemyHeroHP+60 and FV>1)) and zs_EnemyHeroNearMeCount <= zs_AllyHeroNearMeCount then
            call ChaseAttackUnit(HeroD) //追击敌人 
        else
            call attackUnitAround(HeroD)		//绕兵打
        endif
    endif
    if index==42 then
        call HeroAttack(TowerD)		//打塔
        call SleepCanBreak(.9)
    endif
    if index==43 then
        call HeroAttack(HeroD)		//打英雄
        call SleepCanBreak(.9)
    endif
    if index==45 and intoUnitRange(ZhongliEnemy,600)then
        call HeroAttack(ZhongliEnemy)	//打中兵
        call SleepCanBreak(.9)
    endif
    if index==46 and intoUnitRange(NearestEnemyBubing,600)then
        call HeroAttack(NearestEnemyBubing)	//打近兵
        call SleepCanBreak(.9)
    endif
    if index==47 then
        call HeroAttack(zs_mutong)	//打桶
        call SleepCanBreak(.9)
    endif
    if index==48 then
        call HeroAttack(TowerW)	//打己方塔
        call SleepCanBreak(.9)
    endif
    if index==49 and intoUnitRange(zs_attackEnemyBing,600)then
        call HeroAttack(zs_attackEnemyBing)
        call SleepCanBreak(.9)
    endif
    if index==70 and intoUnitRange(UnitTouShiChe,600)then
        call ChaseAttackUnit(UnitTouShiChe)    //追击投石车 
    endif
    if index==73 then
        if zs_action_prioty_arry[73]==70 then
            call HeroAttack(UnitYanJin)
            call SleepCanBreak(.9)
        endif
        if zs_action_prioty_arry[73]==50 then
            call HeroAttack(UnitZhiMingJieJie)
            call SleepCanBreak(.9)
        endif
    endif
endfunction

function zs_attack_condition_zhanshi takes nothing returns nothing
    if HeroD!=null then
        if IsRangeAttacker(HeroD)then
            set zs_SafeLocRangeToEnemy=620
        endif
        if IsGroundAttacker(HeroD)then
            set zs_SafeLocRangeToEnemy=500
        endif
        if(EnemyHeroHP<800 or IsLifeAlmostFull(mHero))and RG then
            set zs_action_prioty_arry[40]=39
        endif
        if IsRangeAttacker(HeroD)and YG>0 and RG then
            set zs_action_prioty_arry[41]=51
        endif
        if not IsRangeAttacker(HeroD)and YG>0 and RG then
            set zs_action_prioty_arry[40]=52
        endif
        if MyHeroHP>EnemyHeroHP and MyHeroMP>EnemyHeroMP and FV>3 and RG and rangeToHeroD<300 then
            set zs_action_prioty_arry[41]=52
        endif
        if zs_HeroPower>0 and MyHeroHP>500 and YG>-2 and OG then
            set zs_action_prioty_arry[41]=58
        endif
        if MyHeroHP>EnemyHeroHP+200 and OG and MyHeroHP>500 and YG>-2 then
            set zs_action_prioty_arry[41]=63
        endif
        if zs_HeroPower>0 and MyHeroHP>600 and OG then
            set zs_action_prioty_arry[41]=71
        endif
        if(IsBianXing(HeroD)or IsStunned(HeroD)or IsLocked(HeroD)or IsSlowed(HeroD)or IsSlowStriked(HeroD))and(zs_prioty_index!=5 and zs_prioty_index!=8)then
            set zs_action_prioty_arry[43]=74
        endif
        if zs_HeroPower>0 and EnemyHeroHP<800 and MyHeroHP>500 and OG then
            set zs_action_prioty_arry[41]=75
        endif
        if EnemyHeroHP<300 and(IsLifeAlmostFull(mHero)or MyHeroHP>=600)and OG then
            set zs_action_prioty_arry[41]=76
        endif
        if zs_HeroPower>1 and MyHeroHP>500 and OG then
            set zs_action_prioty_arry[41]=77
        endif
        if CW(HeroD)then
            set zs_action_prioty_arry[41]=78
        endif
        if CW(HeroD)and rangeToHeroD<300 then
            set zs_action_prioty_arry[41]=79
        endif
    endif
    if TowerD!=null and MyHeroHP>300 and(FarestAllyBubingFromRetreatLoc!=null and RangeTo(FarestAllyBubingFromRetreatLoc,TowerD)<600)then
        if(HeroD==null or rangeToHeroD>1000)and mHeroLevel>7 then
            set zs_action_prioty_arry[42]=49
        endif
    endif
    if HeroD==null and mHeroLevel>10 and ZhongliEnemy!=null and GetUnitLevel(ZhongliEnemy)<8 and MyHeroHP>300 then
        set zs_action_prioty_arry[45]=72
    endif
    if HeroD==null and EnemyCount<3 and NearestEnemyBubing!=null and MyHeroHP>500 and mHeroLevel>11 then
        if AllyCount>0 then
            set zs_action_prioty_arry[46]=40
        else
            set zs_action_prioty_arry[46]=54
        endif
    endif
    if HeroD==null and mHeroLevel>16 and NearestEnemyBubing!=null and MyHeroHP>500 then
        if AllyCount>0 then
            set zs_action_prioty_arry[46]=40
        else
            set zs_action_prioty_arry[46]=54
        endif
    endif
    if zs_mutong!=null then
        set zs_action_prioty_arry[47]=70
    endif
    if TowerD!=null and GetHP(TowerD)<120 and MyHeroHP>300 and HeroD==null then
        set zs_action_prioty_arry[42]=101
    endif
    if TowerD!=null and GetHP(TowerD)<60 and(AllyCount>0 or MyHeroHP>500)then
        set zs_action_prioty_arry[42]=101
    endif
    if TowerW!=null and GetHP(TowerW)<160 then
        set zs_action_prioty_arry[48]=79
    endif
    if zs_attackEnemyBing!=null and(mHeroLevel>6 or HeroD==null)then
        set zs_action_prioty_arry[49]=36
    endif
    if UnitTouShiChe!=null and YG>0 then
        set zs_action_prioty_arry[70]=52
    endif
endfunction

function zs_attack_action_zhanshi takes integer index returns nothing
    if index==40 then
        call MoveAttackUnit2(HeroD,200)
    endif
    if index==41 then
        if zs_action_prioty_arry[41]>=75 and rangeToHeroD>600 and can_UseFeiXie(mHero)then
            call UseFeiXieU(HeroD)
        endif
        if zs_action_prioty_arry[41]>=75 and rangeToHeroD>600 then
            set OkSunZiBingFa=true
        endif
        if zs_action_prioty_arry[41]>=75 and GetUnitMoveSpeed(HeroD)>400 and can_TuiMoDao(mHero)then
            set OkTuiMoDao=true
        endif
        if zs_action_prioty_arry[41]>=75 and rangeToHeroD>500 and can_TuiMoDao(mHero)then
            set OkTuiMoDao=true
        endif
        call attackUnitAround2(HeroD)
    endif
    if index==42 then
        call HeroAttack(TowerD)
        call SleepCanBreak(.9)
    endif
    if index==43 then
        call HeroAttack(HeroD)
        call SleepCanBreak(.9)
    endif
    if index==45 and intoUnitRange(ZhongliEnemy,260)then
        call HeroAttack(ZhongliEnemy)
        call SleepCanBreak(.9)
    endif
    if index==46 and intoUnitRange(NearestEnemyBubing,260)then
        call HeroAttack(NearestEnemyBubing)
        call SleepCanBreak(.9)
    endif
    if index==47 then
        call HeroAttack(zs_mutong)
        call SleepCanBreak(.9)
    endif
    if index==48 then
        call HeroAttack(TowerW)
        call SleepCanBreak(.9)
    endif
    if index==49 and intoUnitRange(zs_attackEnemyBing,260)then
        call HeroAttack(zs_attackEnemyBing)
        call SleepCanBreak(.9)
    endif
    if index==70 and intoUnitRange(UnitTouShiChe,220)then
        call attackUnitAround2(UnitTouShiChe)
    endif
endfunction

function zs_attack_condition takes nothing returns nothing
    if not GG then
        if IsRangeAttacker(mHero)then
            call zs_attack_condition_fashi()
        else
            call zs_attack_condition_zhanshi()
        endif
    endif
    if isZhuGeLiang()or isSiMaYi()or isguojia()or isxun()then
        call zs_attack_condition_fashi()
    endif
    if iszhaoyun()or iszhangfei()or isguanyu()or isweiyan()or isdianwei()or iszhangliao()or iscaoren()or isdadi()then
        call zs_attack_condition_zhanshi()
    endif
    if HeroD!=null and MyHeroHP>700 and(rangeToHeroD<700 or ZG>0)then
        if FV>1 and YG>-4 then
            if zs_action_prioty_arry[41]<60 then
                set zs_action_prioty_arry[41]=60
            endif
        endif
        if FV>8 and YG>-4 then
            if zs_action_prioty_arry[41]<77 then
                set zs_action_prioty_arry[41]=77
            endif
        endif
        if zs_HeroPower>0 then
            set zs_action_prioty_arry[41]=77
        endif
    endif
    if KH>800 and EnemyNonAttackStructure!=null and(not BH)then
        set zs_action_prioty_arry[44]=54
    endif
    if KH>800 and EnemyBingYing!=null and rangeToTowerD>771 then
        set zs_action_prioty_arry[44]=78
    endif
    if BF!=null then
        set zs_action_prioty_arry[71]=51
        if HeroD==null then
            set HeroD=BF
        endif
    endif
    if SH!=null and IsAlive(SH)and(AO==102 or AO==103 or zs_cr_fightline==102 or zs_cr_fightline==103)and RangeTo(mHero,SH)<1300 then
        set zs_action_prioty_arry[72]=71
    endif
    if(IsDead(SH)and RangeToLoc(mHero,TH)<800)then
        set AO=1
    endif
    if RangeToLoc(mHero,TH)<800 and MyHeroHP<600 then
        set zs_action_prioty_arry[8]=57
    endif
endfunction

function A7V takes integer index returns nothing
    if index==44 then
        if TowerD!=null and RangeTo(mHero,TowerD)<771 then
            call HeroAttack(TowerD)
            call SleepCanBreak(.9)
            return
        endif
        if NearestEnemyBubing!=null and RangeTo(mHero,NearestEnemyBubing)<600 then
            call HeroAttack(NearestEnemyBubing)
            call SleepCanBreak(.9)
            return
        endif
        if EnemyBingYing!=null then
            call HeroAttack(EnemyBingYing)
            call SleepCanBreak(.9)
        else
            call HeroAttack(EnemyNonAttackStructure)
            call SleepCanBreak(.9)
        endif
    endif
    if index==45 then
        if intoUnitRange(ZhongliEnemy,600)then
            if can_sima_cast_f()then
                call sima_cast_fu(ZhongliEnemy)
            endif
            if can_guojia_cast_n()then
                call guojia_cast_n(ZhongliEnemy)
            endif
            if can_guojia_cast_f()then
                call guojia_cast_f(mHero)
            endif
            if can_caoren_cast_c()then
                call caoren_cast_c(ZhongliEnemy)
            endif
            if can_zhuge_cast_g()and GetUnitLifePercent(ZhongliEnemy)>50 then
                call zhuge_cast_g(ZhongliEnemy)
            endif
            if can_zhuge_cast_e()and GetUnitLifePercent(ZhongliEnemy)>50 then
                call zhuge_cast_e(ZhongliEnemy)
            endif
            if can_xun_cast_g()then
                call xun_cast_gu(ZhongliEnemy)
            endif
            if can_guanyu_cast_d()then
                call guanyu_cast_du(ZhongliEnemy)
            endif
        endif
        if intoUnitRange(ZhongliEnemy,160)then
            if can_dianwei_cast_t()then
                call dianwei_cast_t()
            endif
            if RMV()then
                call RPV()
            endif
        endif
    endif
    if index==71 then
        call HeroAttack(BF)
        call Sleep(.9)
    endif
    if index==72 then
        if not isguanyu()then
            if zs_AllyHeroNearMeCount==0 then
                if NearestEnemyBubing!=null then
                    call HeroAttack(NearestEnemyBubing)
                    call debugstr("NearestEnemyBubing")
                endif
                call Sleep(.8)
                call HeroStop(mHero)
                return
            endif
        endif
        call AZV()
    endif
endfunction

function A8V takes integer index returns nothing
    if not GG then
        if IsRangeAttacker(mHero)then
            call zs_attack_action_fashi(index)
        else
            call zs_attack_action_zhanshi(index)
        endif
    endif
    if isZhuGeLiang()or isSiMaYi()or isguojia()or isxun()or ismadai()or iszhanghe()then
        call zs_attack_action_fashi(index)
    endif
    if iszhaoyun()or iszhangfei()or isguanyu()or isweiyan()or isdianwei()or iszhangliao()or iscaoren()or isdadi()then
        call zs_attack_action_zhanshi(index)
    endif
    if issunquan()or isgongben()then
        call zs_attack_action_zhanshi(index)
    endif
    call A7V(index)
endfunction

function A9V takes nothing returns nothing
    local location loc=null
    local location NVV=null
    local integer AAV=0
    set AAV=GetStoredInteger(zs_gamecache2,"maintimer","testtime")
    if isZhugeCastingE()then
        set AAV=GetStoredInteger(zs_gamecache2,"maintimer","testtime")
        if K1(SG)then
            return
        endif
        set NVV=GetUnitLoc(mHero)
        set loc=GetLocBetweenTwoLocsRangeToFirst(NVV,SG,-500)
        call gotoLocation(mHero,loc,30)
        call Sleep(1.1)
        call RemoveLocation(loc)
        set loc=null
        call RemoveLocation(NVV)
        set NVV=null
        return
    endif
    if U6()then
        set loc=GetLocBetweenTwoUnitsRangeToFirst(mHero,HeroD,-300)
        call gotoLocation(mHero,loc,30)
        call Sleep(.9)
        call RemoveLocation(loc)
        set loc=null
        return
    endif
    if isZhugeCastingX()then
        call P1()
        return
    endif
    call J1()
endfunction

function zs_useitem_condition takes nothing returns nothing
    if HeroD!=null then
        if(IsJuFeng(mHero)and EnemyHeroMP>550)then
            if can_UseFeiXie(mHero)then
                set zs_action_prioty_arry[20]=105
            endif
            set OkSunZiBingFa=true
            if can_UseFengZhang(mHero)then
                set zs_action_prioty_arry[21]=102
            endif
            if can_UseBianXing(mHero)then
                set zs_action_prioty_arry[22]=103
            endif
            if XXV(mHero)then
                set zs_action_prioty_arry[33]=104
            endif
        endif
        if GetUnitLifePercent(mHero)<40 and zs_EnemyHeroNearMeCount>1 and KH<500 and XXV(mHero)then
            set zs_action_prioty_arry[33]=91
        endif
        if not can_sima_cast_n()or not can_zhuge_cast_x()then
            if can_UseBianXing(mHero)then
                set zs_action_prioty_arry[23]=100
            endif
        endif
        if EnemyHeroHP>1800 or IsLifeAlmostFull(HeroD)then
            if can_UseBianXing(mHero)then
                set zs_action_prioty_arry[23]=100
            endif
        endif
        if EnemyHeroHP<600 then
            if can_UseBianXing(mHero)then
                set zs_action_prioty_arry[23]=100
            endif
        endif
        if CW(HeroD)and rangeToHeroD>500 then
            if can_UseFeiXie(mHero)then
                set zs_action_prioty_arry[24]=101
            endif
            set OkSunZiBingFa=true
        endif
        if EnemyHeroHP>1000 and not can_sima_cast_n()and not can_zhuge_cast_x()then
            if can_UseBianXing(mHero)then
                set zs_action_prioty_arry[23]=100
            endif
        endif
        if W6()then
            if not IsImmune(mHero)then
                set zs_action_prioty_arry[25]=85
            endif
        endif
        if Z6()then
            if not IsImmune(mHero)then
                set zs_action_prioty_arry[25]=95
            endif
        endif
    endif
    if VH==1 and can_UseFeiXie(mHero)then
        call UseFeiXie(zs_cr_retreatLoc)
        set VH=0
        set OkSunZiBingFa=false
        set zs_action_prioty_arry[34]=104
    endif
    if VH==2 and can_UseFeiXie(mHero)then
        call UseFeiXieU(HeroD)
        set zs_action_prioty_arry[34]=104
        set VH=0
        set OkSunZiBingFa=false
    endif
    if OkSunZiBingFa then
        if can_SunZiBingFa(mHero)then
            call UseSunZiBingFa()
        endif
    endif
    set VH=0
    set OkSunZiBingFa=false
    if HeroD!=null and can_MengDe(mHero)then
        call UseMengDe(HeroD)
    endif
    if GetHPVoided(mHero)>200 and can_QingNangShu(mHero)then
        call UseQingNangShu()
    endif
    if can_ShenNongBenCao(mHero)and GetHPVoided(mHero)>300 then
        set zs_action_prioty_arry[29]=104
    endif
    if OkTuiMoDao and not can_TuiMoDao(mHero)then
        set OkTuiMoDao=false
    endif
    if HeroD!=null and OkTuiMoDao and can_TuiMoDao(mHero)and zs_IsTimeOut(60,3)then
        set zs_action_prioty_arry[30]=108
    endif
    if zs_allyHeroToMeMinRange<1100 and GetHPVoided(zs_AllyHeroNearestToMe)>300 and can_QingNangShu(mHero)and intoUnitRange(zs_AllyHeroNearestToMe,400)then
        call UseQingNangShu()
    endif
    if GD!=null and(GetItemTypeId(GD)==iid_zhanshenfu or GetItemTypeId(GD)==iid_zhanshenkai or GetItemTypeId(GD)==iid_tianxue or GetItemTypeId(GD)==iid_laojiu or GetItemTypeId(GD)==iid_roubao)then
        set zs_action_prioty_arry[32]=80
    endif
    if GD!=null and GetItemTypeId(GD)=='I00O' and GetHPVoided(mHero)>300 then
        set zs_action_prioty_arry[32]=78
    endif
    if GD!=null and isguanyu()and GetItemTypeId(GD)==iid_longzhixin and QH then
        set zs_action_prioty_arry[32]=102
    endif
    if zs_allyHeroToMeMinRange<800 and GetHPVoided(zs_AllyHeroNearestToMe)>500 and YK(zs_AllyHeroNearestToMe)and not IsRestoreHP(zs_AllyHeroNearestToMe)and GetItemChargesById(zs_AllyHeroNearestToMe,'hslv')<1 and KH>800 and RangeTo(mHero,NearestEnemyBubing)>600 then
        set zs_action_prioty_arry[35]=70
    endif
    if GD!=null and isguanyu()and GetItemTypeId(GD)==iid_longzhixue and QH and GetWidgetLife(GD)>0 then
        set zs_action_prioty_arry[39]=103
        call GQ(GD)
        call Sleep(1)
    endif
endfunction

function NXV takes nothing returns nothing
    local location loc=null
    if can_guanyu_cast_d()then
        if HeroD!=null then
            call guanyu_cast_du(HeroD)
        else
            call guanyu_cast_du(PG)
        endif
        return
    endif
    if CastImdSkillByStr(mHero,aid_xiahouyuan_huixuanzhan,"whirlwind")then
        call Sleep(.3)
        return
    endif
    set loc=GetUnitLoc(NearestHeroD)
    if CastPointSkillByOderStr(mHero,aid_gongben_longzuishan,"dispel",loc)then
        call Sleep(1.2)
        call HeroAttack(HeroD)
        call Sleep(1)
    endif
    call RemoveLocation(loc)
    set loc=null
    if zs_canspelltoHerod then
        if can_caoren_cast_e()then
            call caoren_cast_e(PG)
            return
        endif
        if can_zhaoyun_cast_c()and RangeTo(mHero,PG)<300 then
            call zhaoyun_cast_c(PG)
            return
        endif
        if can_UseBianXing(mHero)then
            call UseBianXing(PG)
            return
        endif
    endif
    if zs_EnemyHeroNearMeCount>1 and XXV(mHero)then
        call XOV()
        return
    endif
    if can_zhangfei_cast_v()then
        call zhangfei_cast_v()
        return
    endif
    if can_UseFeiXie(mHero)then
        call UseFeiXie(zs_cr_retreatLoc)
        return
    endif
    if zs_action_prioty_arry[25]==85 then
        call A9V()
        return
    endif
    if zs_action_prioty_arry[25]>85 then
        if can_guojia_cast_c()then
            call guojia_cast_c(PG)
            return
        endif
        if XXV(mHero)then
            call XOV()
            return
        endif
        if can_zhangfei_cast_v()then
            call zhangfei_cast_v()
            return
        endif
        set OkSunZiBingFa=true
        if isZhugeCastingX()then
            if zs_canspelltoHerod then
                if can_UseFengZhang(mHero)then
                    call Sleep(.36)
                    call XGV(PG)
                    return
                endif
            endif
            call P1()
        else
            call A9V()
        endif
    endif
endfunction

function NOV takes integer index returns nothing
    local location loc=null
    if index==20 and HeroD!=null then
        call Sleep(5.7)
        call UseFeiXie(zs_cr_retreatLoc)
        call Sleep(.3)
        call HeroRetreat(3000)
        call Sleep(2)
    endif
    if index==21 and HeroD!=null then
        call Sleep(5.7)
        call XGV(HeroD)
        call Sleep(.5)
        call HeroRetreat(3000)
        call Sleep(3)
    endif
    if index==22 and HeroD!=null then
        call Sleep(5.7)
        call UseBianXing(HeroD)
        call Sleep(.3)
    endif
    if index==23 and HeroD!=null then
        call UseBianXing(HeroD)
    endif
    if index==24 and HeroD!=null then
        set loc=GetLocBetweenTwoUnitsRangeToFirst(HeroD,mHero,-200)
        call UseFeiXie(loc)
        call RemoveLocation(loc)
        set loc=null
    endif
    if index==25 then
        set MG=0
        set FR=0
        call NXV()
        set PG=null
        set UG=0
    endif
    if index==26 then
    endif
    if index==27 and HeroD!=null and intoUnitRange(HeroD,790)then
        call UseMengDe(HeroD)
    endif
    if index==28 then
        call UseQingNangShu()
    endif
    if index==29 then
        call UseShenNongBenCao(mHero)
    endif
    if index==30 and HeroD!=null and intoUnitRange(HeroD,700)then
        call UseTuiMoDao(HeroD)
        set OkTuiMoDao=false
    endif
    if index==31 and intoUnitRange(zs_AllyHeroNearestToMe,400)then
        call UseQingNangShu()
    endif
    if index==32 then
        if GetItemTypeId(GD)==iid_longzhixin then
            if GetSlotsFreeOnUnit(mHero)==0 then
                if UnitDropItemPoint(mHero,GetItemByID(mHero,'I01R'),GetUnitX(mHero),GetUnitY(mHero))then
                    call Sleep(.5)
                endif
                if UnitDropItemPoint(mHero,GetItemByID(mHero,zs_itemID1[4]),GetUnitX(mHero),GetUnitY(mHero))then
                    call Sleep(.5)
                endif
                if UnitDropItemPoint(mHero,GetItemByID(mHero,zs_itemID2[4]),GetUnitX(mHero),GetUnitY(mHero))then
                    call Sleep(.5)
                endif
                if UnitDropItemPoint(mHero,GetItemByID(mHero,zs_itemID1[5]),GetUnitX(mHero),GetUnitY(mHero))then
                    call Sleep(.5)
                endif
                if UnitDropItemPoint(mHero,GetItemByID(mHero,zs_itemID2[5]),GetUnitX(mHero),GetUnitY(mHero))then
                    call Sleep(.5)
                endif
                if UnitDropItemPoint(mHero,GetItemByID(mHero,iid_zhiliaobang),GetUnitX(mHero),GetUnitY(mHero))then
                    call Sleep(.5)
                endif
            endif
            if GetSlotsFreeOnUnit(mHero)==0 then
                if UnitDropItemPoint(mHero,GetItemByID(mHero,'I004'),GetUnitX(mHero),GetUnitY(mHero))then
                    call Sleep(.5)
                endif
            endif
        endif
        call PickItem(mHero,GD)
        call T2()
    endif
    if index==33 then
        if XOV()then
            return
        endif
        if can_zhangfei_cast_v()then
            call zhangfei_cast_v()
            return
        endif
    endif
    if index==34 then
        call Sleep(.001)
    endif
    if index==35 then
        call UseItemTargetByID(mHero,'hslv',zs_AllyHeroNearestToMe,.15)
    endif
endfunction

function getNearestFLFromBase takes nothing returns integer
    local real max=999999
    local integer index=0
    local integer ri=-1
    loop
        exitwhen index>2 or zs_firelines[index]==null
        if zs_firelines[index]!=null and RangeLocToLoc(mBaseLoc,zs_firelines[index])<max then
            set max=RangeLocToLoc(mBaseLoc,zs_firelines[index])
            set ri=index
        endif
        set index=index+1
    endloop
    return ri
endfunction

function zs_shiftLine_cdt takes nothing returns nothing
    local boolean aidzhonglu=true
    local boolean likaizhonglu=false
    local integer nearestfl=-1
    local integer priority=51
    local integer NDV=-1
    local integer bangbianlu=-1
    local boolean NFV=false
    local integer NGV=-1
    if not LD then
        return
    endif
    if rangeToTowerD<1200 then
        set priority=55
    endif
    if ZhongluAllyHeroCountNearFL>0 and ZhongluEnemyHeroCountNearFL>0 and zs_cr_fightline!=1 then
        set aidzhonglu=true
    endif
    if zs_cr_fightline==1 and HN!=1 and(MyHeroHP<500 or MyHeroHP<130 or ZhongluEnemyHeroCountNearFL==0 or RangeToLoc(HeroD,zs_firelines[1])>1200 or GetHP(zs_AllyHeroNearestToMe)<500 or GetMP(zs_AllyHeroNearestToMe)<200)then
        set likaizhonglu=false
    endif
    if isZhuGeLiang()or isSiMaYi()then
    endif
    if ShangluAllyHeroCountNearFL>0 and ShangluEnemyHeroCountNearFL>0 and((zs_cr_fightline==1 and mHeroLevel>7 and MyHeroHP>500 and MyHeroMP>300)or likaizhonglu)then
        if(TowerD!=null and RangeToLoc(TowerD,zs_MyFireLoc)<1000)or(RF[0]==null or RangeToLoc(RF[0],zs_firelines[0])>2000)then
            set NDV=1
        endif
    endif
    if XialuAllyHeroCountNearFL>0 and XialuEnemyHeroCountNearFL>0 and((zs_cr_fightline==1 and mHeroLevel>7 and MyHeroHP>500 and MyHeroMP>300)or likaizhonglu)then
        if(TowerD!=null and RangeToLoc(TowerD,zs_MyFireLoc)<1000)or(RF[2]==null or RangeToLoc(RF[2],zs_firelines[2])>2000)then
            set NDV=1
        endif
    endif
    if zs_cr_fightline==0 and HN!=0 and(ShangluEnemyHeroCountNearFL==0 or MyHeroHP<500 or MyHeroMP<100 or RangeToLoc(TowerD,zs_MyFireLoc)<1000)then
        set NDV=1
        set NFV=true
    endif
    if zs_cr_fightline==2 and HN!=2 and(XialuEnemyHeroCountNearFL==0 or MyHeroHP<500 or MyHeroMP<100 or RangeToLoc(TowerD,zs_MyFireLoc)<1000)then
        set NDV=1
        set NFV=true
    endif
    if isweiyan()then
        if aidzhonglu and mHeroLevel>1 and MyHeroHP>550 and can_weiyan_cast_t()then
            set NDV=1
        endif
    endif
    if isguanyu()then
        if aidzhonglu and mHeroLevel>5 and MyHeroHP>550 and can_guanyu_cast_x()then
            set NDV=1
        endif
    endif
    if iszhangfei()then
        if aidzhonglu and mHeroLevel>10 and isHeroHasFeiXie(mHero)and MyHeroHP>550 and RMV()then
            set NDV=1
        endif
    endif
    if iszhaoyun()then
        if aidzhonglu and mHeroLevel>15 and MyHeroHP>550 and can_zhaoyun_cast_b()then
            set NDV=1
        endif
    endif
    if isdadi()then
        if aidzhonglu and mHeroLevel>15 and MyHeroHP>550 and can_dadi_cast_c()then
            set NDV=1
        endif
    endif
    if isdianwei()then
        if aidzhonglu and mHeroLevel>5 and MyHeroHP>550 and can_dianwei_cast_t()then
            set NDV=1
        endif
    endif
    if isguojia()then
        if aidzhonglu and mHeroLevel>5 and MyHeroHP>550 and can_guojia_cast_c()then
            set NDV=1
        endif
    endif
    if iszhangliao()then
        if aidzhonglu and mHeroLevel>7 and MyHeroHP>550 and can_zhangliao_cast_fw()then
            set NDV=1
        endif
    endif
    if isxun()then
        if aidzhonglu and mHeroLevel>5 and can_xun_cast_w()and MyHeroHP>550 then
            set NDV=1
        endif
    endif
    if iscaoren()then
        if aidzhonglu and mHeroLevel>2 and MyHeroHP>550 and(can_caoren_cast_g()or can_caoren_cast_c())then
            set NDV=1
        endif
    endif
    if not GG and aidzhonglu then
        if FG==0 and MyHeroHP>600 and MyHeroMP>200 and mHeroLevel>3 then
            set NDV=1
        endif
        if FG==1 and MyHeroHP>700 and mHeroLevel>10 then
            set NDV=1
        endif
        if FG==2 and MyHeroHP>700 and mHeroLevel>8 then
            set NDV=1
        endif
    endif
    if likaizhonglu then
        if NDV==-1 or NDV==zs_cr_fightline then
            set NDV=HN
        endif
    endif
    set nearestfl=getNearestFLFromBase()
    if AS()>25*60 and mHeroLevel>11 then
        set ND=9999
        set likaizhonglu=false
        set NFV=false
        set NDV=-1
        if DF[1]!=null and IsAlive(DF[1])then
            set NDV=1
        endif
        if DF[2]!=null and IsAlive(DF[2])then
            set NDV=1
        endif
        if DF[0]!=null and IsAlive(DF[0])then
            set NDV=1
        endif
		set nearestfl=1
        if nearestfl>-1 and nearestfl!=zs_cr_fightline and RangeLocToLoc(mBaseLoc,zs_firelines[nearestfl])<9000 and J6(zs_firelines[nearestfl],2500)>1 then
            set NDV=nearestfl
        endif
    endif
    if AS()>40*60 or NF!=null and not IG then
        set likaizhonglu=false
        set NFV=false
        if mForceId==1 then
            set NDV=1
        endif
        if mForceId==2 then
            set NDV=1
        endif
    endif
    if nearestfl>-1 and nearestfl!=zs_cr_fightline and RangeLocToLoc(mBaseLoc,zs_firelines[nearestfl])<5000 then
        set priority=56
		set nearestfl = 1
        if nearestfl==0 and ShangluEnemyHeroCountNearFL>1 then
            set NGV=nearestfl
        endif
        if nearestfl==1 and ZhongluEnemyHeroCountNearFL>1 then
            set NGV=nearestfl
        endif
        if nearestfl==2 and XialuEnemyHeroCountNearFL>1 then
            set NGV=nearestfl
        endif
        if AO<99 and NGV>-1 then
            set AO=nearestfl
        endif
    endif
    if NDV>-1 then
        if zs_IsTimeOut(85,50)then
            if AO<99 then
                set AO=NDV
            endif
        endif
    endif
    if NFV or(likaizhonglu and mHeroLevel<16)then
        set AO=NDV
    endif
    if AO>-1 and zs_cr_fightline!=AO then
        if AO>99 then
            set priority=55
        endif
        if AO==103 then
            set priority=57
        endif
        if AO==101 or(AO>=104 and AO<=106)then
            set priority=79
        endif
        set zs_action_prioty_arry[90+AO]=priority
        if AO>99 then
            set zs_action_prioty_arry[99]=priority
        endif
    endif
endfunction

function GetLineLocByRangeFromBase takes integer lineid,real range returns location
    local integer i=0
    if lineid==0 then
        loop
            exitwhen(zs_path_shanglu[i+1]==null or i==20)
            if range>=RangeLocToLoc(mBaseLoc,zs_path_shanglu[i])and range<RangeLocToLoc(mBaseLoc,zs_path_shanglu[i+1])then
                return zs_path_shanglu[i+1]
            endif
            set i=i+1
        endloop
        return zs_path_shanglu[i]
    endif
    set i=0
    if lineid==1 then
        loop
            exitwhen(zs_path_middle[i+1]==null or i==20)
            if range>=RangeLocToLoc(mBaseLoc,zs_path_middle[i])and range<RangeLocToLoc(mBaseLoc,zs_path_middle[i+1])then
                return zs_path_middle[i+1]
            endif
            set i=i+1
        endloop
        return zs_path_middle[i]
    endif
    set i=0
    if lineid==2 then
        loop
            exitwhen(zs_path_xialu[i+1]==null or i==20)
            if range>=RangeLocToLoc(mBaseLoc,zs_path_xialu[i])and range<RangeLocToLoc(mBaseLoc,zs_path_xialu[i+1])then
                return zs_path_xialu[i+1]
            endif
            set i=i+1
        endloop
        return zs_path_xialu[i]
    endif
    if lineid>99 then
        return zs_firelines[lineid]
    endif
    return null
endfunction

function zs_gotoFL takes integer id returns nothing
    local real therange=0
    local real therange2=0
    local location aim1=null
    if id<0 then
        return
    endif
    if JN!=id then
        set YF=false
        set JN=id
    endif
    if RangeToLoc(mHero,mEnemyBaseLoc)<4000 then
        call HeroRetreat(1000)
        call Sleep(2)
    endif
    set therange=RangeLocToLoc(mBaseLoc,zs_firelines[id])
    set therange2=RangeToLoc(mHero,mBaseLoc)
    if therange2<=therange then
        set aim1=GetLineLocByRangeFromBase(id,therange2)
        if gotoLocation(mHero,aim1,1200)then
            set zs_cr_fightline=id
            set YF=false
            set ZF=false
            set aim1=null
            call SleepCanBreak(.3)
            return
        else
            call SleepCanBreak(.8)
        endif
    endif
    if therange2>therange then
        if not YF then
            set aim1=GetLineLocByRangeFromBase(zs_cr_fightline,therange)
            if gotoLocation(mHero,aim1,800)then
                set YF=true
            else
                call SleepCanBreak(.8)
            endif
        endif
        if YF and gotoLocation(mHero,zs_firelines[id],1200)then
            set zs_cr_fightline=id
            set YF=false
            set ZF=false
        else
            call SleepCanBreak(.8)
        endif
    endif
    set aim1=null
endfunction

function zs_shiftLine_action takes integer index returns nothing
    if index==90 then
        call zs_gotoFL(1)
    endif
    if index==91 then
        call zs_gotoFL(1)
    endif
    if index==92 then
        call zs_gotoFL(1)
    endif
    if index==93 then
		call zs_gotoFL(1)
    endif
    if index==99 then
        //call zs_gotoFL(AO)
        call zs_gotoFL(1)
    endif
endfunction

function zs_get_sima_e_damage takes nothing returns integer
    local integer level=1
    set level=GetUnitAbilityLevelZs(mHero,'A07A')
    if level==1 then
        return 75
    endif
    if level==2 then
        return 125
    endif
    if level==3 then
        return 175
    endif
    if level==4 then
        return 275
    endif
    return 0
endfunction

function zs_get_sima_f_damage takes nothing returns integer
    local integer level=GetUnitAbilityLevelZs(mHero,'A03O')
    if level==1 then
        return 90
    endif
    if level==2 then
        return 150
    endif
    if level==3 then
        return 200
    endif
    if level==4 then
        return 250
    endif
    return 0
endfunction

function NUV takes nothing returns integer
    return zs_get_sima_e_damage()+zs_get_sima_f_damage()+60
endfunction

function zs_get_sima_n_damage takes nothing returns integer
    local integer level=GetUnitAbilityLevelZs(mHero,'A041')
    if level==1 then
        return 400
    endif
    if level==2 then
        return 500
    endif
    if level==3 then
        return 600
    endif
    return 0
endfunction

function zs_get_sima_nef_damage takes nothing returns integer
    return zs_get_sima_e_damage()+zs_get_sima_f_damage()+zs_get_sima_n_damage()
endfunction

function NZV takes nothing returns integer
    return zs_get_sima_nef_damage()+NUV()+100
endfunction

function zs_get_zhuge_g_damage takes nothing returns integer
    local integer level=1
    set level=GetUnitAbilityLevelZs(mHero,'A087')
    if level==1 then
        return 80
    endif
    if level==2 then
        return 145
    endif
    if level==3 then
        return 205
    endif
    if level==4 then
        return 265
    endif
    return 0
endfunction

function zs_get_zhuge_e_damage takes nothing returns integer
    local integer level=1
    set level=GetUnitAbilityLevelZs(mHero,'A085')
    if level==1 then
        return 70
    endif
    if level==2 then
        return 120
    endif
    if level==3 then
        return 170
    endif
    if level==4 then
        return 220
    endif
    return 0
endfunction

function zs_get_zhuge_x_damage takes nothing returns integer
    local integer level=1
    set level=GetUnitAbilityLevelZs(mHero,'A083')
    if level==1 then
        return 400
    endif
    if level==2 then
        return 640
    endif
    if level==3 then
        return 880
    endif
    return 0
endfunction

function zs_get_zhuge_lei_damage takes nothing returns integer
    local integer level=0
    local real f=.85
    set level=GetUnitAbilityLevelZs(mHero,'A083')
    if level==1 then
        return R2I(175*f)
    endif
    if level==2 then
        return R2I(250*f)
    endif
    if level==3 then
        return R2I(325*f)
    endif
    return 0
endfunction

function set_spell_damage takes nothing returns nothing
    local integer i=0
    loop
        exitwhen i==10
        set spell_damage_m[i]=0
        set i=i+1
    endloop
    if isSiMaYi()then
        if can_sima_cast_e()then
            set spell_damage_m[0]=zs_get_sima_e_damage()
        endif
        if can_sima_cast_f()then
            set spell_damage_m[1]=zs_get_sima_f_damage()
        endif
        if can_sima_cast_ef()then
            set spell_damage_m[2]=NUV()
        endif
        if can_sima_cast_feng_n_ef()then
            set spell_damage_m[3]=zs_get_sima_nef_damage()
        endif
        if can_sima_cast_bian_n_ef()then
            set spell_damage_m[4]=zs_get_sima_nef_damage()
        endif
        if can_sima_cast_n_ef()then
            set spell_damage_m[5]=zs_get_sima_nef_damage()
            if EnemyCount>3 then
                set spell_damage_m[5]=spell_damage_m[5]+AllyCount*30
            endif
        endif
        if can_sima_cast_ef_feng_n_feng_fe()then
            set spell_damage_m[6]=NZV()
        endif
    endif
    if isZhuGeLiang()then
        if can_zhuge_cast_g()then
            set spell_damage_m[0]=zs_get_zhuge_g_damage()
        endif
        if can_zhuge_cast_eg()then
            set spell_damage_m[1]=zs_get_zhuge_e_damage()+zs_get_zhuge_g_damage()
        endif
        if can_zhuge_cast_feng_e_x_g()then
            set spell_damage_m[2]=zs_get_zhuge_g_damage()+zs_get_zhuge_e_damage()+R2I(zs_get_zhuge_x_damage()*1.5)
        endif
        if can_zhuge_cast_fei_e_x_g()then
            set spell_damage_m[3]=zs_get_zhuge_g_damage()+zs_get_zhuge_e_damage()+R2I(zs_get_zhuge_x_damage()*1.5)
        endif
        if can_zhuge_cast_bian_e_x_g()then
            set spell_damage_m[4]=zs_get_zhuge_g_damage()+zs_get_zhuge_e_damage()+R2I(zs_get_zhuge_x_damage()*1.2)
        endif
        if can_zhuge_cast_x()and rangeToHeroD>600 then
            set spell_damage_m[5]=R2I(zs_get_zhuge_x_damage()*.5)
        endif
        if can_zhuge_cast_x_move_g()and rangeToHeroD>600 then
            set spell_damage_m[6]=R2I((zs_get_zhuge_x_damage()+zs_get_zhuge_g_damage())*.5)
        endif
    endif
endfunction

function getSpellOffDamageIndex takes nothing returns integer
    local integer i=0
    call set_spell_damage()
    loop
        exitwhen i==10
        if isZhuGeLiang()then
        endif
        if spell_damage_m[i]>EnemyHeroHP then
            return i
        endif
        set i=i+1
    endloop
    return-1
endfunction

function sima_spell_condition takes nothing returns nothing
    local integer index=-1
    if not isSiMaYi()then
        return
    endif
    if HeroD!=null and zs_canspelltoHerod then
        set index=getSpellOffDamageIndex()
        if (not canZhuGong(HeroD)) and (EnemyHeroHP>500)and MyHeroMP>300 and rangeToTowerD>1100 and rangeToHeroD<700 and can_sima_cast_ef() and mHeroLevel>6 and OG then
            set zs_action_prioty_arry[52]=82	//EFA	魔血
        endif
        if (not canZhuGong(HeroD)) and zs_HeroPower>0 and can_sima_cast_ef() and mHeroLevel>4 and OG then
            set zs_action_prioty_arry[52]=82	//EFA	魔血
        endif
        if (not canZhuGong(HeroD)) and (EnemyHeroHP>600 or IsLifeAlmostFull(HeroD)or(EnemyHeroHP>300 and mHeroLevel<5))and rangeToTowerD>1100 and MyHeroMP>300 and rangeToHeroD<710 and can_sima_cast_e()and OG then
            set zs_action_prioty_arry[50]=81	//EA
        endif
        if index>=0 and YG>-4 and(rangeToHeroD<900 or ZG>0) then
            set zs_kickoff=true
            set zs_action_prioty_arry[50+index]=99
        endif
        if zs_action_prioty_arry[55]>90 then	//NEFA
            set zs_action_prioty_arry[55]=83
        endif
        if GetUnitCurrentOrder(HeroD)==851986 then	//NEFA
            set zs_action_prioty_arry[55]=0
        endif
        if zs_EnemyHeroNearMeCount>=2 and zs_AllyHeroNearMeCount>=2 and canZhuGong(HeroD) and can_sima_cast_n_ef() then	//NEFA
            set zs_action_prioty_arry[55]=86
		endif
		if EnemyCount==0 and AllyCount > 1 and can_sima_cast_e() then
			set zs_action_prioty_arry[50]=84	//有兵E
		endif
		if zs_EnemyHeroNearMeCount>=2 and zs_AllyHeroNearMeCount>=2 and (not canZhuGong(HeroD)) and can_sima_cast_n_ef() then
			set zs_action_prioty_arry[67]=86	//ENFA
		endif
		if rangeToHeroD<700 and MyHeroHP<200 and (can_UseBianXing(mHero) or can_sima_cast_e()) then	//EorBian逃
			set zs_action_prioty_arry[68]=98	//E逃跑
		endif	
		if zs_canspelltoHerod and IsStunned(HeroD)and EnemyHeroHP>500 and zs_AllyHeroNearMeCount>0 and can_sima_cast_f()then
			set zs_action_prioty_arry[62]=84	//A F A
		endif
		if zs_canspelltoHerod and canZhuGong(HeroD) and EnemyHeroHP>500 and zs_AllyHeroNearMeCount>0 and can_sima_cast_e()then
			set zs_action_prioty_arry[65]=85	//AA E A
		endif	
		return
    endif
    if EnemyHeroHP<NUV()+30+5*mHeroLevel and YG>-1 and MyHeroHP>zs_get_zhuge_g_damage()+100 and OG then
        if zs_action_prioty_arry[41]<68 then
            set zs_action_prioty_arry[41]=68
        endif
    endif
    if(YG<-5 or(not IsUnitType(HeroD,UNIT_TYPE_HERO)))then
        set zs_action_prioty_arry[53]=0
        set zs_action_prioty_arry[56]=0
    endif
    if(YG<-6 or MyHeroHP<zs_get_zhuge_g_damage()+80)and rangeToHeroD>600 and zs_HeroPower<1 and ZG<=0 then
        set zs_action_prioty_arry[50]=0
        set zs_action_prioty_arry[51]=0
        set zs_action_prioty_arry[52]=0
    endif
    if NearestEnemyBubing!=null and EnemyCount>2 and mHeroLevel>6 and can_sima_cast_ef()then
        if MyHeroMP>600 or IsManaAlmostFull(mHero) and (FarestAllyBubingFromRetreatLoc==null or RangeTo(FarestAllyBubingFromRetreatLoc,NearestEnemyBubing)>300)then
            set zs_action_prioty_arry[59]=58	//EF Bing
        endif
        if MyHeroMP>600 or IsManaAlmostFull(mHero) and (FarestAllyBubingFromRetreatLoc!=null and RangeTo(FarestAllyBubingFromRetreatLoc,NearestEnemyBubing)<300)then
            set zs_action_prioty_arry[66]=58	//FE Bing
    endif
    endif
    if TowerD!=null and GetHP(TowerD)<260 and MyHeroHP>200 and can_sima_cast_f()then
        set zs_action_prioty_arry[60]=102	//F Tower
    endif
    if TowerD!=null and GetHP(TowerD)>600 and MyHeroHP>400 and rangeToHeroD>1100 and rangeToTowerD<700 and RangeTo(TowerD, FarestAllyBubingFromRetreatLoc)<600 and can_sima_cast_f() then
        set zs_action_prioty_arry[61]=69	//F Tower
    endif
    if EnemyBingYing!=null and can_sima_cast_f() and RangeTo(mHero,EnemyBingYing)<1000 and rangeToHeroD>1100 then
        set zs_action_prioty_arry[63]=68	//F bingYing
    endif
    if UnitTouShiChe!=null and can_sima_cast_f()and YG>-2 and KH>900 then
        set zs_action_prioty_arry[64]=59
    endif
endfunction

function sima_spell_action takes integer index returns nothing
    if not isSiMaYi()then
        return
    endif
    if index==50 and intoUnitRange(HeroD,600)then	//EA
        if zs_kickoff then
            if can_UseFeiXie(mHero) and rangeToHeroD>1400 and zs_HeroPower>1 then
                call UseFeiXieU(HeroD)
            endif
            if can_UseBianXing(mHero) and (not canZhuGong(HeroD)) then
                call UseBianXing(HeroD)
				call ChaseAttackUnit(HeroD)
				call Sleep(.9)
				call ChaseAttackUnit(HeroD)
				call Sleep(.9)
            endif
        endif
        call sima_cast_e(HeroD)
        call HeroAttack(HeroD)
        call Sleep(.9)
    endif
    if index==51 and intoUnitRange(HeroD,600)then	//FA
        if zs_kickoff then
            if can_UseFeiXie(mHero) and rangeToHeroD>1400 and zs_HeroPower>1 then
                call UseFeiXieU(HeroD)
            endif
            if can_UseBianXing(mHero) and (not canZhuGong(HeroD)) then
                call UseBianXing(HeroD)
            endif
        endif
        call sima_cast_fu2(HeroD)
        call HeroAttack(HeroD)
    endif
    if index==52 then	//EFA
        if zs_kickoff and can_UseFeiXie(mHero) and rangeToHeroD>1400 and intoUnitRange(HeroD,1200)then
            call UseFeiXieU(HeroD)
        endif
        if zs_kickoff and intoUnitRange(HeroD,600) and (not IsBianXing(HeroD)) then
            if can_UseBianXing(mHero) and (not canZhuGong(HeroD)) then
                call UseBianXing(HeroD)
            endif
        endif
        if intoUnitRange(HeroD,600)then
            call sima_cast_ef(HeroD)
            call HeroAttack(HeroD)
            call Sleep(.9)
        endif
    endif
    if index==53 then	//FengNEFA
        if intoUnitRange(HeroD,600)then
            if can_sima_cast_feng_n_ef()then
                call sima_cast_feng_n_ef(HeroD)
                call HeroAttack(HeroD)
            endif
        endif
    endif
    if index==54 then	//BianNEF
        if intoUnitRange(HeroD,600)and can_sima_cast_bian_n_ef()then
            call sima_cast_bian_n_ef(HeroD)
            call HeroAttack(HeroD)
            call Sleep(.9)
        endif
    endif
    if index==55 then	//NEFA
        if intoUnitRange(HeroD,900)then
            call sima_cast_n_ef(HeroD)
            call HeroAttack(HeroD)
            call Sleep(.9)
        endif
    endif
    if index==56 then	//EFFengNFengFE
        if intoUnitRange(HeroD,600)then
            call sima_cast_ef_feng_n_feng_fe(HeroD)
        endif
    endif
    if index==59 and NearestEnemyBubing!=null then	//EF Bing
        if intoUnitRange(NearestEnemyBubing,590)then
            call sima_cast_ef(NearestEnemyBubing)
        endif
    endif
    if index==60 and intoUnitRange(TowerD,600)then	//F Tower
        call sima_cast_fu(TowerD)
    endif
    if index==61 and intoUnitRange(TowerD,600)then	//F Tower
        call sima_cast_fu(TowerD)
    endif
    if index==62 and intoUnitRange(HeroD,800)then	//A F A
        call sima_cast_nu(HeroD)
        call HeroAttack(HeroD)
        call Sleep(.9)
        if can_sima_cast_f() and RangeTo(mHero,HeroD)<650 then
            call sima_cast_fu(HeroD)
        endif
        call HeroAttack(HeroD)
        call Sleep(.9)
    endif
    if index==63 and intoUnitRange(EnemyBingYing,590)then	//F bingYing
        call sima_cast_fu(EnemyBingYing)
    endif
    if index==64 and intoUnitRange(UnitTouShiChe,500)then
        call OVV(UnitTouShiChe)
    endif
	//-----------------------------add by maple-----------------------------
    if index==65 and intoUnitRange(HeroD,800)then	//AA E A 助攻
        call ChaseAttackUnit(HeroD)
        call Sleep(.9)
		if IsBianXing(HeroD) then
			call ChaseAttackUnit(HeroD)
			call Sleep(.9)
		endif
        if can_sima_cast_e() and RangeTo(mHero,HeroD)<650 then
            call sima_cast_e(HeroD)
        endif
        call ChaseAttackUnit(HeroD)
        call Sleep(.9)
    endif	
    if index==66 and NearestEnemyBubing!=null then	//FE Bing
        if intoUnitRange(NearestEnemyBubing,590)then
            call sima_cast_ef(NearestEnemyBubing)
        endif
    endif	
	if index==67 and intoUnitRange(HeroD,600)then	//ENFA 助攻
        call sima_cast_e(HeroD)		
		call sima_cast_n(HeroD)
		if can_sima_cast_f() and IsAlive(HeroD) then
			call sima_cast_fu(HeroD)
		endif
        call HeroAttack(HeroD)
        call Sleep(.9)		
	endif
    if index==68 and intoUnitRange(HeroD,600)then	//技能逃命
        if can_UseBianXing(mHero) and (not canZhuGong(HeroD)) then
            call UseBianXing(HeroD)		
		else
			call sima_cast_e(HeroD)
        endif		
    endif	
endfunction

function zhuge_spell_condition takes nothing returns nothing
    local integer index=-1
    if not isZhuGeLiang()then
        return
    endif
    if HeroD != null and zs_canspelltoHerod then
        set index=getSpellOffDamageIndex()
        if(IsLifeAlmostFull(HeroD)or EnemyHeroHP>1000)and can_zhuge_cast_g() and MyHeroMP>300 and rangeToTowerD>1100 and rangeToHeroD<700 then
            set zs_action_prioty_arry[59]=81	//G Bing
        endif
        if IsBianXing(HeroD) then
            set zs_action_prioty_arry[57]=82	//ChaseA
        endif
        if(EnemyHeroHP<300 or(EnemyHeroHP<zs_get_zhuge_e_damage()+110+mHeroLevel*10))and can_zhuge_cast_e()and OG then
            set zs_action_prioty_arry[57]=81	//ChaseA
        endif
        if can_zhuge_cast_g()and MyHeroMP>500 and rangeToTowerD>1100 and rangeToHeroD<=700 and(FV>2 or zs_action_prioty_arry[41]>50)then
            set zs_action_prioty_arry[50]=83	//GA
        endif
        if can_zhuge_cast_g()and MyHeroMP>280 and rangeToTowerD>1100 and rangeToHeroD<=700 and(zs_action_prioty_arry[41]>56 or FV>2)then
            set zs_action_prioty_arry[50]=83	//GA
        endif
        if zs_HeroPower>0 and can_zhuge_cast_g()and OG then
            set zs_action_prioty_arry[50]=83	//GA
        endif
		if zs_HeroPower>0 and zs_EnemyHeroNearMeCount>=2 and MyHeroHP>EH and can_zhuge_cast_x() and rangeToTowerD>1000 and MyHeroMP>550 and OG then
			set zs_action_prioty_arry[60]=86	// XM
		endif
		if canZhuGong(HeroD) and can_zhuge_cast_x() and zs_EnemyHeroNearMeCount>=2 and (EnemyHeroHP>900 or zs_HeroPower<1)then
			set zs_action_prioty_arry[60]=100	// XM
		endif
		if canZhuGong(HeroD) and zs_HeroPower>0 and can_zhuge_cast_e() then
			set zs_action_prioty_arry[64]=83	//AA EA
		endif
		if MyHeroHP>EH and can_zhuge_cast_g()and EnemyHeroHP<zs_get_zhuge_g_damage()+zs_get_zhuge_e_damage()+120+mHeroLevel*10 and MyHeroMP>295 and rangeToTowerD>1000 and zs_action_prioty_arry[5]<60 and OG then
			set zs_action_prioty_arry[58]=85	//ChaseAG
		endif		
        if index>=0 and YG>-4 and(rangeToHeroD<900 or ZG>0) and zs_HeroPower>0 then
            set zs_kickoff=true
            set zs_action_prioty_arry[50+index]=99
        endif
		if can_zhuge_cast_x() and zs_EnemyHeroNearMeCount>=2 and zs_AllyHeroNearMeCount>=2 and (not canZhuGong(HeroD)) then
			set zs_action_prioty_arry[60]=88	//XMoveA
		endif
		if rangeToHeroD<700 and MyHeroHP<200 and (can_UseBianXing(mHero) or can_zhuge_cast_e()) then	//EorBian逃
			set zs_action_prioty_arry[66]=98	//E逃跑
		endif		
		if EnemyCount==0 and AllyCount > 1 and (not canZhuGong(HeroD)) and (can_UseBianXing(mHero) or can_zhuge_cast_e()) then
			set zs_action_prioty_arry[65]=84	//有兵E Bian
		endif	
		if can_zhuge_cast_fei_e_x_g() and zs_HeroPower>0 and zs_EnemyHeroNearMeCount >=2 and RangeTo(NearestHeroD,zs_AllyHeroNearestToHeroD)<600 then
			set zs_action_prioty_arry[53]=86		//FEXGA
		endif	
		return
    endif

    if zs_nearestMinHpEnemyBing!=null and zs_nearestEnemyBingMinHp<zs_get_zhuge_g_damage()and EnemyCount>2 and mHeroLevel>7 and can_zhuge_cast_g()then
        if MyHeroMP>500 or IsManaAlmostFull(mHero)then
            set zs_action_prioty_arry[59]=58	//G Bing
        endif
    endif
    if zs_nearestMinHpEnemyBing!=null and zs_nearestEnemyBingMinHp<zs_get_zhuge_g_damage()and EnemyCount>2 and mHeroLevel>15 and can_zhuge_cast_e()then
        if MyHeroMP>500 or IsManaAlmostFull(mHero)then
            set zs_action_prioty_arry[67]=57	//E Bing
        endif
    endif	
    if zs_nearestMinHpEnemyBing!=null and zs_nearestEnemyBingMinHp<zs_get_zhuge_g_damage()and EnemyCount>1 and mHeroLevel>2 and can_zhuge_cast_g()then
        if MyHeroMP>600 or IsManaAlmostFull(mHero)then
            set zs_action_prioty_arry[59]=58	//G Bing
        endif
    endif
    if zs_get_zhuge_lei_damage()>LowestEnemyHeroHp and RangeTo(mHero,zs_weakestEnemyHero) > 1500 and IsUnitVisible(zs_weakestEnemyHero,ai_player)and RangeTo(D6(zs_weakestEnemyHero),zs_weakestEnemyHero)>600 and can_zhuge_cast_x()and not IsImmune(zs_weakestEnemyHero)then
        set zs_action_prioty_arry[61]=100	//Lei
    endif
    if CW(mHero)and zs_EnemyHeroNearMeCount>1 and can_zhuge_cast_x()then
        set zs_action_prioty_arry[62]=100	//Wu	
    endif
    if HeroD!=null and IsImmune(HeroD)and rangeToHeroD<300 and can_zhuge_cast_x()and MyHeroHP>800 and(zs_action_prioty_arry[5]<60 and zs_action_prioty_arry[8]<60)and OG then
        set zs_action_prioty_arry[63]=99	//Xue
    endif
    if can_zhuge_cast_eg() and can_zhuge_cast_x() and ((EnemyHeroHP<500 or(zs_HeroPower>1 and EnemyHeroHP<1000))and zs_EnemyHeroNearMeCount==1)or(not IsUnitType(HeroD,UNIT_TYPE_HERO))then
        set zs_action_prioty_arry[52]=0		//EXGA
    endif
    if(YG<-5 and zs_HeroPower<=0)then
        set zs_action_prioty_arry[56]=0
    endif
    if MyHeroHP<EH-20 and zs_HeroPower<=0 and(rangeToHeroD>620)then
        set zs_action_prioty_arry[56]=0
    endif
    if (EnemyBingYing!=null or TowerD!=null) and can_zhuge_cast_w() and RangeTo(mHero,EnemyBingYing)<700 and rangeToHeroD>1100 and RangeTo(TowerD,FarestAllyBubingFromRetreatLoc)<400 then
        set zs_action_prioty_arry[68]=68	//W bingYing
    endif	
endfunction

function zhuge_spell_action takes integer index returns nothing	//诸葛
    if not isZhuGeLiang()then
        return
    endif
    if index==50 then	//GA
        if zs_kickoff then
            if can_UseFeiXie(mHero) and rangeToHeroD>1400 and zs_HeroPower>1 then
                call UseFeiXieU(HeroD)
            endif
            if can_UseBianXing(mHero) and (not canZhuGong(HeroD))then
                call UseBianXing(HeroD)
				call ChaseAttackUnit(HeroD)
				call Sleep(.9)
				call ChaseAttackUnit(HeroD)
				call Sleep(.9)				
            endif
        endif
        call zhuge_cast_g(HeroD)
        call HeroAttack(HeroD)
    endif
    if index==51 then	//EGA
        if zs_kickoff then
            if can_UseFeiXie(mHero) and rangeToHeroD>1400 and zs_HeroPower>1 then
                call UseFeiXieU(HeroD)
            endif
            if can_UseBianXing(mHero) and (not canZhuGong(HeroD)) then
                call UseBianXing(HeroD)
            endif
        endif
        if intoUnitRange(HeroD,600)then
            call zhuge_cast_e(HeroD)
            call zhuge_cast_g(HeroD)
            call HeroAttack(HeroD)
        endif
    endif
    if index==52 then	//FengEXGA
        if intoUnitRange(HeroD,600)then
            call zhuge_cast_feng_e_x_g(HeroD)
            call HeroAttack(HeroD)
        endif
    endif
    if index==53 then	//FeiEXGA
        if intoUnitRange(HeroD,800)then
            call zhuge_cast_fei_e_x_g(HeroD)
            call HeroAttack(HeroD)
        endif
    endif
    if index==54 then	//BianEXGA
        if intoUnitRange(HeroD,600)then
            call zhuge_cast_bian_e_x_g(HeroD)
            call HeroAttack(HeroD)
        endif
    endif
    if index==55 then	//XMoveA
        if intoUnitRange(HeroD,700)then
            call zhuge_cast_x_move(HeroD)
            call HeroAttack(HeroD)
        endif
    endif
    if index==56 then	//XMoveGA
        if intoUnitRange(HeroD,700)then
            call zhuge_cast_x_move_g(HeroD)
            call HeroAttack(HeroD)
        endif
    endif
    if index==57 then	//ChaseA
        if zs_HeroPower>1 and rangeToHeroD>1400 and can_UseFeiXie(mHero)then
            call UseFeiXieU(HeroD)
        endif
        if intoUnitRange(HeroD,600)then
            if OMV(HeroD)then
                call ChaseAttackUnit(HeroD)
            endif
        endif
    endif
    if index==58 and intoUnitRange(HeroD,600)then	//ChaseAG
        if OMV(HeroD)then
            call ChaseAttackUnit(HeroD)
            call Sleep(.1)
            call zhuge_cast_g(HeroD)
        endif
    endif
    if index==59 and zs_nearestMinHpEnemyBing!=null then	//G Bing
        if intoUnitRange(zs_nearestMinHpEnemyBing,700)then
            call zhuge_cast_g(zs_nearestMinHpEnemyBing)
        endif
    endif
    if index==60 and intoUnitRange(HeroD,600)then	// XM
        if OMV(HeroD)then
            if can_zhuge_cast_x()then
                call zhuge_cast_x_move(HeroD)
            endif
            if can_zhuge_cast_g()then
                call zhuge_cast_g(HeroD)
            endif
        endif
    endif
    if index==61 then	//Lei
        call zhuge_cast_lei()	
    endif
    if index==62 then	//Wu
        call zhuge_cast_wu()
    endif
    if index==63 then	//Xue
        call zhuge_cast_xue()
    endif
	//------------------------------------add by maple--------------------------------------
    if index==64 then	//AA E A
		call ChaseAttackUnit(HeroD)
        call Sleep(.9)
		if IsBianXing(HeroD) then
			call ChaseAttackUnit(HeroD)
			call Sleep(.9)
		endif	
		if can_zhuge_cast_e() then
			call zhuge_cast_e(HeroD)
		endif
        call ChaseAttackUnit(HeroD)
        call Sleep(.9)		
    endif	
    if index==65 then	//YangE
		if can_UseBianXing(mHero)then
			call UseBianXing(HeroD)
    		call ChaseAttackUnit(HeroD)
            call Sleep(.9)
    		call ChaseAttackUnit(HeroD)
    		call Sleep(.9)
		endif	
        if can_zhuge_cast_e() then
			call zhuge_cast_e(HeroD)	
		endif
    endif	
    if index==66 then	//技能逃跑
        if can_UseBianXing(mHero) and (not canZhuGong(HeroD)) then
            call UseBianXing(HeroD)		
		else
			call zhuge_cast_e(HeroD)	
		endif
    endif	
    if index==67 and zs_nearestMinHpEnemyBing!=null then	//E Bing
        if intoUnitRange(zs_nearestMinHpEnemyBing,600)then
            call zhuge_cast_e(zs_nearestMinHpEnemyBing)
        endif
    endif	
	if index==68 then		
		if TowerD != null then
			call zhuge_cast_w(TowerD)			
		elseif EnemyBingYing != null then
			call debugstr("zhuge_cast_w")
			call zhuge_cast_w(EnemyBingYing)
		endif
	endif
endfunction

function zhangliao_spell_condition takes nothing returns nothing
    if not iszhangliao()then
        return
    endif
    if zs_canspelltoHerod then
        if(EnemyHeroHP>1500)and rangeToTowerD>1100 and OG and can_zhangliao_cast_fw()and mHeroLevel>3 then
            set zs_action_prioty_arry[51]=69
        endif
        if EnemyHeroHP<900 and can_zhangliao_cast_fw()and OG then
            set zs_action_prioty_arry[51]=81
        endif
        if zs_HeroPower>0 and can_zhangliao_cast_fw()and OG then
            set zs_action_prioty_arry[51]=83
        endif
        if EnemyHeroHP<900 and can_zhangliao_cast_fw()and can_UseFeiXie(mHero)then
            set zs_action_prioty_arry[52]=81
        endif
    endif
    if HeroD==null and NearestEnemyBubing!=null and EnemyCount>2 and mHeroLevel>7 and can_zhangliao_cast_w()then
        if MyHeroMP>300 or IsManaAlmostFull(mHero)then
            set zs_action_prioty_arry[50]=52
        endif
    endif
    if HeroD!=null and isZhaoYunHasB(HeroD)and IsImmune(HeroD)then
    endif
endfunction

function zhangliao_spell_action takes integer index returns nothing
    local location loc=null
    if not iszhangliao()then
        return
    endif
    if index==50 and intoUnitRange(NearestEnemyBubing,120)then
        call zhangliao_cast_wu(NearestEnemyBubing)
    endif
    if index==51 then
        if zs_HeroPower>0 and rangeToHeroD>400 and can_UseFeiXie(mHero)then
            call UseFeiXie(loc)
            call zhangliao_cast_fw(HeroD)
        endif
        if intoUnitRange(HeroD,400)then
            call zhangliao_cast_fw(HeroD)
        endif
    endif
    if index==52 and intoUnitRange(HeroD,800)then
        set loc=GetLocBetweenTwoUnitsRangeToFirst(HeroD,mHero,-120)
        call UseFeiXie(loc)
        call zhangliao_cast_fw(HeroD)
    endif
    if index==53 then
        set loc=GetLocBetweenTwoUnitsRangeToFirst(mHero,HeroD,900)
        if can_UseFeiXie(mHero)then
            call UseFeiXie(loc)
        endif
        call HeroRetreat(3000)
        call Sleep(2)
    endif
    if loc!=null then
        call RemoveLocation(loc)
        set loc=null
    endif
endfunction

function zhaoyun_spell_condition takes nothing returns nothing
    if not iszhaoyun()then
        return
    endif
    if zs_canspelltoHerod and can_zhaoyun_cast_c()then
        if(IsLifeAlmostFull(HeroD)or EnemyHeroHP>1500)and rangeToTowerD>1100 and rangeToHeroD<300 then
            set zs_action_prioty_arry[50]=86
        endif
    endif
    if zs_canspelltoHerod and can_zhaoyun_cast_c()then
        if(EnemyHeroHP<300)and rangeToTowerD>1100 and rangeToHeroD<300 then
            set zs_action_prioty_arry[50]=99
        endif
    endif
    if HeroD!=null and can_zhaoyun_cast_b()then
        set zs_action_prioty_arry[51]=85
    endif
    if HeroD!=null and isZhaoYunHasB(mHero)and MyHeroHP>600 then
        set zs_action_prioty_arry[52]=87
    endif
    if HeroD!=null and IsImmune(mHero)and isZhaoYunHasB(mHero)and MyHeroHP>500 then
        set zs_action_prioty_arry[52]=95
    endif
    if HeroD!=null and can_zhaoyun_cast_b()and XXV(mHero)then
        set zs_action_prioty_arry[53]=97
    endif
    if UnitTouShiChe!=null and GetUnitMoveSpeed(UnitTouShiChe)<350 and isZhaoYunHasB(mHero)and MyHeroHP>660 and KH>700 then
        set zs_action_prioty_arry[54]=88
        if IsImmune(mHero)then
            set zs_action_prioty_arry[54]=96
        endif
    endif
    if NearestHeroD!=null and(zs_prioty_index==5 or zs_prioty_index==8)and not IsImmune(NearestHeroD)and rangeToHeroD<300 and can_zhaoyun_cast_c()then
        set zs_action_prioty_arry[55]=81
    endif
endfunction

function zhaoyun_spell_action takes integer index returns nothing
    if not iszhaoyun()then
        return
    endif
    if index==50 and intoUnitRange(HeroD,220)then
        call zhaoyun_cast_c(HeroD)
        call HeroAttack(HeroD)
        call Sleep(.8)
    endif
    if index==51 and intoUnitRange(HeroD,700)then
        call zhaoyun_cast_b()
    endif
    if index==52 then
        if(rangeToHeroD>500 or GetUnitMoveSpeed(HeroD)>390)and can_TuiMoDao(mHero)then
            set OkTuiMoDao=true
        endif
        call HeroAttack(HeroD)
        call Sleep(1)
    endif
    if index==53 and intoUnitRange(HeroD,700)then
        call XOV()
        call Sleep(.2)
        call zhaoyun_cast_b()
    endif
    if index==54 then
        call HeroAttack(UnitTouShiChe)
        call Sleep(1)
    endif
    if index==55 and intoUnitRange(NearestHeroD,220)then
        call zhaoyun_cast_c(NearestHeroD)
        call HeroRetreat(1000)
    endif
endfunction

function guanyu_spell_condition takes nothing returns nothing
    if not isguanyu()then
        return
    endif
    if zs_IsTimeOut(57,2.6)then
        if not MH and GetNumberOfItemByID(mHero,iid_longzhixin)>0 then
            set MH=true
        endif
        if not PH and GetNumberOfItemByID(mHero,iid_guanyuzhuanshu)>0 then
            set PH=true
        endif
        if not MH and not PH and GetNumberOfItemByID(mHero,iid_qinghongjian)>0 then
            set QH=true
        else
            set QH=false
        endif
        if IsDead(SH)or SH==null then
            call F3()
        endif
    endif
    if MH and not PH and GetPlayerGold(ai_player)>2800 then
        set zs_action_prioty_arry[6]=59
    endif
    if zs_canspelltoHerod and can_guanyu_cast_x()then
        if(EnemyHeroHP>1200 and MyHeroMP>500)and rangeToTowerD>1100 and(rangeToHeroD<700 or GetUnitMoveSpeed(mHero)>=GetUnitMoveSpeed(HeroD)+50)and OG then
            set zs_action_prioty_arry[50]=78
        endif
        if zs_HeroPower>0 and(rangeToHeroD<700 or GetUnitMoveSpeed(mHero)>=GetUnitMoveSpeed(HeroD)+50)and OG then
            set zs_action_prioty_arry[50]=81
        endif
        if CW(HeroD)and(rangeToHeroD<700 or GetUnitMoveSpeed(mHero)>=GetUnitMoveSpeed(HeroD)+50)then
            set zs_action_prioty_arry[50]=82
        endif
        if EnemyHeroHP<300 and mHeroLevel>7 then
            set zs_action_prioty_arry[50]=81
        endif
    endif
    if TowerD!=null and can_guanyu_cast_d()and GetHP(TowerD)<200 then
        set zs_action_prioty_arry[51]=89
    endif
    if zs_canspelltoHerod and can_guanyu_cast_xd()then
        if(IsLifeAlmostFull(HeroD)or EnemyHeroHP>1500)and rangeToTowerD>1100 and OG then
            set zs_action_prioty_arry[52]=85
        endif
        if zs_HeroPower>0 and OG then
            set zs_action_prioty_arry[52]=85
        endif
    endif
    if zs_canspelltoHerod and can_guanyu_cast_xd()and EnemyHeroHP<800 and mHeroLevel>11 and OG then
        set zs_action_prioty_arry[52]=86
    endif
    if zs_canspelltoHerod and can_guanyu_cast_xd()and EnemyHeroHP<500 and OG then
        set zs_action_prioty_arry[52]=91
    endif
    if zs_EnemyHeros[5]!=null and IsImmune(mHero)and RangeTo(mHero,zs_EnemyHeros[5])<300 then
        set HeroD=zs_EnemyHeros[5]
    endif
    if HeroD!=null and(not IsJuFeng(HeroD))and rangeToHeroD<280 and EnemyHeroHP>300 and RKV()then
        set zs_action_prioty_arry[53]=88
    endif
    if HeroD!=null and IsImmune(mHero)then
        set zs_action_prioty_arry[54]=90
    endif
    if HeroD!=null and IsImmune(mHero)and mHeroLevel>11 and MyHeroHP>500 then
        set zs_action_prioty_arry[54]=103
    endif
    if isGuanyuXuanFeng(mHero)then
    endif
    if zs_canspelltoHerod and can_guanyu_cast_x()and MyHeroMP>350 and EnemyHeroHP>400 and RKV()and OG then
        set zs_action_prioty_arry[55]=93
    endif
    if HeroD!=null and can_guanyu_cast_d()and MyHeroMP>350 and EnemyHeroHP>400 and RKV()then
        set zs_action_prioty_arry[56]=92
    endif
    if zs_canspelltoHerod and can_guanyu_cast_xd()and MyHeroMP>550 and EnemyHeroHP>600 and RKV()and GetUnitCurrentOrder(HeroD)!=851986 then
        set zs_action_prioty_arry[57]=94
    endif
    if HeroD!=null and can_guanyu_cast_d()and IsJuFeng(mHero)then
        set zs_action_prioty_arry[58]=87
    endif
    if HeroD!=null and can_guanyu_cast_d()and CW(mHero)then
        set zs_action_prioty_arry[59]=83
    endif
    if HeroD!=null and EnemyHeroHP>500 and rangeToHeroD<300 and RKV()then
        set zs_action_prioty_arry[60]=84
    endif
    if zs_EnemyHeros[5]!=null and GetUnitLifePercent(zs_EnemyHeros[5])<70 and MyHeroHP>500 and RangeTo(mHero,zs_EnemyHeros[5])<700 and RKV()then
        set zs_action_prioty_arry[61]=90
    endif
    if QH and mHeroLevel>15 and SH!=null and IsAlive(SH)and(GetPlayerGold(ai_player)>620 or AO==102)then
        if RangeTo(mHero,SH)>1200 and zs_IsTimeOut(59,3)then
            call JQ(TH)
        endif
        if GetPlayerGold(ai_player)>620 then
            set AO=102
            if RangeTo(mHero,SH)>1000 and RangeTo(mHero,SH)<2500 then
                if not S8(mHero)then
                    call T8()
                endif
            endif
        endif
        if S8(mHero)then
            set AO=102
        endif
        if IsDead(SH)or KH<800 then
            set AO=1
        endif
        if RangeTo(mHero,SH)<600 then
            set zs_action_prioty_arry[62]=71
        endif
    endif
    if(not QH or IsDead(SH))and RangeTo(mHero,SH)<600 then
        set AO=1
    endif
    if PH and MyHeroHP>1000 and MyHeroMP>500 and RKV()then
        if AO<100 or AO==103 or AO==102 then
            if IsAlive(NF)then
                set KI=NF
            endif
        endif
        if AO<100 or AO==103 or AO==102 then
            if IsAlive(DF[2])then
                set zs_firelines[104]=FF[2]
                set KI=DF[2]
            endif
        endif
        if AO<100 or AO==103 or AO==102 then
            if IsAlive(DF[1])then
                set zs_firelines[105]=FF[1]
                set KI=DF[1]
            endif
        endif
        if AO<100 or AO==103 or AO==102 then
            if IsAlive(DF[0])then
                set zs_firelines[106]=FF[0]
                set KI=DF[0]
            endif
        endif
        if IsAlive(EnemyBingYing)then
            set KI=EnemyBingYing
        endif
        if IsAlive(NF)then
            set KI=NF
        endif
        if RangeTo(mHero,KI)>1300 then
            set KI=null
        endif
    endif
    if PH and IsAlive(KI)and((MyHeroHP>1600 and MyHeroMP>500)or(RangeTo(mHero,KI)<1000 and MyHeroHP>800))and RKV()then
        set zs_action_prioty_arry[63]=105
    else
        if AO==101 or(AO>=104 and AO<=106)then
            set AO=I9V(mHero)
        endif
    endif
    if IsImmune(mHero)and PH and(IsAlive(KI)and RangeTo(mHero,KI)<400)then
        set zs_action_prioty_arry[64]=106
    endif
endfunction

function guanyu_spell_action takes integer index returns nothing
    local location loc=null
    if not isguanyu()then
        return
    endif
    if index==50 and intoUnitRange(HeroD,450)then
        call guanyu_cast_x(HeroD)
        call HeroAttack(HeroD)
        call Sleep(.8)
    endif
    if index==51 and intoUnitRange(TowerD,800)then
        call guanyu_cast_du(TowerD)
    endif
    if index==52 and intoUnitRange(HeroD,450)then
        call guanyu_cast_xd(HeroD)
    endif
    if index==53 and intoUnitRange(HeroD,200)then
        call RLV()
    endif
    if index==54 then
        if rangeToHeroD>400 and can_UseFeiXie(mHero)then
            set loc=GetLocBetweenTwoUnitsRangeToFirst(HeroD,mHero,-180)
            call UseFeiXie(loc)
            call RemoveLocation(loc)
            set loc=null
        endif
        if(rangeToHeroD>260 or GetUnitMoveSpeed(HeroD)>390)and can_TuiMoDao(mHero)then
            set OkTuiMoDao=true
        endif
        set loc=GetLocBetweenTwoUnitsRangeToFirst(HeroD,mHero,-180)
        call gotoLocation(mHero,loc,30)
        call RemoveLocation(loc)
        set loc=null
        call Sleep(.2)
    endif
    if index==55 and intoUnitRange(HeroD,450)then
        call guanyu_cast_x(HeroD)
        call HeroAttack(HeroD)
        call Sleep(1.2)
        if GetHP(HeroD)<200 then
            return
        endif
        if intoUnitRange(HeroD,250)then
            call RLV()
        endif
    endif
    if index==56 and intoUnitRange(HeroD,800)then
        set loc=GetUnitLoc(HeroD)
        call guanyu_cast_d(loc)
        call RemoveLocation(loc)
        set loc=null
        call HeroAttack(HeroD)
        call Sleep(.86)
        if GetHP(HeroD)<200 then
            return
        endif
        if intoUnitRange(HeroD,250)then
            call RLV()
        endif
    endif
    if index==57 and intoUnitRange(HeroD,800)then
        set loc=GetUnitLoc(HeroD)
        call guanyu_cast_d(loc)
        call RemoveLocation(loc)
        set loc=null
        call HeroAttack(HeroD)
        call Sleep(.9)
        if can_guanyu_cast_x()then
            call guanyu_cast_x(HeroD)
            call HeroAttack(HeroD)
            call Sleep(1.3)
        endif
        if GetHP(HeroD)<200 then
            return
        endif
        if intoUnitRange(HeroD,250)then
            call RLV()
        endif
    endif
    if index==58 then
        call guanyu_cast_du(HeroD)
        call Sleep(5.7)
    endif
    if index==59 then
        set loc=GetLocBetweenTwoUnitsRangeToFirst(mHero,HeroD,-700)
        call guanyu_cast_d(loc)
        call RemoveLocation(loc)
        set loc=null
    endif
    if index==60 then
        if intoUnitRange(HeroD,250)then
            call RLV()
        endif
    endif
    if index==61 and intoUnitRange(zs_EnemyHeros[5],250)then
        call RLV()
    endif
    if index==62 then
        if zs_AllyHeroNearMeCount==0 then
            call JQ(TH)
        endif
        call AZV()
    endif
    if index==63 then
        if intoUnitRange(KI,700)then
            if can_guanyu_cast_d()and MyHeroMP>500 then
                call guanyu_cast_du(KI)
            endif
        endif
        if intoUnitRange(KI,280)then
            if RKV()then
                call RLV()
            endif
            set zs_cr_fightline=AO
            set AO=I9V(mHero)
        endif
    else
        call SleepCanBreak(.8)
    endif
    if index==64 then
        if RangeTo(KI,mHero)>400 and can_UseFeiXie(mHero)then
            set loc=GetLocBetweenTwoUnitsRangeToFirst(KI,mHero,-180)
            call UseFeiXie(loc)
            call RemoveLocation(loc)
            set loc=null
        endif
        set loc=GetLocBetweenTwoUnitsRangeToFirst(KI,mHero,-180)
        call gotoLocation(mHero,loc,30)
        call RemoveLocation(loc)
        set loc=null
        call Sleep(.2)
    endif
endfunction

function weiyan_spell_condition takes nothing returns nothing
    if not isweiyan()then
        return
    endif
    if zs_canspelltoHerod and OG then
        if can_weiyan_cast_t()and zs_AllyHeroNearMeCount==0 and IsManaAlmostFull(mHero)then
            if(IsLifeAlmostFull(HeroD)or EnemyHeroHP>1500)and rangeToTowerD>1100 then
                set zs_action_prioty_arry[50]=52
            endif
        endif
        if CW(HeroD)and can_weiyan_cast_t()then
            set zs_action_prioty_arry[50]=91
        endif
        if EnemyHeroHP<500 and mHeroLevel>7 and can_weiyan_cast_t()then
            set zs_action_prioty_arry[50]=92
        endif
        if zs_AllyHeroNearMeCount>0 and zs_allyHeroToHeroDMinRange<900 and can_weiyan_cast_t()then
            set zs_action_prioty_arry[50]=86
        endif
    endif
    if rangeToTowerD<800 and can_weiyan_cast_r()and((GetHP(TowerD)<700 and GetHP(TowerD)>200)or IsLifeAlmostFull(TowerD))then
        set zs_action_prioty_arry[51]=92
    endif
    if HeroD!=null and can_weiyan_cast_r()and(IsManaAlmostFull(mHero)and mHeroLevel>10)and rangeToHeroD<300 then
        set zs_action_prioty_arry[52]=81
    endif
    if EnemyCount>AllyCount+8 and can_weiyan_cast_r()and NearestEnemyBubing!=null then
        set zs_action_prioty_arry[53]=80
    endif
    if zs_canspelltoHerod and can_weiyan_cast_t()and can_UseFeiXie(mHero)and MyHeroMP>400 and can_weiyan_cast_r()then
        set zs_action_prioty_arry[54]=93
    endif
    if zs_canspelltoHerod and can_weiyan_cast_t()and rangeToHeroD<200 and MyHeroMP>400 and can_weiyan_cast_r()then
        set zs_action_prioty_arry[55]=94
    endif
    if UnitSheXingJieJie!=null and RangeTo(mHero,UnitSheXingJieJie)<160 and can_weiyan_cast_r()then
        set zs_action_prioty_arry[56]=86
    endif
    if mHeroLevel>15 and NF!=null and MyHeroHP>1000 and can_weiyan_cast_r()then
        set zs_cr_fightline=101
        set zs_action_prioty_arry[59]=78
    endif
    if zs_cr_fightline==101 and(MyHeroHP<900 or not can_weiyan_cast_r()or IsDead(NF))then
        set zs_cr_fightline=2
    endif
    if zs_IsTimeOut(92,1)then
        call GroupRemoveUnit(EF,null)
    endif
    if FirstOfGroup(EF)!=null then
        if zs_IsTimeOut(91,1)then
            call GroupPointOrderByIdLoc(EF,851983,zs_cr_attackLoc)
            if HeroD!=null and RangeTo(HeroD,FirstOfGroup(EF))<600 then
                call GroupTargetOrderById(EF,851983,HeroD)
            endif
            if RangeTo(HeroD,FirstOfGroup(EF))>500 and TowerD!=null then
                call GroupTargetOrderById(EF,851983,TowerD)
            endif
        endif
    endif
endfunction

function weiyan_spell_action takes integer index returns nothing
    local location loc=null
    if not isweiyan()then
        return
    endif
    if index==50 then
        if zs_HeroPower>0 and rangeToHeroD>600 and can_UseFeiXie(mHero)then
            set loc=GetUnitLoc(HeroD)
            call UseFeiXie(loc)
            call RemoveLocation(loc)
            set loc=null
        endif
        if intoUnitRange(HeroD,600)then
            call weiyan_cast_t(HeroD)
        endif
    endif
    if index==51 and intoUnitRange(TowerD,600)then
        call weiyan_cast_r()
        call Sleep(.5)
        call DestroyGroup(EF)
        set EF=null
        set EF=SelectUnitsByIlussion(ai_player)
    endif
    if index==52 and intoUnitRange(HeroD,220)then
        call weiyan_cast_r()
        call Sleep(.5)
        call DestroyGroup(EF)
        set EF=null
        set EF=SelectUnitsByIlussion(ai_player)
    endif
    if index==53 and intoUnitRange(NearestEnemyBubing,500)then
        call weiyan_cast_r()
        call Sleep(.5)
        call DestroyGroup(EF)
        set EF=null
        set EF=SelectUnitsByIlussion(ai_player)
    endif
    if index==54 then
        if intoUnitRange(HeroD,700)then
            call weiyan_cast_t(HeroD)
            set loc=GetUnitLoc(HeroD)
            call UseFeiXie(loc)
            call RemoveLocation(loc)
            set loc=null
            call HeroAttack(HeroD)
            call Sleep(.05)
            call weiyan_cast_r()
            call Sleep(.46)
            call DestroyGroup(EF)
            set EF=null
            set EF=SelectUnitsByIlussion(ai_player)
            if FirstOfGroup(EF)!=null then
                call debugstr("ok")
            endif
            set loc=GetUnitLoc(HeroD)
            call GroupPointOrderByIdLoc(EF,851986,loc)
            call RemoveLocation(loc)
            set loc=null
            call Sleep(.9)
            call GroupTargetOrderById(EF,851983,HeroD)
        endif
    endif
    if index==55 then
        call weiyan_cast_t(HeroD)
        call HeroAttack(HeroD)
        call Sleep(.05)
        call weiyan_cast_r()
        call Sleep(.46)
        call DestroyGroup(EF)
        set EF=null
        set EF=SelectUnitsByIlussion(ai_player)
        if FirstOfGroup(EF)!=null then
            call debugstr("ok")
            set loc=GetUnitLoc(HeroD)
            call GroupPointOrderByIdLoc(EF,851986,loc)
            call RemoveLocation(loc)
            set loc=null
            call Sleep(.9)
            call GroupTargetOrderById(EF,851983,HeroD)
        endif
    endif
    if index==56 then
        call weiyan_cast_r()
        call Sleep(.5)
        call DestroyGroup(EF)
        set EF=null
        set EF=SelectUnitsByIlussion(ai_player)
    endif
    if index==59 then
        if intoUnitRange(NF,1000)then
            if can_UseFeiXie(mHero)then
                set loc=GetUnitLoc(NF)
                call UseFeiXie(loc)
                call RemoveLocation(loc)
                set loc=null
            endif
            call HeroAttack(NF)
            call Sleep(.05)
            call weiyan_cast_r()
            call Sleep(.66)
            call DestroyGroup(EF)
            set EF=null
            set EF=SelectUnitsByIlussion(ai_player)
            if FirstOfGroup(EF)!=null then
                call debugstr("ok")
            endif
            set loc=GetUnitLoc(NF)
            call GroupPointOrderByIdLoc(EF,851986,loc)
            call RemoveLocation(loc)
            set loc=null
            call Sleep(1)
            call GroupTargetOrderById(EF,851983,NF)
        endif
    endif
endfunction

function dianwei_spell_condition takes nothing returns nothing
    if not isdianwei()then
        return
    endif
    if zs_canspelltoHerod and(zs_HeroPower>0 or rangeToHeroD<300 or(EnemyHeroHP<500 and rangeToHeroD<700))and can_dianwei_cast_t()and OG then
        set zs_action_prioty_arry[50]=90
    endif
    if zs_canspelltoHerod and(EnemyHeroHP<700 and can_UseFeiXie(mHero))and can_dianwei_cast_t()then
        set zs_action_prioty_arry[50]=90
    endif
    if HeroD!=null and can_dianwei_cast_r()and rangeToHeroD<500 then
        set zs_action_prioty_arry[51]=91
    endif
    if HeroD!=null and(isHeroHasJinglinghuo(HeroD)or IsStunned(HeroD))and MyHeroHP>500 and(YG>-5 and rangeToTowerD>1000)and(zs_prioty_index!=5 and zs_prioty_index!=8)then
        set zs_action_prioty_arry[52]=73
    endif
    if NearestEnemyBubing!=null and((EnemyCount>AllyCount+9 and rangeToHeroD>1000)or(HeroD==null and MyHeroMP>400 and EnemyCount>2)or ZhongliEnemy!=null)and can_dianwei_cast_t()then
        set zs_action_prioty_arry[53]=80
    endif
endfunction

function dianwei_spell_action takes integer index returns nothing
    local location loc=null
    if not isdianwei()then
        return
    endif
    if index==50 and not IsImmune(HeroD)and intoUnitRange(HeroD,200)then
        call dianwei_cast_t()
    endif
    if index==50 and not IsImmune(HeroD)and rangeToHeroD>600 and intoUnitRange(HeroD,800)then
        if can_UseFeiXie(mHero)then
            set loc=GetLocBetweenTwoUnitsRangeToFirst(HeroD,mHero,-160)
            call UseFeiXie(loc)
            call RemoveLocation(loc)
            set loc=null
            call dianwei_cast_t()
        endif
    endif
    if index==51 and intoUnitRange(HeroD,500)then
        call dianwei_cast_r(HeroD)
    endif
    if index==52 then
        if rangeToHeroD>600 and can_UseFeiXie(mHero)then
            set loc=GetLocBetweenTwoUnitsRangeToFirst(HeroD,mHero,-120)
            call UseFeiXie(loc)
            call RemoveLocation(loc)
            set loc=null
        endif
        call HeroAttack(HeroD)
        call Sleep(1)
    endif
    if index==53 and IsAlive(NearestEnemyBubing)and intoUnitRange(NearestEnemyBubing,120)then
        call dianwei_cast_t()
    endif
endfunction

function xun_spell_condition takes nothing returns nothing
    if not isxun()then
        return
    endif
    if EnemyCount>2 and NearestEnemyBubing!=null and can_xun_cast_g()and(not can_xun_cast_w()or(can_xun_cast_w()and MyHeroMP>300))then
        set zs_action_prioty_arry[50]=57
    endif
    if can_xun_cast_t()and rangeToTowerD>700 and NearestEnemyBubing!=null and(not can_xun_cast_w()or(can_xun_cast_w()and MyHeroMP>300))then
        set zs_action_prioty_arry[51]=62
    endif
    if HeroD!=null and can_xun_cast_w()and EnemyHeroHP>300 then
        set zs_action_prioty_arry[52]=89
        if IsStunned(HeroD)and rangeToHeroD<700 and EnemyHeroHP>500 then
            set zs_action_prioty_arry[52]=100
        endif
    endif
    if GetHPVoided(mHero)>500 and can_xun_cast_e()then
        set zs_action_prioty_arry[53]=80
    endif
    if zs_allyHeroToMeMinRange<800 and GetHPVoided(zs_AllyHeroNearestToMe)>500 and can_xun_cast_e()then
        set zs_action_prioty_arry[54]=69
    endif
    if HeroD!=null and can_xun_cast_w()and can_UseFengZhang(mHero)and EnemyHeroHP>500 and zs_HeroPower<2 then
        set zs_action_prioty_arry[55]=99
    endif
    if FirstOfGroup(XF)!=null then
        if zs_IsTimeOut(90,1)then
            if TowerD!=null and RangeTo(TowerD,FirstOfGroup(XF))<600 then
                call GroupTargetOrderById(XF,851971,TowerD)
            endif
            if HeroD!=null and(not IsJuFeng(HeroD))and RangeTo(HeroD,FirstOfGroup(XF))<620 then
                call GroupTargetOrderById(XF,851971,HeroD)
            endif
        endif
    endif
endfunction

function xun_spell_action takes integer index returns nothing
    local location loc=null
    if not isxun()then
        return
    endif
    if index==50 and intoUnitRange(NearestEnemyBubing,500)then
        set loc=GetUnitLoc(NearestEnemyBubing)
        call xun_cast_g(loc)
        call RemoveLocation(loc)
        set loc=null
    endif
    if index==51 then
        set loc=GetUnitToOuterLocAngle(NearestEnemyBubing,mHero,498,90*GetRandomInt(-1,1))
        call xun_cast_t(loc)
        call RemoveLocation(loc)
        set loc=null
    endif
    if index==52 and intoUnitRange(HeroD,500)then
        if GetUnitCurrentOrder(HeroD)==851986 then
            set loc=GetUnitFrontLoc(HeroD,GetUnitMoveSpeed(HeroD)*.5)
            call xun_cast_w(loc)
            call RemoveLocation(loc)
            set loc=null
        else
            set loc=GetUnitLoc(HeroD)
            call xun_cast_w(loc)
            call RemoveLocation(loc)
            set loc=null
        endif
        call Sleep(.5)
        call DestroyGroup(XF)
        set XF=null
        set XF=SelectWard(ai_player)
    endif
    if index==53 then
        call xun_cast_e(mHero)
    endif
    if index==54 and intoUnitRange(zs_AllyHeroNearestToMe,600)then
        call xun_cast_e(zs_AllyHeroNearestToMe)
    endif
    if index==55 and intoUnitRange(HeroD,600)then
        if XGV(HeroD)then
            set loc=GetUnitLoc(HeroD)
            call gotoLocation(mHero,loc,460)
            call Sleep(.5)
            call xun_cast_w(loc)
            if can_xun_cast_t()then
                call xun_cast_t(loc)
            endif
            if can_xun_cast_g()then
                call xun_cast_g(loc)
            endif
            call RemoveLocation(loc)
            set loc=null
        endif
    endif
endfunction

function zhangfei_spell_condition takes nothing returns nothing
    if not iszhangfei()then
        return
    endif
    if zs_canspelltoHerod and(zs_HeroPower>0 or rangeToHeroD<300)and OG and RMV()then
        set zs_action_prioty_arry[50]=95
    endif
    if zs_canspelltoHerod and(EnemyHeroHP<700 and can_UseFeiXie(mHero))and RMV()then
        set zs_action_prioty_arry[50]=96
    endif
    if HeroD!=null and RQV()and mHeroLevel>8 and(zs_HeroPower>0 or FV>6)then
        set zs_action_prioty_arry[51]=81
    endif
    if HeroD!=null and(IsImmune(mHero)or iszhangfeihasb(mHero))and MyHeroHP>600 and OG and(zs_HeroPower>0 or FV>6)then
        set zs_action_prioty_arry[52]=71
    endif
    if HeroD!=null and(IsImmune(mHero)and iszhangfeihasb(mHero))and MyHeroHP>600 then
        set zs_action_prioty_arry[52]=96
    endif
    if HeroD!=null and can_zhangfei_cast_v()then
        set zs_action_prioty_arry[53]=88
    endif
    if HeroD!=null and can_zhangfei_cast_v()and RQV()then
        set zs_action_prioty_arry[54]=92
    endif
    if NearestEnemyBubing!=null and((EnemyCount>AllyCount+9 and rangeToHeroD>1000)or(HeroD==null and MyHeroMP>400 and EnemyCount>2))and RMV()then
        set zs_action_prioty_arry[55]=80
    endif
endfunction

function zhangfei_spell_action takes integer index returns nothing
    local location loc=null
    if not iszhangfei()then
        return
    endif
    if index==50 then
        if can_UseFeiXie(mHero)and rangeToHeroD>500 and intoUnitRange(HeroD,800)then
            set loc=GetLocBetweenTwoUnitsRangeToFirst(HeroD,mHero,-160)
            call UseFeiXie(loc)
            call RemoveLocation(loc)
            set loc=null
        endif
        if intoUnitRange(HeroD,200)then
            call RPV()
        endif
    endif
    if index==51 and intoUnitRange(HeroD,700)then
        call zhangfei_cast_b()
    endif
    if index==52 then
        if rangeToHeroD>600 and can_UseFeiXie(mHero)then
            set loc=GetLocBetweenTwoUnitsRangeToFirst(HeroD,mHero,-160)
            call UseFeiXie(loc)
            call RemoveLocation(loc)
            set loc=null
        endif
        call HeroAttack(HeroD)
        call Sleep(1)
    endif
    if index==53 and intoUnitRange(HeroD,700)then
        call zhangfei_cast_v()
    endif
    if index==54 and intoUnitRange(HeroD,700)then
        call zhangfei_cast_v()
        call zhangfei_cast_b()
    endif
    if index==55 and IsAlive(NearestEnemyBubing)and intoUnitRange(NearestEnemyBubing,160)then
        call RPV()
    endif
endfunction

function guojia_spell_condition takes nothing returns nothing
    if not isguojia()then
        return
    endif
    if zs_canspelltoHerod and can_guojia_cast_n()and(MyHeroMP>400 or zs_HeroPower>0)and OG then
        set zs_action_prioty_arry[50]=80
    endif
    if(HeroD!=null or rangeToTowerD<700 or zs_myhero_hpchanged<-20)and can_guojia_cast_f()and zs_IsTimeOut(61,30)then
        set zs_action_prioty_arry[51]=79
    endif
    if HeroD!=null and(not IsJuFeng(HeroD))and can_guojia_cast_c()and(EnemyHeroHP<500 or zs_HeroPower>0)then
        set zs_action_prioty_arry[52]=89
    endif
    if zs_canspelltoHerod and can_guojia_cast_c()and can_guojia_cast_n()and MyHeroMP>520 and(EnemyHeroHP<800 or zs_HeroPower>0)then
        set zs_action_prioty_arry[53]=99
    endif
    if HeroD==null and NearestEnemyBubing!=null and EnemyCount>1 and can_guojia_cast_n()and mHeroLevel>6 then
        if MyHeroMP>1500 or IsManaAlmostFull(mHero)then
            set zs_action_prioty_arry[59]=58
        endif
    endif
    if zs_canspelltoHerod and EnemyHeroHP>800 and EnemyHeroHP<1700 and MyHeroHP>600 and can_guojia_cast_c()and can_guojia_cast_n()and MyHeroMP>1300 and XIV(mHero)then
        set zs_action_prioty_arry[60]=91
    endif
    if zs_canspelltoHerod and not can_guojia_cast_c()and not can_guojia_cast_n()and MyHeroMP>800 and XIV(mHero)then
        call XAV(mHero)
    endif
endfunction

function guojia_spell_action takes integer index returns nothing
    if not isguojia()then
        return
    endif
    if index==50 and intoUnitRange(HeroD,530)then
        call guojia_cast_n(HeroD)
    endif
    if index==51 then
        call guojia_cast_f(mHero)
    endif
    if index==52 and intoUnitRange(HeroD,800)then
        call guojia_cast_c(HeroD)
        call HeroAttack(HeroD)
        call Sleep(1.6)
    endif
    if index==53 and intoUnitRange(HeroD,800)then
        call guojia_cast_c(HeroD)
        call HeroAttack(HeroD)
        call Sleep(1.6)
        call guojia_cast_n(HeroD)
    endif
    if index==59 and intoUnitRange(NearestEnemyBubing,600)then
        call guojia_cast_n(NearestEnemyBubing)
    endif
    if index==60 and intoUnitRange(HeroD,800)then
        call guojia_cast_c(HeroD)
        call HeroAttack(HeroD)
        call Sleep(1.5)
        call guojia_cast_n(HeroD)
        call XAV(mHero)
        call guojia_cast_c(HeroD)
        call HeroAttack(HeroD)
        call Sleep(1.5)
        call guojia_cast_n(HeroD)
    endif
endfunction

function caoren_spell_condition takes nothing returns nothing
    if not iscaoren()then
        return
    endif
    if not LF then
        if zs_canspelltoHerod and(zs_HeroPower>0 or EnemyHeroHP<300 or MyHeroMP>330)and can_caoren_cast_c()and OG then
            set zs_action_prioty_arry[50]=85
        endif
        if zs_canspelltoHerod and can_caoren_cast_f()and MyHeroMP>500 and rangeToHeroD<600 then
            set zs_action_prioty_arry[51]=81
        endif
        if zs_canspelltoHerod and zs_HeroPower>0 and MyHeroHP>400 and can_caoren_cast_e()and rangeToHeroD>400 and OG then
            set zs_action_prioty_arry[52]=71
        endif
        if NearestEnemyBubing!=null and(EnemyCount>AllyCount+6 or((HeroD==null and EnemyCount>2)and MyHeroMP>400)or(GetHP(NearestEnemyBubing)<300 and MyHeroMP>300))and can_caoren_cast_c()then
            set zs_action_prioty_arry[53]=80
        endif
        if zs_canspelltoHerod and(((EnemyHeroHP<600 or zs_HeroPower>0)and EnemyHeroHP>220)or MyHeroHP<330 or CW(mHero))and can_caoren_cast_g()then
            set zs_action_prioty_arry[54]=83
        endif
        if TowerD!=null and NearestEnemyBubing!=null and((AllyCount>3 and EnemyCount>3)or MyHeroHP<330 or CW(mHero))and can_caoren_cast_g()then
            set zs_action_prioty_arry[60]=82
        endif
        if(EnemyCount>8 or MyHeroHP<330 or CW(mHero))and NearestEnemyBubing!=null and can_caoren_cast_g()then
            set zs_action_prioty_arry[60]=82
        endif
    endif
    if LF then
        if HeroD!=null and GetHP(mHero)>400 and rangeToHeroD<400 then
            set zs_action_prioty_arry[55]=85
        endif
        if zs_canspelltoHerod and rangeToHeroD<400 and can_caozixiao_cast_t()then
            set zs_action_prioty_arry[56]=86
        endif
        if NearestEnemyBubing!=null and rangeToHeroD>600 and EnemyCount>2 and can_caozixiao_cast_t()then
            set zs_action_prioty_arry[57]=84
        endif
        if NearestEnemyBubing!=null and rangeToHeroD>600 and MyHeroHP>500 then
            set zs_action_prioty_arry[58]=80
        endif
        if TowerD!=null and rangeToHeroD>600 and MyHeroHP>800 and AllyCount>0 and EnemyCount<10 then
            set zs_action_prioty_arry[59]=81
        endif
        if MyHeroHP<700 then
            set zs_action_prioty_arry[5]=82
        endif
        if MyHeroHP<400 then
            set zs_action_prioty_arry[5]=87
        endif
    endif
endfunction

function caoren_spell_action takes integer index returns nothing
    local location loc=null
    if not iscaoren()then
        return
    endif
    if index==50 and not IsImmune(HeroD)and intoUnitRange(HeroD,600)then
        call caoren_cast_c(HeroD)
    endif
    if index==51 and not IsImmune(HeroD)and intoUnitRange(HeroD,600)then
        call caoren_cast_f(HeroD)
    endif
    if index==52 and intoUnitRange(HeroD,600)then
        call caoren_cast_e(HeroD)
    endif
    if index==53 and intoUnitRange(NearestEnemyBubing,600)then
        call caoren_cast_c(NearestEnemyBubing)
    endif
    if index==54 and intoUnitRange(HeroD,700)then
        call caoren_cast_gu(HeroD)
    endif
    if index==60 and intoUnitRange(NearestEnemyBubing,700)then
        call caoren_cast_gu(NearestEnemyBubing)
    endif
    if index==55 then
        set loc=GetLocBetweenTwoUnitsRangeToFirst(HeroD,mHero,-180)
        call gotoLocation(mHero,loc,30)
        call RemoveLocation(loc)
        set loc=null
        call Sleep(.2)
        if IsStunned(HeroD)or EnemyHeroHP<120 or RangeTo(mHero,HeroD)<160 then
            call HeroAttack(HeroD)
            call Sleep(.9)
        endif
    endif
    if index==56 and intoUnitRange(HeroD,200)then
        call caozixiao_cast_t()
    endif
    if index==57 and intoUnitRange(NearestEnemyBubing,160)then
        call caozixiao_cast_t()
    endif
    if index==58 then
        call HeroAttack(NearestEnemyBubing)
        call Sleep(.9)
    endif
    if index==59 then
        call HeroAttack(TowerD)
        call Sleep(.9)
    endif
endfunction

function dadi_spell_condition takes nothing returns nothing
    if not isdadi()then
        return
    endif
    if zs_canspelltoHerod and(zs_HeroPower>0 or rangeToHeroD<300 or EnemyHeroHP<300)and can_dadi_cast_t()and(MyHeroMP>400 or IsManaAlmostFull(mHero))and OG then
        set zs_action_prioty_arry[50]=81
    endif
    if zs_canspelltoHerod and EnemyHeroHP<1200 and can_dadi_cast_c()and not can_UseFeiXie(mHero)and OG and GetUnitCurrentOrder(HeroD)!=851986 then
        set zs_action_prioty_arry[51]=90
    endif
    if zs_canspelltoHerod and can_UseFeiXie(mHero)and can_dadi_cast_c()and rangeToHeroD<1200 and GetUnitCurrentOrder(HeroD)!=851986 then
        set zs_action_prioty_arry[52]=95
    endif
    if NearestEnemyBubing!=null and((EnemyCount>AllyCount+9 and rangeToHeroD>1000)or(HeroD==null and EnemyCount>10))and can_dadi_cast_c()then
        set zs_action_prioty_arry[53]=85
    endif
    if ZhongliEnemy!=null and mHeroLevel>5 and MyHeroHP>300 then
        set zs_action_prioty_arry[54]=61
    endif
endfunction

function dadi_spell_action takes integer index returns nothing
    local location loc=null
    if not isdadi()then
        return
    endif
    if index==50 and intoUnitRange(HeroD,300)then
        call dadi_cast_t()
    endif
    if index==50 and rangeToHeroD>600 and intoUnitRange(HeroD,800)then
        if can_UseFeiXie(mHero)then
            set loc=GetLocBetweenTwoUnitsRangeToFirst(HeroD,mHero,-160)
            call UseFeiXie(loc)
            call RemoveLocation(loc)
            set loc=null
            call dadi_cast_t()
        endif
    endif
    if index==51 and intoUnitRange(HeroD,220)then
        call dadi_cast_c()
        call Sleep(1.3)
        call XOV()
        call Sleep(1)
        call dadi_cast_t()
        call Sleep(4.3)
    endif
    if index==52 and intoUnitRange(HeroD,800)then
        set loc=GetLocBetweenTwoUnitsRangeToFirst(HeroD,mHero,-120)
        call dadi_cast_c()
        call Sleep(1.3)
        if XXV(mHero)then
            call XOV()
        endif
        call UseFeiXie(loc)
        call RemoveLocation(loc)
        set loc=null
        call Sleep(1)
        call dadi_cast_t()
        call Sleep(4.3)
    endif
    if index==53 and intoUnitRange(NearestEnemyBubing,200)then
        call dadi_cast_c()
        call Sleep(7)
    endif
    if index==54 and intoUnitRange(ZhongliEnemy,300)then
        call HeroAttack(ZhongliEnemy)
        call Sleep(1)
        if ZhongliEnemyCount>3 then
            call dadi_cast_c()
            call Sleep(7)
        endif
    endif
endfunction

function madai_spell_condition takes nothing returns nothing
    local boolean BSV=false
    local boolean BTV=false
    if not ismadai()then
        return
    endif
    set BSV=CanCastAbilityOrder(mHero,aid_madai_yingyan,"Locustswarm")
    set BTV=CanCastAbilityOrder2(mHero,aid_madai_zhuihun,"chainlightning")
    if HeroD!=null then
        if BSV and(zs_HeroPower>0 or rangeToHeroD<500 or EnemyHeroHP<600)and(MyHeroMP>220 or IsManaAlmostFull(mHero))and OG then
            set zs_action_prioty_arry[50]=81
        endif
        if BTV and(zs_HeroPower>0 or rangeToHeroD<500 or EnemyHeroHP<1000)and OG then
            set zs_action_prioty_arry[51]=90
        endif
    endif
    if NearestEnemyBubing!=null and((EnemyCount>AllyCount+9 and rangeToHeroD>1300)or(HeroD==null and EnemyCount>10))and BTV then
        set zs_action_prioty_arry[52]=85
    endif
    if ZhongliEnemy!=null and mHeroLevel>5 and mHeroLevel<15 and MyHeroHP>300 and BSV then
        set zs_action_prioty_arry[50]=61
    endif
endfunction

function madai_spell_action takes integer index returns nothing
    local location loc=null
    if not ismadai()then
        return
    endif
    if index==50 and intoUnitRange(HeroD,600)then
        call CastImdSkillByStr(mHero,aid_madai_yingyan,"Locustswarm")
        call Sleep(1)
    endif
    if index==51 and intoUnitRange(HeroD,600)then
        call CastTargetSkillByOderStr(mHero,aid_madai_zhuihun,"chainlightning",HeroD)
        call Sleep(.8)
    endif
    if index==52 and intoUnitRange(NearestEnemyBubing,500)then
        call CastTargetSkillByOderStr(mHero,aid_madai_zhuihun,"chainlightning",NearestEnemyBubing)
        call Sleep(.8)
    endif
endfunction

function zhanghe_spell_condition takes nothing returns nothing
    local boolean BYV=false
    local boolean BZV=false
    local boolean B_V=false
    if not iszhanghe()then
        return
    endif
    set BYV=CanCastAbilityOrder2(mHero,aid_zhanghe_duwu,"healingward")
    set BZV=CanCastAbilityOrderById2(mHero,aid_zhanghe_dujian,852254)
    set B_V=CanCastAbilityOrder2(mHero,aid_zhanghe_juduji,"shadowstrike")
    if HeroD!=null then
        if BYV and(zs_HeroPower>0 or rangeToHeroD<500 or EnemyHeroHP<600)and(MyHeroMP>320 or IsManaAlmostFull(mHero))and OG then
            set zs_action_prioty_arry[50]=81
        endif
        if BZV and zs_canspelltoHerod and(zs_HeroPower>0 or rangeToHeroD<500 or EnemyHeroHP<1000)and OG then
            set zs_action_prioty_arry[51]=82
        endif
        if B_V and(zs_HeroPower>0 or rangeToHeroD<600 or EnemyHeroHP<1500)and OG then
            set zs_action_prioty_arry[52]=89
        endif
    endif
    if BYV and NearestEnemyBubing!=null and((EnemyCount>AllyCount+9 and rangeToHeroD>1300)or(HeroD==null and EnemyCount>10)or IsManaAlmostFull(mHero))then
        set zs_action_prioty_arry[53]=85
    endif
    if BYV and ZhongliEnemy!=null and mHeroLevel>5 and mHeroLevel<15 and MyHeroHP>300 then
        set zs_action_prioty_arry[54]=61
    endif
endfunction

function B0V takes unit Target returns boolean
    local location loc=null
    local boolean rb=false
    if Target==null then
        return false
    endif
    if intoUnitRange(Target,620)then
        call CastTargetSkillByID(mHero,aid_zhanghe_dujian,852254,HeroD,1)
    endif
    if attackRange>=500 then
        if RangeTo(mHero,Target)<=330 then
            return true
        endif
    endif
    set loc=GetLocBetweenTwoUnitsRangeToFirst(mHero,Target,600)
    call gotoLocation(mHero,loc,50)
    call RemoveLocation(loc)
    set loc=null
    call SleepCanBreak(.5)
    return true
endfunction

function zhanghe_spell_action takes integer index returns nothing
    local location loc=null
    if not iszhanghe()then
        return
    endif
    if index==50 and intoUnitRange(HeroD,500)then
        set loc=GetUnitLoc(HeroD)
        call CastPointSkillByOderStr(mHero,aid_zhanghe_duwu,"healingward",loc)
        call RemoveLocation(loc)
        set loc=null
        call Sleep(.8)
    endif
    if index==51 and intoUnitRange(HeroD,700)then
        call B0V(HeroD)
    endif
    if index==52 and intoUnitRange(HeroD,350)then
        call CastTargetSkillByOderStr(mHero,aid_zhanghe_juduji,"shadowstrike",HeroD)
        call Sleep(3)
    endif
    if index==53 and intoUnitRange(NearestEnemyBubing,500)then
        set loc=GetUnitLoc(NearestEnemyBubing)
        call CastPointSkillByOderStr(mHero,aid_zhanghe_duwu,"healingward",loc)
        call RemoveLocation(loc)
        set loc=null
        call Sleep(.8)
    endif
    if index==54 and intoUnitRange(ZhongliEnemy,500)then
        set loc=GetUnitLoc(ZhongliEnemy)
        call CastPointSkillByOderStr(mHero,aid_zhanghe_duwu,"healingward",loc)
        call RemoveLocation(loc)
        set loc=null
        call Sleep(.8)
    endif
endfunction

function sunquan_spell_condition takes nothing returns nothing
    local boolean BTV=false
    local boolean B3V=false
    local boolean BZV=false
    if not issunquan()then
        return
    endif
    set BTV=HT(mHero,aid_sunquan_fandongjian)
    set B3V=CanCastAbilityOrderById2(mHero,aid_sunquan_bizhan,852230)
    set BZV=CanCastAbilityOrder(mHero,ER,"roar")
    if HeroD!=null then
        if BTV and(zs_HeroPower>0 or rangeToHeroD<500 or EnemyHeroHP<600)and(MyHeroMP>320 or IsManaAlmostFull(mHero))and OG then
            set zs_action_prioty_arry[50]=81
        endif
        if B3V and(zs_HeroPower>0 or rangeToHeroD<500 or EnemyHeroHP<1000)and OG then
            set zs_action_prioty_arry[51]=82
        endif
        if BZV and(zs_HeroPower>0 or rangeToHeroD<500 or EnemyHeroHP<1200)and RG then
            set zs_action_prioty_arry[52]=89
        endif
    endif
endfunction

function sunquan_spell_action takes integer index returns nothing
    local location loc=null
    if not issunquan()then
        return
    endif
    if index==50 and intoUnitRange(HeroD,500)then
        call CastImdSkillByStr(mHero,aid_sunquan_fandongjian,"berserk")
        call Sleep(.8)
    endif
    if index==51 and intoUnitRange(HeroD,620)then
        call CastTargetSkillByOderId(mHero,aid_sunquan_bizhan,852230,HeroD)
        call Sleep(.8)
    endif
    if index==52 and intoUnitRange(HeroD,350)then
        call CastImdSkillByStr(mHero,ER,"roar")
        call Sleep(.6)
    endif
endfunction

function gongben_spell_condition takes nothing returns nothing
    local boolean B_V=false
    local boolean B6V=false
    if not isgongben()then
        return
    endif
    set B6V=HT(mHero,aid_xiahouyuan_huixuanzhan)
    set B_V=CanCastAbilityOrder2(mHero,aid_gongben_longzuishan,"dispel")
    if HeroD!=null then
        if B_V and(zs_HeroPower>0 or rangeToHeroD<700 or EnemyHeroHP<600)and(MyHeroMP>320 or IsManaAlmostFull(mHero))and OG then
            set zs_action_prioty_arry[50]=83
        endif
        if B6V and(zs_HeroPower>0 or rangeToHeroD<200 or EnemyHeroHP<1000)and RG then
            set zs_action_prioty_arry[51]=82
        endif
        if B_V and B6V and(zs_HeroPower>0 or rangeToHeroD<700 or EnemyHeroHP<1000)and OG and MyHeroMP>190 then
            set zs_action_prioty_arry[52]=89
        endif
    endif
    if B_V and NearestEnemyBubing!=null and((EnemyCount>AllyCount+9 and rangeToHeroD>1300)or(HeroD==null and EnemyCount>10)or IsManaAlmostFull(mHero))and mHeroLevel>2 then
        set zs_action_prioty_arry[53]=81
    endif
    if B_V and HeroD==null and ZhongliEnemy!=null and mHeroLevel>5 and mHeroLevel<15 and MyHeroHP>300 and mHeroLevel>2 then
        set zs_action_prioty_arry[54]=61
    endif
endfunction

function gongben_spell_action takes integer index returns nothing
    local location loc=null
    if not isgongben()then
        return
    endif
    if index==50 and intoUnitRange(HeroD,700)then
        set loc=GetUnitLoc(HeroD)
        call CastPointSkillByOderStr(mHero,aid_gongben_longzuishan,"dispel",loc)
        call RemoveLocation(loc)
        set loc=null
        call Sleep(.8)
    endif
    if index==51 and intoUnitRange(HeroD,220)then
        call CastImdSkillByStr(mHero,aid_xiahouyuan_huixuanzhan,"whirlwind")
        call Sleep(1)
    endif
    if index==52 and intoUnitRange(HeroD,700)then
        set loc=GetUnitLoc(HeroD)
        call CastPointSkillByOderStr(mHero,aid_gongben_longzuishan,"dispel",loc)
        call RemoveLocation(loc)
        set loc=null
        call Sleep(1.2)
        call HeroAttack(HeroD)
        call Sleep(1)
        if intoUnitRange(HeroD,220)then
            call CastImdSkillByStr(mHero,aid_xiahouyuan_huixuanzhan,"whirlwind")
            call Sleep(1)
        endif
    endif
    if index==53 and intoUnitRange(NearestEnemyBubing,700)then
        set loc=GetUnitLoc(NearestEnemyBubing)
        call CastPointSkillByOderStr(mHero,aid_gongben_longzuishan,"dispel",loc)
        call RemoveLocation(loc)
        set loc=null
        call Sleep(.8)
    endif
    if index==54 and intoUnitRange(ZhongliEnemy,700)then
        set loc=GetUnitLoc(ZhongliEnemy)
        call CastPointSkillByOderStr(mHero,aid_gongben_longzuishan,"dispel",loc)
        call RemoveLocation(loc)
        set loc=null
        call Sleep(.8)
    endif
endfunction

function buyHeros_shuguo takes nothing returns nothing
    call BuyHero('n001',hid_zhugeliang)
    call BuyHero('n001',hid_weiyan)
    call BuyHero('n001',hid_guanyu)
    call BuyHero('n001',hid_zhaoyun)
    call BuyHero('n001',hid_zhangfei)
    call BuyHero('n00Z',hid_dadi)
endfunction

function buyHeros_weiguo takes nothing returns nothing
    call BuyHero('n000',hid_simayi)
    call BuyHero('n000',hid_guojia)
    call BuyHero('n000',hid_dianwei)
    call BuyHero('n00Y',hid_xun)
    call BuyHero('n000',hid_caoren)
    call BuyHero('n000',hid_zhangliao)
endfunction

function CVV takes integer id returns boolean
    return(BuyHero('n001',id))or(BuyHero('n000',id))or(BuyHero('n00Z',id))or(BuyHero('n00Y',id))or(BuyHero('n00B',id))or(BuyHero('n01B',id))
endfunction

function CEV takes nothing returns nothing
    // local integer index=0
    // local integer id=0
    // loop
        // set index=GetRandomInt(1,4)
        // exitwhen GetStoredInteger(zs_gamecache,"heros",ITS(index))>0
    // endloop
    // if GetStoredInteger(zs_gamecache,"heros",ITS(index))>0 then
        // call CVV(GetStoredInteger(zs_gamecache,"heros",ITS(index)))
    // endif
    local integer rs=0
    set rs = GetRandomInt(1,4)
    if rs == 1 then
        call CVV(hid_zhugeliang)
    elseif rs == 2 then
		call CVV(hid_simayi)
	elseif rs == 3 then
		call CVV(hid_guojia)
	else
		call CVV(hid_xun)
    endif	
endfunction

function CXV takes nothing returns nothing
    local integer rs=0
    set rs = GetRandomInt(1,2)
    if rs == 1 then
        call CVV(hid_zhugeliang)
    else
        call CVV(hid_simayi)
    endif
    //  if zs_player_index==1 then
    //    if BuyHero('n001',hid_zhugeliang)then
    //      return
    //    endif
    //  endif
    //  if zs_player_index==7 then
    //    if BuyHero('n000',hid_simayi)then
    //      return
    //    endif
    //  endif
    //  if IG then
    //    return
    //  endif
    //  call Sleep(2)
    //  if zs_player_index==4 then
    //    call BuyHero('n001',hid_weiyan)
    //  endif
    //  if zs_player_index==2 then
    //    call BuyHero('n001',hid_guanyu)
    //  endif
    //  if zs_player_index==5 then
    //    call BuyHero('n001',hid_zhaoyun)
    //  endif
    //  if zs_player_index==3 then
    //    call BuyHero('n001',hid_zhangfei)
    //  endif
    //  if zs_player_index==8 then
    //    call BuyHero('n000',hid_guojia)
    //  endif
    //  if zs_player_index==10 then
    //    call BuyHero('n000',hid_dianwei)
    //  endif
    //  if zs_player_index==11 then
    //    call BuyHero('n00Y',hid_xun)
    //  endif
    //  if zs_player_index==9 then
    //    call BuyHero('n000',hid_caoren)
    //  endif
    //  call Sleep(3)
    //  if mForceId==1 then
    //    call buyHeros_shuguo()
    //  endif
    //  if mForceId==2 then
    //    call buyHeros_weiguo()
    //  endif
endfunction

function COV takes nothing returns nothing
    if zs_CCPlayerID<0 then
        return
    endif
     if zhuLiMoShi then	// 主力 主要是诸葛跟司马
		call debugstr("zhuli")
       call CXV()
       return
     endif
     if quanZheYingMoShi then	// 全部 包括国家跟荀
       if NS()>21 then
		call debugstr("quanzhenyin")
         call CEV()
       endif
       return
     endif
endfunction

function isToLoop takes nothing returns boolean
    if zs_CCPlayerID<0 then
        return false
    endif
    if iscaoren()then
        if IsUnitHidden(zs_caoren)then
            set LF=true
            if MI==null then
                set MI=getGSOfPlayer(ai_player)
            endif
            set mHero=MI
            call B2(MI,"caozixiao")
        endif
        if not IsUnitHidden(zs_caoren)then
            set mHero=zs_caoren
            set LF=false
            set MI=null
            call B2(null,"caozixiao")
        endif
        if IsDead(mHero)then
            set mHero=zs_caoren
            call B2(null,"caozixiao")
        endif
    endif
    if mHero==null then
        if NS()>20.2 then    //买英雄 的时间
            call COV()
        endif
        call SleepCanBreak(1)
        return false
    endif
    if(not UnitAlive(mHero))then
        set YF=false
        set ZF=false
        set HeroD=null
        set CH=0
        call Sleep(1)
        return false
    endif
    return true
endfunction

function initPriotArray takes nothing returns nothing
    local integer index=0
    loop
        exitwhen index==100
        set zs_action_prioty_arry[index]=0
        set index=index+1
    endloop
endfunction

function getMaxPriotIndex takes nothing returns integer
    local integer index=0
    local integer itmp=0
    local integer ri=5
    loop
        exitwhen index==100
        if zs_action_prioty_arry[index]>itmp then
            set itmp=zs_action_prioty_arry[index]
            set ri=index
        endif
        set index=index+1
    endloop
    return ri
endfunction

function zs_CanSpellToHeroD takes nothing returns nothing
    set zs_canspelltoHerod=true
    if HeroD==null then
        set zs_canspelltoHerod=false
        return
    endif
    if(IsImmune(HeroD)or IsJuFeng(HeroD)or IsDead(HeroD))then
        set zs_canspelltoHerod=false
    endif
endfunction

function CBV takes nothing returns nothing
    local real CCV=600
    local real CDV=0
    local real CFV=0
    if zs_nearestMinHpEnemyBing!=null then
        set CCV=RangeTo(mHero,zs_nearestMinHpEnemyBing)
        set CDV=(CCV/600)*8
        set CFV=(CCV/600)*.3
    endif
    if IH>RH+2 then
        set CDV=CDV+3
        set CFV=CFV+.2
    endif
    set EB=WN+mHeroLevel*ZN+CDV
    set SC=PC+mHeroLevel*.06+CFV
    set RB=IB+mHeroLevel*4
    set TC=QC+mHeroLevel*.16
    if GetUnitTypeId(zs_nearestMinHpEnemyBing)=='earc' then
        set EB=EB+19
        set RB=RB+100
        set SC=SC+.48
        set TC=TC+1.5
    endif
    set EB=EB+(IH-RH)*.9
    set RB=RB+(IH-RH)*20
    set SC=SC+(IH-RH)*.1
    set TC=TC+(IH-RH)*.2
    if IH>4 then
        set EB=EB+5
        set RB=RB+60
        set SC=SC+.14
        set TC=TC+1.
        if GetUnitTypeId(zs_nearestMinHpEnemyBing)=='earc' then
            set EB=EB+10+(IH-RH)*1
            set RB=RB+20*(IH-RH)
            set SC=SC+.1*(IH-RH)
            set TC=TC+.2*(IH-RH)
        endif
    endif
    if IH>RH+3 and RH==2 then
        set EB=EB+IH-RH+6
        set RB=RB+80
        set SC=SC+.1*(IH-RH)
        set TC=TC+1
    endif
    if IH>4 and RH==1 then
        set EB=EB+(IH-RH)*1.9+16
        set RB=RB+60
        set SC=SC+.21*(IH-RH)
        set TC=TC+2
        if GetUnitTypeId(zs_nearestMinHpEnemyBing)=='earc' then
            set EB=EB+21+(IH-RH)*2.5
            set RB=RB+60
            set SC=SC+.53+.17*(IH-RH)
            set TC=TC+3
        endif
    endif
    if U<800 then
        set RB=RB+500
        set TC=TC+8
    endif
endfunction

function CGV takes nothing returns nothing
    local real CCV=600
    local real CDV=0
    local real CFV=0
    if zs_nearestMinHpAllyBing!=null then
        set CCV=RangeTo(mHero,zs_nearestMinHpAllyBing)
        set CDV=(CCV/600)*8
        set CFV=(CCV/600)*.3
    endif
    if RH>IH+2 then
        set CDV=CDV+2
        set CFV=CFV+.2
    endif
    set XB=YN+mHeroLevel*ZN+CDV
    set WC=PC+mHeroLevel*.06+CFV
    set OB=AB+mHeroLevel*4
    set WC=QC+mHeroLevel*.16
    if GetUnitTypeId(zs_nearestMinHpAllyBing)=='earc' then
        set XB=XB+22
        set OB=OB+60
        set UC=UC+.4
        set WC=WC+1.5
    endif
    if RH>4 then
        set XB=XB+3
        set OB=OB+10
        set UC=UC+.15
        set WC=WC+1.
    endif
    if RH>IH+3 and IH==2 then
        set XB=XB+RH-IH+6
        set OB=OB+80
        set UC=UC+.13*(RH-IH)
        set WC=WC+1
    endif
    if RH>4 and IH==1 then
        set XB=XB+RH-IH+16
        set OB=OB+100
        set UC=UC+.21*(RH-IH)
        set WC=WC+2
        if GetUnitTypeId(zs_nearestMinHpAllyBing)=='earc' then
            set XB=XB+26+RH-IH
            set OB=OB+70
            set UC=UC+.5+.16*(RH-IH)
            set WC=WC+3
        endif
    endif
    if rangeToTowerD<800 then
        set OB=OB+400
        set WC=WC+6
    endif
endfunction

function CHV takes nothing returns nothing
    if zs_IsTimeOut(54,2)then
        set RH=GetEnemyBingCountNearFireLoc()
        set IH=GetAllyBingCountNearFireLoc()
    endif
    call CBV()
    call CGV()
endfunction

function CJV takes nothing returns integer
    local integer ri=0
    if LC<=WC and LC>0 then
        set budaobingW2=zs_nearestMinHpAllyBing
        set ri=1
    endif
    if KC<=TC and KC>0 then
        set budaobingD2=zs_nearestMinHpEnemyBing
        set ri=2
    endif
    if LC<=UC and LC>0 then
        set budaobingW=zs_nearestMinHpAllyBing
        set ri=5
    endif
    if KC<=SC and KC>0 then
        set budaobingD=zs_nearestMinHpEnemyBing
        set ri=6
    endif
    return ri
endfunction

function CKV takes nothing returns integer
    local integer ri=0
    if zs_nearestAllyBingMinHp<OB then
        set budaobingW2=zs_nearestMinHpAllyBing
        set ri=3
    endif
    if zs_nearestEnemyBingMinHp<RB then
        set budaobingD2=zs_nearestMinHpEnemyBing
        set ri=4
    endif
    if zs_nearestAllyBingMinHp<XB then
        set budaobingW=zs_nearestMinHpAllyBing
        set ri=7
    endif
    if zs_nearestEnemyBingMinHp<EB then
        set budaobingD=zs_nearestMinHpEnemyBing
        set ri=8
    endif
    return ri
endfunction

function CLV takes nothing returns integer
    local integer CMV=-1
    call CHV()
    set budaobingD=null
    set budaobingW=null
    set budaobingD2=null
    set budaobingW2=null
    if U<600 then
        set CMV=CJV()
    endif
    set ED=CMV
    set CMV=CKV()
    if(CMV>ED and CMV!=7)or(CMV==7 and ED!=6)then
        set ED=CMV
    endif
    return ED
endfunction

function CPV takes nothing returns nothing
    set OG=true
    set RG=true
    if HeroD!=null and UnitIsSleeping(HeroD)then
        set OG=false
        set RG=false
    endif
endfunction

function RefreshParam takes nothing returns nothing
    local item item1=null
    local integer CMV=0
    set lockflag=true
    call LearnSkill()
    set zs_kickoff=false
    call I2()
    set mHeroLevel=GetHeroLevel(mHero)
    if mHeroLevel>15 then
        set ND=0
    endif
    call I8V(mHero)
    if zs_IsTimeOut(95,.5)then
        set zs_EnemyHeros[5]=null
        set zs_AllyHeros[5]=null
        if C2("caozixiao")!=null and IsAlive(C2("caozixiao"))then
            if IsUnitEnemy(C2("caozixiao"),ai_player)then
                set zs_EnemyHeros[5]=C2("caozixiao")
            else
                set zs_AllyHeros[5]=C2("caozixiao")
            endif
        endif
    endif
    if AS()<60 then
        call setHeroArry()
    endif
    if zs_IsTimeOut(97,1)then
        call resetParam()
        call A5()
        call enumUnitsNearMyHero()
    endif
    call X5()
    if EnemyNonAttackStructure==null and NF!=null and RangeTo(mHero,NF)<2800 then
        set EnemyNonAttackStructure=NF
    endif
    if isZhuGeLiang()then
    endif
    if zs_EnemyHeros[5]!=null and RangeTo(zs_EnemyHeros[5],mHero)<zs_nearestEnemyHeroMinRange and zs_nearestEnemyHeroMinRange<=900 then
        set NearestHeroD=zs_EnemyHeros[5]
        set zs_nearestEnemyHeroMinRange=RangeTo(zs_EnemyHeros[5],mHero)
    endif
    call M6()
    if HeroD==null then
        set HeroD=NearestHeroD
    endif
    if IsAlive(HeroD)and IsUnitInvisible(HeroD,ai_player)and HY(HeroD)then
        set HeroD=null
    endif
    call zs_CanSpellToHeroD()
    set CMV=CLV()
    if CMV==6 or CMV==8 then
        if isZhuGeLiang()then
        endif
    endif
    if budaobingD2!=null then
    endif
    if zs_attackEnemyBing==null then
        set zs_attackEnemyBing=DD
    endif
    call Q2()
    if GD!=null then
    endif
    if EnemyBingYing!=null then
    endif
    if zs_mutong!=null then
    endif
    call setShangluFireLoc()
    call setZhongLuFireLoc()
    call setXiaLuFireLoc()
    if TowerD!=null then
        if(GetUnitX(TowerD)<-7000 and GetUnitY(TowerD)<-500 and GetUnitY(TowerD)>-2500)or(GetUnitX(TowerD)>6300 and GetUnitY(TowerD)<1300 and GetUnitY(TowerD)>0)then
        endif
    endif
    call RemoveLocation(safeLoc)
    set safeLoc=null
    set safeLoc=D4()
    if HeroD!=null then
        set EnemyHeroLevel=GetHeroLevel(HeroD)
        set EnemyHeroHP=GetHP(HeroD)
        set EnemyHeroMP=GetMP(HeroD)
        set rangeToHeroD=RangeTo(mHero,HeroD)
    else
        set EnemyHeroHP=999999
        set EnemyHeroMP=999999
        set rangeToHeroD=999999
    endif
    set MyHeroHP=GetHP(mHero)
    set MyHeroMP=GetMP(mHero)
    if NearestHeroD!=null then
        set KH=RangeTo(mHero,NearestHeroD)
    else
        set KH=9999999
    endif
    if TowerD!=null then
        if RangeTo(TowerD,zs_attackEnemyBing)<500 then
            set zs_attackEnemyBing=null
        endif
        set rangeToTowerD=RangeTo(mHero,TowerD)
    else
        set rangeToTowerD=999999
    endif
    if TowerW!=null then
        set U=RangeTo(mHero,TowerW)
    else
        set U=99999
    endif
    if zs_cr_fightline==0 and zs_MyFireLoc!=zs_firelines[0]then
        set zs_MyFireLoc=zs_firelines[0]
    endif
    if zs_cr_fightline==1 and zs_MyFireLoc!=zs_firelines[1]then
        set zs_MyFireLoc=zs_firelines[1]
    endif
    if zs_cr_fightline==2 and zs_MyFireLoc!=zs_firelines[2]then
        set zs_MyFireLoc=zs_firelines[2]
    endif
    if zs_MyFireLoc!=null then
        set NV=RangeToLoc(mHero,zs_cr_retreatLoc)-RangeLocToLoc(zs_MyFireLoc,zs_cr_retreatLoc)
        if isguanyu()then
        endif
    else
        set NV=-1000
    endif
    call CPV()
    call AUV()
    call setHeroCountNearMe()
    if zs_AllyHeroNearestToMe!=null and RangeTo(zs_AllyHeroNearestToMe,mHero)<1200 and GetHP(zs_AllyHeroNearestToMe)<EH then
    endif
    set zs_HeroPower=zs_AllyHeroNearMeCount+1-zs_EnemyHeroNearMeCount
    if zs_AllyHeroNearMeCount+1==zs_EnemyHeroNearMeCount and zs_EnemyHeroNearMeCount>1 and zs_allyHeroToHeroDMinRange<830 then
        set zs_HeroPower=1
    endif
    set lockflag=false
endfunction

function RefreshParam2 takes nothing returns nothing
    set lockflag=true
    if HeroD!=null then
        set EnemyHeroHP=GetHP(HeroD)
        set EnemyHeroMP=GetMP(HeroD)
        set rangeToHeroD=RangeTo(mHero,HeroD)
    else
        set EnemyHeroHP=999999
        set EnemyHeroMP=999999
        set rangeToHeroD=999999
        set crEnemyHeroOrder=GetUnitCurrentOrder(HeroD)
    endif
    if NearestHeroD!=null then
        set KH=RangeTo(mHero,NearestHeroD)
    else
        set KH=9999999
    endif
    set MyHeroHP=GetHP(mHero)
    set MyHeroMP=GetMP(mHero)
    if TowerD!=null then
        set rangeToTowerD=RangeTo(mHero,TowerD)
    else
        set rangeToTowerD=999999
    endif
    set lockflag=false
endfunction

function zs_ComputerPriot takes nothing returns nothing
    set lockflag=true
    call initPriotArray()
    call zs_budao_d_condition()
    call zs_budao_w_condition()
    call zs_buchonghp_condition()
    call zs_buchongmp_condition()
    call zs_move_condition()
    call zs_buyItems_condition()
    if zs_IsTimeOut(55,1.2)then
        call zs_buyunit_condition()
    endif
    call zs_attack_condition()
    call zs_shiftLine_cdt()
    call zs_useitem_condition()
    call zhangliao_spell_condition()
    call zhaoyun_spell_condition()
    call guanyu_spell_condition()
    call dianwei_spell_condition()
    call zhangfei_spell_condition()
    call guojia_spell_condition()
    call weiyan_spell_condition()
    call xun_spell_condition()
    call caoren_spell_condition()
    call dadi_spell_condition()
    call madai_spell_condition()
    call zhanghe_spell_condition()
    call sunquan_spell_condition()
    call gongben_spell_condition()
    if isZhuGeLiang()then
        call zhuge_spell_condition()
    endif
    if isSiMaYi()then
        call sima_spell_condition()
    endif
    set lockflag=false
endfunction

function debugindex takes string title returns nothing
    if debugTmpindex!=zs_prioty_index or zs_IsTimeOut(40,5)then
        call debugstr(aistr+"-"+ITS(zs_prioty_index)+"-"+ITS(zs_action_prioty_arry[zs_prioty_index])+"-Env:"+ITS(YG)+"-loc2:"+ITS(FV)+"-TheLoc1:"+ITS(zs_HeroPower)+"-CRL:"+ITS(zs_cr_fightline)+"-locB:"+ITS(AO))
    endif
    if debugTmpindex!=zs_prioty_index then
        set debugTmpindex=zs_prioty_index
    endif
endfunction

function duizhan takes nothing returns nothing
    local integer index=0
    if lockflag then
        return
    endif
    set zs_prioty_index=getMaxPriotIndex()
    if GetPlayerId(ai_player)==11 then
    endif
    if GetPlayerId(ai_player)==5 then
    endif
    call A8V(zs_prioty_index)
    call zs_move_action(zs_prioty_index)
    call zs_budao_d_action(zs_prioty_index)
    call zs_budao_w_action(zs_prioty_index)
    call zs_buyunit_action(zs_prioty_index)
    call zs_shiftLine_action(zs_prioty_index)
    if GetUnitAcquireRange(mHero)>61 then
    endif
    if isSiMaYi()then
        call sima_spell_action(zs_prioty_index)
    endif
    call zs_buyItems_Action_common(zs_prioty_index)
    call zs_buchonghp_action(zs_prioty_index)
    call zs_buchongmp_action(zs_prioty_index)
    call NOV(zs_prioty_index)
    if isZhuGeLiang()then
		//call debugindex("zhuge")
        call zhuge_spell_action(zs_prioty_index)
    endif
    if iszhaoyun()then
        call zhaoyun_spell_action(zs_prioty_index)
    endif
    if iszhangliao()then
        call zhangliao_spell_action(zs_prioty_index)
    endif
    if isguojia()then
        call guojia_spell_action(zs_prioty_index)
    endif
    if isxun()then
        call xun_spell_action(zs_prioty_index)
    endif
    if iscaoren()then
        call caoren_spell_action(zs_prioty_index)
    endif
    if isdianwei()then
        call dianwei_spell_action(zs_prioty_index)
    endif
    if isguanyu()then
        call guanyu_spell_action(zs_prioty_index)
    endif
    if iszhangfei()then
        call zhangfei_spell_action(zs_prioty_index)
    endif
    if isweiyan()then
        call weiyan_spell_action(zs_prioty_index)
    endif
    if isdadi()then
        call dadi_spell_action(zs_prioty_index)
    endif
    if ismadai()then
        call debugindex("dadi")
        call madai_spell_action(zs_prioty_index)
    endif
    if iszhanghe()then
        call zhanghe_spell_action(zs_prioty_index)
    endif
    if issunquan()then
        call sunquan_spell_action(zs_prioty_index)
    endif
    if isgongben()then
        call gongben_spell_action(zs_prioty_index)
    endif
    if not GG then
        loop
            exitwhen index>20 or GetUnitCurrentOrder(mHero)<852055
            call Sleep(.35)
            set index=index+1
        endloop
    endif
endfunction

function adjustBaseLoc takes nothing returns nothing
    local unit u=null
    set u=getUnitByid('n002',suguoBaseLoc,2600)
    if(u!=null)then
        set suguoBaseLoc=GetUnitLoc(u)
    endif
    set u=getUnitByid('n002',weiguoBaseLoc,2600)
    if(u!=null)then
        set weiguoBaseLoc=GetUnitLoc(u)
    endif
endfunction

function C_V takes integer ai returns nothing
    local unit C0V=null
    local unit tmpu=null
    local integer index=1
    local item tmp=null
    local location temploc=null
    local location loc=null
    local location C1V=null
    local location C2V=null
    if ai_player==Player(7)then
        set mHero=null
        return
    endif
    set C1V=Location(894,-2713)
    set C2V=Location(1444,-2323)
    set C0V=CreateUnitAtLoc(Player(5),hid_zhugeliang,C2V,270.)
    set HeroD=CreateUnitAtLoc(Player(7),hid_simayi,C1V,270.)
    call SetHeroLevel(HeroD,25,false)
    set mHero=C0V
    call SetHeroLevel(C0V,10,false)
    call initSkillArry_zhugeliang()
    set index=0
    loop
        exitwhen index==25
        call LearnSkill()
        set index=index+1
    endloop
    call UnitAddItemById(C0V,'sneg')
    call UnitAddItemById(C0V,'desc')
    call UnitAddItemById(C0V,'desc')
    call UnitAddItemById(C0V,'desc')
    call UnitAddItemById(C0V,'desc')
    call UnitAddItemById(C0V,'desc')
    call UnitAddItemById(HeroD,'I02C')
    call UnitAddItemById(HeroD,'ssan')
    call UnitAddItemById(HeroD,'sneg')
    call X0(mHero)
    call UnitAddItemById(HeroD,'desc')
    loop
        if ai==1 then
            if can_zhuge_cast_feng_e_x_g()and intoUnitRange(HeroD,600)then
                call zhuge_cast_feng_e_x_g(HeroD)
                call HeroStop(mHero)
            endif
        endif
        call SleepCanBreak(2)
    endloop
endfunction

function testitem takes nothing returns nothing
    local integer index=0
    loop
        call WZ()
        call Sleep(33)
    endloop
endfunction

function testhero takes nothing returns nothing
    local unit C0V=null
    local unit tmpu=null
    local integer index=1
    local item tmp=null
    local location temploc=null
    local location loc=null
    local location C1V=null
    local location C2V=null
    call C_V(1)
    loop
        exitwhen index==100
        call SetPlayerState(Player(5),ConvertPlayerState(index),GetPlayerState(Player(8),ConvertPlayerState(index)))
        set index=index+1
    endloop
    if ai_player==Player(7)then
        set mHero=null
        return
    endif
    set C1V=Location(894,-2713)
    set C2V=Location(1444,-2323)
    set C0V=CreateUnitAtLoc(Player(5),hid_simayi,C2V,270.)
    set HeroD=CreateUnitAtLoc(Player(7),hid_zhugeliang,C1V,270.)
    call SetHeroLevel(HeroD,25,false)
    set mHero=C0V
    call SetHeroLevel(C0V,10,false)
    call initSkillArry_simayi()
    set index=0
    loop
        exitwhen index==25
        call LearnSkill()
        set index=index+1
    endloop
    call UnitAddItemById(C0V,'sneg')
    call UnitAddItemById(C0V,'desc')
    call UnitAddItemById(C0V,'desc')
    call UnitAddItemById(C0V,'desc')
    call UnitAddItemById(C0V,'desc')
    call UnitAddItemById(C0V,'desc')
    call UnitAddItemById(HeroD,'I02C')
    call UnitAddItemById(HeroD,'ssan')
    call X0(mHero)
    call UnitAddItemById(HeroD,'desc')
    loop
        if can_sima_cast_feng_n_ef()and intoUnitRange(HeroD,600)then
            call sima_cast_feng_n_ef(HeroD)
            call HeroStop(mHero)
        endif
        call SleepCanBreak(2)
    endloop
    call SetUnitUserData(C0V,100)
    call UnitRemoveAbility(C0V,'A088')
    call SetUnitAcquireRange(C0V,60)
    call UnitAddItemById(C0V,iid_sunzibingfa)
    call UnitAddItemById(C0V,'desc')
    call UnitAddItemById(HeroD,'I02C')
    call UnitAddItemById(mHero,'ssan')
    call X0(HeroD)
    call X0(mHero)
    call Sleep(3)
    loop
        if intoUnitRange(HeroD,600)then
            call weiyan_cast_t(HeroD)
            set loc=GetUnitLoc(HeroD)
            call UseFeiXie(loc)
            call RemoveLocation(loc)
            set loc=null
            call HeroAttack(HeroD)
            call Sleep(.05)
            call weiyan_cast_r()
            call Sleep(.46)
            call DestroyGroup(EF)
            set EF=null
            set EF=SelectUnitsByIlussion(ai_player)
            if FirstOfGroup(EF)!=null then
                call debugstr("ok")
            endif
            set loc=GetUnitLoc(HeroD)
            call GroupPointOrderByIdLoc(EF,851986,loc)
            call RemoveLocation(loc)
            set loc=null
            call Sleep(.9)
            call GroupTargetOrderById(EF,851983,HeroD)
        endif
        call Sleep(.3)
    endloop
    loop
        if intoUnitRange(HeroD,600)then
            if OMV(HeroD)then
                call zhuge_cast_g(HeroD)
            endif
            if can_zhuge_cast_e()then
                call debugstr("can")
            endif
            call Sleep(3)
        endif
    endloop
    loop
        if intoUnitRange(HeroD,600)then
            call UseBianXing(HeroD)
            call Sleep(1)
            call UseFeiXie(GetUnitLoc(HeroD))
            call XRV(HeroD)
            call SetUnitState(HeroD,UNIT_STATE_LIFE,-1)
            call Sleep(6)
            call ItemToUseStateAll(HeroD)
            call E0(mHero,iid_xuanwufu)
            call E0(mHero,'ssan')
        endif
        set MyHeroMP=GetMP(mHero)
        if can_QingNangShu(mHero)then
            call debugstr("can_QingNangShu")
            call UseQingNangShu()
        endif
        if IsAlive(HeroD)and can_MengDe(mHero)and intoUnitRange(HeroD,800)then
            call debugstr("can_UseMengDe")
            call UseMengDe(HeroD)
        endif
        if IsAlive(HeroD)and can_UseBianXing(mHero)and intoUnitRange(HeroD,600)then
            call debugstr("can_UseBianXing")
            call UseBianXing(HeroD)
        endif
        if can_SunZiBingFa(mHero)then
            call debugstr("can_SunZiBingFa")
            call UseSunZiBingFa()
        endif
        if XXV(mHero)then
            call debugstr("can_UseXuanWu")
            call XOV()
        endif
        call Sleep(2)
        if can_zhangfei_cast_v()then
            call debugstr("can_zhangfei_cast_v")
            call zhangfei_cast_v()
        endif
        if RQV()then
            call debugstr("RQV")
            call zhangfei_cast_b()
        endif
        if RMV()then
            call debugstr("RMV")
            call RPV()
        endif
    endloop
    call debugstr("v:"+ITS(DT(mHero,'A006')))
    call debugstr("b:"+ITS(DT(mHero,'A009')))
    call debugstr("t:"+ITS(DT(mHero,'A04W')))
    if intoUnitRange(HeroD,600)then
        call caoren_cast_gu(HeroD)
        call HeroAttack(HeroD)
        call Sleep(.9)
    endif
    call Sleep(.5)
    if RMV()then
        call UseFeiXie(GetUnitFrontLoc(mHero,700))
        call RPV()
        call HeroStop(mHero)
    endif
    call caoren_cast_c(mHero)
    call UseItemByID(mHero,'pclr',.5)
    call can_caoren_cast_c()
    call can_caoren_cast_e()
    call can_caoren_cast_f()
    call can_caoren_cast_g()
    call ItemToUseState(mHero,iid_mengdeshu)
    call Sleep(.1)
    if IssueImmediateOrderById(mHero,852010)then
        call debugstr("can_MengDe")
    endif
    call Sleep(.1)
    call X0(mHero)
    if can_MengDe(mHero)then
    endif
    if can_TuiMoDao(mHero)then
        call debugstr("can_TuiMoDao")
    endif
    if can_UseFengZhang(mHero)then
        call debugstr("can_UseFengZhang")
    endif
    call UseQingNangShu()
    if can_UseBianXing(mHero)then
        call debugstr("can_UseBianXing")
    endif
    loop
        call X0(mHero)
        call Sleep(5)
        call ItemToUseStateAll(mHero)
        call E0(mHero,iid_xuanwufu)
        call E0(mHero,'ssan')
        call Sleep(5)
    endloop
    call ItemToUseStateAll(mHero)
    call X0(mHero)
    call XOV()
    call Sleep(2)
    call UseQingNangShu()
    call Sleep(2)
    call UseMengDe(GetEnemyNearestBubingNearHero(mHero,1200,false))
    call Sleep(2)
    call XGV(GetEnemyNearestBubingNearHero(mHero,1200,false))
    call Sleep(2)
    call UseBianXing(GetEnemyNearestBubingNearHero(mHero,1200,false))
    call Sleep(2)
    call UseTuiMoDao(GetEnemyNearestBubingNearHero(mHero,1200,false))
    call Sleep(2)
    call UseItemByID(mHero,'pclr',.3)
    call Sleep(2)
    call UseItemTargetByID(mHero,'hslv',mHero,.3)
    call Sleep(2)
    call ItemToUseState(mHero,'I02C')
    call ItemToUseState(mHero,'sneg')
    call ItemToUseState(mHero,'ssan')
    call ItemToUseState(mHero,iid_qingnangshu)
    call ItemToUseState(mHero,iid_mengdeshu)
    call ItemToUseState(mHero,iid_tuimodao)
    call ItemToUseState(mHero,'pclr')
    call ItemToUseState(mHero,'hslv')
    call SetUnitUserData(CreateUnit(Player(5),uid_toushiche,-1000,-1000,0),100)
    loop
        call caoren_cast_c(GetEnemyNearestBubingNearHero(mHero,1200,false))
        call caoren_cast_f(GetEnemyNearestBubingNearHero(mHero,1200,false))
        call caoren_cast_e(GetEnemyNearestBubingNearHero(mHero,1200,false))
        call SetWidgetLife(mHero,2000)
        call SetUnitState(mHero,UNIT_STATE_MANA,1000)
        call Sleep(3)
    endloop
    set C0V=CreateUnit(Player(7),hid_zhangliao,-200,-700,270.)
    call SetHeroLevel(C0V,25,false)
    call UnitAddItemById(C0V,'I02C')
    call UnitAddItemById(C0V,'I02C')
    call UnitAddItemById(C0V,'I02C')
    call UnitAddItemById(C0V,'I02C')
    loop
        call SetWidgetLife(mHero,300)
        call SetUnitState(mHero,UNIT_STATE_MANA,100)
        call Sleep(3)
        call UseItemByID(mHero,'pclr',.3)
        call Sleep(3)
        call UseItemTargetByID(mHero,'hslv',mHero,.22)
    endloop
    call UnitAddItemById(C0V,iid_qingnangshu)
    call RemovePlayer(Player(5),PLAYER_GAME_RESULT_TIE)
    call UnitAddItemById(C0V,iid_sunzibingfa)
    call SetHeroLevel(C0V,25,false)
    call Sleep(.5)
    set C0V=CreateUnit(Player(1),hid_zhugeliang,-2500,-3200,270.)
    call UnitRemoveAbility(C0V,'A088')
    call SetHeroLevel(C0V,25,false)
    call SetUnitAcquireRange(C0V,60)
    call UnitAddItemById(C0V,'I02C')
    call UnitAddItemById(C0V,iid_qingnangshu)
    call UnitAddItemById(C0V,iid_mengdeshu)
    call UnitAddItemById(C0V,iid_tuimodao)
    call UnitAddItemById(C0V,'sneg')
    call UnitAddItemById(C0V,'ssan')
    call UnitAddItemById(C0V,'desc')
    set mHero=C0V
    call SetHeroLevel(C0V,25,false)
    call UnitAddItemById(C0V,iid_sunzibingfa)
    call UnitAddItemById(C0V,iid_qingnangshu)
    call RemovePlayer(Player(0),PLAYER_GAME_RESULT_DEFEAT)
    call RemovePlayer(Player(6),PLAYER_GAME_RESULT_DEFEAT)
    call SetHeroLevel(C0V,25,false)
    call UnitAddItemById(C0V,iid_sunzibingfa)
    call UnitAddItemById(C0V,iid_qingnangshu)
    call UnitAddItemById(C0V,'I010')
    call UnitAddItemById(C0V,'I010')
    call SetHeroLevel(C0V,25,false)
    if GetPlayerController(Player(5))==MAP_CONTROL_COMPUTER then
        call debugstr("MAP_CONTROL_COMPUTER")
    endif
    if GetPlayerController(Player(5))==MAP_CONTROL_USER then
        call debugstr("MAP_CONTROL_USER")
    endif
    if GetPlayerController(Player(5))==MAP_CONTROL_NONE then
        call debugstr("MAP_CONTROL_NONE")
    endif
    if GetPlayerSlotState(Player(5))==PLAYER_SLOT_STATE_EMPTY then
        call debugstr("PLAYER_SLOT_STATE_EMPTY")
    endif
    if GetPlayerSlotState(Player(5))==PLAYER_SLOT_STATE_PLAYING then
        call debugstr("PLAYER_SLOT_STATE_PLAYING")
    endif
    if GetPlayerSlotState(Player(5))==PLAYER_SLOT_STATE_LEFT then
        call debugstr("PLAYER_SLOT_STATE_LEFT")
    endif
    call debugstr(ITS(GetPlayerState(Player(5),PLAYER_STATE_OBSERVER)))
    call SetPlayerState(Player(5),PLAYER_STATE_OBSERVER,2)
    if IsPlayerObserver(Player(5))then
        call debugstr("PLAYER_STATE_OBSERVER")
    endif
    call SetPlayers(0)
    call RemovePlayer(Player(0),PLAYER_GAME_RESULT_NEUTRAL)
    call RemovePlayer(Player(2),PLAYER_GAME_RESULT_NEUTRAL)
    call RemovePlayer(Player(3),PLAYER_GAME_RESULT_NEUTRAL)
    call RemovePlayer(Player(4),PLAYER_GAME_RESULT_NEUTRAL)
    call RemovePlayer(Player(5),PLAYER_GAME_RESULT_NEUTRAL)
endfunction

function chubing takes nothing returns nothing
    local integer i=0
    local integer C3V=0
    local unit u
    call Sleep(2)
    loop
        exitwhen C3V==3
        loop
            exitwhen i==1
            set u=CreateUnit(Player(0),'h01F',-1500,-1600,0)
            call IssuePointOrderByIdLoc(u,851983,weiguoBaseLoc)
            set u=CreateUnit(Player(0),'earc',-1500,-1800,0)
            call IssuePointOrderByIdLoc(u,851983,weiguoBaseLoc)
            set u=CreateUnit(Player(6),'h01F',1000,1200,0)
            call IssuePointOrderByIdLoc(u,851983,suguoBaseLoc)
            set u=CreateUnit(Player(6),'earc',1200,1600,0)
            call IssuePointOrderByIdLoc(u,851983,suguoBaseLoc)
            set i=i+1
        endloop
        call Sleep(30)
        set i=0
        set C3V=C3V+1
    endloop
endfunction

function oneLoop takes nothing returns nothing
    call RefreshParam()
    call zs_ComputerPriot()
    call duizhan()
endfunction

function mainLoop takes nothing returns nothing
    loop
        if isToLoop()then
            call oneLoop()
        endif
        if MG<=0 then
            call XZ(.08)
        else
            set MG=MG-1
        endif
    endloop
endfunction

function C6V takes unit F2,integer id returns nothing
    local real therange=0
    local real therange2=0
    local location aim1=null
    if id<0 then
        return
    endif
    if LN!=id then
        set MN=false
        set LN=id
    endif
    if KN!=id then
        if QN!=null and RangeTo(F2,QN)<1000 then
            if RangeToLoc(F2,zs_firelines[KN])<=RangeToLoc(F2,zs_firelines[id])then
                set PN=KN
            else
                set KN=id
            endif
            set MN=false
        endif
        if RangeToLoc(F2,mEnemyBaseLoc)<4000 then
            call P2(KF)
        endif
        set therange=RangeLocToLoc(mBaseLoc,zs_firelines[id])
        set therange2=RangeToLoc(F2,mBaseLoc)
        if therange2<=therange then
            set aim1=GetLineLocByRangeFromBase(id,therange2)
            if P2(aim1)then
                set KN=id
                set MN=false
                set aim1=null
                return
            endif
        endif
        if therange2>therange then
            if not MN then
                set aim1=GetLineLocByRangeFromBase(KN,therange)
                if P2(aim1)then
                    set MN=true
                endif
            endif
            if MN and P2(zs_firelines[id])then
                set KN=id
                set MN=false
            endif
        endif
    endif
    set aim1=null
endfunction

function C7V takes nothing returns nothing
    local unit C8V=null
    local location C9V=null
    local location tmp=null
    local unit DVV=null
    local unit DEV=null
    local unit DXV=null
    local unit F2=null
    local integer DOV=0
    local integer DRV=0
    local integer DIV=0
    local unit DAV=null
    if NG<1 then
        return
    endif
    set YD=W1(zs_toushiche_group)
    set YD=YD+W1(VF)
    if YD<1 then
        return
    endif
    call J2()
    set F2=FirstOfGroup(zs_toushiche_group)
    if F2!=null then
        call AVV(F2)
        set EJ=null
        set XJ=null
        set OJ=null
        set C8V=G3(F2,1200,true)
        if EJ!=null then
            set DAV=EJ
        endif
        if OJ!=null then
            set DAV=OJ
        endif
        if XJ!=null and DQ(F2,XJ)then
            set DAV=XJ
        endif
        if C8V==null then
            set DOV=1
        endif
        if C8V!=null then
            set DOV=2
        endif
        set DVV=GetEnemyWeakestBubingNearHero(F2,1600,false)
        if DVV!=null and GetHP(DVV)<260 then
            set DOV=3
        endif
        set DXV=GetNearestEnemyImportantStructs(F2,1300,false)
        if DXV!=null and AS()>10*60 then
            set DOV=4
        endif
        if DVV!=null and isZhongLiEnemy(DVV)then
            set DOV=5
        endif
        if HeroD!=null and IsAlive(HeroD)and RangeTo(HeroD,F2)<1100 then
            set DOV=6
        endif
        if DAV!=null then
            set DOV=61
        endif
        set DEV=GetNearestEnemyTower(F2,1800)
        if DEV!=null and AS()>10*60 then
            set DOV=7
        endif
        if C8V!=null and RangeTo(C8V,F2)<900 then
            set DOV=8
        endif
        if KN!=zs_cr_fightline and NS()>12*60 and zs_IsTimeOut(56,10)and zs_cr_fightline<100 then
            set PN=zs_cr_fightline
        endif
        if PN!=KN then
            set DOV=9
        endif
        set QN=D6(F2)
        set DRV=K6(F2,1300)
        set DIV=L6(F2,1000)
        if(DRV-DIV>1)or(DRV==0 and DRV>0 and GetHeroLevel(QN)>10)then
            set DOV=8
        endif
        if DOV==1 then
            call GroupPointOrderByIdLoc(zs_toushiche_group,851983,JF)
        endif
        if DOV==2 then
            set C9V=GetUnitLoc(F2)
            call GroupPointOrderByIdLoc(zs_toushiche_group,851986,C9V)
            call RemoveLocation(C9V)
            set C9V=null
        endif
        if DOV==3 then
            call GroupTargetOrderById(zs_toushiche_group,851983,DVV)
        endif
        if DOV==4 then
            call GroupTargetOrderById(zs_toushiche_group,851983,DXV)
        endif
        if DOV==5 then
            call GroupTargetOrderById(zs_toushiche_group,851983,DVV)
        endif
        if DOV==6 then
            set tmp=GetUnitLoc(HeroD)
            call GroupPointOrderByIdLoc(zs_toushiche_group,851984,tmp)
            call RemoveLocation(tmp)
            set tmp=null
        endif
        if DOV==61 then
            call GroupTargetOrderById(zs_toushiche_group,851983,DAV)
        endif
        if DOV==7 then
            set tmp=GetUnitLoc(DEV)
            call GroupPointOrderByIdLoc(zs_toushiche_group,851984,tmp)
            call RemoveLocation(tmp)
            set tmp=null
        endif
        if DOV==8 then
            call GroupPointOrderByIdLoc(zs_toushiche_group,851986,KF)
        endif
        if DOV==9 then
            call C6V(F2,PN)
        endif
        set XG=DOV
    endif
    if zs_IsTimeOut(53,3)then
        if iscaoren()then
        endif
        if isZhuGeLiang()then
        endif
    endif
    set C8V=null
    set C9V=null
    set tmp=null
    set DVV=null
    set DEV=null
    set DXV=null
    set F2=null
endfunction

function inittimearry takes nothing returns nothing
    local integer i=0
    loop
        exitwhen i==100
        set zs_ElapsedTime[i]=-1
        set i=i+1
    endloop
endfunction

function DBV takes nothing returns nothing
    if mHero==null then
        return
    endif
    if zs_IsTimeOut(51,3)then
        if mHero==null or IsDead(mHero)then
            set DI=false
            set CI=0
            return
        endif
        if DI then
            call AYV()
            return
        endif
        if BI==null then
            set BI=GetUnitLoc(mHero)
            return
        endif
        if BI!=null then
            if RangeToLoc(mHero,BI)<100 and(GetUnitCurrentOrder(mHero)!=851983and zs_prioty_index!=80 and zs_prioty_index!=81)then
                set CI=CI+1
            else
                set CI=0
                call RemoveLocation(BI)
                set BI=null
                set BI=GetUnitLoc(mHero)
            endif
        endif
        if CI>8 then
            set CI=0
            set DI=true
        endif
    endif
endfunction

function RunOnceEveryDueTime takes nothing returns nothing
    local integer DDV=-1
    local boolean DFV=false
    call StoreInteger(zs_gamecache2,"maintimer","1",AK(zs_timer1))
    call TimerStart(zs_timer1,999999,true,null)
    call inittimearry()
    loop
        if zs_IsTimeOut(0,.06)then
            call handleCommands()
        endif
        if zs_CCPlayerID>-1 then
            if zs_IsTimeOut(7,1.3)then
                call C7V()
            endif
        endif
        call DBV()
        if mHero!=null and IsAlive(mHero)then
            if zs_IsTimeOut(1,.1)then
                call RefreshParam2()
            endif
            set GR=false
            if rangeToTowerD<BV and(FarestAllyBubingFromRetreatLoc==null or(FarestAllyBubingFromRetreatLoc!=null and RangeTo(FarestAllyBubingFromRetreatLoc,TowerD)>600))then
                set GR=true
            endif
            if IsStunned(HeroD)then
                set GR=true
            endif
            if GR and zs_action_prioty_arry[zs_prioty_index]<80 then
                if zs_IsTimeOut(2,.9)then
                    set FR=3
                    set MG=3
                endif
            endif
            if zs_IsTimeOut(3,MC)then
                call setSecondsOfUnitsAlly()
                call setSecondsOfUnitsEnemy()
                call CLV()
            endif
            if zs_IsTimeOut(4,.2)then
                call setLowestAllyLifeBing()
                call setLowestEnemyLifeBing()
                call CLV()
            endif
            if zs_IsTimeOut(5,3)then
            endif
            if((ED==6 or ED==8)and zs_action_prioty_arry[zs_prioty_index]<50)then
                if zs_IsTimeOut(8,.1)then
                    set FR=3
                    set MG=3
                    if isZhuGeLiang()then
                        if ED==6 or ED==8 then
                        endif
                    endif
                endif
            endif
            if zs_IsTimeOut(9,.8)then
                if(ED>0 and zs_action_prioty_arry[zs_prioty_index]<43)then
                    set FR=3
                    set MG=3
                endif
            endif
        endif
        if zs_IsTimeOut(10,.98)then
        endif
        if HeroD!=null and HG>0 and JG>=HG and RangeTo(mHero,HeroD)<=HG then
            if zs_IsTimeOut(11,.8)then
                set FR=3
                set MG=3
                set JG=HG-100
            endif
        endif
        if HeroD!=null then
            set DDV=A2(HeroD,LG)
            if DDV>0 then
                if zs_IsTimeOut(14,.8)then
                    set FR=3
                    set MG=3
                    set LG=DDV-100
                endif
            endif
        endif
        if HeroD!=null then
            if zs_IsTimeOut(12,.2)then
                if RangeTo(mHero,HeroD)>HG then
                    set JG=999999
                endif
            endif
            if zs_IsTimeOut(15,.2)then
                if RangeTo(mHero,HeroD)>DDV then
                    set LG=999999
                endif
            endif
        endif
        if zs_IsTimeOut(13,2.6)then
            if HeroD!=null and IsJuFeng(mHero)and can_UseFengZhang(mHero)then
                set DFV=true
            endif
        endif
        if HeroD!=null and DFV then
            if not IsJuFeng(mHero)then
                set DFV=false
                if RangeTo(HeroD,mHero)<620 and GetMP(HeroD)>300 then
                    call XGV(HeroD)
                    call HeroRetreat(1000)
                endif
            endif
        endif
        if DFV then
            call Sleep(.005)
        else
            call Sleep(.05)
        endif
    endloop
endfunction

function DGV takes unit TheUnit,integer DHV returns integer
    local integer i1=61-25
    local integer i2=61-25
    local integer i3=10
    local integer DJV
    local player ThePlayer=GetOwningPlayer(TheUnit)
    local mapcontrol DKV=GetPlayerController(ThePlayer)
    local integer AbilLvl
    local integer DLV=DHV
    local integer count=0
    local integer flag=0
    call SetPlayerController(ThePlayer,MAP_CONTROL_USER)
    call SetHeroLevel(TheUnit,100,false)
    loop
        exitwhen(i3>61)
        set DJV=16640
        if i3>35 then
            set DJV=DJV+(i3+61)
        elseif i3>9 then
            set DJV=DJV+(i3+55)
        else
            set DJV=DJV+(i3+48)
        endif
        set DJV=DJV*256
        if i2>35 then
            set DJV=DJV+(i2+61)
        elseif i2>9 then
            set DJV=DJV+(i2+55)
        else
            set DJV=DJV+(i2+48)
        endif
        set DJV=DJV*256
        if i1>35 then
            set DJV=DJV+(i1+61)
        elseif i1>9 then
            set DJV=DJV+(i1+55)
        else
            set DJV=DJV+(i1+48)
        endif
        if flag==0 then
            set flag=DJV
        endif
        if TY(TheUnit,DJV)then
            call KS(GetUnitTypeId(TheUnit),DLV,DJV)
            set DLV=DLV+1
        endif
        set count=count+1
        set i1=i1+1
        if i1>61 then
            set i2=i2+1
            set i1=61-25
        endif
        if i2>61 then
            set i3=i3+1
            set i2=61-25
        endif
    endloop
    call SetPlayerController(ThePlayer,DKV)
    return DLV
endfunction

function DMV takes unit TheUnit returns integer
    local integer i1=0
    local integer i2=0
    local integer i3=0
    local integer DJV
    local player ThePlayer=GetOwningPlayer(TheUnit)
    local mapcontrol DKV=GetPlayerController(ThePlayer)
    local integer AbilLvl
    local integer DLV=0
    local integer count=0
    call SetPlayerController(ThePlayer,MAP_CONTROL_USER)
    call SetHeroLevel(TheUnit,100,false)
    loop
        exitwhen(i2>11)
        set DJV=16640
        if i3>35 then
            set DJV=DJV+(i3+61)
        elseif i3>9 then
            set DJV=DJV+(i3+55)
        else
            set DJV=DJV+(i3+48)
        endif
        set DJV=DJV*256
        if i2>35 then
            set DJV=DJV+(i2+61)
        elseif i2>9 then
            set DJV=DJV+(i2+55)
        else
            set DJV=DJV+(i2+48)
        endif
        set DJV=DJV*256
        if i1>35 then
            set DJV=DJV+(i1+61)
        elseif i1>9 then
            set DJV=DJV+(i1+55)
        else
            set DJV=DJV+(i1+48)
        endif
        if TY(TheUnit,DJV)then
            call KS(GetUnitTypeId(TheUnit),DLV,DJV)
            set DLV=DLV+1
        endif
        set count=count+1
        set i1=i1+1
        if i1>61 then
            set i2=i2+1
            set i1=0
        endif
        if i2>61 then
            set i3=i3+1
            set i2=0
        endif
    endloop
    call SetPlayerController(ThePlayer,DKV)
    return DLV
endfunction

function DYV takes nothing returns nothing
    local real r1=0
    local unit u=null
    local integer DZV=0
    local integer D_V
    call Sleep(25)
    set D_V=GetUnitTypeId(mHero)
    if mHero==null then
        call Sleep(10)
        set D_V=GetUnitTypeId(mHero)
    endif
    if GG then
        return
    endif
    if D_V<1 then
        return
    endif
    if TS(D_V)>0 then
        return
    endif
    set u=CreateUnit(Player(12),D_V,hiddenX,hiddenY+2100,180)
    set r1=NS()
    if zs_gamecache2==null then
        call debugstr("zs_ucacheCommon==null")
    endif
    set DZV=DMV(u)
    if DZV<4 then
        set DZV=DGV(u,DZV)
    endif
    call QS(GetUnitTypeId(u),DZV)
    call RemoveUnit(u)
    set u=null
endfunction

function main takes nothing returns nothing
    local integer i
    local integer command
    local integer data
    local unit utmp
    local integer ADV
    local integer AFV
    local unit C0V
    local unit u
    local group NearestEnemyBubing
    local integer AAV
    set i=0
    set command=-1
    set data=-1
    set utmp=null
    set ADV=0
    set AFV=0
    loop
        exitwhen CommandsWaiting()==0 or GetLastCommand()<1
        set command=GetLastCommand()
        set data=GetLastData()
        if command==1000 and data>-1 and data<16 then
            set utmp=getfirstHeroOfPlayer(Player(data))
            if ControlHero(utmp)then
                call DisplayToAll("电脑控制成功!")
            else
                call DisplayToAll("电脑控制失败!!")
            endif
            set utmp=null
        endif
        if command==1001 then
            call ReleaseHero(data)
        endif
        if command==2000 and data>0 then
        endif
        if command==2001 then
        endif
        if command==3000 then
            set zs_FirelocShanglu[0]=data
        endif
        if command==3001 then
            set zs_FirelocShanglu[1]=data
        endif
        if command==3002 then
            set zs_FirelocZhonglu[0]=data
        endif
        if command==3003 then
            set zs_FirelocZhonglu[1]=data
        endif
        if command==3004 then
            set zs_FirelocXialu[0]=data
        endif
        if command==3005 then
            set zs_FirelocXialu[1]=data
        endif
        if command==4000 then
            set LD=true
            call DisplayToAll("帮助中路英雄开启!")
        endif
        if command==4001 then
            set LD=false
            if isZhuGeLiang()or isSiMaYi()then
                set zs_cr_fightline=1
                set HN=1
                set SA=true
                set GG=true
            endif
            if isZhuGeLiang()or isguojia()then
                set NG=0    //不买车
            endif
            if iszhaoyun()or isdadi()or iscaoren()then
                set zs_cr_fightline=2
                set HN=1
                set NG=0
                set GG=true
            endif
            if isweiyan()or isxun()or isdianwei()or iszhangliao()then
                set zs_cr_fightline=2
                set HN=1
                set GG=true
            endif
            if isguanyu()or iszhangfei()then
                set zs_cr_fightline=0
                set HN=1
                set GG=true
            endif
            if isguojia()or iscaoren()then
                set zs_cr_fightline=0
                set HN=1
                set GG=true
            endif
            if ismadai()or iszhanghe()or isgongben()or issunquan()then
                set GG=true
            endif
            if XH or quanZheYingMoShi then
                if FG==0 or FG==1 then
                    if CS("zhongehc"+ITS(mForceId))==0 then
                        set zs_cr_fightline=1
                        set HN=1
                        set NG=0
                        call BS("zhongehc"+ITS(mForceId),1)
                        set AJ=true
                    endif
                endif
                if not AJ then
                    if CS("shanghc"+ITS(mForceId))<2 then
                        set zs_cr_fightline=1
                        set HN=1
                        call BS("shanghc"+ITS(mForceId),1+CS("shanghc"+ITS(mForceId)))
                        set AJ=true
                    endif
                endif
                if not AJ then
                    if CS("xiahc"+ITS(mForceId))<2 then
                        set zs_cr_fightline=1
                        set HN=1
                        call BS("xiahc"+ITS(mForceId),1+CS("xiahc"+ITS(mForceId)))
                        set AJ=true
                    endif
                endif
                if not AJ then
                    if CS("zhongehc"+ITS(mForceId))==0 then
                        set zs_cr_fightline=1
                        set HN=1
                        set NG=0
                        call BS("zhongehc"+ITS(mForceId),1)
                        set AJ=true
                    endif
                endif
            endif
            if HN==1 then
                set SA=true
            endif
            set PN=HN
            call DisplayToAll("帮助中路英雄关闭!")
        endif
        if command==4002 then
            set IG=true
            set canBuyFireCar=false
            call DisplayToAll("中法1v1开启!")
        endif
        if command==4003 then
            set IG=false
            call DisplayToAll("中法1v1关闭!")
        endif
        if command==4004 then
            set canBuyFireCar=false
            call DisplayToAll("禁止出车!")
        endif
        if command==4005 then
            set canBuyFireCar=true
            call DisplayToAll("允许出车!")
        endif
        if command==4006 then
            set quanZheYingMoShi=true
			set zhuLiMoShi=false
        endif
        if command==4007 then
            set zhuLiMoShi=true
			set quanZheYingMoShi=false
            call DisplayToAll("真三主力英雄模式开启！")
        endif
        if command==5000 then
        endif
        if mHero!=null and IsAlive(mHero)then
            if command==6000 then
                set PG=NK(data)
            endif
            if command==6001 then
                set QG=NK(data)
            endif
            if command==6004 then
                set SG=BK(data)
            endif
            if command==6005 then
                set UG=data
            endif
            if command==6006 then
                set WG=data
                set AAV=0
                set GR=false
                if W6()then
                    set GR=true
                endif
                if Y6()then
                    set GR=true
                endif
                if GR and not IsImmune(mHero)then
                    set FR=3
                    set MG=3
                endif
            endif
        endif
        if command==6200 then
            call Sleep(.1)
            set XH=true
            set FR=1
            call getfirstHero()
        endif
        if command==6300 then
            set ADV=data
        endif
        if command==6301 then
            set AFV=data
        endif
        if command==6302 then
            if(mForceId==1 and data<=5)or(mForceId==2 and data>=6)then
                if ADV!=0 and AFV!=0 then
                    if WH!=null then
                        call RemoveLocation(WH)
                        set WH=null
                    endif
                    if isdebug then
                    endif
                    set WH=Location(ADV,AFV)
                    if AO!=101 and AO!=102 then
                        set AO=103
                        set zs_firelines[103]=WH
                    endif
                endif
            endif
        endif
        if command>=3000 and command<=3100 then
        endif
        call PopLastCommand()
        set i=i+1
    endloop
    set ai_player=Player(GetAiPlayer())
    if GetPlayerId(ai_player)==0 or GetPlayerId(ai_player)==6 then
        set zs_CCPlayerID=-1
    else
        set zs_CCPlayerID=GetPlayerId(ai_player)
    endif
    set C0V=null
    set mForceId=getForceId()
    set zs_player_index=GetPlayerId(ai_player)
    call adjustBaseLoc()
    if mForceId==1 then
        set zs_path_middle[0]=suguoBaseLoc
        set zs_path_middle[1]=Location(-4752,-5782)
        set zs_path_middle[2]=Location(-3300,-4100)
        set zs_path_middle[3]=Location(-2000,-2300)
        set zs_path_middle[4]=Location(-600,-350)
        set zs_path_middle[5]=Location(430,1000)
        set zs_path_middle[6]=Location(2000,2400)
        set zs_path_middle[7]=Location(3700,4300)
        set zs_path_middle[8]=Location(5400,5300)
        set zs_path_middle[9]=weiguoBaseLoc
        set zs_path_shanglu[0]=suguoBaseLoc
        set zs_path_shanglu[1]=Location(-6500,-4600)
        set zs_path_shanglu[2]=Location(-6200,-2000)
        set zs_path_shanglu[3]=Location(-6000,480)
        set zs_path_shanglu[4]=Location(-5900,2555)
        set zs_path_shanglu[5]=Location(-5500,5700)
        set zs_path_shanglu[6]=Location(-3500,6000)
        set zs_path_shanglu[7]=Location(-400,6000)
        set zs_path_shanglu[8]=Location(3300,5800)
        set zs_path_shanglu[9]=Location(5500,5500)
        set zs_path_shanglu[10]=weiguoBaseLoc
        set zs_path_xialu[0]=suguoBaseLoc
        set zs_path_xialu[1]=Location(-3300,-7000)
        set zs_path_xialu[2]=Location(-700,-6888)
        set zs_path_xialu[3]=Location(2000,-6900)
        set zs_path_xialu[4]=Location(5000,-6600)
        set zs_path_xialu[5]=Location(5500,-3000)
        set zs_path_xialu[6]=Location(5700,-690)
        set zs_path_xialu[7]=Location(5500,1390)
        set zs_path_xialu[8]=Location(5500,3700)
        set zs_path_xialu[9]=weiguoBaseLoc
    endif
    if mForceId==2 then
        set zs_path_middle[9]=suguoBaseLoc
        set zs_path_middle[8]=Location(-4752,-5782)
        set zs_path_middle[7]=Location(-3300,-4100)
        set zs_path_middle[6]=Location(-2000,-2300)
        set zs_path_middle[5]=Location(-600,-350)
        set zs_path_middle[4]=Location(430,1000)
        set zs_path_middle[3]=Location(2000,2400)
        set zs_path_middle[2]=Location(3700,4300)
        set zs_path_middle[1]=Location(5400,5300)
        set zs_path_middle[0]=weiguoBaseLoc
        set zs_path_shanglu[10]=suguoBaseLoc
        set zs_path_shanglu[9]=Location(-6500,-4600)
        set zs_path_shanglu[8]=Location(-6200,-2000)
        set zs_path_shanglu[7]=Location(-6000,480)
        set zs_path_shanglu[6]=Location(-5900,2555)
        set zs_path_shanglu[5]=Location(-5500,5700)
        set zs_path_shanglu[4]=Location(-3500,6000)
        set zs_path_shanglu[3]=Location(-400,6000)
        set zs_path_shanglu[2]=Location(3300,5800)
        set zs_path_shanglu[1]=Location(5500,5500)
        set zs_path_shanglu[0]=weiguoBaseLoc
        set zs_path_xialu[9]=suguoBaseLoc
        set zs_path_xialu[8]=Location(-3300,-7000)
        set zs_path_xialu[7]=Location(-700,-6888)
        set zs_path_xialu[6]=Location(2000,-6900)
        set zs_path_xialu[5]=Location(5000,-6600)
        set zs_path_xialu[4]=Location(5500,-3000)
        set zs_path_xialu[3]=Location(5700,-690)
        set zs_path_xialu[2]=Location(5500,1390)
        set zs_path_xialu[1]=Location(5500,3700)
        set zs_path_xialu[0]=weiguoBaseLoc
    endif
    set mdubingLoc=getDuBingLoc()
    set mBaseLoc=getBaseLoc()
    set mEnemyBaseLoc=getEnemyBaseLoc()
    set ON=GetLocBetweenTwoLocsRangeToFirst(zs_He_middle,mBaseLoc,-800)
    set digit_str[0]="0"
    set digit_str[1]="1"
    set digit_str[2]="2"
    set digit_str[3]="3"
    set digit_str[4]="4"
    set digit_str[5]="5"
    set digit_str[6]="6"
    set digit_str[7]="7"
    set digit_str[8]="8"
    set digit_str[9]="9"
    set zs_itemID1[0]=iid_mengdeshu
    set zs_itemID2[0]=iid_mengdeshu
    set zs_itemID1[1]=iid_qingnangshu
    set zs_itemID2[1]=iid_qingnangshu
    set zs_itemID1[2]='sneg'
    set zs_itemID2[2]='sneg'
    set zs_itemID1[3]=iid_tuimodao
    set zs_itemID2[3]=iid_tuimodao
    set zs_itemID1[4]='pclr'
    set zs_itemID2[4]='pclr'
    set zs_itemID1[5]='hslv'
    set zs_itemID2[5]='hslv'
    call U2('A04W',1,15,100,0,852127)
    call U2('A04W',2,15,100,0,852127)
    call U2('A04W',3,15,100,0,852127)
    call U2('A04W',4,15,100,0,852127)
    call U2('A009',1,35,70,0,852100)
    call U2('A009',2,35,90,0,852100)
    call U2('A009',3,35,110,0,852100)
    call U2('A009',4,35,130,0,852100)
    call U2(aid_xiahouyuan_huixuanzhan,1,10,100,0,852128)
    call U2(aid_xiahouyuan_huixuanzhan,2,10,105,0,852128)
    call U2(aid_xiahouyuan_huixuanzhan,3,10,110,0,852128)
    call U2(aid_xiahouyuan_huixuanzhan,4,10,115,0,852128)
    call U2(aid_sunquan_fandongjian,1,11,90,0,852100)
    call U2(aid_sunquan_fandongjian,2,11,95,0,852100)
    call U2(aid_sunquan_fandongjian,3,11,100,0,852100)
    call U2(aid_sunquan_fandongjian,4,11,105,0,852100)
    call U2('A006',1,170,150,0,852086)
    call U2('A006',2,170,185,0,852086)
    call U2('A006',3,170,235,0,852086)
    call U2('A00A',1,130,150,0,852128)
    call U2('A00A',2,130,180,0,852128)
    call U2('A00A',3,130,210,0,852128)
    call U2('A02V',1,170,350,0,852128)
    call U2('A02V',2,170,350,0,852128)
    call U2('A02V',3,170,350,0,852128)
    call U2(iid_sunzibingfa,1,61,140,0,0)
    call U2(iid_xuanwufu,1,92,100,0,0)
    call U2(iid_qingnangshu,1,41,150,0,0)
    call U2(iid_mengdeshu,1,41,145,800,0)
    call U2(iid_wushuquanzhang,1,24,110,600,0)
    call U2(iid_bingjinyushan,1,180,300,0,0)
    if mForceId==1 then
        if GetPlayerId(ai_player)==5 then
        endif
    endif
    if mForceId==2 then
        set zs_dubingParam=189
        if GetPlayerId(ai_player)==11 then
        endif
    endif
    call getfirstHero()
    set C0V=null
    call StartThread(function RunOnceEveryDueTime)
    if GetPlayerId(ai_player)==5 then
    endif
    if GetStoredInteger(zs_gamecache,"heros","1")<1 then
        call StoreInteger(zs_gamecache,"heros","1",hid_zhugeliang)
        call StoreInteger(zs_gamecache,"heros","2",hid_simayi)
        call StoreInteger(zs_gamecache,"heros","3",hid_guojia)
        call StoreInteger(zs_gamecache,"heros","4",hid_xun)		
		// call StoreInteger(zs_gamecache,"heros","2",hid_guanyu)
		// call StoreInteger(zs_gamecache,"heros","3",hid_zhangfei)
        // call StoreInteger(zs_gamecache,"heros","4",hid_weiyan)
        // call StoreInteger(zs_gamecache,"heros","5",hid_zhaoyun)
        // call StoreInteger(zs_gamecache,"heros","6",hid_dadi)
        // call StoreInteger(zs_gamecache,"heros","2",hid_simayi)
        // call StoreInteger(zs_gamecache,"heros","3",hid_guojia)
        // call StoreInteger(zs_gamecache,"heros","9",hid_caoren)
        // call StoreInteger(zs_gamecache,"heros","10",hid_dianwei)
        // call StoreInteger(zs_gamecache,"heros","4",hid_xun)
        // call StoreInteger(zs_gamecache,"heros","12",hid_zhangliao)
        // call StoreInteger(zs_gamecache,"heros","13",hid_madai)
        // call StoreInteger(zs_gamecache,"heros","14",hid_zhanghe)
        // call StoreInteger(zs_gamecache,"heros","15",hid_gongben)
        // call StoreInteger(zs_gamecache,"heros","16",hid_sunquan)
    endif
    call StartThread(function mainLoop)
    call Sleep(2)
    set u=null
    set NearestEnemyBubing=CreateGroup()
    call GroupEnumUnitsInRange(NearestEnemyBubing,0,0,999999,null)
    loop
        set u=FirstOfGroup(NearestEnemyBubing)
        exitwhen u==null
        if IsAlive(u)then
            if IsUnitAlly(u,ai_player)then
                if GetUnitTypeId(u)==uid_benzhen then
                    set GF=u
                endif
                if GetUnitTypeId(u)==uid_liangcang then
                    set AF=u
                endif
                if GetUnitTypeId(u)==uid_judian and isUnitInShanglu(u)then
                    set zs_judianw[0]=u
                endif
                if GetUnitTypeId(u)==uid_judian and isUnitInXiaLu(u)then
                    set zs_judianw[2]=u
                endif
                if GetUnitTypeId(u)==uid_bingying and isUnitInShanglu(u)then
                    set IF[0]=u
                    set CF[0]=GetUnitLoc(u)
                endif
                if GetUnitTypeId(u)==uid_bingying and isUnitInMiddleLine(u)then
                    set IF[1]=u
                    set CF[1]=GetUnitLoc(u)
                endif
                if GetUnitTypeId(u)==uid_bingying and isUnitInXiaLu(u)then
                    set IF[2]=u
                    set CF[2]=GetUnitLoc(u)
                endif
            endif
            if GetUnitTypeId(u)==uid_zhonglishangdian then
                set UH=u
            endif
            if IsUnitEnemy(u,ai_player)then
                if GetUnitTypeId(u)==uid_dragon then
                    set SH=u
                    set TH=GetUnitLoc(SH)
                endif
                if GetUnitTypeId(u)==uid_benzhen then
                    set HF=u
                endif
                if GetUnitTypeId(u)==uid_liangcang then
                    set NF=u
                    set TG=GetUnitLoc(NF)
                endif
                if GetUnitTypeId(u)==uid_judian and isUnitInShanglu(u)then
                    set RF[0]=u
                endif
                if GetUnitTypeId(u)==uid_judian and isUnitInXiaLu(u)then
                    set RF[2]=u
                endif
                if GetUnitTypeId(u)==uid_bingying and isUnitInShanglu(u)then
                    set DF[0]=u
                    set FF[0]=GetUnitLoc(u)
                endif
                if GetUnitTypeId(u)==uid_bingying and isUnitInMiddleLine(u)then
                    set DF[1]=u
                    set FF[1]=GetUnitLoc(u)
                endif
                if GetUnitTypeId(u)==uid_bingying and isUnitInXiaLu(u)then
                    set DF[2]=u
                    set FF[2]=GetUnitLoc(u)
                endif
            endif
        endif
        call GroupRemoveUnit(NearestEnemyBubing,u)
    endloop
    call DestroyGroup(NearestEnemyBubing)
    set NearestEnemyBubing=null
    set zs_firelines[101]=TG
    set zs_firelines[102]=TH
    call DYV()
endfunction